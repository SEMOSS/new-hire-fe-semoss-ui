<!-- Backdrop -->
<div ng-click="related.hideRelated()" class="related-panel-backdrop"></div>

<div class="related-panel-wrapper border-radius">
    <div class="sm-margin xs-vert-margin border-radius">
        <!-- <div class="input-group full-width">
            <!-- Search Input Field --
            <input type="text"
                   ng-model="related.filterInput" placeholder="Filter results here"
                   class="form-control" aria-label="..."
                   style="border-radius: 3px;">
            <i class="fa fa-times pointer" ng-if="!related.isEmpty(related.searchInput)"
               ng-click="related.resetSearch()"
               style="position: absolute; top: 10px; right: 45px; color: #444; z-index: 3"></i>
            <div class="input-group-btn" ng-click="toggleSearch=!toggleSearch">
                <button class="btn btn-default search-bar-height" ng-click="related.searchInsightData(related.searchInput)">
                    <i class="fa fa-search pointer"></i>
                </button>
            </div>
        </div> -->
        <span>Displaying insights related to: </span><span class="bold" ng-bind="related.selectedConcept"></span>
    </div>
    <!-- Visualization Facets -->
    <div class="border xs-margin border-radius">
        <div class="xs-padding sm-font border-bottom">
            <a class="related-panel-icons-list"
               ng-repeat="option in related.vizFacetList"
               ng-class="{'selected': option.selected}"
               ng-click="option.selected = !option.selected; related.vizLayoutFacetSelected(option);"
               title="{{option.label | replaceUnderscores}}">
               <img class="related-panel-icon pointer" ng-src="{{related.getVizSvg(option.label)}}" alt="{{related.getVizSvg(option.label)}}">
            </a>
            <a ng-click="related.showFacetPane()" class="pointer">More</a>
        </div>
        <!-- Facets Pane (Databases, Tags) -->
        <div class="related-facets-pane" ng-show="related.showFacets">
            <div class="search-facet-wrapper pull-left border-right">
                <div class="sm-padding">
                    <span class="text-header">
                        Databases
                    </span>
                    <a ng-click="related.clearSelectedFacets('core_engine')" class="pointer pull-right"
                       ng-if="related.filterData.core_engine">
                        Clear
                    </a>
                </div>
                <div class="search-facet-select-pane border-top overflow-auto">
                    <div ng-repeat="option in related.facetOptions.core_engine.list track by $index">
                        <!-- Repeat for Each Selectable Facet Option -->
                        <div class="sm-left-margin sm-font">
                            <input type="checkbox" ng-model="option.selected"
                                   class="search-checkbox-align pointer"
                                   ng-click="related.facetSelected(option);"/>
                            <label class="pointer" style="font-weight:100;"
                                   title="{{option.label | replaceUnderscores}}"
                                   ng-class="{'bold': option.selected}"
                                   ng-click="$event.preventDefault(); option.selected = !option.selected; related.facetSelected(option);">
                                {{option.label | replaceUnderscores | reduceStringLength : 11}}
                                ({{option.count}})
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="search-facet-wrapper pull-right">
                <div class="sm-padding">
                    <span class="text-header">
                        Tags
                    </span>
                    <a ng-click="related.clearSelectedFacets('tags')" class="pointer pull-right"
                       ng-if="related.filterData.tags">
                        Clear
                    </a>
                </div>
                <div class="search-facet-select-pane border-top overflow-auto">
                    <div ng-repeat="option in related.facetOptions.tags.list track by $index">
                        <!-- Repeat for Each Selectable Facet Option -->
                        <div class="sm-left-margin sm-font">
                            <input type="checkbox" ng-model="option.selected"
                                   class="search-checkbox-align pointer"
                                   ng-click="related.facetSelected(option);"/>
                            <label class="pointer" style="font-weight:100;"
                                   title="{{option.label | replaceUnderscores}}"
                                   alt="{{option.label | replaceUnderscores}}"
                                   ng-class="{'bold': option.selected}"
                                   ng-click="$event.preventDefault(); option.selected = !option.selected; related.facetSelected(option);">
                                {{option.label | replaceUnderscores | reduceStringLength : 11}}
                                ({{option.count}})
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Insight Results Pane -->
    <div class="related-insight-wrapper border-top"
         ng-class="{'facets-shown': related.showFacets, 'search-viz-1': related.facetOptions.layout.list.length < 6}">
        <ul class="full-width search-results-list" infinite-scroll="related.getMoreRelatedInsights()"
            infinite-scroll-distance="0.2" infinite-scroll-use-document-bottom="false"
            infinite-scroll-immediate-check="false" infinite-scroll-container="'.related-insight-wrapper'">
            <li ng-repeat="insight in related.insightResults track by $index"
                class="search-results-list-item xs-padding"
                title="{{insight.name}}"
                ng-keydown="related.handleResultKeyPress($event)"
                id="relatedResult{{::$index}}"
                ng-click="related.createViz(insight)">

                <div class="search-results-list-img" 
                     ng-class="{'disabled': related.getVizDisabledStatus(insight.layout)}">
                    <img class="search-icon-repeat" ng-src="{{related.getVizSvg(insight.layout)}}" alt="{{related.getVizSvg(insight.layout)}}">
                </div>

                <div class="inline smss-txt xssm-padding xs-vert-padding"                     
                     ng-class="{'disabled': related.getVizDisabledStatus(insight.layout)}">
                    <div>
                        {{insight.name | replaceUnderscores | reduceStringLength: 70}}
                        <button type="button" class="btn btn-default btn-sm pull-right"
                                ng-disabled="related.disableRequest(insight.core_engine)"
                                ng-click="$event.stopPropagation(); related.addEngineAccessRequest({name: insight.core_engine})"
                                ng-show="!related.checkEnginePermission(insight.core_engine)">Request Access
                        </button>
                    </div>
                    <div class="sm-font color-gray">
                        <i class="fa fa-database"></i>
                        <span class="bold">{{insight.core_engine | replaceUnderscores}}</span>
                    </div>
                </div>
            </li>
            <!-- Loader -->
            <li ng-if="related.resultsPaneLoadingScreen" class="search-results-list-item loader xs-padding">
                <div>
                    <div class="search-load-spinner">
                        <img class="search-load-icon viz-pane-loader" src="resources/img/semoss-bw-spin.svg">
                    </div>
                </div>                
            </li>
        </ul>
    </div>

</div>
