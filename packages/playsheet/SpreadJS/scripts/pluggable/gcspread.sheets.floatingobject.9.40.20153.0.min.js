/*
 *
 * SpreadJS Library 9.40.20153.0
 *
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 *
 * Licensed under the SpreadJS Commercial License. 
 * spread.sales@grapecity.com
 * http://spread.grapecity.com/Pages/Spread-JS-License/
 *
 *
 **/
var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},GcSpread;(function(n){(function(n){var ri,wt,y,p,ft,c,bt,et,w;n.feature("floatingObject",["core.common","core.stringResource","core.sheet_action","core.imageLoader"]);var i=null,t=undefined,ui="string",fi="number",e=Math.ceil,s=Math.floor,l=Math.max,r=Math.min,u=Math.abs,ot="#044062",ei=0,h=1,oi=2,st=9007199254740992,kt=700,dt=701,b="position",k="absolute",ht="100%",ct="background",si="background-image",lt="floatingobject-selected",at="floatingobject-unselected",f="floatingobject-resize-indicator-select",d="floatingobject-resize-indicator-unSelect",o="no-user-select",a="floatingobject-content-container",gt="floatingobject-container",ni="floatingobject-moving-container",ti="floatingobject-moving-div",ii="floatingobject-background-cover",vt=".floatingobject-resize-indicator",g="div.floatingobject-resize-indicator.floatingobject-top.floatingobject-left",nt="div.floatingobject-resize-indicator.floatingobject-middle.floatingobject-left",tt="div.floatingobject-resize-indicator.floatingobject-bottom.floatingobject-left",yt="div.floatingobject-resize-indicator.floatingobject-top.floatingobject-center",pt="div.floatingobject-resize-indicator.floatingobject-bottom.floatingobject-center",it="div.floatingobject-resize-indicator.floatingobject-top.floatingobject-right",rt="div.floatingobject-resize-indicator.floatingobject-middle.floatingobject-right",ut="div.floatingobject-resize-indicator.floatingobject-bottom.floatingobject-right",hi="input",v=".gcFloatingObject";(function(n){n[n.CustomFloatingObject=0]="CustomFloatingObject";n[n.Picture=1]="Picture"})(n.FloatingObjectType||(n.FloatingObjectType={}));ri=n.FloatingObjectType;wt=function(r){function u(n){r.call(this);this._floatingObjectType=i;var t=this;t._sheet=n;t._bindEventsOnSheet()}return __extends(u,r),u.prototype.ownerSheet=function(n){return arguments.length===0?this._sheet:(this._sheet=n,this)},u.prototype.find=function(n){var t=this._findItemIndex(n);return t>=0?this[t]:i},u.prototype.replace=function(r,u){if(u===i||u===t)throw new Error(n.SR.Exp_ValueIsNull);var f=this._findItemIndex(r);f>=0&&this.splice(f,1,u)},u.prototype.add=function(r){var u=r.name();if(u===i||u===t)throw new Error(n.SR.Exp_FloatingObjectNameEmptyError);this._checkObjectExists(u);r.owner(this._sheet);this.push(r)},u.prototype.remove=function(n){if(n!==i&&n!==t){var r=this._findItemIndex(n.name());return r>=0&&n.owner(i),this.splice(r,1),!0}return!1},u.prototype.addRows=function(n,t){for(var i=0,r=this.length;i<r;i++)this[i].addRows(n,t)},u.prototype.removeRows=function(n,t){for(var u=this,e=[],r,i=0,f=u.length;i<f;i++)r=u[i],u._isCoverRange(n,-1,n+t-1,u._sheet.getColumnCount(),r)&&(r.dynamicMove()||r.dynamicSize())?e.push(r):r.removeRows(n,t);for(i=0,f=e.length;i<f;i++)u.remove(e[i])},u.prototype.addColumns=function(n,t){for(var i=0,r=this.length;i<r;i++)this[i].addColumns(n,t)},u.prototype.removeColumns=function(n,t){for(var u=this,e=[],r,i=0,f=u.length;i<f;i++)r=u[i],u._isCoverRange(-1,n,u._sheet.getRowCount(),n+t-1,r)&&(r.dynamicMove()||r.dynamicSize())?e.push(r):r.removeColumns(n,t);for(i=0,f=e.length;i<f;i++)u.remove(e[i])},u.prototype._isCoverRange=function(n,t,i,r,u){var f=u.startRow(),e=u.startColumn(),o=u.endRow(),s=u.endColumn();return n<=f&&t<=e&&i>=o&&r>=s},u.prototype._checkObjectExists=function(t){if(this._sheet._findFloatingObjectInternal(t))throw new Error(n.SR.Exp_FloatingObjectHasSameNameError);},u.prototype._findItemIndex=function(n){for(var i=this.length,t=0;t<i;t++)if(this[t].name()===n)return t;return-1},u.prototype._updateFloatingsObjectlayoutOnColumnRowChanged=function(){for(var n,t=0,i=this.length;t<i;t++)n=this[t],n.dynamicMove()?n._updateFloatingObjectLocation():n._updateStartPosition(),n.dynamicSize()?n._updateFloatingObjectSize():n._updateEndPosition()},u.prototype._bindEventsOnSheet=function(){var i=this,t=i._sheet;t&&(n.GC$(window.document.body).bind("scroll.gcSpread",function(){var n=t.parent.getActiveSheet(),i=n._render,r=n._floatingObjectArray;r&&r.length>0&&i&&i._paintFloatingObject(n.getBounds())}),t._bind(n.Events.ColumnChanged,function(n,t){var r=t.propertyName;(r==="width"||r==="isVisible")&&i._updateFloatingObjectsLayout()}),t._bind(n.Events.RowChanged,function(n,t){var r=t.propertyName;(r==="height"||r==="isVisible")&&i._updateFloatingObjectsLayout()}),t._bind(n.Events.ColumnWidthChanged,function(n,t){i._updateFloatingObjectsLayout()}),t._bind(n.Events.RowHeightChanged,function(n,t){i._updateFloatingObjectsLayout()}))},u.prototype.dispose=function(){n.GC$(window.document.body).unbind("scroll.gcSpread")},u.prototype._updateFloatingObjectsLayout=function(){var n=this,t=n._sheet,i=t._render;n.length>0&&(n.isNeedToUpdateLayout=!0,i&&i._paintFloatingObject(t.getBounds()))},u.prototype.toJSON=function(){var n=this,r,i;if(!n||n.length===0)return t;for(r=[],i=0;i<n.length;i++)n[i].typeName==="FloatingObject"&&r.push(n[i].toJSON());return r.length===0?t:r},u.prototype.fromJSON=function(n,t){var e=this,u,f,r,s,o;if(n&&n.length!==0)for(u=0;u<n.length;u++)f=n[u],r=i,f&&(s=e._getFloatingObjectTypes(),o=s[f.floatingObjectType],o&&(r=new o,r.owner(e._sheet),r.fromJSON(f,t),e.push(r)))},u.prototype._getFloatingObjectTypes=function(){if(!this._floatingObjectType){var n={};n[0]=p;n[1]=ft;this._floatingObjectType=n}return this._floatingObjectType},u}(n._XArray);n._FloatingObjectArray=wt;y=function(){function r(i,r,u,f,e){this._cacheOffset={startRowOffset:t,startColumnOffset:t,endRowOffset:t,endColumnOffset:t};this._isFOColumnsOrRowsVisible=!0;var o=this;o.typeName="FloatingObject";o._name=i;o._location=new n.Rect(typeof r=="number"?r:0,typeof u=="number"?u:0,typeof f=="number"?f:0,typeof e=="number"?e:0);o._canPrint=!0;o._isLocked=!0;o._isVisible=!0;o._isSelected=!1;o._dynamicMove=!0;o._dynamicSize=!0;o._fixedPosition=!1;o._allowMove=!0;o._allowResize=!0}return r.prototype.name=function(t){var i=this;if(arguments.length===0)return i._name;if(typeof t!="string"||t==="")throw new Error(n.SR.Exp_FloatingObjectNameEmptyError);if(i._name!==t){i._name=t;i.onPropertyChanged("name",t)}return i},r.prototype.owner=function(n){var t=this;return arguments.length===0?t._sheet:(t._sheet=n,t._updateFloatingObjectCoorinates(),t)},r.prototype.isSelected=function(n){var t=this,i=t._sheet;if(arguments.length===0)return t._isSelected;if(typeof n=="boolean"&&t._isSelected!==n){i?i._bindToAutoRefresh(function(n){t._isSelected=n})(n):t._isSelected=n;t.onPropertyChanged("isSelected",n)}return t},r.prototype.isLocked=function(n){var t=this;if(arguments.length===0)return t._isLocked;if(typeof n=="boolean"&&t._isLocked!==n){t._isLocked=n;t.onPropertyChanged("isLocked",n)}return t},r.prototype.canPrint=function(n){var t=this;if(arguments.length===0)return t._canPrint;if(typeof n=="boolean"&&t._canPrint!==n){t._canPrint=n;t.onPropertyChanged("canPrint",n)}return t},r.prototype.isVisible=function(n){var t=this,i=t._sheet;if(arguments.length===0)return t._isVisible;if(typeof n=="boolean"&&t._isVisible!==n){i?i._bindToAutoRefresh(function(n){t._isVisible=n})(n):t._isVisible=n;t.onPropertyChanged("visible",n)}return t},r.prototype.position=function(t){var i=this,r=i._sheet;if(arguments.length===0)return new n.Point(i._location.x,i._location.y);if(t instanceof n.Point&&(i._location.x!==t.x||i._location.y!==t.y)){r?r._bindToAutoRefresh(function(n){i._location.x=n.x;i._location.y=n.y;i._adjustPosition();i._updateCoverRange()})(t):(i._location.x=t.x,i._location.y=t.y);i.onPropertyChanged("position",t)}return i},r.prototype.height=function(n){var t=this,i=t._sheet;if(arguments.length===0)return t._location.height;if(typeof n=="number"&&t._location.height!==n){i?i._bindToAutoRefresh(function(n){t._location.height=n;t._adjustSize();t._adjustPosition();t._updateCoverRange()})(n):t._location.height=n;t.onPropertyChanged("height",n)}return t},r.prototype.width=function(n){var t=this,i=t._sheet;if(arguments.length===0)return t._location.width;if(typeof n=="number"&&t._location.width!==n){i?i._bindToAutoRefresh(function(n){t._location.width=n;t._adjustSize();t._adjustPosition();t._updateCoverRange()})(n):t._location.width=n;t.onPropertyChanged("width",n)}return t},r.prototype.startRow=function(n){var t=this;return arguments.length===0?t._startRow:(typeof n=="number"&&t._startRow!==n&&(n=e(n),t._sheet?t._sheet._bindToAutoRefresh(function(n){t._startRow=n;t._updateFloatingObjectLocation()})(n):t._startRow=n),t)},r.prototype.startRowOffset=function(n){var t=this;return arguments.length===0?t._startRowOffset:(typeof n=="number"&&t._startRowOffset!==n&&(t._sheet?t._sheet._bindToAutoRefresh(function(n){t._startRowOffset=n;t._updateFloatingObjectLocation()})(n):t._startRowOffset=n),t)},r.prototype.startColumn=function(n){var t=this;return arguments.length===0?t._startColumn:(typeof n=="number"&&t._startColumn!==n&&(n=e(n),t._sheet?t._sheet._bindToAutoRefresh(function(n){t._startColumn=n;t._updateFloatingObjectLocation()})(n):t._startColumn=n),t)},r.prototype.startColumnOffset=function(n){var t=this;return arguments.length===0?t._startColumnOffset:(typeof n=="number"&&t._startColumnOffset!==n&&(t._sheet?t._sheet._bindToAutoRefresh(function(n){t._startColumnOffset=n;t._updateFloatingObjectLocation()})(n):t._startColumnOffset=n),t)},r.prototype.endRow=function(n){var t=this;return arguments.length===0?t._endRow:(typeof n=="number"&&t._endRow!==n&&(t._sheet?t._sheet._bindToAutoRefresh(function(n){t._endRow=n;t._updateFloatingObjectSize()})(n):t._endRow=n),t)},r.prototype.endRowOffset=function(n){var t=this;return arguments.length===0?t._endRowOffset:(typeof n=="number"&&t._endRowOffset!==n&&(t._sheet?t._sheet._bindToAutoRefresh(function(n){t._endRowOffset=n;t._updateFloatingObjectSize()})(n):t._endRowOffset=n),t)},r.prototype.endColumn=function(n){var t=this;return arguments.length===0?t._endColumn:(typeof n=="number"&&t._endColumn!==n&&(n=e(n),t._sheet?t._sheet._bindToAutoRefresh(function(n){t._endColumn=n;t._updateFloatingObjectSize()})(n):t._endColumn=n),t)},r.prototype.endColumnOffset=function(n){var t=this;return arguments.length===0?t._endColumnOffset:(typeof n=="number"&&t._endColumnOffset!==n&&(t._sheet?t._sheet._bindToAutoRefresh(function(n){t._endColumnOffset=n;t._updateFloatingObjectSize()})(n):t._endColumnOffset=n),t)},r.prototype.dynamicMove=function(n){var t=this;if(arguments.length===0)return t._dynamicMove;if(typeof n=="boolean"&&t._dynamicMove!==n&&!t._fixedPosition){t._dynamicMove=n;n||(t._dynamicSize=!1);t.onPropertyChanged("dynamicMove",n)}return t},r.prototype.dynamicSize=function(n){var t=this;if(arguments.length===0)return t._dynamicSize;if(typeof n=="boolean"&&t._dynamicSize!==n&&!t._fixedPosition){n&&!t._dynamicMove&&(n=!1);t._dynamicSize=n;t.onPropertyChanged("dynamicSize",n)}return t},r.prototype.fixedPosition=function(n){var t=this;if(arguments.length===0)return t._fixedPosition;if(typeof n=="boolean"&&t._fixedPosition!==n){t._fixedPosition=n;n&&(t._dynamicMove=!1,t._dynamicSize=!1);t.onPropertyChanged("fixedPosition",n)}return t},r.prototype.allowResize=function(n){var t=this,i=t._sheet;if(arguments.length===0)return t._allowResize;else n!==t._allowResize&&(i?i._bindToAutoRefresh(function(n){t._allowResize=n})(n):t._allowResize=n)},r.prototype.allowMove=function(n){var t=this,i=t._sheet;if(arguments.length===0)return t._allowMove;else n!==t._allowMove&&(i?i._bindToAutoRefresh(function(n){t._allowMove=n})(n):t._allowMove=n)},r.prototype.onPropertyChanged=function(n,t){var i=this._sheet;this._trigger({sheet:i,sheetName:i?i._name:"",floatingObject:this,propertyName:n})},r.prototype.addRows=function(n,t){var i=this;n=e(n);t=e(t);n<=i.startRow()?i.dynamicMove()&&(i.startRow(i.startRow()+t),i.endRow(i.endRow()+t)):n>i.startRow()&&n<i.endRow()&&i.dynamicSize()&&i.endRow(i.endRow()+t)},r.prototype.removeRows=function(n,t){var i=this,r=n+t-1,u,f;n<=i.startRow()?r<i.startRow()?i.dynamicMove()&&(i.startRow(i.startRow()-t),i.endRow(i.endRow()-t)):r<i.endRow()&&(u=r-i.startRow()+1,f=i.endRow()-i.startRow()+1-u,i.dynamicMove()&&(i.startRow(n),i.startRowOffset(0)),i.dynamicSize()&&i.endRow(n+f-1)):n<=i.endRow()&&(r<i.endRow()?i.dynamicSize()&&i.endRow(i.endRow()-t):i.dynamicSize()&&(i.endRow(n),i.endRowOffset(0)))},r.prototype.addColumns=function(n,t){var i=this;n=e(n);t=e(t);n<=i.startColumn()?i.dynamicMove()&&(i.startColumn(i.startColumn()+t),i.endColumn(i.endColumn()+t)):n>i.startColumn()&&n<i.endColumn()&&i.dynamicSize()&&i.endColumn(i.endColumn()+t)},r.prototype.removeColumns=function(n,t){var i=this,r,u,f;n=e(n);t=e(t);r=n+t-1;n<=i.startColumn()?r<i.startColumn()?i.dynamicMove()&&(i.startColumn(i.startColumn()-t),i.endColumn(i.endColumn()-t)):r<i.endColumn()&&(u=r-i.startColumn()+1,f=i.endColumn()-i.startColumn()+1-u,i.dynamicMove()&&(i.startColumn(n),i.startColumnOffset(0)),i.dynamicSize()&&i.endColumn(n+f-1)):n<=i.endColumn()&&(r<i.endColumn()?i.dynamicSize()&&i.endColumn(i.endColumn()-t):i.dynamicSize()&&(i.endColumn(n),i.endColumnOffset(0)))},r.prototype._isDefaultValue=function(n,t){switch(n){case"x":return t===0;case"y":return t===0;case"width":return t===0;case"height":return t===0;case"canPrint":return t===!0;case"isSelected":return t===!1;case"isLocked":return t==!0;case"isVisible":return t===!0;case"dynamicMove":return t===!0;case"dynamicSize":return t===!0;case"fixedPosition":return t===!1;default:return!1}},r.prototype.toJSON=function(){var n=this,r={name:n._name,x:n._location.x,y:n._location.y,width:n._location.width,height:n._location.height,canPrint:n._canPrint,isSelected:n._isSelected,isLocked:n._isLocked,isVisible:n._isVisible,dynamicMove:n._dynamicMove,dynamicSize:n._dynamicSize,fixedPosition:n._fixedPosition},u={},t,i;for(t in r)i=r[t],n._isDefaultValue(t,i)||(u[t]=i);return u},r.prototype.fromJSON=function(i,r){var u;if(i){u=this;u._name=i.name;var f=i.x!==t?i.x:0,e=i.y!==t?i.y:0,o=i.width!==t?i.width:0,s=i.height!==t?i.height:0;u._location=new n.Rect(f,e,o,s);i.canPrint!==t&&(u._canPrint=i.canPrint);i.isSelected!==t&&(u._isSelected=i.isSelected);i.isLocked!==t&&(u._isLocked=i.isLocked);i.isVisible!==t&&(u._isVisible=i.isVisible);i.dynamicMove!==t&&(u._dynamicMove=i.dynamicMove);i.dynamicSize!==t&&(u._dynamicSize=i.dynamicSize);i.fixedPosition!==t&&(u._fixedPosition=i.fixedPosition);u._updateCoverRange()}},r.prototype.clone=function(){var n=new r,t=JSON.stringify(this.toJSON());return n.fromJSON(JSON.parse(t)),n},r.prototype._adjustSize=function(){var n=this,t=n._getSheetHeight(n._location.height),i=n._getSheetWidth(n._location.width);n._location.width>i&&(n._location.width=i);n._location.height>t&&(n._location.height=t)},r.prototype._adjustPosition=function(){var n=this,r=n._location.x+n._location.width,u=n._getSheetWidth(r),t,i;r>u&&(n._location.x=u-n._location.width);n._location.x<0&&(n._location.x=0);t=n._location.y+n._location.height;i=n._getSheetHeight(t);t>i&&(n._location.y=i-n._location.height);n._location.y<0&&(n._location.y=0)},r.prototype._updateFloatingObjectCoorinates=function(){var n=this;n._adjustSize();n._adjustPosition();n._startRow!==i&&n._startRow!==t&&n._startColumn!==i&&n._startColumn!==t?(n._startRowOffset||(n._startRowOffset=0),n._startColumnOffset||(n._startColumnOffset=0),n._updateFloatingObjectLocation()):n._updateStartPosition();n._endColumn!==i&&n._endColumn!==t&&n._endRow!==i&&n._endRow!==t?(n._endRowOffset||(n._endRowOffset=0),n._endColumnOffset||(n._endColumnOffset=0),n._updateFloatingObjectSize()):n._updateEndPosition()},r.prototype._getSheetHeight=function(n){var o=this,r=o._sheet,u,e,f;if(r===i||r===t)return st;for(u=0,e=r.getRowCount(),f=0;f<e;f++)if(u+=r.getRowHeight(f,3),u>n)break;return u},r.prototype._getSheetWidth=function(n){var o=this,r=o._sheet,u,e,f;if(r===i||r===t)return st;for(u=0,e=r.getColumnCount(),f=0;f<e;f++)if(u+=r.getColumnWidth(f,3),u>n)break;return u},r.prototype._updateStartRowOffset=function(){var n=this,u=n._startRowOffset,i=n._sheet.getRowHeight(n.startRow(),3),r=n._cacheOffset;i>0&&i--;u>i?(r.startRowOffset||(r.startRowOffset=u),n._startRowOffset=i):r.startRowOffset&&(r.startRowOffset<i?(n._startRowOffset=r.startRowOffset,r.startRowOffset=t):i<r.startRowOffset&&(n._startRowOffset=i))},r.prototype._updateStartColumnOffset=function(){var n=this,u=n._startColumnOffset,r=n._sheet.getColumnWidth(n.startColumn(),3),i=n._cacheOffset;r>0&&r--;u>r?(i.startColumnOffset||(i.startColumnOffset=u),n._startColumnOffset=r):i.startColumnOffset&&(i.startColumnOffset<r?(n._startColumnOffset=i.startColumnOffset,i.startColumnOffset=t):u<i.startColumnOffset&&(n._startColumnOffset=r))},r.prototype._updateEndRowOffset=function(){var n=this,u=n._endRowOffset,r=n._sheet.getRowHeight(n.endRow(),3),i=n._cacheOffset;r>0&&r--;u>r?(i.endRowOffset||(i.endRowOffset=u),n._endRowOffset=r):i.endRowOffset&&(i.endRowOffset<r?(n._endRowOffset=i.endRowOffset,i.endRowOffset=t):u<i.endRowOffset&&(n._endRowOffset=r))},r.prototype._updateEndColumnOffset=function(){var n=this,u=n._endColumnOffset,r=n._sheet.getColumnWidth(n.endColumn(),3),i=n._cacheOffset;r>0&&r--;u>r?(i.endColumnOffset||(i.endColumnOffset=u),n._endColumnOffset=r):i.endColumnOffset&&(i.endColumnOffset<r?(n._endColumnOffset=i.endColumnOffset,i.endColumnOffset=t):u<i.endColumnOffset&&(n._endColumnOffset=r))},r.prototype._updateFloatingObjectLocation=function(){var r=this,e=r._sheet,u,h,o,f,c,s;if(e!==i&&e!==t){for(u=0,h=r.startRow(),o=0;o<h;o++)u+=e.getRowHeight(o,3);for(r._updateStartRowOffset(),u+=r._startRowOffset,f=0,c=r.startColumn(),s=0;s<c;s++)f+=e.getColumnWidth(s,3);if(r._updateStartColumnOffset(),f+=r._startColumnOffset,r._location.x!==f||r._location.y!==u){r._location.x=f;r._location.y=u;r.onPropertyChanged("location",new n.Rect(f,u,r._location.width,r._location.height))}}},r.prototype._updateFloatingObjectSize=function(){var n=this,f=n._sheet,e,a,v,o,y,p;if(f!==i&&f!==t){n._isFOColumnsOrRowsVisible===!1&&(n._isVisible=!0,n._isFOColumnsOrRowsVisible=!0);var r=0,s=n.startRow(),h=n.endRow();for(e=s;e<h;e++)r+=f.getRowHeight(e,3);a=r+f.getRowHeight(h,3);a===0&&n._isVisible===!0&&(n._isVisible=!1,n._isFOColumnsOrRowsVisible=!1);s===h?(n._updateEndRowOffset(),r=n.endRowOffset()-n.startRowOffset()):(v=f.getRowHeight(s,3),v>0&&(r-=n._startRowOffset),n._updateEndRowOffset(),r+=n._endRowOffset);var u=0,c=n.startColumn(),l=n.endColumn();for(o=c;o<l;o++)u+=f.getColumnWidth(o,3);if(y=u+f.getColumnWidth(l,3),y===0&&n._isVisible===!0&&(n._isVisible=!1,n._isFOColumnsOrRowsVisible=!1),c===l?(n._updateEndColumnOffset(),u=n.endColumnOffset()-n.startColumnOffset()):(p=f.getColumnWidth(c,3),p>0&&(u-=n._startColumnOffset),n._updateEndColumnOffset(),u+=n._endColumnOffset),u<0&&(u=0),r<0&&(r=0),n._location.width!==u){n._location.width=u;n.onPropertyChanged("width",u)}if(n._location.height!==r){n._location.height=r;n.onPropertyChanged("height",r)}}},r.prototype._updateStartPosition=function(){var n=this,r=n._sheet,u,f,e,o;r!==i&&r!==t&&(u=n._calcAnchorRow(n._location.y),n._startRow=u.row,n._startRowOffset=u.offsetY,n._startRowOffset===-1&&(n._startRow+=1,n._startRowOffset=0,f=r.getRowCount(),n._startRow===f&&(n._startRow=f-1)),e=n._calcAnchorColumn(n._location.x),n._startColumn=e.column,n._startColumnOffset=e.offsetX,n._startColumnOffset===-1&&(n._startColumn+=1,n._startColumnOffset=0,o=r.getColumnCount(),n._startColumn===o&&(n._startColumn=o-1)))},r.prototype._updateEndPosition=function(){var n=this,r,u;n._sheet!==i&&n._sheet!==t&&(r=n._calcAnchorRow(n._location.y+n._location.height),n._endRow=r.row,n._endRowOffset=r.offsetY,u=n._calcAnchorColumn(n._location.x+n._location.width),n._endColumn=u.column,n._endColumnOffset=u.offsetX)},r.prototype._updateCoverRange=function(){this._updateStartPosition();this._updateEndPosition()},r.prototype._calcAnchorRow=function(n){for(var u,i,f=0,r=0,e=this._sheet.getRowCount(),t=0;t<e;t++)if(u=this._sheet.getRowHeight(t,3),f+=u,i=f-n,i>0)return r=i>0?u-i:-1,{row:t,offsetY:r};else if(i===0)return r=0,{row:t+1,offsetY:0};return{row:e-1,offsetY:0}},r.prototype._calcAnchorColumn=function(n){for(var u,i,f=0,r=0,e=this._sheet.getColumnCount(),t=0;t<e;t++)if(u=this._sheet.getColumnWidth(t,3),f+=u,i=f-n,i>0)return r=i>0?u-i:-1,{column:t,offsetX:r};else if(i===0)return r=0,{column:t+1,offsetX:0};return{column:e-1,offsetX:0}},r.prototype._trigger=function(n){if(this._sheet&&(this._sheet.triggerFloatingObjectChanged(n),n.propertyName==="isSelected")){var t={sheet:n.sheet,sheetName:n.sheetName,floatingObject:n.floatingObject};this._sheet.triggerFloatingObjectSelectionChanged(t)}},r.prototype._createContentContainer=function(){var t=document.createElement("div"),i=n.GC$(t).addClass(a).addClass(o).attr("unselectable","on").css(b,k);return i.css(ct,ot),t},r}();n.FloatingObject=y;p=function(t){function r(n,r,u,f,e){t.call(this,n,r,u,f,e);this._content=i}return __extends(r,t),r.prototype.Content=function(n){var t=this;if(arguments.length===0)return t._content;t.owner()?t.owner()._bindToAutoRefresh(function(n){t._content=n})(n):t._content=n;t.onPropertyChanged("content",n)},r.prototype.onPropertyChanged=function(n,t){var i=this.owner();this._trigger({sheet:i,sheetName:i?i._name:"",floatingObject:this,customFloatingObject:this,propertyName:n})},r.prototype.toJSON=function(){var i=t.prototype.toJSON.call(this),r;return i.floatingObjectType=0,r=n.GC$(document.createElement("div")).append(this.cloneContent()).html(),i.content=r,i},r.prototype.fromJSON=function(i,r){if(i&&(t.prototype.fromJSON.call(this,i,r),i.content)){var u=document.createElement("div");u.innerHTML=i.content;this._content=n.GC$(u.firstChild).getElement(0)}},r.prototype.clone=function(n){var t=new r,i=JSON.stringify(this.toJSON());return t.fromJSON(JSON.parse(i)),t._content=this.cloneContent(),t},r.prototype.cloneContent=function(){var t=this._content,r,u;return t?(t.cloneNode?r=t.cloneNode(!0):(u=document.createElement("div"),u.innerHTML=t.outerHTML,r=u.firstChild),n.GC$(r).removeAttr("id").getElement(0)):i},r.prototype._createContentContainer=function(){var r=document.createElement("div"),h=n.GC$(r).addClass(a).addClass(o).attr("unselectable","on").css(b,k),t=this.cloneContent(),e=ht,s=ht,u="",f="",c;return t&&t.style&&(u=t.style.width,f=t.style.height),u!==""&&(e=u),f!==""&&(s=f),t!==i?c=n.GC$(t).css({width:e,height:s}).addClass(ii).addClass(o).attr("unselectable","on").appendTo(r):h.css(ct,ot),r},r.prototype.refreshContent=function(){},r}(y);n.CustomFloatingObject=p;ft=function(r){function u(n,t,u,f,e,o){r.call(this,n,u,f,e,o);var s=this;s._pictureStretch=0;s._borderWidth=1;s._borderStyle="none";s._borderColor=i;s._borderRadius=-1;s._backColor=i;s._imageLoader=i;s._isImageLoaded=!1;s._isTakeOriginalSize=!1;typeof t=="string"&&s.src(t)}return __extends(u,r),u.prototype._trigger=function(n){if(this.owner()&&(n&&n.floatingObject&&(n.picture=n.floatingObject,delete n.floatingObject),this.owner().triggerPictureChanged(n),n.propertyName==="isSelected")){var t={sheet:n.sheet,sheetName:n.sheetName,picture:n.picture};this.owner().triggerPictureSelectionChanged(t)}},u.prototype.backColor=function(n){var t=this,i;if(arguments.length===0)return t._backColor;if(typeof n=="string"&&t._backColor!==n){i=t.owner();i?i._bindToAutoRefresh(function(n){t._backColor=n})(n):t._backColor=n;t.onPropertyChanged("backColor",n)}return t},u.prototype.borderRadius=function(n){var t=this,i;if(arguments.length===0)return t._borderRadius;if(typeof n=="number"&&!isNaN(n)&&t._borderRadius!==n){i=t.owner();i?i._bindToAutoRefresh(function(n){t._borderRadius=n})(n):t._borderRadius=n;t.onPropertyChanged("borderRadius",n)}return t},u.prototype.borderWidth=function(n){var t=this,i;if(arguments.length===0)return t._borderWidth;if(typeof n=="number"&&!isNaN(n)&&t._borderWidth!==n){i=t.owner();i?i._bindToAutoRefresh(function(n){t._borderWidth=n})(n):t._borderWidth=n;t.onPropertyChanged("borderWidth",n)}return t},u.prototype.borderStyle=function(n){var t=this,i;if(arguments.length===0)return t._borderStyle;if(typeof n=="string"&&t._borderStyle!==n){i=t.owner();i?i._bindToAutoRefresh(function(n){t._borderStyle=n})(n):t._borderStyle=n;t._isBorderStyleWork(n)||(t._borderWidth=0);t.onPropertyChanged("borderStyle",n)}return t},u.prototype.borderColor=function(n){var t=this,i;if(arguments.length===0)return t._borderColor;if(typeof n=="string"&&t._borderColor!==n){i=t.owner();i?i._bindToAutoRefresh(function(n){t._borderColor=n})(n):t._borderColor=n;t.onPropertyChanged("borderColor",n)}return t},u.prototype.pictureStretch=function(i){var r=this,u;if(arguments.length===0)return r._pictureStretch;if(r._pictureStretch!==i&&n.ImageLayout[i]!==t){u=r.owner();u?u._bindToAutoRefresh(function(n){r._pictureStretch=n})(i):r._pictureStretch=i;r.onPropertyChanged("pictureStretch",i)}return r},u.prototype.getOriginalWidth=function(){return this._originalWidth},u.prototype.getOriginalHeight=function(){return this._originalHeight},u.prototype.src=function(n){var t=this,i;if(arguments.length===0)return t._src;if(typeof n=="string"&&t._src!==n){i=t.owner();i?i._bindToAutoRefresh(function(n){t._src=n})(n):t._src=n;t.onPropertyChanged("src",n);t._isImageLoaded=!1;t._loadImage()}return t},u.prototype.onPropertyChanged=function(n,t){var i=this.owner();this._trigger({sheet:i,sheetName:i?i._name:"",floatingObject:this,picture:this,propertyName:n})},u.prototype._isDefaultValue=function(n,t){switch(n){case"backColor":return t===i;case"borderRadius":return t===-1;case"borderWidth":return t===1;case"borderStyle":return t==="none";case"borderColor":return t===i;case"pictureStretch":return t===0}return r.prototype._isDefaultValue.call(this,n,t)},u.prototype.toJSON=function(){var u=this,i=r.prototype.toJSON.call(this),f,e,o;i.src=u._src;i.floatingObjectType=1;i.backColor=u._backColor;i.borderRadius=u._borderRadius;i.borderWidth=u._borderWidth;i.borderStyle=u._borderStyle;i.borderColor=u._borderColor;i.pictureStretch=u._pictureStretch;f={};for(e in i)o=i[e],u._isDefaultValue(e,o)||(f[e]=o);return n.GC$.isEmptyObject(f)?t:f},u.prototype.fromJSON=function(n,i){if(n){var u=this;r.prototype.fromJSON.call(this,n,i);n.src&&(u._src=n.src,u._isImageLoaded=!1,u._loadImage(),n.backColor!==t&&(u._backColor=n.backColor),n.borderRadius!==t&&(u._borderRadius=n.borderRadius),n.borderWidth!==t&&(u._borderWidth=n.borderWidth),n.borderStyle!==t&&(u._borderStyle=n.borderStyle),n.borderColor!==t&&(u._borderColor=n.borderColor),n.pictureStretch!==t&&(u._pictureStretch=n.pictureStretch))}},u.prototype.clone=function(){var n=new u,t=JSON.stringify(this.toJSON());return n.fromJSON(JSON.parse(t)),n},u.prototype._isBorderStyleWork=function(n){switch(n){case"dotted":case"dashed":case"solid":case"double":case"groove":case"ridge":case"inset":case"outset":return!0;default:return!1}},u.prototype._loadImage=function(){var t=this,i=t._src,r,u;t._imageLoader||(t._imageLoader=new n._GcImageLoader(function(){t._loadImage()}));try{t._imageLoader.getState(i)?(t._isImageLoaded=!0,r=t._imageLoader.getImage(i),t._originalWidth=r.width,t._originalHeight=r.height,t._isTakeOriginalSize&&(t.width(t._originalWidth),t.height(t._originalHeight),t._isTakeOriginalSize=!1),u=t.owner(),u&&u.repaint()):t._imageLoader.addImage(i)}catch(f){}},u.prototype._createContentContainer=function(){var t=document.createElement("div"),i=n.GC$(t).addClass(a).addClass(o).attr("unselectable","on").css(b,k);return t},u}(y);n.Picture=ft;c=function(){function e(n,t){this._srcCache="";var i=this;i._floatingObject=n;i.name=i._floatingObject.name();i._sheet=t;i._isMouseCapture=!1;i._isResizeIndicatorDisplayed=!1}return e.prototype.floatingObject=function(){return this._floatingObject},e.prototype.render=function(t,i){var r=this,c=!1,s,h,u,f,e,l;r._rect=t;r._floatingObjectContainerDiv||(r._floatingObjectContainerDiv=r._createFloatingObjectContainer(r._floatingObject.name()),s=r._sheet.parent,s&&(r._containerDiv=s._getContainerDiv(),r._containerDiv&&n.GC$(r._containerDiv).append(r._floatingObjectContainerDiv)));r._floatingObjectContentDiv||(r._floatingObjectContentDiv=r._floatingObject._createContentContainer(),typeof r._floatingObject.borderWidth=="function"?(r._borderDiv=document.createElement("div"),n.GC$(r._borderDiv).addClass(o+" "+a).attr("unselectable","on"),r._floatingObjectContainerDiv.appendChild(r._borderDiv),r._borderDiv.appendChild(r._floatingObjectContentDiv)):(r._floatingObjectContainerDiv.appendChild(r._floatingObjectContentDiv),c=!0));r._borderDiv&&(r._applyBorderStyle(i,t),i.x=0,i.y=0);h=n.GC$(r._floatingObjectContainerDiv);u=n.GC$(r._floatingObjectContentDiv);h.css({top:t.y,left:t.x,width:t.width,height:t.height});u.css({top:i.y,left:i.x,width:i.width,height:i.height});r._floatingObject instanceof p&&r._floatingObject.refreshContent();r._borderDiv&&r._paintImage();f=h.getElement(0);r._floatingObject.isSelected()?(u.removeClass(at).addClass(lt),r._floatingObject.allowResize()?r._showResizeIndicator(f):r._isResizeIndicatorDisplayed&&r._hideResizeIndicator(f)):(u.removeClass(lt).addClass(at),r._hideResizeIndicator(f));c&&(e=r._sheet,l=r._floatingObjectContentDiv.firstChild,e.triggerCustomFloatingObjectLoaded({sheet:e,sheetName:e._name,customFloatingObject:r._floatingObject,element:l}))},e.prototype.setFloatingObjectZIndex=function(t){n.GC$(this._floatingObjectContainerDiv).css("z-index",t)},e.prototype.getFloatingObjectZIndex=function(){var i=this._floatingObjectContainerDiv,t;return i&&(t=parseInt(n.GC$(i).css("z-index")),!isNaN(t))?t:-1},e.prototype._paintImage=function(){var u=this,r=u._floatingObject,e=r.src(),o=r.pictureStretch(),s=n._ThemeContext.getColor(r.owner(),r.backColor()),f;if(e&&u._floatingObjectContentDiv&&(f=n.GC$(u._floatingObjectContentDiv),u._srcCache!==e&&(u._srcCache=e,f.css("background-image","url('"+e+"')").css("background-repeat","no-repeat")),f.css("background-color",s),o!==i&&o!==t)&&r._isImageLoaded){var h=r.getOriginalWidth(),c=r.getOriginalHeight(),l=f.width(),a=f.height();n.util._applyBackgroundImageLayout(u._floatingObjectContentDiv,l,a,h,c,o)}},e.prototype._applyBorderStyle=function(t,i){var p=this._borderDiv,f=this._floatingObject,u=f.borderWidth(),a=f.borderStyle(),w=n._ThemeContext.getColor(f.owner(),f.borderColor()),b=f.borderRadius(),o=0,r=s(e._resizeIndicatorSize/2+1);f._isBorderStyleWork(a)||(u=0);u<r&&(o=r-u);var h=o,c=o,v=o,y=o;r=l(u,r);t.x<0?h+=t.x-r:(h+=t.x<r?t.x-r:0,y=i.width-h-t.width-2-2*u);t.y<0?c+=t.y-r:(c+=t.y<r?t.y-r:0,v=i.height-c-t.height-2-2*u);n.GC$(p).css({position:"absolute",left:h,top:c,bottom:v,right:y,"border-width":u,"border-style":a,"border-color":w,"border-radius":b})},e.prototype._dispose=function(){var t=this;t._touchManager&&t._touchManager.detach();t._floatingObjectContainerDiv&&(n.GC$(t._floatingObjectContainerDiv).remove(),t._floatingObjectContainerDiv=i);t._moveResizeContainerDiv&&(n.GC$(t._moveResizeContainerDiv).remove(),t._moveResizeContainerDiv=i)},e.prototype._showResizeIndicator=function(t){var et=n.GC$(vt,t),h,ft;et.removeClass(d);var i=this,l=i._getHTMLElementBounds(i._floatingObjectContainerDiv),w=i._floatingObjectContentDiv,v=i._floatingObject;i._borderDiv&&(w=i._borderDiv);var o=i._getHTMLElementBounds(w),a=o.x,c=o.y,y=l.height-o.y-o.height,b=l.width-o.x-o.width,u=0,r=e._resizeIndicatorSize,p=r+2,k=s(r/2+1);typeof v.borderWidth=="function"&&(h=v.borderWidth(),ft=v.borderStyle(),v._isBorderStyleWork(ft)||(h=0),h>=k&&(u=h-k),y=l.height-c-o.height-h,b=l.width-a-o.width-h,a+=h,c+=h);a>0?(c>0?n.GC$(g,i._floatingObjectContainerDiv).css({top:u,left:u,width:r,height:r}).addClass(f):i._resizeIndicatorUnselect(g),l.height>0?n.GC$(nt,i._floatingObjectContainerDiv).css({left:u,top:(o.height-p)/2+c,width:r,height:r}).addClass(f):i._resizeIndicatorUnselect(nt),y>0?n.GC$(tt,i._floatingObjectContainerDiv).css({left:u,bottom:u,width:r,height:r}).addClass(f):i._resizeIndicatorUnselect(tt)):(i._resizeIndicatorUnselect(g),i._resizeIndicatorUnselect(nt),i._resizeIndicatorUnselect(tt));c>0?n.GC$(yt,i._floatingObjectContainerDiv).css({top:u,left:(o.width-p)/2+a,width:r,height:r}).addClass(f):i._resizeIndicatorUnselect(yt);y>0?n.GC$(pt,i._floatingObjectContainerDiv).css({left:(o.width-p)/2+a,bottom:u,width:r,height:r}).addClass(f):i._resizeIndicatorUnselect(pt);b>0?(c>0?n.GC$(it,i._floatingObjectContainerDiv).css({right:u,top:u,width:r,height:r}).addClass(f):i._resizeIndicatorUnselect(it),l.height>0?n.GC$(rt,i._floatingObjectContainerDiv).css({top:(o.height-p)/2+c,right:u,width:r,height:r}).addClass(f):i._resizeIndicatorUnselect(rt),y>0?n.GC$(ut,i._floatingObjectContainerDiv).css({right:u,bottom:u,width:r,height:r}).addClass(f):i._resizeIndicatorUnselect(ut)):(i._resizeIndicatorUnselect(it),i._resizeIndicatorUnselect(rt),i._resizeIndicatorUnselect(ut));i._isResizeIndicatorDisplayed=!0},e.prototype._resizeIndicatorUnselect=function(t){n.GC$(t,this._floatingObjectContainerDiv).removeClass(f).addClass(d)},e.prototype._hideResizeIndicator=function(t){n.GC$(vt,t).removeClass(f).addClass(d);this._isResizeIndicatorDisplayed=!1},e.prototype._createFloatingObjectContainer=function(t){var r=document.createElement("div"),u=n.GC$(r),i=this;i._renderManager.reduceZIndex();u.addClass(gt).addClass(o).attr("unselectable","on").css("z-index",kt).bind("mousedown",function(n){i._doMouseDown(n)}).bind("mousemove",function(n){i._doMouseMove(n)}).bind("mouseup",function(n){i._doMouseUp(n)});r.addEventListener("mousewheel",function(n){i._doMouseWheel(n)},!1);r.addEventListener("DOMMouseScroll",function(n){i._doMouseWheel(n)},!1);var f=n.GC$(document.createElement("div")).addClass("floatingobject-resize-indicator floatingobject-top floatingobject-left floatingobject-absolute"),e=n.GC$(document.createElement("div")).addClass("floatingobject-resize-indicator floatingobject-top floatingobject-center floatingobject-absolute"),s=n.GC$(document.createElement("div")).addClass("floatingobject-resize-indicator floatingobject-top floatingobject-right floatingobject-absolute"),h=n.GC$(document.createElement("div")).addClass("floatingobject-resize-indicator floatingobject-middle floatingobject-left floatingobject-absolute"),c=n.GC$(document.createElement("div")).addClass("floatingobject-resize-indicator floatingobject-middle floatingobject-right floatingobject-absolute"),l=n.GC$(document.createElement("div")).addClass("floatingobject-resize-indicator floatingobject-bottom floatingobject-left floatingobject-absolute"),a=n.GC$(document.createElement("div")).addClass("floatingobject-resize-indicator floatingobject-bottom floatingobject-center floatingobject-absolute"),v=n.GC$(document.createElement("div")).addClass("floatingobject-resize-indicator floatingobject-bottom floatingobject-right floatingobject-absolute");return u.append(f).append(e).append(s).append(h).append(c).append(l).append(a).append(v),n.features.touch&&(i._touchManager=new n.FloatingObjectTouchManager(r,i,i._sheet.parent._touchEventProvider),i._touchManager.attach()),r},e.prototype._createMoveResizeContainer=function(){var t=this,h,e,r,u,i,c,o,s,l,f;if(t._floatingObjectContainerDiv&&t._layout&&!t._moveResizeDiv){for(t._moveResizeContainerDiv=document.createElement("div"),t._moveResizeDiv=document.createElement("div"),t._attachedMoveResizeDivDict={},h=t._renderManager._containerArray.length,e=0;e<h;e++)r=t._renderManager._containerArray[e],u=r._floatingObject,u&&u.name()!==t._floatingObject.name()&&u.isSelected()&&!t._attachedMoveResizeDivDict[u.name()]&&(t._attachedMoveResizeDivDict[u.name()]={offsetX:r._layout.x-t._layout.x,offsetY:r._layout.y-t._layout.y,height:r._layout.height,width:r._layout.width,moveResizeDiv:document.createElement("div")});i=t._getViewportRect(t._rowViewportIndex,t._columnViewportIndex);c=n.GC$(t._moveResizeContainerDiv);c.addClass(ni).css("z-index",dt).css({top:i.y,left:i.x,width:i.width,height:i.height,background:"rgba(255,255,255,0.01)"}).bind("mousemove",function(n){t._doMouseMove(n)}).bind("mouseup",function(n){t._doMouseUp(n)});o=t._layout.y-i.y;s=t._layout.x-i.x;t._attachMoveResizeDivToContainer(t._moveResizeDiv,t._moveResizeContainerDiv,s,o,t._layout.width,t._layout.height);for(l in t._attachedMoveResizeDivDict)f=t._attachedMoveResizeDivDict[l],t._attachMoveResizeDivToContainer(f.moveResizeDiv,t._moveResizeContainerDiv,s+f.offsetX,o+f.offsetY,f.width,f.height);t._containerDiv&&n.GC$(t._containerDiv).append(t._moveResizeContainerDiv)}},e.prototype._handleDocumentMouseMove=function(){var t=this;t._isMouseCapture||(n.GC$(document).bind("mousemove"+v,function(n){t._doMouseMove(n)}).bind("mouseup"+v,function(n){t._doMouseUp(n)}),t._isMouseCapture=!0)},e.prototype._unhandleDocumentMouseMove=function(){this._isMouseCapture&&(this._isMouseCapture=!1,n.GC$(document).unbind("mousemove"+v).unbind("mouseup"+v))},e.prototype._doMouseDown=function(t){var i=this,r=i._sheet,c,f,e;if(r.canEditFloatingObject(i._floatingObject)&&r.endEdit()){if(i._touchManager&&!t.isTouch&&i._touchManager.preProcessMouseDown(t)){n.util.cancelDefault(t);return}if(t.button===0||t.button===2){if(t.ctrlKey||t.shiftKey?i._floatingObject.isSelected()?i._floatingObject.isSelected(!1):(i._floatingObject.isSelected(!0),n.FocusHelper.setActiveElement(r)):i._floatingObject.isSelected()||(r.unSelectAllFloatingObjects(),i._floatingObject.isSelected(!0),n.FocusHelper.setActiveElement(r)),r._commentManager&&r._commentManager.deactivateComment(),r._saveAndClearSheetSelections(),t.button===2)return;var u=r._eventHandler,s=u._getCanvasOffset(),o=new n.Point(t.pageX-s.left,t.pageY-s.top),h=i._hitTest(o.x,o.y);if(!i._floatingObject.allowMove()&&!(i._floatingObject.allowResize()&&!h.inMoving))return;i._mousePosition=o;i._isMouseLeftButtonDown=!0;i._mouseDownHittestInfo=h;i._mouseDownHittestInfo.inMoving?(i._moveInfo={},i._moveInfo.startTopRow=r.getViewportTopRow(i._rowViewportIndex),i._moveInfo.startLeftColumn=r.getViewportLeftColumn(i._columnViewportIndex),i._moveInfo.startX=i._mousePosition.x,i._moveInfo.startY=i._mousePosition.y):(i._createMoveResizeContainer(),c=n.GC$(i._moveResizeDiv),i._resizeInfo={},f=i._getHTMLElementBounds(i._moveResizeDiv),i._resizeInfo.startX=f.x,i._resizeInfo.startY=f.y,i._resizeInfo.startWidth=f.width,i._resizeInfo.startHeight=f.height,i._resizeInfo.startTopRow=r.getViewportTopRow(i._rowViewportIndex),i._resizeInfo.startLeftColumn=r.getViewportLeftColumn(i._columnViewportIndex));i._handleDocumentMouseMove();e=r.hitTest(i._mousePosition.x,i._mousePosition.y);u.startHitInfo={scrollRowViewportIndex:e.rowViewportIndex,scrollColViewportIndex:e.colViewportIndex,hitTestType:e.hitTestType};u.mousePosition=i._mousePosition;u.startScroll();u.isFloatingObjectWorking=!0}return!1}},e.prototype._doMouseMove=function(t){var i=this,u=i._sheet,e;if(u.canEditFloatingObject(i._floatingObject)){if(i._touchManager&&!t.isTouch&&i._touchManager.preProcessMouseMove(t)){n.util.cancelDefault(t);return}if(u._isMouseDownInSheet)return i._floatingObjectContainerDiv&&(e=n.GC$(i._floatingObjectContainerDiv),e.css("cursor","default")),!0;var f=u._eventHandler,s=f._getCanvasOffset(),r=new n.Point(t.pageX-s.left,t.pageY-s.top);return i._isMouseLeftButtonDown?(n.GC$(i._moveResizeContainerDiv).css("cursor",n.GC$(i._floatingObjectContainerDiv).css("cursor")),i._mouseDownHittestInfo.inMoving?(i._isMoving=!0,i._createMoveResizeContainer(),i._doMoveContainer(i._mousePosition,r)):(i._isResizing=!0,i._doResizeContainer(i._mousePosition,i._mouseDownHittestInfo)),i._mousePosition=r,f.mousePosition=r,f.continueScroll(),n.GC$(document.body).addClass(o).attr("unselectable","on")):i._updateCursor(r),!1}},e.prototype._doMouseUp=function(t){var i=this,r=i._sheet,u=r._eventHandler,h,f,e,s;if(r.canEditFloatingObject(i._floatingObject)){if(i._touchManager&&!t.isTouch&&i._touchManager.preProcessMouseUp(t)){n.util.cancelDefault(t);return}return r._isMouseDownInSheet?(i._floatingObjectContainerDiv&&(h=n.GC$(i._floatingObjectContainerDiv),h.css("cursor","move")),!0):(u.isFloatingObjectWorking=!1,u.stopScroll(),f=u._getCanvasOffset(),e=new n.Point(t.pageX-f.left,t.pageY-f.top),i._moveInfo&&(i._moveInfo.endX=e.x,i._moveInfo.endY=e.y),i._mouseDownHittestInfo&&(s=i._floatingObject.fixedPosition(),i._mouseDownHittestInfo.inMoving&&i._isMoving?(s&&i._adjustMoveInfo(),t.ctrlKey?i._doCopyFloatingObject():i._doMoveFloatingObject()):i._isResizing&&(s&&i._adjustResizeInfo(),i._doResizeFloatingObject()),n.GC$(document.body).removeClass(o)),i._resetStatusOnMouseUp(),!1)}},e.prototype._adjustMoveInfo=function(){var n=this;if(n._moveInfo){var i=n._floatingObject,o=n._sheet,t=o._getSheetLayout(),s=t.width-t.rowHeaderWidth-t.headerX,h=t.height-t.colHeaderHeight-t.headerY,r=n._moveInfo.startX,u=n._moveInfo.startY,f=i.position().x,e=i.position().y,c=i.width(),l=i.height();f+n._moveInfo.endX-r<0&&(n._moveInfo.endX=r-f);e+n._moveInfo.endY-u<0&&(n._moveInfo.endY=u-e);f+c+n._moveInfo.endX-r>s&&(n._moveInfo.endX=s+r-f-c);e+l+n._moveInfo.endY-u>h&&(n._moveInfo.endY=h+u-e-l);n._moveInfo.startTopRow=o.getViewportTopRow(n._rowViewportIndex);n._moveInfo.startLeftColumn=o.getViewportLeftColumn(n._columnViewportIndex)}},e.prototype._adjustResizeInfo=function(){var t=this;if(t._resizeInfo){var u=t._sheet,i=u._getSheetLayout(),f=i.width-i.rowHeaderWidth-i.headerX,e=i.height-i.colHeaderHeight-i.headerY,r=new n.Rect(t._resizeInfo.endX,t._resizeInfo.endY,t._resizeInfo.endWidth,t._resizeInfo.endHeight);r=r.getIntersect(0,0,f,e);t._resizeInfo.endX=r.x;t._resizeInfo.endY=r.y;t._resizeInfo.endWidth=r.width;t._resizeInfo.endHeight=r.height;t._resizeInfo.startTopRow=u.getViewportTopRow(t._rowViewportIndex);t._resizeInfo.startLeftColumn=u.getViewportLeftColumn(t._columnViewportIndex)}},e.prototype._resetStatusOnMouseUp=function(){var t=this;t._resizeInfo=i;t._moveInfo=i;t._attachedMoveResizeDivDict=i;n.GC$(t._moveResizeContainerDiv).remove();t._moveResizeDiv=i;t._isMouseLeftButtonDown=!1;t._unhandleDocumentMouseMove();t._isMoving=!1;t._isResizing=!1},e.prototype._doMouseWheel=function(t){var i=this._sheet,r;if(i)return t=t?t:window.event,r=t.detail?t.detail:t.wheelDelta/-40,i._eventHandler.doMouseWheel(t,parseInt(r,10),0),n.util.cancelDefault(t),!1},e.prototype._doCopyFloatingObject=function(){var t=this,i=t._sheet,r,s,h;if(t._moveInfo){var u=t._getTwoRowDistance(t._moveInfo.startTopRow,i.getViewportTopRow(t._rowViewportIndex)),f=t._getTwoColumnDistance(t._moveInfo.startLeftColumn,i.getViewportLeftColumn(t._columnViewportIndex)),e=t._moveInfo.endX-t._moveInfo.startX+(t._moveInfo.endX>t._moveInfo.startX?f:-1*f),o=t._moveInfo.endY-t._moveInfo.startY+(t._moveInfo.endY>t._moveInfo.startY?u:-1*u);if(e===0&&o===0)return;r=[];r.push(t._floatingObject.name());for(s in t._attachedMoveResizeDivDict)r.push(s);h=new n.UndoRedo.DragCopyFloatingObjectUndoAction(i,{names:r},{offsetX:e,offsetY:o});i._doCommand(h)}},e.prototype._doMoveFloatingObject=function(){var t=this,i=t._sheet,r,s,h;if(t._moveInfo){var e=t._getTwoRowDistance(t._moveInfo.startTopRow,i.getViewportTopRow(t._rowViewportIndex)),o=t._getTwoColumnDistance(t._moveInfo.startLeftColumn,i.getViewportLeftColumn(t._columnViewportIndex)),u=t._moveInfo.endX-t._moveInfo.startX+(t._moveInfo.endX>t._moveInfo.startX?o:-1*o),f=t._moveInfo.endY-t._moveInfo.startY+(t._moveInfo.endY>t._moveInfo.startY?e:-1*e);u=u/i._zoomFactor;f=f/i._zoomFactor;r=[];r.push(t._floatingObject.name());for(s in t._attachedMoveResizeDivDict)r.push(s);h=new n.UndoRedo.MovingFloatingObjectUndoAction(i,{names:r},{offsetX:u,offsetY:f});i._doCommand(h)}},e.prototype._doResizeFloatingObject=function(){var t=this,i=t._sheet,r=i._zoomFactor,u,h,c;if(t._resizeInfo){var f=t._getTwoRowDistance(t._resizeInfo.startTopRow,i.getViewportTopRow(t._rowViewportIndex)),e=t._getTwoColumnDistance(t._resizeInfo.startLeftColumn,i.getViewportLeftColumn(t._columnViewportIndex)),o=t._resizeInfo.endX-t._resizeInfo.startX+(t._resizeInfo.endX>t._resizeInfo.startX?e:-1*e);o=o/r;u=t._resizeInfo.endY-t._resizeInfo.startY+(t._resizeInfo.endY>t._resizeInfo.startY?f:-1*f);u=u/r;var l=(t._resizeInfo.endWidth+e)/r-t._floatingObject.width(),a=(t._resizeInfo.endHeight+f)/r-t._floatingObject.height(),s=[];s.push(t._floatingObject.name());for(h in t._attachedMoveResizeDivDict)s.push(h);c=new n.UndoRedo.ResizingFloatingObjectUndoAction(i,{names:s},{offsetX:o,offsetY:u,offsetWidth:l,offsetHeight:a});i._doCommand(c)}},e.prototype._doMoveContainer=function(t,i){var r=this,e,o;if(r._moveResizeDiv){var s=n.GC$(r._moveResizeDiv),u=i.x-t.x,f=i.y-t.y;r._doMoveContainerImp(r._moveResizeDiv,u,f);for(e in r._attachedMoveResizeDivDict)o=r._attachedMoveResizeDivDict[e],r._doMoveContainerImp(o.moveResizeDiv,u,f)}},e.prototype._doMoveContainerImp=function(t,i,r){var u=n.GC$(t),f=u.position();u.css({top:f.top+r,left:f.left+i})},e.prototype._doResizeContainer=function(t,i){var r,u,e,l,a;if(i){r=this;e=r._getViewportRect(r._rowViewportIndex,r._columnViewportIndex);t=new n.Point(t.x-e.x,t.y-e.y);i.inTopNWSEResizing?u=r._getFloatingObjectTopLeftResizingRect(t):i.inTopNSResizing?u=r._getFloatingObjectTopCenterResizingRect(t):i.inTopNESWResizing?u=r._getFloatingObjectTopRightResizingRect(t):i.inLeftWEResizing?u=r._getFloatingObjectMiddleLeftResizingRect(t):i.inRightWEResizing?u=r._getFloatingObjectMiddleRightResizingRect(t):i.inBottomNESWResizing?u=r._getFloatingObjectBottomLeftResizingRect(t):i.inBottomNSReszing?u=r._getFloatingObjectBottomCenterResizingRect(t):i.inBottomNWSEReszing&&(u=r._getFloatingObjectBottomRightResizingRect(t));r._resizeInfo.endX=u.x;r._resizeInfo.endY=u.y;r._resizeInfo.endWidth=u.width;r._resizeInfo.endHeight=u.height;var v=n.GC$(r._moveResizeDiv),f=r._getHTMLElementBounds(r._moveResizeDiv),o=u.y-f.y,s=u.x-f.x,h=u.width-f.width,c=u.height-f.height;r._doResizeContainerImp(r._moveResizeDiv,s,o,h,c);for(l in r._attachedMoveResizeDivDict)a=r._attachedMoveResizeDivDict[l],r._doResizeContainerImp(a.moveResizeDiv,s,o,h,c)}},e.prototype._doResizeContainerImp=function(t,i,r,u,f){var o=n.GC$(t),e=this._getHTMLElementBounds(t);o.css({top:e.y+r,left:e.x+i,width:e.width+u,height:e.height+f})},e.prototype._attachMoveResizeDivToContainer=function(t,i,r,u,f,e){n.GC$(t).addClass(ti).css({top:u-1,left:r-1,width:f,height:e}).appendTo(i)},e.prototype._getHTMLElementBounds=function(t){var i=n.GC$(t),r=i.position();return new n.Rect(r.left,r.top,i.width(),i.height())},e.prototype._updateCursor=function(t){var f=this;if(f._floatingObjectContainerDiv){var o=n.GC$(f._floatingObjectContainerDiv),r=f._hitTest(t.x,t.y),u=f._floatingObject.allowResize(),s=f._floatingObject.allowMove(),e;r!==i&&(e=r.inTopNWSEResizing?u?"nw-resize":"default":r.inTopNSResizing?u?"n-resize":"default":r.inTopNESWResizing?u?"ne-resize":"default":r.inLeftWEResizing?u?"w-resize":"default":r.inRightWEResizing?u?"w-resize":"default":r.inBottomNESWResizing?u?"sw-resize":"default":r.inBottomNSReszing?u?"n-resize":"default":r.inBottomNWSEReszing?u?"se-resize":"default":s?"move":"default",o.css("cursor",e))}},e.prototype._getFloatingObjectTopLeftResizingRect=function(t){var i=this,f=r(i._resizeInfo.startX+i._resizeInfo.startWidth,t.x),e=r(i._resizeInfo.startY+i._resizeInfo.startHeight,t.y),o=u(t.x-i._resizeInfo.startX-i._resizeInfo.startWidth),s=u(t.y-i._resizeInfo.startY-i._resizeInfo.startHeight);return new n.Rect(f,e,o,s)},e.prototype._getFloatingObjectTopCenterResizingRect=function(t){var i=this,f=i._resizeInfo.startX,e=r(i._resizeInfo.startY+i._resizeInfo.startHeight,t.y),o=u(t.y-i._resizeInfo.startY-i._resizeInfo.startHeight),s=i._resizeInfo.startWidth;return new n.Rect(f,e,s,o)},e.prototype._getFloatingObjectTopRightResizingRect=function(t){var i=this,f=r(i._resizeInfo.startX,t.x),e=r(i._resizeInfo.startY+i._resizeInfo.startHeight,t.y),o=u(t.x-i._resizeInfo.startX),s=u(t.y-i._resizeInfo.startY-i._resizeInfo.startHeight);return new n.Rect(f,e,o,s)},e.prototype._getFloatingObjectMiddleLeftResizingRect=function(t){var i=this,f=r(i._resizeInfo.startX+i._resizeInfo.startWidth,t.x),e=i._resizeInfo.startY,o=u(t.x-i._resizeInfo.startX-i._resizeInfo.startWidth),s=i._resizeInfo.startHeight;return new n.Rect(f,e,o,s)},e.prototype._getFloatingObjectMiddleRightResizingRect=function(t){var i=this,f=r(i._resizeInfo.startX,t.x),e=i._resizeInfo.startY,o=u(t.x-i._resizeInfo.startX),s=i._resizeInfo.startHeight;return new n.Rect(f,e,o,s)},e.prototype._getFloatingObjectBottomLeftResizingRect=function(t){var i=this,f=r(i._resizeInfo.startX+i._resizeInfo.startWidth,t.x),e=r(i._resizeInfo.startY,t.y),o=u(t.x-i._resizeInfo.startX-i._resizeInfo.startWidth),s=u(t.y-i._resizeInfo.startY);return new n.Rect(f,e,o,s)},e.prototype._getFloatingObjectBottomCenterResizingRect=function(t){var i=this,f=i._resizeInfo.startX,e=r(i._resizeInfo.startY,t.y),o=u(t.y-i._resizeInfo.startY),s=i._resizeInfo.startWidth;return new n.Rect(f,e,s,o)},e.prototype._getFloatingObjectBottomRightResizingRect=function(t){var i=this,f=r(i._resizeInfo.startX,t.x),e=r(i._resizeInfo.startY,t.y),o=u(t.x-i._resizeInfo.startX),s=u(t.y-i._resizeInfo.startY);return new n.Rect(f,e,o,s)},e.prototype._getViewportRect=function(n,t){var w=this,i=w._sheet,u=i._getSheetLayout(),r=u.viewportRect(n,t),e,o,s,c,f,l=w._floatingObject,b=l.startRow(),k=l.startColumn(),d=l.endRow(),g=l.endColumn(),a=i.frozenRowCount,v=i.frozenColCount,y=i.getRowCount(3)-i.getFrozenTrailingRowCount()-1,p=i.getColumnCount(3)-i.getFrozenTrailingColumnCount()-1;return n===h?(a>0&&(e=i.getViewportTopRow(n),(b<a||e===a)&&(r.y-=u.frozenHeight,r.height+=u.frozenHeight)),i._frozenTrailingRowCount>0&&(o=i.getViewportBottomRow(n),d>y&&o===y&&(r.height+=u.frozenTrailingHeight))):n===h-1?(e=i.getViewportTopRow(n+1),(d>=e||e===a)&&(f=u.viewportRect(n+1,t),r.height+=f.height)):n===h+1&&(o=i.getViewportBottomRow(n-1),(b<=o||o===y)&&(f=u.viewportRect(n-1,t),r.y=f.y,r.height+=f.height)),t===h?(v>0&&(s=i.getViewportLeftColumn(t),(k<v||s===v)&&(r.x-=u.frozenWidth,r.width+=u.frozenWidth)),i._frozenTrailingColCount>0&&(c=i.getViewportRightColumn(t),(g>p||c===p)&&(r.width+=u.frozenTrailingWidth))):t===h-1?(s=i.getViewportLeftColumn(t+1),(g>=s||s===v)&&(f=u.viewportRect(n,t+1),r.width+=f.width)):t===h+1&&(c=i.getViewportRightColumn(t-1),(k<=c||c===p)&&(f=u.viewportRect(n,t-1),r.x=f.x,r.width+=f.width)),r},e.prototype._getTwoColumnDistance=function(n,t){for(var f=r(n,t),e=l(n,t),u=0,i=f;i<e;i++)u+=this._sheet.getColumnWidth(i,3);return u},e.prototype._getTwoRowDistance=function(n,t){for(var f=r(n,t),e=l(n,t),u=0,i=f;i<e;i++)u+=this._sheet.getRowHeight(i,3);return u},e.prototype._hitTest=function(t,r){var o=this,f,y,p,w,b,k,d,g,nt;if(!o._layout)return i;if(f={inMoving:!1,inTopNWSEResizing:!1,inTopNSResizing:!1,inTopNESWResizing:!1,inLeftWEResizing:!1,inRightWEResizing:!1,inBottomNESWResizing:!1,inBottomNSReszing:!1,inBottomNWSEReszing:!1},!o._floatingObject.isSelected())return f.inMoving=!0,f;var u=s(e._resizeIndicatorSize/2+1),l=10,h=o._layout.x,c=o._layout.y,a=o._layout.width,v=o._layout.height;return(o._floatingObject&&o._floatingObject.isSelected()&&(h-=u,c-=u,a+=2*u,v+=2*u),y=o._inflateRect(new n.Rect(h,c,u,u),l),y.contains(t,r))?(f.inTopNWSEResizing=!0,f):(p=o._inflateRect(new n.Rect(h+a/2-u,c,2*u,u),l),p.contains(t,r))?(f.inTopNSResizing=!0,f):(w=o._inflateRect(new n.Rect(h+a-u,c,u,u),l),w.contains(t,r))?(f.inTopNESWResizing=!0,f):(b=o._inflateRect(new n.Rect(h,c+v/2-u,u,2*u),l),b.contains(t,r))?(f.inLeftWEResizing=!0,f):(k=o._inflateRect(new n.Rect(h+a-u,c+v/2-u,u,2*u),l),k.contains(t,r))?(f.inRightWEResizing=!0,f):(d=o._inflateRect(new n.Rect(h,c+v-u,u,u),l),d.contains(t,r))?(f.inBottomNESWResizing=!0,f):(g=o._inflateRect(new n.Rect(h+a/2-u,c+v-u,2*u,u),l),g.contains(t,r))?(f.inBottomNSReszing=!0,f):(nt=o._inflateRect(new n.Rect(h+a-u,c+v-u,u,u),l),nt.contains(t,r))?(f.inBottomNWSEReszing=!0,f):(f.inMoving=!0,f)},e.prototype._inflateRect=function(t,i){var f=t.x-i,e=t.y-i,r=t.width+2*i,u=t.height+2*i;return new n.Rect(f,e,r>=0?r:0,u>=0?u:0)},e._resizeIndicatorSize=7,e}();n._FloatingObjectRender=c;bt=function(){function t(n){this._sheet=n;this._containerArray=new w}return t.prototype.getFloatingObjectRenderCount=function(){return this._containerArray.length},t.prototype._dispose=function(){for(var t=this._containerArray.length,n=0;n<t;n++)this._containerArray[n]._dispose();this._containerArray.length=0},t.prototype._render=function(t,r,u){var g,ft,st,nt,ht,a,vt;if(!(t<0)&&!(r<0)){for(var o=this,w=o._sheet,rt=o._createViewportFloatingObjectLayoutModel(t,r,u),ut=[],f=0,d=o._containerArray.length;f<d;f++)rt.find(o._containerArray[f].name)||ut.push(o._containerArray[f]);for(f=0,d=ut.length;f<d;f++)g=ut[f],g._renderManager=i,o._containerArray.remove(g.name),g._dispose();if(ft=rt.length,!(ft<=0))for(st=w.parent&&w.parent.useTouchLayout(),c._resizeIndicatorSize=st?11:7,f=0;f<ft;f++){var h=rt[f],b=w._findFloatingObjectInternal(h.name),e=s(c._resizeIndicatorSize/2+1);b&&typeof b.borderWidth=="function"&&(nt=b.borderWidth(),ht=b.borderStyle(),b._isBorderStyleWork(ht)||(nt=0),nt>e&&(e=nt));var p=o._getViewportRect(t,r),k=1,ct=h.x-e-k,lt=h.y-e-k,yt=h.width+2*e+2*k,pt=h.height+2*e+2*k,et=l(p.y,lt),ot=l(p.x,ct),tt=pt,it=yt,v=e,y=e,at=-1*e-k;v=lt-et+v;y=ct-ot+y;v<=0?(tt+=v,tt+=at):v<e&&v>0&&(tt-=e-v);y<=0?(it+=y,it+=at):y<e&&y>0&&(it-=e-y);a=o._containerArray.find(h.name);a||(a=new c(w._findFloatingObjectInternal(h.name),w),a._renderManager=o,o._containerArray.push(a));a._layout=h;a._rowViewportIndex=t;a._columnViewportIndex=r;vt=new n.Rect(p.x,p.y,p.width,p.height);a.render(new n.Rect(ot,et,it,tt).getIntersectRect(vt)||new n.Rect(ot,et,0,0),new n.Rect(y,v,h.width,h.height))}}},t.prototype.setFloatingObjectZIndex=function(n,t){var i=this._containerArray.find(n);i&&i.setFloatingObjectZIndex(t)},t.prototype.getFloatingObjectZIndex=function(n){var t=this._containerArray.find(n);return t?t.getFloatingObjectZIndex():-1},t.prototype.reduceZIndex=function(){for(var t,i,r=this._containerArray,n=0,u=r.length;n<u;n++)t=r[n],i=t.getFloatingObjectZIndex(),i!==-1&&t.setFloatingObjectZIndex(i-1)},t.prototype._getViewportRect=function(t,i){var f=this._sheet,u=f._getViewportColumnLayout(i),e=0,o=0,c=0,l=0,a,s,r,v,h,y,p;return u&&u.length>0&&(a=u[0],s=u[u.length-1],e=a.x,c=s.x+s.width-e),r=f._getViewportRowLayout(t),r&&r.length>0&&(v=r[0],h=r[r.length-1],o=v.y,l=h.y+h.height-o),y=f._getSheetLayout(),p=y.viewportRect(t,i),p.getIntersect(e,o,c,l)||new n.Rect(0,0,0,0)},t.prototype._createViewportFloatingObjectLayoutModel=function(n,t,i){var lt=this,o=lt._sheet,v=new w,e=o._floatingObjectArray,at=e.length,p,r,u,f,ut,l,ft,b,k,a,ot,d,g,ht,ct;if(e.length===0)return v;e.isNeedToUpdateLayout&&(e._updateFloatingsObjectlayoutOnColumnRowChanged(),e.isNeedToUpdateLayout=!1);var st=o._getSheetLayout(),y=o._cachePool,h=o._getViewportColumnLayout(t),c=o._getViewportRowLayout(n);if(h.length<=0||c.length<=0)return v;var nt=h[0],tt=h[h.length-1],it=c[0],rt=c[c.length-1];for(p=0;p<at;p++)if(r=e[p],r.isVisible()){if(r.fixedPosition())ut=r.position(),u=ut.x*i+st.frozenX,f=ut.y*i+st.frozenY;else{if(u=0,l=r.startColumn(),ft=h.findCol(l),ft)u=ft.x;else if(l<nt.col)for(u=nt.x,b=nt.col-1;b>=l;b--)u-=y.getZoomColWidth(b);else for(u=tt.x+tt.width,k=tt.col+1;k<=l;k++)u+=y.getZoomColWidth(k);if(u+=r.startColumnOffset()*i,f=0,a=r.startRow(),ot=c.findRow(a),ot)f=ot.y;else if(a<it.row)for(f=it.y,d=it.row-1;d>=a;d--)f-=y.getZoomRowHeight(d);else for(f=rt.y+rt.height,g=rt.row+1;g<=a;g++)f+=y.getZoomRowHeight(g);f+=r.startRowOffset()*i}ht=s(r.width()*i);ct=s(r.height()*i);v.push(new et(r.name(),u,f,ht,ct))}return v},t}();n._FloatingObjectRenderManager=bt;et=function(){function n(n,t,i,r,u){var f=this;f.name=n;f.x=t;f.y=i;f.height=u;f.width=r}return n}();n._FloatingObjectLayout=et;w=function(n){function t(){n.call(this)}return __extends(t,n),t.prototype.remove=function(n){for(var t=0;t<this.length;t++)if(this[t].name===n){this.splice(t,1);return}},t.prototype.find=function(n){for(var t=0;t<this.length;t++)if(this[t].name===n)return this[t];return i},t.prototype.findByPropertyName=function(n){for(var t=0;t<this.length;t++)if(this[t]._name===n)return this[t];return i},t}(n._XArray);n.NamedObjectArray=w})(n.Sheets||(n.Sheets={}));var t=n.Sheets})(GcSpread||(GcSpread={}))
