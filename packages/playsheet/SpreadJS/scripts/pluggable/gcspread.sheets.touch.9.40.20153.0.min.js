/*
 *
 * SpreadJS Library 9.40.20153.0
 *
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 *
 * Licensed under the SpreadJS Commercial License. 
 * spread.sales@grapecity.com
 * http://spread.grapecity.com/Pages/Spread-JS-License/
 *
 *
 **/
var __extends,GcSpread;(function(n){(function(n){n.feature("basedialog",["core.common"]);var t=function(){function t(n,t){var i=this;i.host=n;i._wijpopupClass="wijspread-popup";i._overlayClass="wijspread-overlay";t=t||0;i.defaultOverlayCSS={position:"fixed",width:"100%",height:"100%",margin:0,padding:0,top:0,left:0,border:"none",zIndex:t,backgroundColor:"rgba(0,0,0,0)"};i.defaultContainerCSS={position:"absolute",padding:0,margin:0,height:"auto",zIndex:t+1,outline:"none"};i._init()}return t.prototype._init=function(){var t=this;t._hasTargetContainer(t._name)?t.container=n.GC$("#"+t._name):(t._name=t._generateName(),t.container=n.GC$(document.createElement("div")).addClass(t._wijpopupClass+" ui-widget").attr({id:t._name,tabIndex:-1}).css(t.defaultContainerCSS))},t.prototype._generateName=function(){for(var n=0,t="dialog";this._hasTargetContainer(t+n);)n++;return t+n},t.prototype.getContainer=function(){if(this.container)return this.container},t.prototype.getHost=function(){return this.host?this.host:document.body},t.prototype.show=function(t){var i=this,u=arguments.length,r=i.container;i._hasOverlay()||i._createOverlay();window.gcGlobal.suspendEvent();i._hasTargetContainer(i._name)||(n.GC$(i.getHost()).append(r),i.resetDialogPosition(),r.css("display","none"));r.show(t)},t.prototype.close=function(){var t=this;t._hasTargetContainer(t._name)&&t.container.remove();n.GC$("."+t._wijpopupClass).isVisible()||t.closeOverlay();window.gcGlobal.resumeEvent()},t.prototype.closeOverlay=function(){n.GC$("."+this._overlayClass).remove()},t.prototype.resetDialogPosition=function(){var t=this.container,a=this.getHost();if(t.length()!==0){var u=n.GC$(a).offset(),i=parseInt(t.css("left"))+u.left,r=parseInt(t.css("top"))+u.top,e=t.width(),o=t.height();if(!isNaN(i)&&!isNaN(r)&&!isNaN(e)&&!isNaN(o)){var s=0,h=0,c=document.documentElement.clientWidth,l=document.documentElement.clientHeight,f=t.getElement(0).getBoundingClientRect();f.left+e>c&&(h=f.left+e-c);f.top+o>l&&(s=f.top+o-l);(i<0||r<0||s>0||h>0)&&(i-=h,r-=s,i<0&&(i=0),r<0&&(r=0),t.css({left:i-u.left+"px",top:r-u.top+"px"}))}}},t.prototype._hasTargetContainer=function(t){return n.GC$("#"+t).length()>0?!0:!1},t.prototype._createOverlay=function(){var t=this,u=n.GC$(document.createElement("div")).addClass(t._overlayClass),i,r,f;u.css(t.defaultOverlayCSS);n.GC$(t.host).append(u);i=n.util.browser&&n.util.browser.mozilla;r=n.util.browser&&n.util.browser.qtMode;(i||r)&&(f=(new Date).valueOf());u.bind("mousedown",function(u){if(i||r){var e=(new Date).valueOf();if(e-f<100)return}t.close();(i||r)&&t._delayCloseTimeout&&window.clearTimeout(t._delayCloseTimeout);n.util.cancelDefault(u)});"touchstart MSPointerDown pointerdown".split(" ").forEach(function(f,e){u.bind(f,function(u){i||r?t._delayCloseTimeout=setTimeout(function(){t.close()},100):t.close();n.util.cancelDefault(u)})})},t.prototype._hasOverlay=function(){return n.GC$("."+this._overlayClass).length()>0?!0:!1},t}();n.BaseDialog=t})(n.Sheets||(n.Sheets={}));var t=n.Sheets})(GcSpread||(GcSpread={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){(function(n){var i,ht,ct,lt,b,at,vt,yt,s,k,h,pt,wt,bt,kt,dt,c,gt,ni,d,ti,ii;n.feature("touch",["core.common","core.sheet_action","core.sheet_model","core.sheet_border"]);var t=null,u=undefined,r=Math.abs,v=Math.min,g=Math.max,nt=Math.pow,tt=Math.atan2,o=Math.PI,p=Math.round,w=Math.sqrt,it=Math.atan,rt=Math.log,ut=Math.floor,f="undefined",ri=100,ui=function(){function r(){var n=this;n._elements=[];n._pressedPointers={length:0};n._checkPointerIntervalId=-1;n._manipulationProcessor=new fi;n._tapEventProcesser=new ei}return r.prototype.ManipulationStarting=function(n){var t=this._manipulationProcessor;t&&(t.ManipulationStarting=n)},r.prototype.ManipulationStarted=function(n){var t=this._manipulationProcessor;t&&(t.ManipulationStarted=n)},r.prototype.ManipulationCompleted=function(n){var t=this,i=t._manipulationProcessor;i&&(i.ManipulationCompleted=function(i){if(n){n(i);var r=t._touchMouseMessageFilter;r&&r.postProcessManipulationComplete()}})},r.prototype.ManipulationInertiaStarting=function(n){var t=this._manipulationProcessor;t&&(t.ManipulationInertiaStarting=n)},r.prototype.ManipulationDelta=function(n){var t=this._manipulationProcessor;t&&(t.ManipulationDelta=n)},r.prototype.Tapped=function(n){var t=this._tapEventProcesser;t&&(t.Tapped=n)},r.prototype.DoubleTapped=function(n){var t=this._tapEventProcesser;t&&(t.DoubleTapped=n)},r.prototype.RightTapped=function(n){var t=this._tapEventProcesser;t&&(t.RightTapped=n)},r.prototype.TouchOperatorStart=function(n){this.touchOperatorStart=n},r.prototype.TouchOperatorEnd=function(n){this.touchOperatorEnd=n},r.prototype._getOffsetRelativeToDownElement=function(t,i){var r={left:0,top:0},u,f,e;return u=i?i.element:this._downElement.element,t!==u&&(f=n.GC$(t).offset(),e=n.GC$(u).offset(),r.left=f.left-e.left,r.top=f.top-e.top),r},r.prototype.msPointerDown=function(t,r){var u,f,e,o;(r.pointerType===r.MSPOINTER_TYPE_TOUCH||r.pointerType==="touch")&&(u=this._getOffsetRelativeToDownElement(r.target,t),f=this._down(t,r.target,r.pointerId,new i(r.offsetX+u.left,r.offsetY+u.top),r.timeStamp),f&&n.util.cancelDefault(r),this._downElement.eventFlag==="sheet"&&(e=r.pageX-(r.offsetX+u.left),o=r.pageY-(r.offsetY+u.top),window.gcGlobal.canvasOffset={top:o,left:e}))},r.prototype.msPointerMove=function(t){if(t.pointerType===t.MSPOINTER_TYPE_TOUCH||t.pointerType==="touch"){if(this._pressedPointers[t.pointerId]===u)return!1;var r=this._getOffsetRelativeToDownElement(t.target),f=this._move(t.pointerId,new i(t.offsetX+r.left,t.offsetY+r.top),t.timeStamp);f&&n.util.cancelDefault(t)}},r.prototype.msPointerUp=function(t){if(t.pointerType===t.MSPOINTER_TYPE_TOUCH||t.pointerType==="touch"){if(this._pressedPointers[t.pointerId]===u)return!1;var r=this._getOffsetRelativeToDownElement(t.target),f=this._up(t.pointerId,new i(t.offsetX+r.left,t.offsetY+r.top));f&&n.util.cancelDefault(t)}},r.prototype.msPointerCancel=function(t){if(t.pointerType===t.MSPOINTER_TYPE_TOUCH||t.pointerType==="touch"){if(this._pressedPointers[t.pointerId]===u)return!1;var r=this._getOffsetRelativeToDownElement(t.target),f=this._cancel(t.pointerId,new i(t.offsetX+r.left,t.offsetY+r.top));f&&n.util.cancelDefault(t)}},r.prototype._getElementOffset=function(t){var i=n.GC$(t).offset();return i?(isNaN(document.body.clientTop)||(i.top+=document.body.clientTop),isNaN(document.body.clientLeft)||(i.left+=document.body.clientLeft)):i={top:0,left:0},i},r.prototype.touchStart=function(t,r){for(var u,s,o=this._getElementOffset(t.element),f=!1,e=0;e<r.changedTouches.length;e++)u=r.changedTouches[e],s=n.util.browser.mozilla?(new Date).valueOf():r.timeStamp,f=this._down(t,r.target,u.identifier,new i(u.pageX-o.left,u.pageY-o.top),s)||f;f&&n.util.cancelDefault(r)},r.prototype.touchMove=function(t){for(var r,o,e=this._getElementOffset(this._downElement.element),u=!1,f=0;f<t.changedTouches.length;f++)r=t.changedTouches[f],o=n.util.browser.mozilla?(new Date).valueOf():t.timeStamp,u=this._move(r.identifier,new i(r.pageX-e.left,r.pageY-e.top),o)||u;u&&n.util.cancelDefault(t)},r.prototype.touchEnd=function(t){for(var r,e=this._getElementOffset(this._downElement.element),u=!1,f=0;f<t.changedTouches.length;f++)r=t.changedTouches[f],u=this._up(r.identifier,new i(r.pageX-e.left,r.pageY-e.top))||u;u&&n.util.cancelDefault(t)},r.prototype.touchCancel=function(t){for(var r,e=this._getElementOffset(this._downElement.element),u=!1,f=0;f<t.changedTouches.length;f++)r=t.changedTouches[f],u=this._cancel(r.identifier,new i(r.pageX-e.left,r.pageY-e.top))||u;u&&n.util.cancelDefault(t)},r.prototype._startCheckPointer=function(){this._checkPointerIntervalId===-1&&(this._checkPointerIntervalId=setInterval(this._checkCancelPointer,200))},r.prototype._endCheckPointer=function(){this._checkPointerIntervalId!==-1&&(clearInterval(this._checkPointerIntervalId),this._checkPointerIntervalId=-1)},r.prototype._checkCancelPointer=function(){var i=this,u,t;if(!i._manipulationProcessor||i._manipulationProcessor._process!==3){var e=(new Date).valueOf(),n=[],r=i._pressedPointers,f=0;for(u in r)e-r[u].time>200&&n.push(r[u]),f++;for(t=0;t<n.length;t++)i._cancel(n[t].id,n[t].position),delete r[n[t].id];f===n.length&&i._endCheckPointer()}},r.prototype._fixPosition=function(t){var i=this,r,u;if(i._downElement===i._manipulationElement)return t;r=n.GC$(i._downElement.element).offset();u=n.GC$(i._manipulationElement.element).offset();t.X+=r.left-u.left;t.Y+=r.top-u.top},r.prototype._setCaptureElement=function(n,i){var r=this,h=r._elements,f,u;for(r._manipulationElement=t,r._touchMouseMessageFilter=t,f=0;f<h.length;f++)if(h[f]===n){var o=h[f],e=t,s=t;if(o.canDoManipulation&&!o.canDoManipulation()){for(f=0;f<h.length;f++)if(u=h[f],u!==o&&u.level>=0&&u.level<o.level&&(!u.canDoManipulation||u.canDoManipulation())){e=u;break}if(e===t)return!1}if(o.canDoTap&&!o.canDoTap()){for(f=0;f<h.length;f++)if(u=h[f],u!==o&&u.level>=0&&u.level<o.level&&(!u.canDoTap||u.canDoTap())){s=u;break}if(s===t)return!1}e===t&&(e=o);s===t&&(s=o);r._downElement=o;r._manipulationElement=e;r._tapElement=s;r.ManipulationStarting(e.manipulationStarting||t);r.ManipulationStarted(e.manipulationStarted||t);r.ManipulationDelta(e.manipulationDelta||t);r.ManipulationInertiaStarting(e.manipulationInertiaStarting||t);r.ManipulationCompleted(e.manipulationCompleted||t);r.Tapped(s.tapped||t);r.DoubleTapped(s.doubleTapped||t);r.RightTapped(s.rightTapped||t);r.TouchOperatorStart(e.touchOperatorStart||t);r.TouchOperatorEnd(e.touchOperatorEnd||t);e.messageFilter&&(r._touchMouseMessageFilter=o.messageFilter);break}return!0},r.prototype._down=function(n,i,r,e,o){var s=this;return s._pressedPointers[r]!==u?!1:s._pressedPointers.length===0&&!s._setCaptureElement(n,i)?!1:s._manipulationElement===t||typeof s._manipulationElement===f?!1:s._pressedPointers.length>=s._manipulationElement.maxPointer?!0:s._touchMouseMessageFilter&&s._touchMouseMessageFilter.preProcessPointerDown()?!1:(s._fixPosition(e),s._touchMouseMessageFilter&&s._pressedPointers.length===0&&s._touchMouseMessageFilter.preProcessManipulationStarting(),s._pressedPointers[r]={id:r,time:(new Date).valueOf(),position:e},s._pressedPointers.length++,s._manipulationProcessor&&(s._manipulationProcessor.PreviewPointerDown(i,r,e,o),s._manipulationProcessor.PointerDown(r,e,s._pressedPointers.length,o)),s._pressedPointers.length===1&&s._tapEventProcesser&&s._tapEventProcesser.PointerDown(e),s._pressedPointers.length===1&&s.touchOperatorStart&&s.touchOperatorStart({Position:e}),!0)},r.prototype._move=function(n,t,i){var r=this;return r._pressedPointers[n]===u?!1:r._touchMouseMessageFilter&&r._touchMouseMessageFilter.preProcessPointerMove()?!1:(r._fixPosition(t),r._pressedPointers[n]={id:n,time:(new Date).valueOf(),position:t},r._manipulationProcessor&&r._manipulationProcessor.PointerMove(n,t,i),!0)},r.prototype._up=function(n,t){var i=this;return i._pressedPointers[n]===u?!1:(delete i._pressedPointers[n],i._pressedPointers.length--,i._touchMouseMessageFilter&&i._touchMouseMessageFilter.preProcessPointerUp())?!1:(i._fixPosition(t),i._manipulationProcessor&&(i._manipulationProcessor.PreviewPointerUp(n),i._manipulationProcessor.PointerUp(n)),i._pressedPointers.length===0&&i._tapEventProcesser&&(i._tapEventProcesser.PreviewPointerUp(t),i._tapEventProcesser.PointerUp(t)),i._pressedPointers.length===0&&i.touchOperatorEnd&&i.touchOperatorEnd({Position:t}),i._touchMouseMessageFilter&&i._pressedPointers.length===0&&i._manipulationProcessor._process===0&&i._touchMouseMessageFilter.postProcessManipulationComplete(),!0)},r.prototype._cancel=function(n,t){return this._up(n,t)},r.prototype.attachDettach=function(i,r){var u=this,o=i.element,h=u._elements,c=n.ArrayHelper.indexOf(h,i);if((!(c>=0)||!r)&&(!(c<0)||r)){var s="."+i.eventFlag,e=".gcSheet",l="MSPointerDown"+e,a="MSPointerMove"+e+s,v="MSPointerUp"+e+s,y="MSPointerCancel"+e+s,p="MSLostPointerCapture"+e+s,w="pointerdown"+e,b="pointermove"+e+s,k="pointerup"+e+s,d="LostPointerCapture"+e+s,g="pointercancel"+e+s,nt="touchstart"+e,tt="touchmove"+e,it="touchend"+e,rt="touchcancel"+e,ut=window.navigator.msPointerEnabled||window.navigator.pointerEnabled;r?ut?(o.style.msTouchAction!==t&&typeof o.style.msTouchAction!==f&&(o.style.msTouchAction="none"),o.style.touchAction!==t&&typeof o.style.touchAction!==f&&(o.style.touchAction="none"),function(t,i){n.GC$(o).bind(l,function(n){u.msPointerDown(t,n)}).bind(w,function(n){u.msPointerDown(t,n)})}.call(u,i),n.GC$(document).bind(a,function(n){u.msPointerMove(n)}).bind(v,function(n){u.msPointerUp(n)}).bind(b,function(n){u.msPointerMove(n)}).bind(k,function(n){u.msPointerUp(n)}).bind(y,function(n){u.msPointerCancel(n)}).bind(p,function(n){u.msPointerCancel(n)}).bind(d,function(n){u.msPointerCancel(n)}).bind(g,function(n){u.msPointerCancel(n)})):(function(t,i){n.GC$(o).bind(nt,function(n){u.touchStart(t,n)})}.call(u,i),n.GC$(o).bind(tt,function(n){u.touchMove(n)}).bind(it,function(n){u.touchEnd(n)}).bind(rt,function(n){u.touchCancel(n)})):ut?(n.GC$(o).unbind(l).unbind(w),n.GC$(document).unbind(a).unbind(b).unbind(v).unbind(k).unbind(y).unbind(g).unbind(p).unbind(d)):n.GC$(o).unbind(nt).unbind(tt).unbind(it).unbind(rt);r?h.push(i):h.splice(c,1)}},r.prototype.dispose=function(){for(var t=this._elements,n=t.length-1;n>=0;n--)this.attachDettach(t[n],!1)},r}();n.TouchEventProvider=ui;var fi=function(){function n(){var n=this;n._totalTranslateX=0;n._totalTranslateY=0;n._totalScale=1;n._totalRotation=0;n._totalExpansion=0;n._process=0;n._workingModes=511;n._manipulatorPointers=new pi;n._minimumScaleRotateRadius=20;n._deltaHistory=new hi}return n.prototype.PreviewPointerDown=function(n,t,i,r){var u=this,f;u._process===3&&u.Complete(!0);u._isScroll=u._process===2?u._manipulatorPointers.Count()===1:!1;u._originalSource=n;f=new yi(t);f.PreviousPoint=i;f.InitialPoint=i;u._manipulatorPointers.Add(f);u._lastTime=r;u._manipulatorPointers.Count()>1&&(u.TranslateXLocked=!1,u.TranslateYLocked=!1,u._process===1&&u.StartManipulation())},n.prototype.PointerDown=function(n,t,i,r){this._process===0&&i===1&&this.Starting(this._manipulatorPointers.ItemAt(0).InitialPoint)},n.prototype.PointerMove=function(n,i,u){var f=this,c,l,a,h,o,s;if(f._workingModes!==0&&f._manipulatorPointers.Contains(n)){if(f._process===1&&f._manipulatorPointers.Count()===1){if(c=f.IsPinned(),!f.SupportsMode(1)&&!f.SupportsMode(2)&&!c)return;if(e.AreClose(i,f._manipulatorPointers.Find(n).InitialPoint))return;else l=r(i.X-f._manipulatorPointers.Find(n).InitialPoint.X),a=r(i.Y-f._manipulatorPointers.Find(n).InitialPoint.Y),f.SetTranslateRails(l,a)}if(!(u-f._lastTime<e.ManipulationDeltaInterval)){if(f._manipulatorPointers.Find(n).CurrentPoint=i,h=f._manipulatorPointers.Count(),h>1)for(o=0;o<h;o++)if(s=f._manipulatorPointers.ItemAt(o),!s.CurrentPoint)return;for(f.PointerMoveCore(u),f._lastTime=u,h=f._manipulatorPointers.Count(),o=0;o<h;o++)s=f._manipulatorPointers.ItemAt(o),s.PreviousPoint=s.CurrentPoint,s.CurrentPoint=t}}},n.prototype.PointerUp=function(n){var i=this;i._needFireEvents&&(i.OnManipulationCompleted(i._needFireEvents),i._needFireEvents=t)},n.prototype.PreviewPointerUp=function(n){var t=this;t._manipulatorPointers.Contains(n)&&(t._manipulatorPointers.Remove(n),t._process===2?t._manipulatorPointers.Count()===0&&(t.SupportsMode(64)||t.SupportsMode(256)||t.SupportsMode(128)?t.StartInertia():t.Complete(!0)):t._process===2||t._process===3?t.Complete(!0):t._process===1&&t.Complete(!1))},n.prototype.PointerMoveCore=function(n){var t=this,f,e,o,c,s,v,y=t.CalculateTranslate(),h,r,w,u,b,p;if(f=y.translateX,e=y.translateY,v=y.position,h=t.CalculateRotationAndScale(),s=h.rotation,c=h.scale,o=h.expansion,t._totalTranslateX+=f,t._totalTranslateY+=e,t._totalScale*=c,t._totalRotation+=s,t._totalExpansion+=o,r=new si,r.expansion=o,r.rotation=s,r.timeStamp=n-t._lastTime,r.translateX=f,r.translateY=e,t._deltaHistory.Enqueue(r),t._lastPosition=v,t._process===1||t._process===2){if(t._process===1&&(w=t.StartManipulation(),w))return;if(u=new a,u.Expansion=o,u.Rotation=s,u.Scale=c,u.Translation=new i(f,e),b=new l(t._deltaHistory),p=new ft(t._originalSource,t.GetCumulative(),u,!1,v,b),t.OnManipulationDelta(p),p.IsComplete){t.Complete(!0);return}}},n.prototype.StartManipulation=function(){var n=this,t;return(n._process=2,t=new di(n._originalSource,n._manipulatorPointers.Count(),n.GetCumulative(),n._manipulatorPointers.ItemAt(0).InitialPoint),n.OnManipulationStarted(t),t.IsComplete)?(n.Complete(!0),!0):!1},n.prototype.SetTranslateRails=function(n,t){var i=oi.GetTranslateLocked(n,t);this.TranslateXLocked=i.translateXLocked;this.TranslateYLocked=i.translateYLocked},n.prototype.CalculateTranslate=function(){var t=0,r=0,u=this.GetAveragePoint(),n=u.currentAveragePoint,f=u.previousAveragePoint,e=new i(n.X,n.Y);return t=n.X-f.X,r=n.Y-f.Y,{translateX:t,translateY:r,position:e}},n.prototype.CalculateRotationAndScale=function(){var n=this,t=0,r=1,u=0,i;return n.SupportsMode(16)&&n._manipulatorPointers.Count()===1&&n.IsPinned()&&(t=n.CalculateSingleManipulatorRotation(n._manipulatorPointers.ItemAt(0).CurrentPoint,n._manipulatorPointers.ItemAt(0).PreviousPoint,n._pivot)),n._manipulatorPointers.Count()>1&&(i=n.CalculateMultiManipulatorRotationAndScale(),t=i.rotation,r=i.scale,u=i.expansion),t=t/o*180,{rotation:t,scale:r,expansion:u}},n.prototype.CalculateMultiManipulatorRotationAndScale=function(){for(var d,n=this,y=n.GetAveragePoint(),c=y.currentAveragePoint,l=y.previousAveragePoint,f=n.IsPinned(),t=f?n._pivot.Center:new i(0,0),e=0,p=1,w=0,a=0,o=0,s=0,v=0,g=n._manipulatorPointers.Count(),h=0;h<g;h++){var r=n._manipulatorPointers.ItemAt(h).CurrentPoint,u=n._manipulatorPointers.ItemAt(h).PreviousPoint,b=n.GetLength(r,c),k=n.GetLength(u,l),nt=f?new i(u.X-t.X,u.Y-t.Y):new i(u.X-l.X,u.Y-l.Y),tt=f?new i(r.X-t.X,r.Y-t.Y):new i(r.X-c.X,r.Y-c.Y),it=n.GetLength(u,t),rt=n.GetLength(r,t);k>=n._minimumScaleRotateRadius&&b>=n._minimumScaleRotateRadius&&(o++,s+=b,v+=k,(!f||it>=n._minimumScaleRotateRadius)&&rt>=n._minimumScaleRotateRadius&&(d=n.AngleBetween(nt,tt),e+=d,a++))}return e=a>0&&n.SupportsMode(16)?e/a:0,o>0&&n.SupportsMode(32)?(n._isScroll||(p=s/v),w=(s-v)/o,n._lastDistance=s/o):n._lastDistance=0,{rotation:e,scale:p,expansion:w}},n.prototype.CalculateSingleManipulatorRotation=function(n,t,r){var u=new i(r.Center.X,r.Center.Y),e=new i(t.X-u.X,t.Y-u.Y),o=new i(n.X-u.X,n.Y-u.Y),s=v(1,nt(this.GetLength(t,u)/r.Radius,4)),f=this.AngleBetween(e,o);return isNaN(f)?0:f*s},n.prototype.AngleBetween=function(n,t){var i=tt(t.Y,t.X)-tt(n.Y,n.X);return i>o?i-=o*2:i<-o&&(i+=o*2),i},n.prototype.SupportsMode=function(n){return(this._workingModes&n)!=0},n.prototype.GetLength=function(n,t){return w((t.X-n.X)*(t.X-n.X)+(t.Y-n.Y)*(t.Y-n.Y))},n.prototype.GetAveragePoint=function(){for(var t,s,h,u=0,f=0,e=0,o=0,n=this._manipulatorPointers.Count(),r=0;r<n;r++)t=this._manipulatorPointers.ItemAt(r),u+=t.PreviousPoint.X,f+=t.PreviousPoint.Y,e+=t.CurrentPoint.X,o+=t.CurrentPoint.Y;return s=new i(u/n,f/n),h=new i(e/n,o/n),{currentAveragePoint:h,previousAveragePoint:s}},n.prototype.IsPinned=function(){return this._pivot&&!isNaN(this._pivot.Radius)},n.prototype.Starting=function(n){var i=this,r=new gi(i._originalSource,i._workingModes,t,n);return r.Mode=511,i.OnManipulationStarting(r),i.ManipulationMode=r.Mode,r.Mode===0?(i.Complete(!1),!1):(i._workingModes=r.Mode,i._pivot=r.Pivot,i._process=1,!0)},n.prototype.Complete=function(n){var r=this,f=r._process===3,u;r._process=0;r._inertiaTimer&&(clearInterval(r._inertiaTimer),r._inertiaTimer=t);n&&(u=new bi(r._originalSource,r.GetCumulative(),f,i.Round(r._lastPosition),new l(r._deltaHistory)),r._process===3?r._needFireEvents=u:r.OnManipulationCompleted(u));r._deltaHistory.Clear();r._manipulatorPointers.Clear();r._pivot=t;r._totalTranslateX=0;r._totalTranslateY=0;r._totalScale=1;r._totalRotation=0;r._totalExpansion=0;r.TranslateXLocked=!1;r.TranslateYLocked=!1;r._workingModes=0},n.prototype.StartInertia=function(){var i=this,n=new vi,r=new l(i._deltaHistory),u,f;if(n.CurrentTranslateXVelocity=i.SupportsMode(64)?r.Linear().X:0,n.CurrentTranslateYVelocity=i.SupportsMode(64)?r.Linear().Y:0,n.CurrentExpansionVelocity=i.SupportsMode(256)?r.Expansion():0,n.CurrentRotationVelocity=i.SupportsMode(128)?r.Angular():0,n.CurrentTranslateXVelocity===0&&n.CurrentTranslateYVelocity===0&&n.CurrentExpansionVelocity===0&&n.CurrentRotationVelocity===0){i.Complete(!0);return}n.TranslateBehavior=new ai(n.CurrentTranslateXVelocity,n.CurrentTranslateYVelocity);n.ExpansionBehavior=new ci(n.CurrentExpansionVelocity);n.RotationBehavior=new li(n.CurrentRotationVelocity);r=new l(t,n.CurrentTranslateXVelocity,n.CurrentTranslateYVelocity,n.CurrentRotationVelocity,n.CurrentExpansionVelocity);u=new ki(i._originalSource,i.GetCumulative(),new a,r,n.ExpansionBehavior,n.RotationBehavior,n.TranslateBehavior);i.OnManipulationInertiaStarting(u);n.TranslateBehavior=u.TranslationBehavior;n.ExpansionBehavior=u.ExpansionBehavior;n.RotationBehavior=u.RotationBehavior;n.TranslateBehavior.XDeceleration<=0&&n.TranslateBehavior.YDeceleration<=0&&n.TranslateBehavior.SetDecelerationInternal(.003);n.ExpansionBehavior.DecelerationInternal()<=0&&n.ExpansionBehavior.SetDecelerationInternal(.002);n.RotationBehavior.DecelerationInternal()<=0&&n.RotationBehavior.SetDecelerationInternal(.003);f=(new Date).valueOf();n.StartTime=f;n.LastTime=f;n.DeltaXRemainder=0;n.DeltaYRemainder=0;i._process=3;i._inertiaTimer=setInterval(function(){try{i.InertiaTick(n)}catch(t){}},20)},n.prototype.InertiaTick=function(n){var u=this,k=(new Date).valueOf(),it=k-n.StartTime,f=k-n.LastTime,b,h,tt,g;if(f!==0){var c=n.CurrentTranslateXVelocity,v=n.CurrentTranslateYVelocity,y=n.CurrentExpansionVelocity,w=n.CurrentRotationVelocity;n.CurrentTranslateXVelocity=u.GetInertiaCurrentVelocity(f,n.TranslateBehavior.XDeceleration,n.CurrentTranslateXVelocity);n.CurrentTranslateYVelocity=u.GetInertiaCurrentVelocity(f,n.TranslateBehavior.YDeceleration,n.CurrentTranslateYVelocity);n.CurrentExpansionVelocity=u.GetInertiaCurrentVelocity(f,n.ExpansionBehavior.DecelerationInternal(),n.CurrentExpansionVelocity);n.CurrentRotationVelocity=u.GetInertiaCurrentVelocity(f,n.RotationBehavior.DecelerationInternal(),n.CurrentRotationVelocity);c=(c+n.CurrentTranslateXVelocity)/2;v=(v+n.CurrentTranslateYVelocity)/2;y=(y+n.CurrentExpansionVelocity)/2;w=(w+n.CurrentRotationVelocity)/2;n.LastTime=k;b=!1;u.IsZero(c)&&u.IsZero(v)&&u.IsZero(y)&&u.IsZero(w)&&(b=!0);var e=f*c,o=f*v,s=f*y,nt=f*w,d=1;if(u._lastDistance>0&&(u._lastDistance+s*2<0&&(s=-u._lastDistance/2+1),u._lastDistance!==0&&(d=(u._lastDistance+s*2)/u._lastDistance)),u._totalExpansion+=s,u._totalRotation+=nt,u._totalTranslateX+=e,u._totalTranslateY+=o,u._totalScale*=d,u._lastDistance+=s,u._lastPosition=new i(u._lastPosition.X+e,u._lastPosition.Y+o),n.DeltaXRemainder+=e,n.DeltaYRemainder+=o,b){if(e=p(n.DeltaXRemainder),o=p(n.DeltaYRemainder),u.IsZero(e)&&u.IsZero(o)){u.Complete(!0);return}}else r(n.DeltaXRemainder)>=1&&(e=n.DeltaXRemainder,n.DeltaXRemainder-=e),r(n.DeltaYRemainder)>=1&&(o=n.DeltaYRemainder,n.DeltaYRemainder-=o);if(h=new a,h.Translation=new i(e,o),h.Scale=d,h.Expansion=s,h.Rotation=nt,tt=new l(t,n.CurrentTranslateXVelocity,n.CurrentTranslateYVelocity,n.CurrentRotationVelocity,n.CurrentExpansionVelocity),g=new ft(u._originalSource,u.GetCumulative(),h,!0,i.Round(u._lastPosition),tt),u.OnManipulationDelta(g),g.IsComplete){u.Complete(!0);return}b&&u.Complete(!0)}},n.prototype.GetInertiaCurrentVelocity=function(n,t,i){if(this.IsZero(i))return 0;var r;return r=i<0?i+t*n:i-t*n,(r<0&&i>0||r>0&&i<0)&&(r=0),r},n.prototype.GetCumulative=function(){var n=this,t=new a;return t.Expansion=n._totalExpansion,t.Rotation=n._totalRotation,t.Scale=n._totalScale,t.Translation=new i(n._totalTranslateX,n._totalTranslateY),t},n.prototype.IsZero=function(n){return r(n)<=22204460492503131e-32},n.prototype.GetManipulationData=function(n,i,r,u){var f=this,e=new a,o=new a,s=0,h=0,c=0,v=0,p=f.SupportsMode(4)&&f.TranslateXLocked,w=f.SupportsMode(8)&&f.TranslateYLocked,y;return f.SupportsMode(1)&&!w&&(!n||f.SupportsMode(64))&&(e.Translation.X=i.Translation.X,o.Translation.X=r.Translation.X,s=u.Linear().X),f.SupportsMode(2)&&!p&&(!n||f.SupportsMode(64))&&(e.Translation.Y=i.Translation.Y,o.Translation.Y=r.Translation.Y,h=u.Linear().Y),f.SupportsMode(32)&&(!n||f.SupportsMode(256))?(e.Scale=i.Scale,e.Expansion=i.Expansion,o.Scale=r.Scale,o.Expansion=r.Expansion,v=u.Expansion()):(e.Scale=i.Scale,o.Scale=1),f.SupportsMode(16)&&(!n||f.SupportsMode(128))&&(e.Rotation=i.Rotation,o.Rotation=r.Rotation,c=u.Angular()),y=new l(t,s,h,c,v),new wi(e,o,y)},n.prototype.OnManipulationStarting=function(n){this.ManipulationStarting&&n&&this.ManipulationStarting(n)},n.prototype.OnManipulationStarted=function(n){this.ManipulationStarted&&n&&this.ManipulationStarted(n)},n.prototype.OnManipulationCompleted=function(n){if(this.ManipulationCompleted&&n){var t=this.GetManipulationData(!1,n.Cumulative,n.Cumulative,n.Velocities);n.Cumulative=t.Cumulative;n.Velocities=t.Velocities;this.ManipulationCompleted(n)}},n.prototype.OnManipulationInertiaStarting=function(n){if(this.ManipulationInertiaStarting&&n){var t=this.GetManipulationData(!1,n.Cumulative,n.Delta,n.Velocities);n.Cumulative=t.Cumulative;n.Delta=t.Delta;n.Velocities=t.Velocities;this.ManipulationInertiaStarting(n)}},n.prototype.OnManipulationDelta=function(n){if(this.ManipulationDelta&&n){var t=this.GetManipulationData(n.IsInertia,n.Cumulative,n.Delta,n.Velocities);n.Cumulative=t.Cumulative;n.Delta=t.Delta;n.Velocities=t.Velocities;this.ManipulationDelta(n)}},n}(),ei=function(){function n(){}return n.prototype.PointerDown=function(n){var t=this,i;(t._pointerCount++,t._pointerCount>1)||(i=(new Date).valueOf(),t._firstDownPosition&&e.DoubleTappedAreClose(n,t._firstDownPosition)&&i-t._lastDownTimestamp<e.DoubleTappedTimeOffset?t._count++:(t._firstDownPosition=n,t._count=1),t._lastDownPosition=n,t._lastDownTimestamp=i)},n.prototype.PointerUp=function(n){var i=this;i._needFireEvents&&(i._needFireEvents instanceof et?i.OnTapped(i._needFireEvents):i._needFireEvents instanceof ot&&i.OnRightTapped(i._needFireEvents),i._needFireEvents=t)},n.prototype.PreviewPointerUp=function(n){var i=this,r;(i._pointerCount--,i._pointerCount>0)||(r=(new Date).valueOf(),e.AreClose(n,i._lastDownPosition)?r-i._lastDownTimestamp>e.RightTappedTimeOffset?i._needFireEvents=new ot(i._lastDownPosition):i._count>1?(i._count=0,i.OnDoubleTapped(new nr(i._firstDownPosition)),i._firstDownPosition=t):i._needFireEvents=new et(i._lastDownPosition):i._firstDownPosition=t)},n.prototype.PointerCancel=function(){this._firstDownPosition=t},n.prototype.OnTapped=function(n){this.Tapped&&n&&this.Tapped(n)},n.prototype.OnDoubleTapped=function(n){this.DoubleTapped&&n&&this.DoubleTapped(n)},n.prototype.OnRightTapped=function(n){this.RightTapped&&n&&this.RightTapped(n)},n}(),oi=function(){function n(){}return n.GetTranslateLocked=function(n,t){var u=!1,r=!1,i;return n!==0&&(i=it(t/n)/o*180,i<20&&(u=!0)),n===0?r=!0:(i=it(t/n)/o*180,i>75&&i<105&&(r=!0)),{translateXLocked:u,translateYLocked:r}},n}(),e=function(){function n(){}return n.AreClose=function(t,i){if(!t||!i)return!1;var e=n.TappedMaxOffset,o=n.TappedMaxOffset,s=n.TappedMaxDistance,h=n.TappedMaxDistance,u=t.X-i.X,f=t.Y-i.Y;return r(u)<e&&r(f)<o&&w(u*u+f*f)<v(s,h)},n.DoubleTappedAreClose=function(t,i){if(!t||!i)return!1;var e=n.DoubleTappedMaxOffset,o=n.DoubleTappedMaxOffset,s=n.DoubleTappedMaxDistance,h=n.DoubleTappedMaxDistance,u=t.X-i.X,f=t.Y-i.Y;return r(u)<e&&r(f)<o&&w(u*u+f*f)<v(s,h)},n.TouchScrollOnRails=function(t){t?(n.TappedMaxOffset=13,n.TappedMaxDistance=15):(n.TappedMaxOffset=3,n.TappedMaxDistance=4)},n.TappedMaxOffset=13,n.TappedMaxDistance=15,n.DoubleTappedMaxOffset=13,n.DoubleTappedMaxDistance=15,n.DoubleTappedTimeOffset=400,n.RightTappedTimeOffset=1e3,n.ManipulationDeltaInterval=20,n}();n.TouchHelper=e;i=function(){function n(n,t){this.X=n;this.Y=t}return n.Round=function(t){return t?new n(p(t.X),p(t.Y)):new n(-1,-1)},n}();n.TouchPoint=i;var si=function(){function n(){}return n}(),hi=function(){function n(){var n=this;n._count=0;n._start=0;n._maxCount=10;n._history=new Array(n._maxCount)}return n.prototype.GetVelocity=function(n){var t=this,i,r,u;if(t._count===0)return 0;var o=t.Item(t._count-1).timeStamp,f=0,e=(1+t._count)*t._count/2;for(i=t._count-1;i>=0;i--)r=0,n===0?r=t.Item(i).translateX:n===1?r=t.Item(i).translateY:n===2?r=t.Item(i).expansion:n===3&&(r=t.Item(i).rotation),u=t.GetSingleVelocity(r,t.Item(i).timeStamp),u*=i+1,f+=u;return f/e},n.prototype.GetSingleVelocity=function(n,t){return n/t},n.prototype.Item=function(n){return this._history[this.GetInnerListIndex(n)]},n.prototype.Last=function(){return this._history[this._count-1]},n.prototype.Enqueue=function(n){var t=this,r,i;for(t._count===10&&t.Dequeue(),t._count++,t._history[t.GetInnerListIndex(t._count-1)]=n,r=e.ManipulationDeltaInterval*t._maxCount,i=0;i<t._count;i++)n.timeStamp-t._history[i].timeStamp>r&&(t.Dequeue(),i--)},n.prototype.Dequeue=function(){var n=this;n._start++;n._start===n._maxCount&&(n._start=0);n._count--},n.prototype.Clear=function(){this._count=0},n.prototype.GetInnerListIndex=function(n){return(this._start+n)%this._maxCount},n}(),l=function(){function n(n,t,r,u,f){var e=this;n?e._history=n:(e._linear=new i(t,r),e._angular=u,e._expansion=f)}return n.prototype.Linear=function(){var n=this;return n._linear||(n._linear=new i(n._history.GetVelocity(0),n._history.GetVelocity(1))),n._linear},n.prototype.Angular=function(){var n=this;return(n._angular===t||typeof n._angular===f)&&(n._angular=n._history.GetVelocity(3)),n._angular},n.prototype.Expansion=function(){var n=this;return(n._expansion===t||typeof n._expansion===f)&&(n._expansion=n._history.GetVelocity(2)),n._expansion},n}(),ci=function(){function n(n){this._initialVelocity=n;this._decelerationInternal=0}return n.prototype.DecelerationInternal=function(){var n=this;return isNaN(n.DesiredExpansion)||n.DesiredExpansion===0?isNaN(n.DesiredDeceleration)?n._decelerationInternal:n.DesiredDeceleration:.5*n._initialVelocity*n._initialVelocity/n.DesiredExpansion},n.prototype.SetDecelerationInternal=function(n){this._decelerationInternal=n},n}(),li=function(){function n(n){this._initialVelocity=n;this._decelerationInternal=0}return n.prototype.DecelerationInternal=function(){var n=this;return isNaN(n.DesiredRotation)||n.DesiredRotation===0?isNaN(n.DesiredDeceleration)?n._decelerationInternal:n.DesiredDeceleration:.5*n._initialVelocity*n._initialVelocity/n.DesiredRotation},n.prototype.SetDecelerationInternal=function(n){this._decelerationInternal=n},n}(),ai=function(){function n(n,t){var i=this;i._initialXVelocity=n;i._initialYVelocity=t;i.XDeceleration=0;i.YDeceleration=0;i._decelerationInternal=0;i._velocity=w(i._initialXVelocity*i._initialXVelocity+i._initialYVelocity*i._initialYVelocity)}return n.prototype.UpdateXYDecelerations=function(){var n=this;isNaN(n.DesiredDisplacement)||n.DesiredDisplacement===0?isNaN(n.DecelerationInternal())||n.DecelerationInternal()===0?(n.XDeceleration=0,n.YDeceleration=0):(n.XDeceleration=n.DecelerationInternal()*r(n._initialXVelocity)/n._velocity,n.YDeceleration=n.DecelerationInternal()*r(n._initialYVelocity)/n._velocity):(n.XDeceleration=.5*n._velocity*r(n._initialXVelocity)/n.DesiredDisplacement,n.YDeceleration=.5*n._velocity*r(n._initialYVelocity)/n.DesiredDisplacement)},n.prototype.SetDesiredDeceleration=function(n){this.DesiredDeceleration=n;this.UpdateXYDecelerations()},n.prototype.SetDesiredDisplacement=function(n){this.DesiredDisplacement=n;this.UpdateXYDecelerations()},n.prototype.DecelerationInternal=function(){return this.IsDefault()?this._decelerationInternal:this.DesiredDeceleration},n.prototype.SetDecelerationInternal=function(n){this._decelerationInternal=n;this.UpdateXYDecelerations()},n.prototype.IsDefault=function(){return isNaN(this.DesiredDeceleration)&&isNaN(this.DesiredDisplacement)},n}(),vi=function(){function n(){}return n}(),a=function(){function n(){var n=this;n.Translation=new i(0,0);n.Scale=0;n.Rotation=0;n.Expansion=0}return n}(),ur=function(){function n(n,t){this.Center=n;this.Radius=t}return n}(),yi=function(){function n(n){this.ID=n}return n}(),pi=function(){function n(){this._list=[]}return n.prototype.Contains=function(n){for(var i,t=0;t<this._list.length;t++)if(i=this._list[t],i.ID===n)return!0;return!1},n.prototype.Add=function(n){this._list.push(n)},n.prototype.Remove=function(n){for(var t=0;t<this._list.length;t++)if(this._list[t].ID===n){this._list.splice(t,1);break}},n.prototype.Count=function(){return this._list.length},n.prototype.ItemAt=function(n){return this._list[n]},n.prototype.Find=function(n){for(var r,i=0;i<this._list.length;i++)if(r=this._list[i],r.ID===n)return r;return t},n.prototype.Clear=function(){this._list.splice(0,this._list.length)},n}(),wi=function(){function n(n,t,i){this.Cumulative=n;this.Delta=t;this.Velocities=i}return n}(),y=function(){function n(n){this.OriginalSource=n}return n}(),bi=function(n){function t(t,i,r,u,f){n.call(this,t);var e=this;e.Cumulative=i;e.IsInertia=r;e.Position=u;e.Velocities=f}return __extends(t,n),t}(y),ft=function(n){function t(t,i,r,u,f,e){n.call(this,t);var o=this;o.Cumulative=i;o.Delta=r;o.IsInertia=u;o.Position=f;o.Velocities=e}return __extends(t,n),t}(y),ki=function(n){function t(t,i,r,u,f,e,o){n.call(this,t);var s=this;s.Cumulative=i;s.Delta=r;s.Velocities=u;s.ExpansionBehavior=f;s.RotationBehavior=e;s.TranslationBehavior=o}return __extends(t,n),t}(y),di=function(n){function t(t,i,r,u){n.call(this,t);this.PointerCount=i;this.Cumulative=r;this.Position=u}return __extends(t,n),t}(y),gi=function(n){function t(t,i,r,u){n.call(this,t);this.Mode=i;this.Pivot=r;this.Position=u}return __extends(t,n),t}(y),et=function(){function n(n){this.Position=n}return n}(),ot=function(){function n(n){this.Position=n}return n}(),nr=function(){function n(n){this.Position=n}return n}(),st;(function(n){n[n.All=511]="All";n[n.None=0]="None";n[n.TranslateX=1]="TranslateX";n[n.TranslateY=2]="TranslateY";n[n.TranslateRailsX=4]="TranslateRailsX";n[n.TranslateRailsY=8]="TranslateRailsY";n[n.Rotate=16]="Rotate";n[n.Scale=32]="Scale";n[n.TranslateInertia=64]="TranslateInertia";n[n.RotateInertia=128]="RotateInertia";n[n.ScaleInertia=256]="ScaleInertia"})(st||(st={})),function(n){n[n.NotStart=0]="NotStart";n[n.Starting=1]="Starting";n[n.Started=2]="Started";n[n.InertiaStarted=3]="InertiaStarted"}(ht||(ht={})),function(n){n[n.TranslateX=0]="TranslateX";n[n.TranslateY=1]="TranslateY";n[n.Expansion=2]="Expansion";n[n.Rotation=3]="Rotation"}(ct||(ct={})),function(n){n[n.column=1]="column";n[n.row=2]="row";n[n.range=3]="range"}(lt||(lt={}));b=function(){function i(n){this._sheet=n}return i.prototype._getTouchCanvas=function(t,i){var r=this._canvas;return r?(t!==n.DPIHelper.getLogicWidth(r)||i!==n.DPIHelper.getLogicHeight(r))&&n.DPIHelper.setSize(r,t,i):(r=document.createElement("canvas"),n.DPIHelper.adjustDevicePixel(r,null,this._sheet),n.DPIHelper.setSize(r,t,i)),r},i.prototype._getNewZoomFactor=function(n,t){var i=n*t;return i>4?i=4:i<.5&&(i=.5),i},i.prototype._saveCanvas=function(t,i,r,u){var e=this,c=n.DPIHelper.getLogicWidth(t),l=n.DPIHelper.getLogicHeight(t),f=e._getTouchCanvas(c,l),o=f.getContext("2d"),s=n.DPIHelper.getScaleX(f),h=n.DPIHelper.getScaleY(f);o.scale(1/s,1/h);o.drawImage(t,0,0,f.width,f.height,0,0,f.width,f.height);o.scale(s,h);e._canvas=f;e._oldSheetLayout=i;e._oldGroupLayout=r;e._oldZoomFactor=u},i.prototype._restoreCanvas=function(t,i,r){var nt=this,tt=nt._sheet,e,o,s,h,c,l,a,v,et=n.DPIHelper.getLogicWidth(t),ot=n.DPIHelper.getLogicHeight(t),ut=tt.getFrozenTrailingColumnCount(),ft=tt.getFrozenTrailingRowCount(),w=ut>0?1:0,b=ft>0?1:0,k=nt._oldGroupLayout,d=tt._getGroupLayout(),y=nt._oldSheetLayout,g=tt._getSheetLayout(),it=i/nt._oldZoomFactor,p=t.getContext("2d"),u=n.DPIHelper.getScaleX(t),f=n.DPIHelper.getScaleY(t),rt=nt._canvas;p.save();p.fillStyle=r;p.fillRect(0,0,et,ot);tt._render.paintGroup(p,null);e=k.x+k.width;o=k.y+k.height;s=y.frozenTrailingX-e-w;h=y.frozenTrailingY-o-b;c=d.x+d.width;l=d.y+d.height;a=s*it;v=h*it;e*=u;o*=f;s*=u;h*=f;c*=u;l*=f;a*=u;v*=f;p.scale(1/u,1/f);p.drawImage(rt,e,o,s,h,c,l,a,v);ut>0&&(e=y.frozenTrailingX-w,o=k.y+k.height,s=y.frozenTrailingWidth+w,h=y.frozenTrailingY-o-b,c=g.frozenTrailingX-w,l=d.y+d.height,a=g.frozenTrailingWidth+w,v=h*it,e*=u,o*=f,s*=u,h*=f,c*=u,l*=f,a*=u,v*=f,p.drawImage(rt,e,o,s,h,c,l,a,v));ft>0&&(e=k.x+k.width,o=y.frozenTrailingY-b,s=y.frozenTrailingX-e-w,h=y.frozenTrailingHeight+b,c=d.x+d.width,l=g.frozenTrailingY-b,a=s*it,v=g.frozenTrailingHeight+b,e*=u,o*=f,s*=u,h*=f,c*=u,l*=f,a*=u,v*=f,p.drawImage(rt,e,o,s,h,c,l,a,v));ut>0&&ft>0&&(e=y.frozenTrailingX-w,o=y.frozenTrailingY-b,s=y.frozenTrailingWidth+w,h=y.frozenTrailingHeight+b,c=g.frozenTrailingX-w,l=g.frozenTrailingY-b,a=g.frozenTrailingWidth+w,v=g.frozenTrailingHeight+b,e*=u,o*=f,s*=u,h*=f,c*=u,l*=f,a*=u,v*=f,p.drawImage(rt,e,o,s,h,c,l,a,v));p.scale(u,f);p.restore()},i.prototype.startZoom=function(){var t=this,n=t._sheet,r=n._zoomFactor,i=n._render._getBufferCtx();i&&t._saveCanvas(i.canvas,n._getSheetLayout(),n._getGroupLayout(),r)},i.prototype.continueZoom=function(n){var f=this,i=f._sheet,r,u,e;i.endEdit()&&(r=f._getNewZoomFactor(n,f._oldZoomFactor),i._zoomFactor!==r&&(i.triggerUserZooming({sheet:i,sheetName:i._name,oldZoomFactor:i._zoomFactor,newZoomFactor:r}),i._zoomFactor=r,i.invalidateLayout(),u=i._render,e=u._getCtx(),e&&f._restoreCanvas(e.canvas,r,u._getGrayAreaBackColor(!1)),u._paintFloatingObject(t,r),u._paintComment(t)))},i.prototype.endZoom=function(n){var i=this,t=i._sheet;t._zoomFactor=i._getNewZoomFactor(n,i._oldZoomFactor);t._needSyncHScrollbarSize=!0;t._needSyncVScrollbarSize=!0;t.invalidateLayout();t.repaint()},i}(),function(n){n[n.NotStarted=0]="NotStarted";n[n.HorizontalOnly=1]="HorizontalOnly";n[n.VecticalOnly=2]="VecticalOnly";n[n.Free=3]="Free"}(at||(at={}));var tr=function(){function i(n){this.BOUNDARY_SCOPE=200;this.INERTIA_BOUNDARY_SCOPE=20;this.sheet=n}return i.prototype._getNewTopRowInfo=function(n,t){var i=t,r=0,e=0,u=this.sheet,o=u._cachePool,s,h,c=u._getSheetLayout().viewportY,f=u._getViewportRowLayout(1).findRow(i);if(f)if(n>0){for(s=u._getScrollableRow(-1),r=c-f.y;i>s&&r<n;)i--,r+=o.getZoomRowHeight(i);e=n-r}else if(n<0){for(h=u._getLastVisualScrollRow(),r=-(f.y+f.height-c);i<h&&r>n;)i++,r-=o.getZoomRowHeight(i);e=n-r}return{row:i,offset:e}},i.prototype._getNewLeftColumnInfo=function(n,t){var i=t,r=0,e=0,u=this.sheet,o,s,h=u._cachePool,c=u._getSheetLayout().viewportX,f=u._getViewportColumnLayout(1).findCol(i);if(f)if(n>0){for(o=u._getScrollableColumn(-1),r=c-f.x;i>o&&r<n;)i--,r+=h.getZoomColWidth(i);e=n-r}else if(n<0){for(s=u._getLastVisualScrollColumn(),r=-(f.x+f.width-c);i<s&&r>n;)i++,r-=h.getZoomColWidth(i);e=n-r}return{col:i,offset:e}},i.prototype._createTouchViewportColumnLayout=function(t){for(var f=new n._LayoutModel,i=this.sheet,h=i._cachePool,e=i._getSheetLayout(),r=g(i.frozenColCount,i._scrollLeftCol),c=i.getColumnCount()-i._frozenTrailingColCount,o=e.viewportX+t,u,s=e.viewportWidth-t;s>0&&r<c;r++)u=h.getZoomColWidth(r),f.push(new n._Layout(-1,r,o,-1,u,-1)),o+=u,s-=u;return f},i.prototype._updateTouchViewportColumnLayout=function(n){var t=this.sheet._colLayoutCache;t.viewport||(t.viewport={});t.viewport[1]=this._createTouchViewportColumnLayout(n)},i.prototype._createTouchViewportRowLayout=function(t){for(var f=new n._LayoutModel,i=this.sheet,h=i._cachePool,e=i._getSheetLayout(),r=g(i.frozenRowCount,i._scrollTopRow),c=i.getRowCount()-i._frozenTrailingRowCount,o=e.viewportY+t,u,s=e.viewportHeight-t;s>0&&r<c;r++)u=h.getZoomRowHeight(r),f.push(new n._Layout(r,-1,-1,o,-1,u)),o+=u,s-=u;return f},i.prototype._updateTouchViewportRowLayout=function(n){var t=this.sheet._rowLayoutCache;t.viewport||(t.viewport={});t.viewport[1]=this._createTouchViewportRowLayout(n)},i.prototype._invalidateLayout=function(){var n=this.sheet,t=n._colLayoutCache.viewport,i=n._rowLayoutCache.viewport;n.invalidateLayout();n._colLayoutCache.viewport=t;n._rowLayoutCache.viewport=i},i.prototype._paintAdornment=function(n,t){var o=this,i=o.sheet,s=i._render,e,r,u,f;if(n&&!i._paintSuspended&&!(i._layoutSuspended>0)&&(e=i._getSheetLayout(),!i._hoverCell))for(u=0;u<=2;u++)for(f=0;f<=2;f++)(r=e.viewportRect(u,f),r&&r.width!==0&&r.height!==0)&&(!t||r.intersectRect(t))&&s.paintSelection(n,u,f,t)},i.prototype._getBoundaryFactor=function(n,t){return parseInt(-t/(n/t+1)+t)},i.prototype._getDistance=function(n,t){return parseInt(t*(-t/(n-t)-1))},i.prototype._triggerTopRowChanged=function(n,t,i){n.triggerTopRowChanged({sheet:n,sheetName:n._name,oldTopRow:t,newTopRow:i})},i.prototype._triggerLeftColChanged=function(n,t,i){n.triggerLeftColumnChanged({sheet:n,sheetName:n._name,oldLeftCol:t,newLeftCol:i})},i.prototype._vScrollTo=function(t,i,u,f){var e=this,o=e.sheet,et=o._scrollTopRow,it=e._getNewTopRowInfo(t,et),b=it.row,s=it.offset,tt,nt,a,ft,w,h;if(o._scrollTopRow=b,o._paintSuspended||o._layoutSuspended>0)return!1;if(n.util._useDoubleBuffer()){var rt=o.getBounds(),k=o._getSheetLayout(),y=k.viewportY,d=k.viewportHeight,l=rt?rt.x:k.x,g=k.width,ot=o._render,st=ot._getCtx();if(t<0){if(e.cachedOffsetY=0,e.cachedAvailableOffsetY=0,a=o._getViewportRowLayout(1),a&&a.length>0&&(tt=a.findRow(b)),tt&&(nt=a[a.length-1],nt.row>=b)){var ut=2,p=y+r(t),c=v(y+d,nt.y+nt.height)-p;c>=0&&(c-=ut,e._updateTouchViewportRowLayout(s-tt.height),u.x=l,u.y=p,u.width=g,u.height=c,u.tx=l,u.ty=y,f.x=l,f.y=y+c,f.width=g,f.height=d-c)}}else if(t>0){if(ft=o._getScrollableRow(-1),b===ft&&s>0)if(e.cachedOffsetY>0&&e.cachedAvailableOffsetY>0){if(w=e.cachedOffsetY+t,h=e._getBoundaryFactor(w,e.BOUNDARY_SCOPE),t=h-e.cachedAvailableOffsetY,s=h,t<=0)return i;if(i&&h>=e.INERTIA_BOUNDARY_SCOPE)return!0;e.cachedOffsetY=w;e.cachedAvailableOffsetY=h}else{if(s>=e.BOUNDARY_SCOPE&&(t-=s-(e.BOUNDARY_SCOPE-1),s=e.BOUNDARY_SCOPE-1,t<=0))return i;if(w=e._getDistance(s,e.BOUNDARY_SCOPE),h=s,i&&h>=e.INERTIA_BOUNDARY_SCOPE)return!0;e.cachedOffsetY=w;e.cachedAvailableOffsetY=h}else e.cachedOffsetY=0,e.cachedAvailableOffsetY=0;if(t<d){var ut=2,p=y,c=d-t;o.getFrozenTrailingRowCount()>0&&(c-=1);e._updateTouchViewportRowLayout(s);u.x=l;u.y=p;u.width=g;u.height=c;u.tx=l;u.ty=p+t;f.x=l;f.y=p;f.width=g;f.height=t+ut}}}return!1},i.prototype._hScrollTo=function(t,i,u,f){var e=this,o=e.sheet,et=o._scrollLeftCol,it=e._getNewLeftColumnInfo(t,et),b=it.col,s=it.offset,tt,nt,a,ft,w,h;if(o._scrollLeftCol=b,o._paintSuspended||o._layoutSuspended>0)return!1;if(n.util._useDoubleBuffer()){var rt=o.getBounds(),k=o._getSheetLayout(),y=k.viewportX,d=k.viewportWidth,l=rt?rt.y:k.y,g=k.height,ot=o._render,st=ot._getCtx();if(t<0){if(e.cachedOffsetX=0,e.cachedAvailableOffsetX=0,a=o._getViewportColumnLayout(1),a&&a.length>0&&(tt=a.findCol(b)),tt&&(nt=a[a.length-1],nt.col>=b)){var ut=2,p=y+r(t),c=v(y+d,nt.x+nt.width)-p;c>=0&&(c-=ut,e._updateTouchViewportColumnLayout(s-tt.width),u.x=p,u.y=l,u.width=c,u.height=g,u.tx=y,u.ty=l,f.x=y+c,f.y=l,f.width=d-c,f.height=g)}}else if(t>0){if(ft=o._getScrollableColumn(-1),b===ft&&s>0)if(e.cachedOffsetX>0&&e.cachedAvailableOffsetX>0){if(w=e.cachedOffsetX+t,h=e._getBoundaryFactor(w,e.BOUNDARY_SCOPE),t=h-e.cachedAvailableOffsetX,s=h,t<=0)return i;if(i&&h>=e.INERTIA_BOUNDARY_SCOPE)return!0;e.cachedOffsetX=w;e.cachedAvailableOffsetX=h}else{if(s>=e.BOUNDARY_SCOPE&&(t-=s-(e.BOUNDARY_SCOPE-1),s=e.BOUNDARY_SCOPE-1,t<=0))return i;if(w=e._getDistance(s,e.BOUNDARY_SCOPE),h=s,i&&h>=e.INERTIA_BOUNDARY_SCOPE)return!0;e.cachedOffsetX=w;e.cachedAvailableOffsetX=h}else e.cachedOffsetX=0,e.cachedAvailableOffsetX=0;if(t<d){var ut=2,p=y,c=d-t;o.getFrozenTrailingColumnCount()>0&&(c-=1);e._updateTouchViewportColumnLayout(s);u.x=p;u.y=l;u.width=c;u.height=g;u.tx=p+t;u.ty=l;f.x=p;f.y=l;f.width=t+ut;f.height=g}}}return!1},i.prototype._fillRect=function(n,t,i,r,u,f){n.fillStyle=t;n.fillRect(i,r,u,f)},i.prototype._getColHeaderFillStyle=function(t,i,r,u,f){var e,o=n.ThemeStyleHelper.getVisualStateThemeStyle(0,"gc-columnHeader-normal"),h=o&&o.backgroundImage,a=o&&o.backgroundColor,c,s,v,l;if(h&&h.indexOf("linear-gradient")!==-1)for(c=n.util.getLinearGradientColors(h),e=t.createLinearGradient(i+u/2,r,i+u/2,r+f),s=0,v=c.length;s<v;s++)l=c[s],e.addColorStop(l.point,l.color);else a&&(e=a);return e},i.prototype._getRowHeaderFillStyle=function(t,i,r,u,f){var e=n.ThemeStyleHelper.getVisualStateThemeStyle(0,"gc-rowHeader-normal");return e&&e.backgroundColor},i.prototype._fillGrayArea=function(n){var f=this,o=f.sheet,ft=o.getBounds(),s=o._getSheetLayout(),p=o._render,e=p._getGrayAreaBackColor(!1),h=p._getCtx(),c=p._getBufferCtx(),t,i,r,u,nt=o._getViewportRowLayout(1),tt,w,l,b,it,v,k,rt,d,a,g,ut,y;t=s.headerX;r=s.width;tt=o._getScrollableRow(-1);w=nt.findRow(tt);w&&(i=s.viewportY,u=w.y-i-1,u>0&&(n?(l=s.rowHeaderWidth,b=f._getRowHeaderFillStyle(h,t,i,l-1,u+1),f._fillRect(h,b,t,i,l-1,u+1),f._fillRect(c,b,t,i,l-1,u+1),f._fillRect(h,e,t+l,i,r-l,u),f._fillRect(c,e,t+l,i,r-l,u)):(f._fillRect(h,e,t,i,r,u),f._fillRect(c,e,t,i,r,u))));it=o._getScrollableRow(o.getRowCount(),!0);v=nt.findRow(it);v&&(i=v.y+v.height,u=s.frozenTrailingY-i-1,u>0&&(f._fillRect(h,e,t,i,r,u),f._fillRect(c,e,t,i,r,u)));k=o._getViewportColumnLayout(1);i=s.headerY;u=s.height;rt=o._getScrollableColumn(-1);d=k.findCol(rt);d&&(t=s.viewportX,r=d.x-t-1,r>0&&(n?(a=s.colHeaderHeight,g=f._getColHeaderFillStyle(h,t,i,r+1,a-1),f._fillRect(h,g,t,i,r+1,a-1),f._fillRect(c,g,t,i,r+1,a-1),f._fillRect(h,e,t,i+a,r,u-a),f._fillRect(c,e,t,i+a,r,u-a)):(f._fillRect(h,e,t,i,r,u),f._fillRect(c,e,t,i,r,u))));ut=o._getScrollableColumn(o.getColumnCount(),!0);y=k.findCol(ut);y&&(t=y.x+y.width,r=s.frozenTrailingX-t-1,r>0&&(f._fillRect(h,e,t,i,r,u),f._fillRect(c,e,t,i,r,u)))},i.prototype._strokeLine=function(n,t,i,r,u,f){n.beginPath();n.strokeStyle=t;n.moveTo(i,r);n.lineTo(u,f);n.stroke()},i.prototype._makeUpGridline=function(t){var s=this,r=s.sheet,g=r.getBounds(),i=r._getSheetLayout(),k=r._render,a=r.gridline.color,v=n.ThemeStyleHelper.getVisualStateThemeStyle(0,"gc-columnHeader-normal"),y=v&&v.borderBottomColor,h=k._getCtx(),u,f,c,l,d=r._getViewportRowLayout(1),p,e,w,b,o;u=i.headerX;c=i.width;p=r._getScrollableRow(-1);e=d.findRow(p);e&&(f=i.viewportY,l=e.y-f,l>0&&(s._strokeLine(h,a,u,e.y-.5,u+c,e.y-.5),t&&s._strokeLine(h,y,i.frozenX-.5,f,i.frozenX-.5,e.y)));w=r._getViewportColumnLayout(1);f=i.headerY;l=i.height;b=r._getScrollableColumn(-1);o=w.findCol(b);o&&(u=i.viewportX,c=o.x-u,c>0&&(s._strokeLine(h,a,o.x-.5,f,o.x-.5,f+l),t&&s._strokeLine(h,y,u,i.frozenY-.5,o.x,i.frozenY-.5)))},i.prototype._getScrollDirection=function(n,t){var i=0;return this.sheet.parent&&this.sheet.parent.touchScrollOnRails()?(i|=n!==0?1:0,i|=t!==0?2:0):i=3,i},i.prototype._continueScrollCore=function(t,i,r,u){var s=this,c=s.sheet,k=!0,d=!0,a=c._render,w=a._getCtx(),e,f,o,h,l=(r&2)!=0,v=(r&1)!=0,b;if(v||l){var y=c.getBounds(),p=c._getSheetLayout(),g=y?y.y:p.y,nt=p.height,tt=y?y.x:p.x,it=p.width;l&&(f={},e={},k=s._vScrollTo(i,u,e,f),a.copyScreen(e.x,e.y,e.width,e.height,e.tx,e.ty));v&&(o={},h={},d=s._hScrollTo(t,u,o,h),a.copyScreen(o.x,o.y,o.width,o.height,o.tx,o.ty),l||(e=o,f=h));b=c.parent;b&&!b._scrollbarShowMax&&(v&&(c._needSyncHScrollbarSize=!0),l&&(c._needSyncVScrollbarSize=!0));s._invalidateLayout();v&&l?a.paintBody(w,new n.Rect(f.x,f.y,f.width,f.height),new n.Rect(h.x,h.y,h.width,h.height)):a.paintBody(w,new n.Rect(f.x,f.y,f.width,f.height));s._paintAdornment(w,new n.Rect(tt,g,it,nt));s._makeUpGridline(!0);s._fillGrayArea(!0);this.onSheetScroll(v,l);return k&&d}},i.prototype.onSheetScroll=function(n,t){var i=this.sheet,r;t&&i._syncVScrollbarPosition();n&&i._syncHScollbarPosition();i._eventHandler.updateEditingEditor();r=i._commentManager;r&&r.updateCommentsLayoutWhenSheetScroll()},i.prototype._getCurrentPositionByTime=function(n,t,i,r){return n/=i,nt(.75,n)*r*(t?1:-1)},i.prototype._getCurrentTimeByPosition=function(n,t,i){return n=r(n),n/=i,rt(n)/rt(.75)*t},i.prototype._buildScrollDirection=function(n,t){var i=0;return n||(i|=1),t||(i|=2),i},i.prototype._endScrollWithAnimation=function(n,i,r){var u=this,f=u.sheet,s=u.BOUNDARY_SCOPE,h=10,v=20,c=100,l=u._getCurrentTimeByPosition(n,h,s),a=u._getCurrentTimeByPosition(i,h,s),w=n,b=i,y=0,p=0,e=!1,o=!1;u.interval=setInterval(function(){var k;if(e&&o){f._cachePool.endCache();k=f.parent;k&&!k._scrollbarShowMax&&(f._needSyncHScrollbarSize=!0,f._needSyncVScrollbarSize=!0);f._cachePool.clearCacheEndPan();f.invalidateLayout();f.repaint();f._syncHScollbarPosition();f._syncVScrollbarPosition();clearInterval(u.interval);u.interval=t;return}if(l+=v,a+=v,l>c&&a>c)u._continueScrollCore(n-y,i-p,u._buildScrollDirection(e,o),r),e=!0,o=!0;else{l>c&&!e&&(u._continueScrollCore(n-y,0,1,r),e=!0);a>c&&!o&&(u._continueScrollCore(0,i-p,2,r),o=!0);var d=u._getCurrentPositionByTime(l,n>0,h,s),g=u._getCurrentPositionByTime(a,i>0,h,s),nt=ut(w-d),tt=ut(b-g);u._continueScrollCore(nt,tt,u._buildScrollDirection(e,o),r);w=d;b=g;y+=nt;p+=tt}},v)},i.prototype.startScroll=function(n){var i=this;i.interval&&(i.sheet._cachePool.clearCacheEndPan(),clearInterval(this.interval),i.interval=t);i.cachedOffsetX=0;i.cachedAvailableOffsetX=0;i.cachedOffsetY=0;i.cachedAvailableOffsetY=0;i.oldScrollTopRow=i.sheet._scrollTopRow;i.oldScrollLeftCol=i.sheet._scrollLeftCol;n&&i.sheet._cachePool.startCacheBeforPan()},i.prototype.continueScroll=function(n,t){var i=parseInt(n.X),r=parseInt(n.Y),u=this._getScrollDirection(i,r);return this._continueScrollCore(i,r,u,t)},i.prototype.endScroll=function(n){var f=this,t=f.sheet,p=t._getSheetLayout(),w=p.viewportX,b=p.viewportY,e=t._getViewportColumnLayout(1),i,d=t._getLastVisualScrollColumn(),o,r,u,k,s,h,c,l,a,v,y;e&&e.length>0&&(o=t._scrollLeftCol,i=e.findCol(o),o<d&&i&&i.x+i.width-w<i.width/2&&t._scrollLeftCol++);r=t._getViewportRowLayout(1);k=t._getLastVisualScrollRow();r&&r.length>0&&(s=t._scrollTopRow,u=r.findRow(s),s<k&&u&&u.y+u.height-b<u.height/2&&t._scrollTopRow++);h=0;c=0;e&&e.length>0&&(i=e.findCol(t._scrollLeftCol),h=w-i.x);r&&r.length>0&&(u=r.findRow(t._scrollTopRow),c=b-u.y);l=t._scrollTopRow;a=f.oldScrollTopRow;l!==a&&f._triggerTopRowChanged(t,a,l);v=t._scrollLeftCol;y=f.oldScrollLeftCol;v!==y&&f._triggerLeftColChanged(t,y,v);f._endScrollWithAnimation(h,c,n)},i}(),ir=function(){function i(n){this._isScroll=!1;this._touchZoomManager=new b(n);this._touchScrollManager=new tr(n);this.sheet=n}return i.prototype.doManipulationStarting=function(n){var r=this.sheet,i=r._getSheetLayout(),t;n.Mode=0;t=this._touchHitTest(n.Position.X,n.Position.Y);t&&(t.resizeInfo||t.dragInfo&&t.dragInfo.side==="corner"||t.selectionHitInfo)?(i.viewportY<=t.y&&t.y<i.frozenTrailingY&&(n.Mode|=2),i.viewportX<=t.x&&t.x<i.frozenTrailingX&&(n.Mode|=1)):(i.viewportY<=t.y&&t.y<i.frozenTrailingY&&(n.Mode|=2),i.viewportX<=t.x&&t.x<i.frozenTrailingX&&(n.Mode|=1),n.Mode|=96,this.sheet.parent&&this.sheet.parent.touchScrollOnRails()&&(n.Mode|=12))},i.prototype.doManipulationStarted=function(n){var r=this,i=r.sheet,u=i._eventHandler,f=i._render,t=r._touchHitTest(n.Position.X,n.Position.Y),h,o;if(i._currentTarget=t,t.resizeInfo){if(!i.endEdit())return;u.startResizing(t)}else if(t.dragInfo&&t.dragInfo.side==="corner")u.startDragFill(t);else if(t.selectionHitInfo){if(!i.endEdit())return;var e=t.selectionHitInfo,s=e.isHeader,c=e.isFirstIndicator,l=e.type;s&&u._startSelectingCore(t,!0);h=t.hitTestType;t.hitTestType=t.selectionHitInfo.type;u._startSelectingScroll(t);t.hitTestType=h;r._changeActiveCellBeforeSelect(s,c,l);f._showTouchSelectionIndicator=!1;f.refreshTouchSelectionIndicator()}else o=i._commentRender,o&&(o.showWhenTouchMoveOrScroll=!1),f._showTouchSelectionIndicator=!1,f.refreshTouchSelectionIndicator(),n.PointerCount>1&&i.parent&&i.parent._allowUserZoom?(r._isScroll=!1,r._touchZoomManager.startZoom()):(r._isScroll=!0,r._touchScrollManager.startScroll(n.PointerCount===1))},i.prototype.doManipulationDelta=function(n){var r=this,f=r.sheet,t=f._eventHandler,e=n.Position.X,o=n.Position.Y,i,s,u,h;if(f._currentTarget)if(i=f._currentTarget,i.resizeInfo)t.mousePosition={e:n,x:e,y:o},t.continueResizing();else if(i.dragInfo&&i.dragInfo.side==="corner")t.mousePosition={e:n,x:e,y:o},t.continueDragFill();else if(i.selectionHitInfo||t.isSelecting){if(s=i.selectionHitInfo,s){if(!t.startHitInfo||!t.isWorking)return;if(t._forceCancelSelectiong===!0)return;u=s.type;t.mousePosition={e:n,x:e,y:o};u===3?t.continueCellSelecting():u===2?t.continueRowSelecting():u===1&&t.continueColumnSelecting()}}else r._isScroll?n.IsComplete=r._touchScrollManager.continueScroll(n.Delta.Translation,n.IsInertia):(h=n.Cumulative.Scale,r._touchZoomManager.continueZoom(h))},i.prototype.doManipulationInertiaStarting=function(n){},i.prototype.doManipulationCompleted=function(n){var t=this,i=t.sheet,r=i._eventHandler,o=i._render,u,f,e,s;if(o._showTouchSelectionIndicator=!0,u=i._currentTarget,u.resizeInfo)r.stopResizing();else if(u.dragInfo&&r.isDraggingFill)r.endDragFill(),i.parent.touchToolStrip._closeAutoFillIndicator();else if(u.selectionHitInfo||r.isSelecting){if(r.stopSelecting(),f=u.selectionHitInfo,f){var h=f.isHeader,c=f.isFirstIndicator,l=f.type;t._changeActiveCellAfterSelect(h,c,l)}o.repaintSelection()}else e=i._commentRender,e&&(e.showWhenTouchMoveOrScroll=!0),t._isScroll?t._touchScrollManager.endScroll(n.IsInertia):(s=n.Cumulative.Scale,t._touchZoomManager.endZoom(s))},i.prototype.doTapped=function(i){var l=this,r=l.sheet,it=!1,w,v,b,y,ut,p,et,g,nt,tt;l._clearTouchToolStripTimeout();typeof r.unSelectAllFloatingObjects=="function"&&r.unSelectAllFloatingObjects();w=r._commentManager;w&&w.deactivateComment();var c=r._eventHandler,f=l._touchHitTest(i.Position.X,i.Position.Y,!0),o=f.row,s=f.col,rt=f.groupHitInfo;if(rt)r.isEditing()||c._doClickRangeGroup(rt);else if(r._currentTarget=f,f.filterButtonHitInfo){if(!r.endEdit())return;v=f.filterButtonHitInfo;v.rowFilter&&v.rowFilter.openFilterDialog(v)}else if(!f.resizeInfo&&r.canSelect(f.rowViewportIndex<0?-1:o,f.colViewportIndex<0?-1:s)){b=r._render;b._existTouchDragFillIndicator&&!c.isDraggingFill&&r.parent.touchToolStrip._closeAutoFillIndicator();var k=r.getActiveRowIndex(),d=r.getActiveColumnIndex(),h=f.cellTypeHitInfo;if(h){if(y=h.sheetArea,(y===t||y===u||y===3)&&(o!==k||s!==d)){if(ut=r.isPaintSuspended(),r.isPaintSuspended(!0),!r.endEdit())return;if(p={sheet:r,sheetName:r._name,row:k,col:d,cancel:!1},r.triggerLeaveCell(p),p&&p.cancel===!0)return;var ot=r._selectionModel.toArray(),ft=t,a=r._getSpanModel().find(o,s);ft=a?[new n.Range(a.row,a.col,a.rowCount,a.colCount)]:[new n.Range(o,s,1,1)];r.triggerSelectionChanging({sheet:r,sheetName:r._name,oldSelections:ot,newSelections:ft});et=h.isReservedLocation&&h.isFocusAware;r._setActiveCellAndSelection(o,s,u,u,et?0:1);r.triggerEnterCell({sheet:r,sheetName:r._name,row:o,col:s});r.triggerSelectionChanged({sheet:r,sheetName:r._name});c._updateValidationUI(o,s);r.isPaintSuspended(ut);it=!0}else b.refreshTouchSelectionIndicator();g=r.getCellType(o,s,f.hitTestType);h.sheet||(h.sheet=r);g.processMouseDown(h);g.processMouseUp(h)}if(h&&h.isReservedLocation)return!0;else{r.triggerCellClick({sheet:r,sheetName:r._name,sheetArea:f.hitTestType,row:f.row,col:f.col});try{if(c._hitTestResult=f,r.isEditing()&&k===r.getActiveRowIndex()&&d===r.getActiveColumnIndex()&&!r.endEdit())return}finally{c._hitTestResult=t}if(o===u||o===t||s===u||s===t)return;f.hitTestType===3&&c._updateValidationUI(o,s);l._isTouchSelected(o,s,f.hitTestType)&&!it?l._touchToolStripTimeout=setTimeout(function(){var n={x:f.x,y:f.y,handled:!1},t=r.parent.touchToolStrip;r.triggerTouchToolStripOpening(n);n.handled||t.open(f.x,f.y-ri);l._clearTouchToolStripTimeout()},e.DoubleTappedTimeOffset+20):(nt=r._selectionModel.toArray(),c._startSelectingCore(f),tt=r._selectionModel.toArray(),c._notEqualSelecions(nt,tt)&&r.triggerSelectionChanging({sheet:r,sheetName:r._name,oldSelections:nt,newSelections:tt}),c.stopSelecting())}}},i.prototype.doDoubleTapped=function(t){var i=this.sheet,e,u,s,o,f,h,c,l,a,r;if(this._clearTouchToolStripTimeout(),o=i._currentTarget,o&&(i.triggerCellDoubleClick({sheet:i,sheetName:i._name,sheetArea:o.hitTestType,row:o.row,col:o.col}),f=o.resizeInfo,f)){if(f.action==="sizeRow"||f.action==="sizeHiddenRow"){if(h=[],i._isRowSelected(f.index)){for(e=0;e<i._selectionModel.length;e++)if(u=i._selectionModel[e],u.col===-1)for(u=i._getActualRange(u),c=0;c<u.rowCount;c++)h.push({row:u.row+c})}else h.push({row:f.index});s=new n.UndoRedo.RowAutoFitUndoAction(i,h,f.sheetArea===1);i._doCommand(s)}else{if(l=[],i._isColumnSelected(f.index)){for(e=0;e<i._selectionModel.length;e++)if(u=i._selectionModel[e],u.row===-1)for(u=i._getActualRange(u),a=0;a<u.colCount;a++)l.push({col:u.col+a})}else l.push({col:f.index});s=new n.UndoRedo.ColumnAutoFitUndoAction(i,l,f.sheetArea===2);i._doCommand(s)}return}r=this._touchHitTest(t.Position.X,t.Position.Y,!0);r&&r.row>=0&&r.col>=0&&r.rowViewportIndex>=0&&r.colViewportIndex>=0&&!r.resizeInfo&&(!i.isProtected||!i.getStyleProperty(r.row,r.col,"locked"))&&(i._clearSelectionImp(),i.addSelection(r.row,r.col,1,1),i._eventHandler.resumeFocus(!1),i._startEditImp(i._getCanvas(),r.row,r.col))},i.prototype.doRightTapped=function(n){},i.prototype.doTouchOperatorStart=function(n){var t=this.sheet,r=this._touchHitTest(n.Position.X,n.Position.Y),i;t.isEditing()?(r.row!==t._activeRowIndex||r.col!==t._activeColIndex)&&t._eventHandler.releaseFocus(r):(this._target=r,i=this._touchHitTest(n.Position.X,n.Position.Y,!0),i&&i.cellTypeHitInfo&&i.cellTypeHitInfo.isEditting||t._eventHandler.releaseFocus(i))},i.prototype.doTouchOperatorEnd=function(n){var r=this.sheet,t,i,u;r.isEditing()||(t=this._target,i=!0,t&&(t.cellTypeHitInfo&&t.cellTypeHitInfo.isReservedLocation?i=!1:(u=r.getCellType(t.row,t.col),u&&u.isEditting()&&(i=!1))),i&&r._eventHandler.resumeFocus())},i.prototype._touchHitTest=function(n,i,r){var h=this,e=h.sheet,a=e._render,f,l,o,s,c,v,y,p,w,b;return e._getSheetLayout(),f={x:n,y:i,rowViewportIndex:t,colViewportIndex:t,row:-1,col:-1,resizeInfo:t,hitTestType:t,groupHitInfo:t,filterButtonHitInfo:t,dragInfo:t,cellTypeHitInfo:t,selectionHitInfo:t,formulaRangeHitInfo:t},l=a.groupHitTest(n,i),l?f.groupHitInfo=l:(o=e._getRowViewportIndexFromY(i),s=e._getColumnViewportIndexFromX(n),f.rowViewportIndex=o,f.colViewportIndex=s,f.row=e._getRowIndexFromY(i,o),f.col=e._getColumnIndexFromX(n,s),o>=0&&o<=2&&s>=0&&(c=e._getCellLayoutByCell(o,s,u,f.row,f.col),c&&(f.row=c.row,f.col=c.col)),f.hitTestType=e._getSheetArea(o,s),a._existTouchDragFillIndicator&&(y=h._getDragFillInfo(f,n,i))?f.dragInfo=y:(v=h._getTouchResizeInfo(f,n,i,10))?f.resizeInfo=v:(p=e._getFilterButtonHitInfo(f,n,i))?f.filterButtonHitInfo=p:!r&&(w=h._getSelectionHitInfo(f,n,i))?f.selectionHitInfo=w:f.cellTypeHitInfo=e._getCellTypeHitInfo(f,n,i)),f},i.prototype._getTouchResizeInfo=function(n,i,r,u){var e=this.sheet,h=e._eventHandler,s=e.getSelections(),f=t;if(e._isTouchMode&&s.length>0){var o=s[s.length-1],c=o.row,a=o.row+o.rowCount-1,l=o.col,v=o.col+o.colCount-1;(!e.parent||e.parent._allowUserResize)&&(c!==-1&&l===-1&&n.rowViewportIndex>=0&&n.colViewportIndex<0&&e.rowHeaderVisible?(f=h._getResizeRowInfo(e,n,u,2,r),f&&(f.action==="sizeRow"||f.action==="sizeHiddenRow")&&f.sheetArea===2&&f.index!==a&&(f=t)):c===-1&&l!==-1&&n.rowViewportIndex<0&&n.colViewportIndex>=0&&e.colHeaderVisible&&(f=h._getResizeColInfo(e,n,u,1,i),f&&(f.action==="sizeCol"||f.action==="sizeHiddenCol")&&f.sheetArea===1&&f.index!==v&&(f=t)))}return f},i.prototype._getSelectionHitInfo=function(n,i,r){var s=this.sheet,c=s._render.getSelectionIndicatorRects(),h=s.getSelections(),o=3,f,e,u;for(s._isTouchMode&&h.length>0&&(f=h[h.length-1],f.row!==-1&&f.col!==-1?o=3:f.row!==-1?o=2:f.col!==-1&&(o=1)),e=0;e<c.length;e++)if(u=c[e],u.x-=u.width,u.y-=u.height,u.width*=3,u.height*=3,u.contains(i,r))return{x:i,y:r,type:o,isHeader:!1,isFirstIndicator:e===0};if(n.hitTestType===1)return{x:i,y:r,type:1,isHeader:!0};else if(n.hitTestType===2)return{x:i,y:r,type:2,isHeader:!0};return t},i.prototype._getDragFillInfo=function(n,i,r){var o=t,h=n.rowViewportIndex,c=n.colViewportIndex,u,p,l,v,a,y,e;if(typeof h===f||h===t||typeof c===f||c===t)return o;if(u=this.sheet,p=u._getActiveSelectedRange(),h>=0&&c>=0&&u._selectionModel.length===1){var s=u._getActualRange(p),w=u._frozenTrailingColCount,b=u._frozenTrailingRowCount,k=u.getColumnCount()-w,d=u.getRowCount()-b;if(c===1&&w>0&&s.col<k&&s.col+s.colCount>k&&(l=u._getColumnLayout(c),l&&l.length>0&&(v=l[l.length-1],i>v.x+v.width))||h===1&&b>0&&s.row<d&&s.row+s.rowCount>d&&(a=u._getRowLayout(h),a&&a.length>0&&(y=a[a.length-1],r>y.y+y.height)))return o}return e=u._render.getTouchDragFillIndicatorRect(),e&&(o||(e.x-=e.width,e.y-=e.height,e.width*=3,e.height*=3,e.contains(i,r)&&(o={action:"drag",side:"corner"})),u.canUserDragFill()||o&&o.side==="corner"&&(o.side=t)),o},i.prototype._clearTouchToolStripTimeout=function(){this._touchToolStripTimeout&&(clearTimeout(this._touchToolStripTimeout),this._touchToolStripTimeout=t)},i.prototype._isTouchSelected=function(n,i,r){for(var f,e=!1,s=this.sheet,h=s._selectionModel,o=0,c=h.length;o<c;o++){if(f=h[o],r===3||typeof r===u||r===t)f=s._getActualRange(f),e=f.row<=n&&n<f.row+f.rowCount&&f.col<=i&&i<f.col+f.colCount;else if(r===2)e=f.col===-1&&f.row<=n&&n<f.row+f.rowCount;else if(r===1)e=f.row===-1&&f.col<=i&&i<f.col+f.colCount;else if(r===0)return e;if(e)return e}return e},i.prototype._changeActiveCellBeforeSelect=function(n,t,i){if(!n){var r=this.sheet,f=r.getSelections(),u=f[f.length-1];t?i===3?(r._activeRowIndex=u.row+u.rowCount-1,r._activeColIndex=u.col+u.colCount-1):i===2?(r._activeRowIndex=u.row+u.rowCount-1,r._activeColIndex=0):i===1&&(r._activeRowIndex=0,r._activeColIndex=u.col+u.colCount-1):i===3?(r._activeRowIndex=u.row,r._activeColIndex=u.col):i===2?(r._activeRowIndex=u.row,r._activeColIndex=0):i===1&&(r._activeRowIndex=0,r._activeColIndex=u.col)}},i.prototype._changeActiveCellAfterSelect=function(n,t,i){var r=this.sheet,f=r.getSelections(),u=f[f.length-1];(n||t)&&(i===3?(r._activeRowIndex=u.row,r._activeColIndex=u.col):i===2?(r._activeRowIndex=u.row,r._activeColIndex=0):i===1&&(r._activeRowIndex=0,r._activeColIndex=u.col))},i}(),rr=function(){function n(n,t,i){var r=this;r._touchEventProvider=i;r._touchMouseMessageFilter=new h(t);r._touchEventHandler=new ir(t);r._touchTarget=new c(n,"sheet",r._touchMouseMessageFilter,100,100);r._touchTarget.level=10;r._touchEventProvider.attachDettach(r._touchTarget,!0)}return n.prototype.attach=function(){var i=this._touchEventProvider,n=this._touchEventHandler,t=this._touchTarget;t.manipulationStarting=function(t){return n.doManipulationStarting(t)};t.manipulationStarted=function(t){return n.doManipulationStarted(t)};t.manipulationDelta=function(t){return n.doManipulationDelta(t)};t.manipulationInertiaStarting=function(t){return n.doManipulationInertiaStarting(t)};t.manipulationCompleted=function(t){return n.doManipulationCompleted(t)};t.tapped=function(t){return n.doTapped(t)};t.doubleTapped=function(t){return n.doDoubleTapped(t)};t.rightTapped=function(t){return n.doRightTapped(t)};t.touchOperatorStart=function(t){return n.doTouchOperatorStart(t)};t.touchOperatorEnd=function(t){return n.doTouchOperatorEnd(t)}},n.prototype.detach=function(){var n=this._touchTarget;n&&(this._touchEventProvider.attachDettach(n,!1),n.manipulationStarting=t,n.manipulationStarted=t,n.manipulationDelta=t,n.manipulationInertiaStarting=t,n.manipulationCompleted=t,n.tapped=t,n.doubleTapped=t,n.rightTapped=t,n.touchOperatorStart=t,n.touchOperatorEnd=t,this._touchTarget=t)},n.prototype.preProcessMouseDown=function(n){return this._touchMouseMessageFilter.preProcessMouseDown(n)},n.prototype.preProcessMouseUp=function(n){return this._touchMouseMessageFilter.preProcessMouseUp(n)},n.prototype.preProcessMouseMove=function(n){return this._touchMouseMessageFilter.preProcessMouseMove(n)},n}();n.TouchManager=rr,function(n){n[n.paste=0]="paste";n[n.cut=1]="cut";n[n.copy=2]="copy";n[n.autoFill=3]="autoFill"}(vt||(vt={}));yt=function(i){function r(t,r){i.call(this,r,n.util.getPreferredZIndex(t._host));var u=this;u._touchEventNamespace=".touchToolStrip";u._buttonClass="toolstrip-button";u._textClass="toolstrip-text";u._imageClass="wijspread-toolstrip-image";u._itemClass="toolstrip-item";u._seprateLineClass="touch-sperate-line";u._imageAreaHeight=32;u._separatorHeight=45;u.menuItems={};u.pasteName="wijspread_toolstrip_paste";u.copyName="wijspread_toolstrip_copy";u.cutName="wijspread_toolstrip_cut";u.autoFillName="wijspread_toolstrip_autofill";u._isOpen=!1;u.spreadHost=t;u._initDialog()}return __extends(r,i),r.prototype.open=function(i,r){var u=this,h=u.spreadHost.getActiveSheet(),e,f,o,s;if(h&&(n.FocusHelper.setActiveElement(t),u._toolStripDialog.css({left:i,top:r}),u.show(),u._isOpen=!0,u.resetDialogPosition(),!n.GC$.isEmptyObject(u.menuItems))){e=u.menuItems;for(f in e)o=e[f],s=o.canExecute?o.canExecute.call(u):!0,s?n.GC$("#"+f).show():n.GC$("#"+f).hide()}},r.prototype.add=function(n){var t,i,r,u;n&&(t=this,i=t.menuItems,n instanceof k?(r=n.name(),r&&(i[r]=n,t._addDom(n.getDOM(t._seprateLineClass,t._separatorHeight+"px")))):n instanceof s&&(u=n.name(),t.getItem(u)||(i[u]=n,t._addDom(n.getDOM(t._imageClass,t._imageAreaHeight+"px",t._textClass,t._buttonClass)))))},r.prototype.getItem=function(n){return this.menuItems[n]},r.prototype.getItems=function(){var i=this,r=[],u;if(!n.GC$.isEmptyObject(i.menuItems)){for(u in i.menuItems)r.push(i.menuItems[u]);return r}return t},r.prototype.remove=function(i){if(this.getItem(i)){n.GC$("#"+i).parent().remove();var r=this.menuItems[i];return delete this.menuItems[i],r}return t},r.prototype.clear=function(){this._toolStripDialog&&(this._toolStripDialog.find("td."+this._itemClass).remove(),this.menuItems={})},r.prototype.close=function(){var t=this,n,i,r;(window.gcGlobal.resumeEvent(),t._toolStripDialog&&t._toolStripDialog.hide(),t._isOpen=!1,t.closeOverlay(),n=t.spreadHost.getActiveSheet(),n)&&(i=n._render,n.setFocus(),r=n.getSelections(),i&&!i._existTouchDragFillIndicator&&r[0].row===-1&&r[0].col===-1&&n._clearSelectionImp())},r.prototype.imageAreaHeight=function(n){var t=this;return arguments.length===0?t._imageAreaHeight:n<=0?void 0:(t._imageAreaHeight=n,t._toolStripDialog.find("span."+t._imageClass).css("height",n+"px"),t)},r.prototype.itemHeight=function(n){var t=this._toolStripDialog.find("button."+this._buttonClass);return arguments.length===0?parseFloat(t.css("height")):n<=0?void 0:(t.css("height",n+"px"),this)},r.prototype.itemWidth=function(n){var t=this._toolStripDialog.find("button."+this._buttonClass),i;return arguments.length===0?parseFloat(t.css("width")):n<0?void 0:(i=parseFloat(t.css("min-width")),i>n&&t.css("min-width",n+"px"),t.css("width",n+"px"),this)},r.prototype.separatorHeight=function(n){var t=this;return arguments.length===0?t._separatorHeight:n<=0?void 0:(t._separatorHeight=n,t._toolStripDialog.find("div."+t._seprateLineClass).css("height",n+"px"),t)},r.prototype._createLayoutTable=function(){var t=n.GC$(document.createElement("table")).css({padding:0,display:"table"}).attr({cellspacing:0,cellpadding:0});this._tableRow=n.GC$(document.createElement("tr")).appendTo(t);t.appendTo(this._toolStripDialog)},r.prototype._dispose=function(){var n=this,i=n._toolStripDialog;i&&(n._isOpen&&window.gcGlobal.resumeEvent(),i.remove(),n.closeOverlay(),i=t)},r.prototype._initDialog=function(){var n=this,t;n._toolStripDialog||(t=n.getContainer(),n._toolStripDialog=t,t.addClass("toolstrip-default ui-state-default well"),t.appendTo(n.getHost()),t.hide(),n._createLayoutTable(),n._setDefaultCellDomString(),n._attachEvent())},r.prototype._attachEvent=function(){var n=this;this._toolStripDialog.bind("click",function(t){var u=t.target,e=u.tagName.toLowerCase(),i,r,f;e==="button"?i=u.id:(r=u.parentElement,r&&r.tagName.toLowerCase()==="button"&&(i=r.id));f=n.menuItems[i];i&&f&&f.command.call(n)})},r.prototype._addDom=function(t){this._toolStripDialog&&t&&n.GC$(document.createElement("td")).append(t).appendTo(this._tableRow).addClass(this._itemClass)},r.prototype._setDefaultCellDomString=function(){var t=this,i=r._getImageSrc(0),u=r._getImageSrc(1),f=r._getImageSrc(2),e=r._getImageSrc(3);t._pasteItem=new s(t._getItemName(t.pasteName),n.SR.ToolStrip_PasteText,i,t._doTapPaste);t._cutItem=new s(t._getItemName(t.cutName),n.SR.ToolStrip_CutText,u,t._doTapCut);t._copyItem=new s(t._getItemName(t.copyName),n.SR.ToolStrip_CopyText,f,t._doTapCopy);t._autoFillItem=new s(t._getItemName(t.autoFillName),n.SR.ToolStrip_AutoFillText,e,t._showAutoFillIndicator,t._hideAutoFill);t.add(t._pasteItem);t.add(t._cutItem);t.add(t._copyItem);t.add(new k(t._hideAutoFill));t.add(t._autoFillItem)},r.prototype._hideAutoFill=function(){var r=this.spreadHost.getActiveSheet(),t,n,i;if(!r)return!1;for(t=r.getSelections(),n=0;n<t.length;n++)if(i=t[n],i.row===-1&&i.col===-1)return!1;return!0},r.prototype._showAutoFillIndicator=function(){var n,i,t;(this.close(),n=this.spreadHost.getActiveSheet(),n)&&((i=n.getSelections().length,i>1)||(t=n._render,t._existTouchDragFillIndicator=!0,t.repaintSelection()))},r.prototype._closeAutoFillIndicator=function(){var t=this.spreadHost.getActiveSheet(),n;t&&(n=t._render,n._existTouchDragFillIndicator=!1,n.repaintSelection())},r.prototype._doTapCopy=function(){var n=this.spreadHost.getActiveSheet();n&&(this._clipboardTouchData=n._doCopy(!0));this.close()},r.prototype._doTapCut=function(){var n=this.spreadHost.getActiveSheet();n&&(this._clipboardTouchData=n._doCut(!0));this.close()},r.prototype._doTapPaste=function(){var n=this,t=n.spreadHost.getActiveSheet();t&&typeof n._clipboardTouchData!==f&&t._doPaste(n._clipboardTouchData);n.close()},r.prototype._getItemName=function(n){for(var t=0,i=n+t;document.getElementById(i);)t++,i=n+t;return i},r.prototype._updateResource=function(){var t=this,i=t._textClass;n.GC$("#"+t._pasteItem._name).find("span."+i).text(n.SR.ToolStrip_PasteText);n.GC$("#"+t._cutItem._name).find("span."+i).text(n.SR.ToolStrip_CutText);n.GC$("#"+t._copyItem._name).find("span."+i).text(n.SR.ToolStrip_CopyText);n.GC$("#"+t._autoFillItem._name).find("span."+i).text(n.SR.ToolStrip_AutoFillText)},r._getImageSrc=function(n){switch(n){case 0:return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAA8ElEQVRIS92VwQ3CMAxFe+qZERiHY8dgDI4cYYNOhDhwY4ayQviW4q/Eddu0KRe+9CQ72P8rEpAmhPBT3ENLd76EiPv5HO5hSmK+KYTFsz+04A4G9NZ0hAizn7jTos2MFRYYugFZQlscoFzRZsYKCwwNulAqnZddtJmxwiIZ3oT6WFh4S2tQHwsLb2kN6mNh4S2tQX0sLLwly4IyY4WFZ2gReV/ZhBOQH2ddgKcYwBAc7R/weL0ZgqO6gGPXE1E0JlBdwJx2CUhvkCL63xvw33QKUc0N+B5MIaq5gb5o8kotBszJDShFlkvQ+ZHBvoTmC+fiVfoq/m86AAAAAElFTkSuQmCC";case 1:return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAABkklEQVRIS7WTUXECQRBEcYCFOIiESAAH/OYPCcQBEogDJCABCUhAwqXf1QzVM0cojko+Xt3ObG/33t7eYhiGf6UU68+vneD5Mu4HpZDgKja+YCYH94NSSHAUg3glZC9k8zgAYwLmhuS6o/tBKUJ8CTGsoveIsin3g1LEAkxzAd/kXbihwxwatGys+EEpEAT5LR6FuDmMb+t+UAoEwVL44h7CvB8lGxrn3A9KkaLAj8pDMD9HL/v0ZgfAQfSAk/WgXAT3g1K4MPCj2AoPhNvRJO4HpejigF1jxtjNy9Ek7gel6GIjfzoP+Ihewf2gFPcWNNL817/c/aAUKXpbfy/FXlzFIM6gOYy3Gp+iz/xBPHeLQGLAMI2PNmYOw1uojZfdCyYNCXexiGcGpiljdp9hsBGjvnvBpCHhRbgBZChjAgj0eXrX7gWThoR992lAMGOOLMfJuIHuBZMGQuE75KN66Cpq14xH2L1g0kixyLNm3I8sNbwJulHfvWDSkJArmou4hlxXeh4AvBEBuZnnbtHfMix+AHqkr6wgQ4Q7AAAAAElFTkSuQmCC";case 2:return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAA3UlEQVRIS72PwQ3CMAxFOwrjcOyZCTgyAjfWYCJO3JiCCVL/iFSO9W0MDTzpqYob+ztTKeWn0uJIadE6H8/ljXsR96q6tzt4YogH/olPcQ2R8mp3CHRBwO3+6EKkvNodcDkSgyyoAx0iRz/AA/8Op0sdtJuv1Va3Ct8FYHgL8dgUAGxIe41+kRAH6CbdaGW86nFAhnaXLSLEAbqJCbxlUgEZ2DIgFaCbmMBbJhWQgS0DUgG6iQm8ZVIBGTYFsK21oN3F1yrEARnsIM/u8JeAT9S9nrQ4UlocKS2Os0wLtkPMdu9POt0AAAAASUVORK5CYII=";case 3:return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAXCAIAAABrvZPKAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAIdJREFUOE/tzEEKgCAQheEOWLdx351adYc8Qgs3rbuAUC9nkkF0BKNN9CMy0Xx25llf8Edr7d57j/tlP4wTHf4W/b7gsT0vLs7Sz9bFWfM9nrDXE9ITphlVPO512wkkM++FNF86vBfKeKR43rjLe5QwOvxPVPSoipHmkY5RxSMFo7rXY9+eMSdet07b6c/bnwAAAABJRU5ErkJggg=="}},r}(n.BaseDialog);n.TouchToolStrip=yt;s=function(){function i(n,t,i,r,u){this._font="normal 12px Arial";var f=this;f._name=n;f._text=t;f._image=i;r&&(f.command=r);u&&(f.canExecute=u)}return i.prototype.name=function(t){var i=this;return arguments.length===0?i._name:(n.GC$("#"+i._name).attr("id",t),n.GC$("#"+i._name+"Text").attr("id",t+"Text"),n.GC$("#"+i._name+"Image").attr("id",t+"Image"),i._name=t,i)},i.prototype.text=function(t){var i=this;return arguments.length===0?i._text:(i._text=t,n.GC$("#"+i.name()+"Text").text(t),i)},i.prototype.font=function(t){var i=this,r=n.GC$("#"+i.name()+"Text");return arguments.length===0?i._font:(i._font=t,r.css("font",t),i)},i.prototype.foreColor=function(t){var i=this,r=n.GC$("#"+i.name()+"Text");return arguments.length===0?i._foreColor?i._foreColor:r.css("color"):(r.css("color",t),i)},i.prototype.image=function(t){var i=this;return arguments.length===0?i._image:(i._image=t,n.GC$("#"+i.name()+"Image").css("background-image","url("+t+")"),i)},i.prototype.getDOM=function(t,i,r,u){var o=this,c=o.name(),s=n.GC$(document.createElement("span")),e,l,h,f;return s.attr("id",c+"Image"),s.addClass(t),s.css({"background-image":"url("+o.image()+")","background-repeat":"no-repeat",display:"block",height:i,"background-position-x":"50%"}),e=n.GC$(document.createElement("span")),e.attr("id",c+"Text"),e.addClass(r),e.css("font",o.font()),e.text(o.text()),l=o.getTextSpanWidth(r),h=60,l>h&&(h=l),f=n.GC$(document.createElement("button")),f.attr("type","button"),f.attr("id",c),f.addClass(u+" toolstrip-button-style ui-state-default ui-widget btn btn-default"),f.css({"box-sizing":"content-box",border:"0px",padding:"4px",margin:"3px",width:h+"px"}),f.append(s),f.append(e),f.getElement(0)},i.prototype.getTextSpanWidth=function(i){var u=this,r=document.createElement("span"),f;return r.className=i,r.style.font=u.font(),r.style.cssFloat="left",r.textContent=u.text(),document.body.insertBefore(r,t),f=n.GC$(r).width(),document.body.removeChild(r),f},i}();n.TouchToolStripItem=s;k=function(){function t(n){this._name=this._getSeparatorName();n&&(this.canExecute=n)}return t.prototype.name=function(){return this._name},t.prototype._getSeparatorName=function(){for(var n=0,t="separator"+n;document.getElementById(t);)n++,t="separator"+n;return t},t.prototype.getDOM=function(t,i){var r=n.GC$(document.createElement("div"));return r.attr("id",this.name()),r.addClass(t),r.css({width:"1px",height:i,display:"inline-block;","background-color":"#CCC","margin-left":"5px","margin-right":"5px",opacity:.6}),r.getElement(0)},t}();n.TouchToolStripSeparator=k;h=function(){function n(n){this.owner=n}return n.prototype.preProcessManipulationStarting=function(){this.eventMode=2;this.owner._isTouchMode=!0},n.prototype.postProcessManipulationComplete=function(){this.eventMode=0;this.touchCompleteTimestamp=(new Date).valueOf()},n.prototype.preProcessPointerDown=function(){return this.eventMode===1},n.prototype.preProcessPointerUp=function(){return this.eventMode===1},n.prototype.preProcessPointerMove=function(){return this.eventMode===1},n.prototype.preProcessMouseDown=function(n){var t=this;if(t.eventMode===2)return!0;else if(t.touchCompleteTimestamp)if((new Date).valueOf()-t.touchCompleteTimestamp<=200)return t.mouseDownHandled++,!0;else t.touchCompleteTimestamp=0,t.mouseDownHandled=0,t.eventMode=1;else t.eventMode=1;return t.owner._isTouchMode=!1,!1},n.prototype.preProcessMouseUp=function(n){var t=this;return t.mouseDownHandled?(t.mouseDownHandled--,!0):t.eventMode===2?!0:(t.eventMode=0,!1)},n.prototype.preProcessMouseMove=function(n){return this.eventMode===2},n}();n.TouchMouseMessageFilter=h,function(n){n[n.None=0]="None";n[n.MouseMode=1]="MouseMode";n[n.TouchMode=2]="TouchMode"}(pt||(pt={}));wt=function(){function i(n){this._tab=n}return i.prototype.doManipulationStarting=function(n){},i.prototype.doManipulationStarted=function(t){var r=this,i=r._tab,c=i._spread.getActiveSheet();i._tabNameEditor&&i.endSheetTabEditing(c,!1);var l="resizeBar",a="tab",v="newTab",f=i.hitTest(t.Position.X,t.Position.Y);if(f.element===l)i.resizeTab=!0,i.activeX=t.Position.X;else if(f.element===a||f.element===v||f.element===""){var e=i.canvas,y=n.DPIHelper.getLogicWidth(e),p=n.DPIHelper.getLogicHeight(e),u=r._getTouchCanvas(y,p),o=u.getContext("2d"),s=n.DPIHelper.getScaleX(u),h=n.DPIHelper.getScaleY(u);o.scale(1/s,1/h);o.drawImage(e,0,0,u.width,u.height,0,0,u.width,u.height);o.scale(s,h);r._canvas=u;r._oldFirstTab=i._firstTab;r._tabStartPosition=i.getTabStartPosition();r._tabEndPosition=i.getTabEndPosition();r._newTabSize=i.getNewTabSize();i._hideNewTabSecondMoreTab=!0}r._minFirstTabIndex=i._getNextVisibleIndex(-1);r._maxFirstTabIndex=i._reCalculateFirstTabIndex(i._getVisibleTabs())},i.prototype.doManipulationDelta=function(i){var p=this,h=p._tab,et,ot,k,d,y,tt,s,a,e,v,it,w,lt,at;if(h.resizeTab){var vt=i.Position.X-h.activeX,b=h._spread,ft=b._vp.clientWidth;b.setTabStripRatio(b._getActualTabStripRatio()+vt/ft,!0);et=h._resizeBarWidth/ft;ot=1;b._getActualTabStripRatio()<et?(b.setTabStripRatio(et,!0),h.activeX=h._resizeBarWidth):b._getActualTabStripRatio()>=ot?(b.setTabStripRatio(ot,!0),h.activeX=ft):h.activeX=i.Position.X}else{if(k=p._canvas,d=p._oldFirstTab,!k||typeof d===f||d===t)return;var st=p._minFirstTabIndex,ht=p._maxFirstTabIndex,ut=p._newTabSize,g=p._tabStartPosition,nt=p._tabEndPosition,c=i.Cumulative.Translation.X,ct=p._getNewFirstTabInfo(c,d);if(h._firstTab=ct.firstTab,y=ct.width,c>0&&d===st&&h._firstTab===st?y=0:c<0&&d===ht&&h._firstTab===ht&&(y=0),c>0&&c>y+ut?c=y+ut:c<0&&c<y-ut&&(c=y-ut),c!==0){var rt=h.canvas,o=rt.getContext("2d"),u=n.DPIHelper.getScaleX(rt),l=n.DPIHelper.getScaleY(rt);o.save();o.clearRect(0,0,n.DPIHelper.getLogicWidth(rt),n.DPIHelper.getLogicHeight(rt));tt=h.getBounds();h.paintBackground(o,tt);a=0;v=tt.height;c>0?(s=g,it=s+c,e=nt-it,e>0&&(o.scale(1/u,1/l),o.drawImage(k,s*u,a,e*u,v*l,it*u,a,e*u,v*l),o.scale(u,l)),w=c-y,nt-g<=c&&(w=0),e=y,s=g,e>0&&(o.translate(w,0),h.paintTabs(o,new n.Rect(s,a,e,v)),o.translate(-w,0))):c<0&&(it=g,s=it+r(c),e=nt-s,e>0&&(o.scale(1/u,1/l),o.drawImage(k,s*u,a,e*u,v*l,it*u,a,e*u,v*l),o.scale(u,l)),w=c-y,nt-g<=r(c)&&(w=0),e=r(y),s=nt-e,e>0&&(o.translate(w,0),h.paintTabs(o,new n.Rect(s,a,e,v)),o.translate(-w,0)));o.scale(1/u,1/l);s=0;e=g;o.drawImage(k,s*u,a,e*u,v*l,s*u,a,e*u,v*l);lt=n.ThemeStyleHelper.getCssClassThemeStyle("");at=parseInt(lt.zIndex);at>2007&&(s=nt,e=tt.x+tt.width-h._resizeBarWidth-s,o.drawImage(k,s*u,a,e*u,v*l,s*u,a,e*u,v*l));s=tt.width-h._resizeBarWidth;e=h._resizeBarWidth;o.drawImage(k,s*u,a,e*u,v*l,s*u,a,e*u,v*l);o.scale(u,l);o.restore()}}},i.prototype.doManipulationInertiaStarting=function(n){},i.prototype.doManipulationCompleted=function(n){var t=this._tab;t.resizeTab?(t.resizeTab=!1,t._spread._doTabHSResize()):(t._hideNewTabSecondMoreTab=u,t.repaint())},i.prototype.doTapped=function(n){var t=this._tab,r=t._spread,f=r.getActiveSheet(),u;t._tabNameEditor&&t.endSheetTabEditing(f,!1);var e="navButton",o="tab",s="newTab",i=t.hitTest(n.Position.X,n.Position.Y);r._suspendSetFocus=!0;try{i.element===e?t.doNavButtonClick(i.index,!0):i.element===o?t.doSheetTabClick(i.index,i.position):i.element===s&&t.doNewTabClick(i.position)}finally{r._suspendSetFocus=!1;u=r.getActiveSheet();u!==f&&(u._isTouchMode=!0,u.setFocus())}},i.prototype.doDoubleTapped=function(n){return this._tab._doMouseDbClickImp(n.Position.X,n.Position.Y)},i.prototype.doRightTapped=function(n){},i.prototype._getTouchCanvas=function(t,i){var r=this._canvas;return r?(t!==n.DPIHelper.getLogicWidth(r)||i!==n.DPIHelper.getLogicHeight(r))&&n.DPIHelper.setSize(r,t,i):(r=document.createElement("canvas"),n.DPIHelper.adjustDevicePixel(r,this._tab._spread),n.DPIHelper.setSize(r,t,i)),r},i.prototype._getNewFirstTabInfo=function(n,t){var o=this._tab,e=o._tabSizes,f=this._minFirstTabIndex,u=this._maxFirstTabIndex,i=t,r=0;if(n>0){while(i>=f){if(r>n)break;r+=e[i];i--}i<f&&(i=f)}else if(n<0&&u!==-1){while(i<=u){if(r<n)break;r-=e[i];i++}i>u&&(i=u)}return{firstTab:i,width:r}},i}();bt=function(){function n(n,t,i){var f=this,r,u;f._touchMouseMessageFilter=new h(f);f._touchTarget=new c(n,"tabStrip",f._touchMouseMessageFilter,1,-1);f._touchEventProvider=i;f._touchEventHandler=new wt(t);r=f._touchEventHandler;u=f._touchTarget;u.manipulationStarting=function(n){return r.doManipulationStarting(n)};u.manipulationStarted=function(n){return r.doManipulationStarted(n)};u.manipulationDelta=function(n){return r.doManipulationDelta(n)};u.manipulationInertiaStarting=function(n){return r.doManipulationInertiaStarting(n)};u.manipulationCompleted=function(n){return r.doManipulationCompleted(n)};u.tapped=function(n){return r.doTapped(n)};u.doubleTapped=function(n){return r.doDoubleTapped(n)};u.rightTapped=function(n){return r.doRightTapped(n)}}return n.prototype.bindTouchEvents=function(){this._touchEventProvider&&this._touchEventProvider.attachDettach(this._touchTarget,!0)},n.prototype.unbindTouchEvents=function(){this._touchEventProvider&&this._touchEventProvider.attachDettach(this._touchTarget,!1)},n.prototype.preProcessMouseDown=function(n){return this._touchMouseMessageFilter.preProcessMouseDown(n)},n.prototype.preProcessMouseUp=function(n){return this._touchMouseMessageFilter.preProcessMouseUp(n)},n.prototype.preProcessMouseMove=function(n){return this._touchMouseMessageFilter.preProcessMouseMove(n)},n}();n.TabStripTouchManager=bt;kt=function(){function n(n,t,i){var f=this,u,r;f._touchMouseMessageFilter=new h(f);f._touchTarget=new c(n,"FL_"+t.name,f._touchMouseMessageFilter,2,200);f._touchEventProvider=i;f._touchEventHandler=new dt(n,t);u=f._touchEventHandler;r=f._touchTarget;r.canDoManipulation=function(){return t.floatingObject().isSelected()};r.canDoTap=function(){return!0};r.manipulationStarting=function(n){return u.doManipulationStarting(n)};r.manipulationStarted=function(n){return u.doManipulationStarted(n)};r.manipulationDelta=function(n){return u.doManipulationDelta(n)};r.manipulationInertiaStarting=function(n){return u.doManipulationInertiaStarting(n)};r.manipulationCompleted=function(n){return u.doManipulationCompleted(n)};r.tapped=function(n){return u.doTapped(n)};r.doubleTapped=function(n){return u.doDoubleTapped(n)};r.rightTapped=function(n){return u.doRightTapped(n)}}return n.prototype.attach=function(){this._touchEventProvider&&this._touchEventProvider.attachDettach(this._touchTarget,!0)},n.prototype.detach=function(){this._touchEventProvider&&this._touchEventProvider.attachDettach(this._touchTarget,!1)},n.prototype.preProcessMouseDown=function(n){return this._touchMouseMessageFilter.preProcessMouseDown(n)},n.prototype.preProcessMouseUp=function(n){return this._touchMouseMessageFilter.preProcessMouseUp(n)},n.prototype.preProcessMouseMove=function(n){return this._touchMouseMessageFilter.preProcessMouseMove(n)},n}();n.FloatingObjectTouchManager=kt;dt=function(){function t(n,t){this._floatingObjectRender=t;this._floatingObject=t.floatingObject();this._containerElement=n;this._touchZoomManager=new b(t._sheet)}return t.prototype._positionToPage=function(t,r){var f=new i(r.X,r.Y),u=n.GC$(this._containerElement).offset();return u&&(isNaN(document.body.clientTop)||(u.top+=document.body.clientTop),isNaN(document.body.clientLeft)||(u.left+=document.body.clientLeft),f.X+=u.left,f.Y+=u.top),f},t.prototype.doManipulationStarting=function(n){n.Mode=35},t.prototype.doManipulationStarted=function(n){var t=this,i=t._positionToPage(n.OriginalSource,n.Position);t._floatingObjectRender._doMouseDown({isTouch:!0,button:0,pageX:i.X,pageY:i.Y,stopPropagation:function(){}});t._touchZoomManager.startZoom()},t.prototype.doManipulationDelta=function(n){var t=this,u=n.Cumulative.Scale,i=t._floatingObjectRender._sheet,r;u!==1&&i.parent&&i.parent._allowUserZoom?(i._eventHandler.isFloatingObjectWorking=!1,t._floatingObjectRender._resetStatusOnMouseUp(),t._touchZoomManager.continueZoom(u)):(r=t._positionToPage(n.OriginalSource,n.Position),t._floatingObjectRender._doMouseMove({isTouch:!0,button:0,pageX:r.X,pageY:r.Y,stopPropagation:function(){}}))},t.prototype.doManipulationInertiaStarting=function(n){},t.prototype.doManipulationCompleted=function(n){var t=this,r=n.Cumulative.Scale,u=t._floatingObjectRender._sheet,i;r!==1&&u.parent&&u.parent._allowUserZoom?t._touchZoomManager.endZoom(r):(i=t._positionToPage(n.OriginalSource,n.Position),this._floatingObjectRender._doMouseUp({isTouch:!0,button:0,pageX:i.X,pageY:i.Y,stopPropagation:function(){}}))},t.prototype.doTapped=function(t){try{var i=this._floatingObjectRender._sheet,r=i.isPaintSuspended();i.isPaintSuspended(!0);this._floatingObject.isSelected()||(i.unSelectAllFloatingObjects(),this._floatingObject.isSelected(!0),n.FocusHelper.setActiveElement(i));i.clearSelection()}finally{i.isPaintSuspended(r)}},t.prototype.doDoubleTapped=function(n){},t.prototype.doRightTapped=function(n){},t}();c=function(){function n(n,t,i,r,u){var f=this;f.element=n;f.messageFilter=i;f.eventFlag=t;f.maxPointer=r;f.level=u}return n}();n.TouchTargetElement=c;gt=function(){function i(){}return i.prototype.simulateMouseEvent=function(i,r){var u=i,e,o;u.isPrimary!==!1&&(u.touches&&u.touches.length>=1&&u.targetTouches&&u.targetTouches.length>=1&&(u.touches[0].clientX!==u.targetTouches[0].clientX||u.touches[0].clientY!==u.targetTouches[0].clientY)||(n.util.cancelDefault(i),e=typeof u.changedTouches!==f?u.changedTouches[0]:u,o=document.createEvent("MouseEvents"),o.initMouseEvent(r,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,t),i.target.dispatchEvent(o)))},i.prototype.down=function(n){if(!n.pointerType||n.pointerType===n.MSPOINTER_TYPE_TOUCH||n.pointerType==="touch"){var t=n.data;if(t.touchHandled)return;t.touchHandled=!0;t._touchMoved=!1;t.simulateMouseEvent(n,"mouseover");t.simulateMouseEvent(n,"mousemove");t.simulateMouseEvent(n,"mousedown")}},i.prototype.move=function(n){if(!n.pointerType||n.pointerType===n.MSPOINTER_TYPE_TOUCH||n.pointerType==="touch"){var t=n.data;if(!t.touchHandled)return;t._touchMoved=!0;t.simulateMouseEvent(n,"mousemove")}},i.prototype.up=function(n){if(!n.pointerType||n.pointerType===n.MSPOINTER_TYPE_TOUCH||n.pointerType==="touch"){var t=n.data;if(!t.touchHandled)return;t.simulateMouseEvent(n,"mouseup");t.simulateMouseEvent(n,"mouseout");t._touchMoved||t.simulateMouseEvent(n,"click");t.touchHandled=!1}},i.prototype.bindUnBindTouchEvents=function(i,r,u){var e=this,b=u.charAt(0);b!=="."&&(u="."+u);var o="MSPointerDown"+u,s="MSPointerMove"+u,h="MSPointerUp"+u,c="pointerdown"+u,l="pointermove"+u,a="pointerup"+u,v="touchstart"+u,y="touchmove"+u,p="touchend"+u,w=window.navigator.msPointerEnabled||window.navigator.pointerEnabled;r?w?(i.style.msTouchAction!==t&&typeof i.style.msTouchAction!==f&&(i.style.msTouchAction="none"),i.style.touchAction!==t&&typeof i.style.touchAction!==f&&(i.style.touchAction="none"),n.GC$(i).bind(o,e,e.down).bind(c,e,e.down),n.GC$(document).bind(s,e,e.move).bind(l,e,e.move).bind(h,e,e.up).bind(a,e,e.up)):n.GC$(i).bind(v,e,e.down).bind(y,e,e.move).bind(p,e,e.up):w?(n.GC$(i).unbind(o).unbind(c),n.GC$(document).unbind(s).unbind(l).unbind(h).unbind(a)):n.GC$(i).unbind(v).unbind(y).unbind(p)},i}();n._SimulateMouseEvents=gt;ni=function(){function n(n,t,i){var u=this,e=u._comment=t._comment,f,r;u._touchMouseMessageFilter=new h(u);u._touchTarget=new c(n,"Comment"+e._rowIndex+e._colIndex,u._touchMouseMessageFilter,2,200);u._touchEventProvider=i;u._touchEventHandler=new d(n,t);f=u._touchEventHandler;r=u._touchTarget;r.canDoManipulation=function(){return u._comment.commentState()!==3};r.canDoTap=function(){return!0};r.manipulationStarting=function(n){return f.doManipulationStarting(n)};r.manipulationStarted=function(n){return f.doManipulationStarted(n)};r.manipulationDelta=function(n){return f.doManipulationDelta(n)};r.manipulationInertiaStarting=function(n){return f.doManipulationInertiaStarting(n)};r.manipulationCompleted=function(n){return f.doManipulationCompleted(n)};r.tapped=function(n){return f.doTapped(n)};r.doubleTapped=function(n){return f.doDoubleTapped(n)};r.rightTapped=function(n){return f.doRightTapped(n)}}return n.prototype.attach=function(){this._touchEventProvider&&this._touchEventProvider.attachDettach(this._touchTarget,!0)},n.prototype.detach=function(){this._touchEventProvider&&this._touchEventProvider.attachDettach(this._touchTarget,!1)},n.prototype.preProcessMouseDown=function(n){return this._touchMouseMessageFilter.preProcessMouseDown(n)},n.prototype.preProcessMouseUp=function(n){return this._touchMouseMessageFilter.preProcessMouseUp(n)},n.prototype.preProcessMouseMove=function(n){return this._touchMouseMessageFilter.preProcessMouseMove(n)},n}();n.CommentTouchManager=ni;d=function(){function t(n,t){var i=this;i._containerElement=n;i._commentView=t;i._comment=t._comment;i._sheet=i._comment._sheet;i._touchZoomManager=new b(i._sheet)}return t.prototype._positionToPage=function(t){var u=new i(t.X,t.Y),r=n.GC$(this._containerElement).offset();return r&&(isNaN(document.body.clientTop)||(r.top+=document.body.clientTop),isNaN(document.body.clientLeft)||(r.left+=document.body.clientLeft),u.X+=r.left,u.Y+=r.top),u},t.prototype.doManipulationStarting=function(n){n.Mode=35},t.prototype.doManipulationStarted=function(n){var t=this,i=t._positionToPage(n.Position);t._commentView._doMouseDownToDragOrResize({target:n.OriginalSource,isTouch:!0,button:0,pageX:i.X,pageY:i.Y,stopPropagation:function(){}});t._touchZoomManager.startZoom()},t.prototype.doManipulationDelta=function(t){var i=this,f=t.Cumulative.Scale,r=i._sheet,e,u;f!=1&&r.parent&&r.parent._allowUserZoom?(r._eventHandler.isCommentWorking=!1,e=i._commentView,n.GC$(e._moveResizeContainerDom).remove(),i._touchZoomManager.continueZoom(f)):(u=i._positionToPage(t.Position),i._commentView._doMouseMove({target:t.OriginalSource,isTouch:!0,button:0,pageX:u.X,pageY:u.Y,stopPropagation:function(){}}))},t.prototype.doManipulationInertiaStarting=function(n){},t.prototype.doManipulationCompleted=function(n){var t=this,r=n.Cumulative.Scale,u=t._sheet,i;r!==1&&u.parent&&u.parent._allowuserZoom?t._touchZoomManager.endZoom(r):(i=t._positionToPage(n.Position),this._commentView._doMouseUp({target:n.OriginalSource,isTouch:!0,button:0,pageX:i.X,pageY:i.Y,stopPropagation:function(){}}))},t.prototype.doTapped=function(n){var r=this,t=r._comment,i=r._sheet,u;try{u=i.isPaintSuspended();i.isPaintSuspended(!0);t.commentState()===3?t.commentState(1):t.commentState()===1&&t.commentState(2)}finally{i.isPaintSuspended(u)}},t.prototype.doDoubleTapped=function(n){},t.prototype.doRightTapped=function(n){},t}();ti=function(){function n(n,t,i){var u=this,e=u._comment=t._comment,f,r;u._touchMouseMessageFilter=new h(u);u._touchTarget=new c(n,"Comment"+e._rowIndex+e._colIndex,u._touchMouseMessageFilter,2,200);u._touchEventProvider=i;u._touchEventHandler=new ii(n,t);f=u._touchEventHandler;r=u._touchTarget;r.canDoManipulation=function(){return u._comment.commentState()!==3};r.canDoTap=function(){return!0};r.manipulationStarting=function(n){return f.doManipulationStarting(n)};r.manipulationStarted=function(n){return f.doManipulationStarted(n)};r.manipulationDelta=function(n){return f.doManipulationDelta(n)};r.manipulationInertiaStarting=function(n){return f.doManipulationInertiaStarting(n)};r.manipulationCompleted=function(n){return f.doManipulationCompleted(n)};r.tapped=function(n){return f.doTapped(n)};r.doubleTapped=function(n){return f.doDoubleTapped(n)};r.rightTapped=function(n){return f.doRightTapped(n)}}return n.prototype.attach=function(){this._touchEventProvider&&this._touchEventProvider.attachDettach(this._touchTarget,!0)},n.prototype.detach=function(){this._touchEventProvider&&this._touchEventProvider.attachDettach(this._touchTarget,!1)},n.prototype.preProcessMouseDown=function(n){return this._touchMouseMessageFilter.preProcessMouseDown(n)},n.prototype.preProcessMouseUp=function(n){return this._touchMouseMessageFilter.preProcessMouseUp(n)},n.prototype.preProcessMouseMove=function(n){return this._touchMouseMessageFilter.preProcessMouseMove(n)},n}();n.CommentContentTouchManager=ti;ii=function(n){function t(t,i){n.call(this,t,i)}return __extends(t,n),t.prototype.doManipulationStarted=function(n){var t=this,i=t._positionToPage(n.Position);t._commentView._doMouseDownToEdit({target:n.OriginalSource,isTouch:!0,button:0,pageX:i.X,pageY:i.Y,stopPropagation:function(){}});t._touchZoomManager.startZoom()},t}(d)})(n.Sheets||(n.Sheets={}));var t=n.Sheets}(GcSpread||(GcSpread={}))
