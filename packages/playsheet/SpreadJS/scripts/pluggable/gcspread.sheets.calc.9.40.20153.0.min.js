/*
 *
 * SpreadJS Library 9.40.20153.0
 *
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 *
 * Licensed under the SpreadJS Commercial License. 
 * spread.sales@grapecity.com
 * http://spread.grapecity.com/Pages/Spread-JS-License/
 *
 *
 **/
var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},GcSpread;(function(n){(function(t){(function(i){function kr(n,t){t||(t=this);var i=ht(n.row,t.row),u=ht(n.column,t.column),f=rt(n.row+n.rowCount,t.row+t.rowCount),e=rt(n.column+n.columnCount,t.column+t.columnCount);return i>=f||u>=e?r:{row:i,column:u,rowCount:f-i,columnCount:e-u,intersectWith:kr}}function nf(n,t,i){n[t]||(n[t]=[]);n[t].push(i)}function tf(n,t,i){var u=n[t],r;if(u)for(r=0;r<u.length;r++)if(u[r]===i){u.splice(r,1);return}}function ei(n,t){return(n===f||n===r)&&(t===f||t===r)?!0:(n===f||n===r)&&t!==f&&t!==r||n!==f&&n!==r&&(t===f||t===r)?!1:n.toLowerCase()===t.toLowerCase()}function fu(n,t){var r=this,i={row:r.row,column:r.column,rowCount:1,columnCount:1};return r.rowRelative&&(i.row+=n,i.row=i.row>=l.maxRowCount?i.row%l.maxRowCount:i.row),r.columnRelative&&(i.column+=t,i.column=i.column>=l.maxColumnCount?i.column%l.maxColumnCount:i.column),i}function tr(n,t){var r={row:-1,column:-1,rowCount:-1,columnCount:-1},u,f,e,o,i=this;return i.isFullRow?(r.column=-1,r.columnCount=-1):(i.startColumnRelative?(e=i.startColumn+t,e=e>=l.maxColumnCount?e%l.maxColumnCount:e):e=i.startColumn,i.endColumnRelative?(o=i.endColumn+t,o=o>=l.maxColumnCount?o%l.maxColumnCount:o):o=i.endColumn,r.column=e<=o?e:o,r.columnCount=it(o-e)+1),i.isFullColumn?(r.row=-1,r.rowCount=-1):(i.startRowRelative?(u=i.startRow+n,u=u>=l.maxRowCount?u%l.maxRowCount:u):u=i.startRow,i.endRowRelative?(f=i.endRow+n,f=f>=l.maxRowCount?f%l.maxRowCount:f):f=i.endRow,r.row=u<=f?u:f,r.rowCount=it(f-u)+1),r}function ir(n){return n<=255}function rr(n){return n<=127}function ur(n){var t=n.charCodeAt(0);return t>=48&&t<=57}function oi(n){var t=n.charCodeAt(0);return ir(t)?rr(t)?(t|=32,t>=96&&t<=122):nt[t]===g.UppercaseLetter||nt[t]===g.LowercaseLetter:!0}function fr(n){var t=n.charCodeAt(0);return ir(t)?rr(t)?t<=57?t>=48:(t|=32,t>=96&&t<=122):nt[t]===g.UppercaseLetter||nt[t]===g.LowercaseLetter:!0}function eu(n){var t=n.charCodeAt(0);return ir(t)?nt[t]===g.MathSymbol||nt[t]===g.currencySymbol||nt[t]===g.ModifierSymbol||nt[t]===g.OtherSymbol:!1}function ni(n){var t=n.charCodeAt(0);return rr(t)?t>=48&&t<=57:nt[t]===g.DecimalDigitNumber||nt[t]===g.OtherNumber}function ff(n,t,i){for(var u,e=n.length,r=a.None,f=t;f<e;f++)if(u=n.charAt(f),ur(u))r===a.None?r=a.Int:r===a.Dot?r=a.Decimal:r===a.Sign?r=a.Int:(r===a.Exponent||r===a.SignExponent)&&(r=a.ScientificNotation);else if(u===i)if(r===a.Int)r=a.Decimal;else if(r===a.None||r===a.Sign)r=a.Dot;else return{result:!1};else if(u==="+"||u==="-")if(r===a.None)r=a.Sign;else if(r===a.Exponent)r=a.SignExponent;else return{result:!0,endIndex:f-1};else if(u==="E"||u==="e")if(r===a.Int||r===a.Decimal)r=a.Exponent;else return{result:!1};else if(r===a.Int||r===a.Decimal||r===a.ScientificNotation)return{result:!0,endIndex:f-1};return r===a.Int||r===a.Decimal||r===a.ScientificNotation?{result:!0,endIndex:e-1}:{result:!1}}function si(n,i,r,u,f){for(var o,c=n.length,h=r===u?0:1,s="",e=i+1;e<c;e++)if(o=n.charAt(e),o===r&&h++,o===u)if(h--,r===u&&e+2<c&&n.charAt(e+1)===r)s+=r,e++;else if(h!==0)s+=o;else return{result:s,endIndex:e};else s+=o;if(f)throw t._StringHelper.format(t.SR.Exp_NoSyntax,[u,r]);}function er(n,i,r,u,f,e){for(var o,l=n.length,c=0,h="",s=i;s<l;s++)if(o=n.charAt(s),o===f&&(h+=o,s++,o=n.charAt(s)),o===r)h+=o,c++;else if(o===u)if(c--,c!=0)h+=o;else return{result:h,endIndex:s};else h+=o;if(e)throw t._StringHelper.format(t.SR.Exp_NoSyntax,[u,r]);}function ou(n,i,r){for(var u,f,o,s=n.length,h=s-i,e=0;e<ii.length;e++)if((u=ii[e],f=u.length,!(i+f>s))&&(o=n.slice(i,i+f),f<=h&&(u===o||u===o.toUpperCase())))return{result:u,endIndex:i+f-1};if(r)throw t._StringHelper.format(t.SR.Exp_IsValid,[n.slice(i)]);}function ti(n){return n==="^"||n===":"?1:n==="*"||n==="/"||n===" "?2:n==="+"||n==="-"||n===","?3:n==="&"?4:5}function su(n){if(n.subType===11)return v.range;else if(n.subType===10)return v.union;else if(n.subType===9)return v.intersection;var t=n.value;if(t==="^")return v.exponent;else if(t==="*")return v.multiply;else if(t==="/")return v.divide;else if(t==="+")return v.add;else if(t==="-")return v.subtract;else if(t==="&")return v.concatenate;else if(t==="<")return v.lessThan;else if(t==="=")return v.equal;else if(t===">")return v.greaterThan;else if(t===">=")return v.greaterThanOrEqual;else if(t==="<=")return v.lessThanOrEqual;else if(t==="<>")return v.notEqual;else if(t===":"||t==="!")return v.range;else if(t===" "||t===",")return v.intersection;return v.add}function hi(n,t,i){return n&&n.hasOwnProperty(t)?n[t]:i}function hu(n,t){var i=t+1;return n<0?n%i+i:n>t?n%i:n}var ku,ai,br,dr,gr,du,ri,pt,yi,pi,wi,bi,ki,b,fi,ft,dt,gi,d,tu,iu,ru,e,gt,uu,v,nr,c,u,uf,ef,of,o,et,l,wt,k,or,sr,cu,hr;t.feature("calc.common",["core.stringResource","core.common","core.globalize"]);var w="undefined",ot="number",y="string",tt="boolean",bt="TRUE",kt="FALSE",vt="ARRAY",st="ARRAYROW",cr="#NULL!",lr="#DIV/0!",ar="#VALUE!",ci="#REF!",vr="#NAME?",yr="#N/A",pr="#NUM!",lu="expr",au="arrayInfo",vu="workingExpr",ii=[cr,lr,ar,ci,vr,yr,pr],yu=[0,7,15,23,29,42,36],li=[1,26,676],r=null,f=undefined,pu=!1,rt=Math.min,ht=Math.max,it=Math.abs,wu=Math.pow;i.missingArgument={},function(n){n[n.anyType=0]="anyType";n[n.numberType=1]="numberType";n[n.stringType=2]="stringType";n[n.booleanType=3]="booleanType";n[n.dateType=4]="dateType"}(i.CalcValueType||(i.CalcValueType={}));var sf=i.CalcValueType,wr=["o","n","s","b","d"],bu=[r,0,"",!1,new Date];(function(n){n[n.Cell=0]="Cell";n[n.Row=1]="Row";n[n.Col=2]="Col";n[n.NameIdentity=3]="NameIdentity"})(i.NodeType||(i.NodeType={}));ku=i.NodeType;ai=function(){function n(){this._headNames=["_head","_headRows","_headCols"];this._tailNames=["_tail","_tailRows","_tailCols"]}return n.prototype.isAdjustCell=function(n){return n.preAdj||n===this._head},n.prototype.isAdjust=function(n){return n.preAdj||n===this._head},n.prototype.addAdjust=function(n,t){var i=this,u=i._headNames[t],f=i._tailNames[t];n&&!n.preAdj&&n!==i[u]&&(i[u]?i[f].nextAdj=n:i[u]=n,n.preAdj=i[f],n.nextAdj=r,i[f]=n)},n.prototype.removeAdjust=function(n,t){var i=this,e=i._headNames[t],o=i._tailNames[t],u,f;n&&(n.preAdj||n===i[e])&&(u=n.preAdj,f=n.nextAdj,u?u.nextAdj=f:i[e]=f,f?f.preAdj=u:i[o]=u,n.preAdj=r,n.nextAdj=r)},n.prototype._adjustIndexesOnAdd=function(n,t,i,r,u,f,e,o,s,h){if(i>=0||!u){var l=r+(u?i:0),c=f+(e?i:0);return o===n&&s+h<=i&&(l-=u?h:0,c-=e?h:0),o===t&&(s<=l?(l+=h,c+=h):s<=c&&(c+=h)),l-=u?i:0,c-=e?i:0,{index:l,endIndex:c}}return{index:r,endIndex:f}},n.prototype._adjustCellExpressionOnAddRemove=function(n,t,i,r,f,o,s,h,c,l){if(t){var v=c?f.row:f.column,y=c?f.rowRelative:f.columnRelative,a;if(c&&i>=0||!c&&r>=0||!y){if(l)a=this._adjustIndexesOnAdd(n,t,c?i:r,v,y,-1,!1,o,s,h).index;else if(a=this._adjustCellOnRemove(n,t,c?i:r,v,y,o,s,h),e.err(a))return new u.ErrorExpression(a);a!==v&&(f=f.offset(c?a-v:0,c?0:a-v,!0))}}return f},n.prototype._adjustRangeExpressionOnAddRemove=function(n,t,i,r,f,o,s,h,l,a){var w,b,k;if(t){if(w=f._getRangeType(),w===c.sheet||l&&w===c.column||!l&&w===c.row)return f;var d=l?f.startRowRelative:f.startColumnRelative,g=l?f.endRowRelative:f.endColumnRelative,y=l?f.startRow:f.startColumn,p=l?f.endRow:f.endColumn,v;if(l&&i>=0||!l&&r>=0||!d||!g){if(a)v=this._adjustIndexesOnAdd(n,t,l?i:r,y,d,p,g,o,s,h);else if(v=this._adjustRangeOnRemove(n,t,l?i:r,y,d,p,g,o,s,h),e.err(v))return new u.ErrorExpression(v);b=v.index;k=v.endIndex;(b!==y||k!==p)&&(f=f.offset2(l?b-y:0,l?0:b-y,l?k-p:0,l?0:k-p))}}return f},n.prototype._adjustStructReferenceExpressionOnAddRemoveColumn=function(n,t,i,r,u,f,e,o,s){if(t){var h=u;if(h&&t===h.source())return h.offsetWhenInsertRemoveColumn(e,o,s)}return u},n.prototype.adjustFormulaOnAddRemove=function(n,t,i,e,o,s,h,c,l){var a=this,b=a.adjustFormulaOnAddRemove,y=e,p,g,nt;if(e.t===0)y=a._adjustCellExpressionOnAddRemove(n,n,t,i,e,o,s,h,c,l);else if(e.t===2)y=a._adjustRangeExpressionOnAddRemove(n,n,t,i,e,o,s,h,c,l);else if(e.t===1)y=a._adjustCellExpressionOnAddRemove(n,e.source,t,i,e,o,s,h,c,l);else if(e.t===3)y=a._adjustRangeExpressionOnAddRemove(n,e.source,t,i,e,o,s,h,c,l);else if(e.t===14)p=b.call(a,n,t,i,e.argument,o,s,h,c,l),p!==e.argument&&(y=new u.ParenthesesExpression(p));else if(e.t===11)p=b.call(a,n,t,i,e.operand,o,s,h,c,l),p!==e.operand&&(y=new u.UnaryOperatorExpression(e.operator,p));else if(e.t===10)g=b.call(a,n,t,i,e.left,o,s,h,c,l),nt=b.call(a,n,t,i,e.right,o,s,h,c,l),(g!==e.left||nt!==e.right)&&(y=new u.BinaryOperatorExpression(e.operator,g,nt));else if(e.t===7){for(var w=r,k,d=e,tt=d.argCount(),v=0;v<tt;v++)if(k=d.getArg(v),p=b.call(a,n,t,i,k,o,s,h,c,l),p!==k){w=[];w[v]=p;break}if(w){for(v=0;v<tt;v++)k=d.getArg(v),(w[v]===f||w[v]===r)&&(w[v]=b.call(a,n,t,i,k,o,s,h,c,l));y=new u.FunctionExpression(d.fn,w)}}else c||e.t!==17||(y=a._adjustStructReferenceExpressionOnAddRemoveColumn(n,n,t,i,e,o,s,h,l));return y},n.prototype.adjustFormulasOnAddRemove=function(n,t,i,r,u){this.adjustFormulasOnOperator(n,this.adjustFormulaOnAddRemove,t,i,r,u);var f=0,e=0,o=0,s=0;t===0&&(r&&u?o=i:r&&!u?f=i:!r&&u?s=i:e=i);this.adjustValidatorFormulasOnOperator(n,this.adjustFormulaOnAddRemove,t,i,f,e,o,s,r,u)},n.prototype._adjustCellOnRemove=function(n,t,i,r,u,f,e,o){if(i>=0||!u){var s=r+(u?i:0);if(f===n&&e<=i&&(s+=u?o:0),f===t)if(e+o<=s)s-=o;else if(e<=s)return h;return s-(u?i:0)}return r},n.prototype._adjustRangeOnRemove=function(n,t,i,r,u,f,e,o,s,c){if(i>=0||!u){var l=r+(u?i:0),a=f+(e?i:0),v=s+c-1;if(o===n&&s<=i&&(l+=u?c:0,a+=e?c:0),o===t)if(v<l)l-=c,a-=c;else if(s<=l&&v>=a)return h;else s>a||(v<=a?(l=s>=l?l:s,a-=c):a=s-1);return l-=u?i:0,a-=e?i:0,{index:l,endIndex:a}}return{index:r,endIndex:f}},n.prototype.adjustValidatorFormulasOnOperator=function(n,i,r,u,f,e,o,s,h,c){var v,ut,d,l,ft,et,a,y,p,g,ot,nt,tt,b,k,w,it,rt,st;if(t.features.dataValidator)for(v=t._DataValidatorCache.getAllValidators(),a=0;a<v.length;a++){y=!0;p=!0;for(g in v[a])if(!isNaN(parseFloat(g))){for(ot in v[a][g])if(nt=ot.split("_"),nt[0]!=="-1"&&(p=!1),nt[1]!=="-1"&&(y=!1),!y&&!p)break;if(!y&&!p)break}if((!h||!p)&&(h||!y)&&(ut=v[a].validator,et=v[a].sheet,tt=et._getSheetSource(),d=ut.condition,l=d.getFormulas(),b=o,k=s,tt!==n&&(b=f,k=e),l&&l.length>0)){for(w=0;w<l.length;w++)ft=l[w],it=n.getCalcService().parse(n,ft,f,e),rt=i.call(this,tt,b,k,it,n,r,u,h,c),(it!==rt||f!==o||e!==s)&&(st=n.getCalcService().unparse(n,rt,b,k),l[w]=st);d.setFormulas(l)}}},n.prototype.adjustFormulasOnOperator=function(n,i,r,u,e,o){for(var s=this,h,c,l,a,w={},b,v,y,p;s._head;){if(h=s._head.sourceModel,b=h.getSource(),c=s._head.row,l=s._head.column,w[c]&&w[c][l]){s.removeAdjust(s._head,0);continue}if(a=h._getExpr(c,l),a)if(a=i.call(s,b,c,l,a,n,r,u,e,o),v=h.getArrayInfo(c,l),v)for(v=new t.Range(c,l,v.rowCount,v.colCount),y=c;y<c+v.rowCount;y++)for(w[y]||(w[y]={}),p=l;p<l+v.colCount;p++)h.setExpression(y,p,a,v,y===c&&p===l),w[y][p]=!0;else h.setExpression(c,l,a,v,!0);else(h.getRowExpression&&h.getRowExpression(c)||h.getColumnExpression&&h.getColumnExpression(l))&&h._addCellsToDirty(c,l,1,1);s.removeAdjust(s._head,0)}while(s._headRows)h=s._headRows.sourceModel,c=s._headRows.row,h.getRowExpression&&(a=h.getRowExpression(c),a&&h.setExpression&&h.setExpression(c,-1,i.call(s,b,c,-1,a,n,r,u,e,o),f,!0)),s.removeAdjust(s._headRows,1);while(s._headCols)h=s._headCols.sourceModel,l=s._headCols.column,h.getColumnExpression&&(a=h.getColumnExpression(l),a&&h.setExpression&&h.setExpression(-1,l,i.call(s,b,-1,l,a,n,r,u,e,o),f,!0)),s.removeAdjust(s._headCols,2)},n.prototype.adjustFormulaOnRemoveSheet2=function(n,t,i,r,u){return this.adjustFormulaOnRemoveSheet(n,r,u)},n.prototype.adjustFormulaOnRemoveSheet=function(n,t,i){var b=this,c=b.adjustFormulaOnRemoveSheet,l=t,o,a,e,v,y,p,s,w;if(t instanceof u.ExternalReferenceExpression)v=t.source,(n!==i&&v===i||n===i&&v!==i)&&(l=new u.ErrorExpression(h));else if(t.t===14)o=c.call(this,n,t.argument,i),o!==t.argument&&(l=new u.ParenthesesExpression(o));else if(t.t===11)o=c.call(this,n,t.operand,i),o!==t.operand&&(l=new u.UnaryOperatorExpression(t.operator,o));else if(t.t===10)y=c.call(this,n,t.left,i),p=c.call(this,n,t.right,i),(y!==t.left||p!==t.right)&&(l=new u.BinaryOperatorExpression(t.operator,y,p));else if(t.t===7){for(s=r,w=t.argCount(),e=0;e<w;e++)if(a=t.getArg(e),o=c.call(this,n,a,i),o!==a){s=[];s[e]=o;break}if(s){for(e=0;e<w;e++)a=t.getArg(e),(s[e]===f||s[e]===r)&&(s[e]=c.call(this,n,a,i));l=new u.FunctionExpression(t.fn,s)}}return l},n.prototype.adjustFormulasOnRemoveSheet=function(n){var t=n.getCalcSourceModel(),i=n.getRowCount(),r=n.getColumnCount();this._addDependentsToAdjust(t,0,0,i,r);this.adjustFormulasOnOperator(n,this.adjustFormulaOnRemoveSheet2);this.adjustValidatorFormulasOnOperator(n,this.adjustFormulaOnRemoveSheet2,0,0,0,0,0,0,!0,!1)},n.prototype._adjustCellExpressionOnMove=function(n,t,i,r,e){var y=!!r.source,c=y?r.source:n,l=r.rowRelative,a=r.columnRelative,o,s,p,v;if((t>=0||!l)&&(i>=0||!a)){if(o=r.row+(l?t:0),s=r.column+(a?i:0),v=e.destinationContains(n,t,i,1,1),c===e._toModel&&e.destinationContains(c,o,s,1,1)&&(!l&&!a||!v))return new u.ErrorExpression(h);if(p=(y&&c===e._fromModel||!y&&n===e._fromModel)&&(!v&&e.sourceContains(e._fromModel,o,s,1,1)||v&&e.destinationContains(e._toModel,o,s,1,1)),v&&(o-=l?e.rowOffset():0,s-=a?e.colOffset():0),p&&(o+=e.rowOffset(),s+=e.colOffset()),o-=l?t:0,s-=a?i:0,e._fromModel===e._toModel?c=y?r.source:f:(c=f,p&&v&&y?c=e._toModel:p&&v||(p?c=e._toModel:v&&!y&&(c=e._fromModel))),o!==r.row||s!==r.column||c!=r.source)return c?new u.ExternalCellExpression(c,o,s,l,a):new u.CellExpression(o,s,l,a)}else if((t>=0||!l)&&i===-1){if(o=r.row+(l?t:0),e.destinationContains(n,t,i,1,1)&&(o-=l?e.rowOffset():0),e.sourceContains(c,o,-1,l,-1))o+=e.rowOffset();else if(e.destinationContains(c,o,-1,1,-1))return new u.ErrorExpression(h);if(o-=l?t:0,o!==r.row)if(r.t===0)return new u.CellExpression(o,r.column,l,r.columnRelative);else if(r.t===1)return new u.ExternalCellExpression(r.source,o,r.column,l,r.columnRelative)}else if(t===-1&&i>=0&&!a){if(s=r.column+(a?i:0),e.destinationContains(n,t,i,1,1)&&(s-=a?e.colOffset():0),e.sourceContains(c,o,s,1,1))s+=e.colOffset();else if(e.destinationContains(c,o,s,1,1))return new u.ErrorExpression(h);if(s-=a?i:0,o!==r.row||s!==r.column)if(r.t===0)return new u.CellExpression(r.row,s,r.rowRelative,a);else if(r.t===1)return new u.ExternalCellExpression(r.source,r.row,s,r.rowRelative,a)}return r},n.prototype._adjustRangeExpressionOnMove=function(n,t,i,r,e){var rt=!!r.source,p=rt?r.source:n,ht=r._getRangeType(),v,w,y,b,o,l,s,a,k,d,g,nt,ut,ft,et,ot,st,tt,ct,lt,at,it,vt,yt,pt,wt;if(ht===c.cell){if(v=r.startRowRelative,w=r.startColumnRelative,y=r.endRowRelative,b=r.endColumnRelative,t>=0||!v||!y||i>=0||!w||!b){if(o=r.startRow+(v?t:0),l=r.endRow+(y?t:0),s=r.startColumn+(w?i:0),a=r.endColumn+(b?i:0),k=l-o+1,d=a-s+1,tt=e.destinationContains(n,t,i,1,1),tt&&(ct=e._toRow-e._toColumn,lt=e._toColumn-e._toRow,k+=(v?-ct:0)+(y?ct:0),d+=(w?-lt:0)+(b?lt:0)),p===e._toModel&&e.destinationContains(p,o,s,k,d)&&(!v&&!w&&!y&&!b||!tt))return new u.ErrorExpression(h);if(st=(rt&&p===e._fromModel||!rt&&n===e._fromModel)&&(!tt&&e.sourceContains(e._fromModel,o,s,k,d)||tt&&e.destinationContains(e._toModel,o,s,k,d)),tt&&(ut=v?e.rowOffset():0,ft=y?e.rowOffset():0,et=w?e.colOffset():0,ot=b?e.colOffset():0,o-=ut,l-=ft,s-=et,a-=ot),at=!1,st)g=e.rowOffset(),nt=e.colOffset(),o+=g,l+=g,s+=nt,a+=nt;else if(e.destinationContains(p,o,s,k,d))if(it=e.intersectWith(p,o,s,k,d),it&&(it.rowCount===k||it.columnCount===d))o=it.row+e.rowOffset(),s=it.column+e.colOffset(),l=o+it.rowCount,a=s+it.columnCount,at=!0;else return new u.ErrorExpression(h);if(o-=v?t:0,l-=y?t:0,s-=w?i:0,a-=b?i:0,e._fromModel===e._toModel?p=rt?r.source:f:(p=f,st&&tt&&rt?p=e._toModel:st&&tt||(st?p=e._toModel:tt&&!rt&&(p=e._fromModel))),o!==r.startRow||s!==r.startColumn||l!==r.endRow||a!==r.endColumn||at||p!=r.source)return p?new u.ExternalRangeExpression(p,o,s,l,a,v,w,y,b):new u.RangeExpression(o,s,l,a,v,w,y,b)}else if((t>=0||!v||!y)&&i===-1){if(o=r.startRow+(v?t:0),l=r.endRow+(y?t:0),o>l)return new u.ErrorExpression(h);if(e.destinationContains(n,t,i,1,1)&&(ut=v?e.rowOffset():0,ft=y?e.rowOffset():0,o-=ut,l-=ft),k=l-o,e.sourceContains(p,o,-1,k,-1))g=e.rowOffset(),o+=g,l+=g;else if(e.destinationContains(p,o,-1,k,-1))return new u.ErrorExpression(h);if(o-=v?t:0,l-=y?t:0,o!==r.startRow||l!==r.endRow)if(r.t===2)return new u.RangeExpression(o,r.startColumn,l,r.endColumn,v,r.startColumnRelative,y,r.endColumnRelative);else if(r.t===3)return new u.ExternalRangeExpression(r.source,o,r.startColumn,l,r.endColumn,v,r.startColumnRelative,y,r.endColumnRelative)}else if(t===-1&&(i>=0||!w||!b)){if(s=r.startColumn+(w?i:0),a=r.endColumn+(b?i:0),s>a)return new u.ErrorExpression(h);if(e.destinationContains(n,t,i,1,1)&&(et=w?e.colOffset():0,ot=b?e.colOffset():0,s-=et,a-=ot),d=a-s,e.sourceContains(p,-1,s,-1,d))nt=e.colOffset(),s+=nt,a+=nt;else if(e.destinationContains(p,-1,s,-1,d))return new u.ErrorExpression(h);if(s-=w?i:0,a-=b?i:0,s!==r.startColumn||a!==r.endColumn)if(r.t===2)return new u.RangeExpression(r.startRow,s,r.endRow,a,r.startRowRelative,w,r.endRowRelative,b);else if(r.t===3)return new u.ExternalRangeExpression(r.source,r.startRow,s,r.endRow,a,r.startRowRelative,w,r.endRowRelative,b)}}else if(ht===c.row){if(v=r.startRowRelative,y=r.endRowRelative,t>=0||!v||!y){if(o=r.startRow+(v?t:0),l=r.endRow+(y?t:0),o>l)return new u.ErrorExpression(h);if(e.destinationContains(n,t,i,1,1)&&(ut=v?e.rowOffset():0,ft=y?e.rowOffset():0,o-=ut,l-=ft),k=l-o,e.sourceContains(p,o,-1,k,-1))g=e.rowOffset(),o+=g,l+=g;else if(e.destinationContains(p,o,-1,k,-1))return new u.ErrorExpression(h);if(o-=v?t:0,l-=y?t:0,o!==r.startRow||l!==r.endRow)if(r.t===2)return vt=new u.RangeExpression,vt.initBand(o,l,v,y,!0),vt;else if(r.t===3)return yt=new u.ExternalRangeExpression,yt.initBand(r.source,o,l,v,y,!0),yt}}else if(ht===c.column){if(w=r.startColumnRelative,b=r.endColumnRelative,s=r.startColumn+(w?i:0),a=r.endColumn+(b?i:0),s<a)return new u.ErrorExpression(h);if(e.destinationContains(n,t,i,1,1)&&(et=w?e.colOffset():0,ot=b?e.colOffset():0,s-=et,a-=ot),d=a-s,e.sourceContains(p,-1,s,-1,d))nt=e.colOffset(),s+=nt,a+=nt;else if(e.destinationContains(p,-1,s,-1,d))return new u.ErrorExpression(h);if(s-=w?i:0,a-=b?i:0,s!==r.startColumn||a!==r.endColumn)if(r.t===2)return pt=new u.RangeExpression,pt.initBand(s,a,w,b,!1),pt;else if(r.t===2)return wt=new u.ExternalRangeExpression,wt.initBand(r.source,s,a,w,b,!1),wt}return r},n.prototype.adjustFormulaOnMoveSwap=function(n,t,i,e,o,s){var c=this,y=c.adjustFormulaOnMoveSwap,a=e,l,d,b;if(e.t===0||e.t===1)a=s?c._adjustCellExpressionOnMove(n,t,i,e,o):c._adjustCellExpressionOnSwap(n,t,i,e,o);else if(e.t===2||e.t===3)a=s?c._adjustRangeExpressionOnMove(n,t,i,e,o):c._adjustRangeExpressionOnSwap(n,t,i,e,o);else if(e.t===14)d=e,l=y.call(c,n,t,i,d.argument,o,s),l!==d.argument&&(a=new u.ParenthesesExpression(l));else if(e.t===11)b=e,l=y.call(c,n,t,i,b.operand,o,s),l!==b.operand&&(a=new u.UnaryOperatorExpression(b.operator,l));else if(e.t===10){var p=e,g=y.call(c,n,t,i,p.left,o,s),nt=y.call(c,n,t,i,p.right,o,s);(g!==p.left||nt!==p.right)&&(a=new u.BinaryOperatorExpression(p.operator,g,nt))}else if(e.t===7){for(var v=r,w,k=e,tt=k.argCount(),h=0;h<tt;h++)if(w=k.getArg(h),l=y.call(c,n,t,i,w,o,s),l!==w){v=[];v[h]=l;break}if(v){for(h=0;h<tt;h++)w=k.getArg(h),(v[h]===f||v[h]===r)&&(v[h]=y.call(c,n,t,i,w,o,s));a=new u.FunctionExpression(k.fn,v)}}return a},n.prototype.adjustDataValidatorFormulasOnMoveSwap=function(n,i){var k=this,a=n._fromModel.getCalcService(),e,w,o,c,l,b;if(t.features.dataValidator){var s=t._DataValidatorCache.getAllValidators(),v,h,f,y,p,r=0,u=0;for((n._fromRow===0&&n._fromColumn===0||n._toRow===0||n._toColumn===0)&&(r=n._rowCount,u=n._columnCount,r>=n._toRow&&r<n._toRow+n._rowCount&&u>=n._toColumn&&u<n._toColumn+n._columnCount?r=n._toRow+n._rowCount:r>=n._fromRow&&r<n._fromRow+n._rowCount&&u>=n._fromColumn&&u<n._fromColumn+n._columnCount&&(r=n._fromRow+n._rowCount)),e=0;e<s.length;e++)if(v=s[e].validator,p=s[e].sheet,w=p._getSheetSource(),h=v.condition,f=h.getFormulas(),f&&f.length>0){for(o=0;o<f.length;o++)y=f[o],c=a.parse(n._fromModel,y,r,u),l=k.adjustFormulaOnMoveSwap(w,r,u,c,n,i),c!==l&&(b=a.unparse(n._fromModel,l,r,u),f[o]=b);h.setFormulas(f)}}},n.prototype._adjustCellExpressionOnSwap=function(n,t,i,r,f){var c=r.source||n,s=r.rowRelative,h=r.columnRelative,e,o;if((t>=0||!s)&&(i>=0||!h)){if(e=r.row+(s?t:0),o=r.column+(h?i:0),f.destinationContains(n,t,i,1,1)?(e-=s?f.rowOffset():0,o-=h?f.colOffset():0):f.sourceContains(n,e,o,1,1)&&(e+=s?f.rowOffset():0,o+=h?f.colOffset():0),f.sourceContains(c,e,o,1,1)?(e+=f.rowOffset(),o+=f.colOffset()):f.destinationContains(c,e,o,1,1)&&(e-=f.rowOffset(),o-=f.colOffset()),e-=s?t:0,o-=h?i:0,e!==r.row||o!==r.column)if(r.t===0)return new u.CellExpression(e,o,s,h);else if(r.t===1)return new u.ExternalCellExpression(r.source,e,o,s,h)}else if((t>=0||!s)&&i===-1){if(e=r.row+(s?t:0),f.destinationContains(n,t,-1,1,-1)?e-=s?f.rowOffset():0:f.sourceContains(n,e,-1,1,-1)&&(e+=s?f.rowOffset():0),f.sourceContains(c,e,-1,1,-1)?e+=f.rowOffset():f.destinationContains(c,e,-1,1,-1)&&(e-=f.rowOffset()),e-=s?t:0,e!==r.row||o!==r.column)if(r.t===0)return new u.CellExpression(e,r.column,s,r.columnRelative);else if(r.t===1)return new u.ExternalCellExpression(r.source,e,r.column,s,r.columnRelative)}else if(t===-1&&i>=0&&!h&&(o=r.column+(h?i:0),f.destinationContains(n,-1,i,-1,1)?o-=h?f.colOffset():0:f.sourceContains(n,-1,o,-1,1)&&(o+=h?f.colOffset():0),f.sourceContains(c,-1,o,-1,1)?o+=f.colOffset():f.destinationContains(c,-1,o,-1,1)&&(o-=f.colOffset()),o-=h?i:0,e!==r.row||o!==r.column))if(r.t===0)return new u.CellExpression(r.row,o,r.rowRelative,h);else if(r.t===1)return new u.ExternalCellExpression(r.source,r.row,o,r.rowRelative,h);return r},n.prototype._adjustRangeExpressionOnSwap=function(n,t,i,r,f){var tt=r.source||n,ut=r._getRangeType(),e,s,o,l,it,rt,a,v,p,y,w,b,k,d,g,nt,ft,et,ot,st;if(ut===c.cell){if(a=r.startRowRelative,v=r.startColumnRelative,p=r.endRowRelative,y=r.endColumnRelative,(t>=0||!a||!p)&&(i>=0||!v||!y)){if(e=r.startRow+(a?t:0),s=r.endRow+(p?t:0),o=r.startColumn+(v?i:0),l=r.endColumn+(y?i:0),it=s-e,rt=l-o,f.destinationContains(n,t,i,1,1)?(k=a?f.rowOffset():0,d=v?f.colOffset():0,g=p?f.rowOffset():0,nt=y?f.colOffset():0,e-=k,s-=g,o-=d,l-=nt):f.sourceContains(n,e,o,it,rt)&&(k=a?f.rowOffset():0,d=v?f.colOffset():0,g=p?f.rowOffset():0,nt=y?f.colOffset():0,e+=k,s+=g,o+=d,l+=nt),f.sourceContains(tt,e,o,it,rt)?(w=f.rowOffset(),b=f.colOffset(),e+=w,s+=w,o+=b,l+=b):f.destinationContains(tt,e,o,it,rt)&&(w=f.rowOffset(),b=f.colOffset(),e-=w,s-=w,o-=b,l-=b),e-=a?t:0,s-=p?t:0,o-=v?i:0,l-=y?i:0,e!==r.startRow||o!==r.startColumn||s!==r.endRow||l!==r.endColumn)if(r.t===2)return new u.RangeExpression(e,o,s,l,a,v,p,y);else if(r.t===3)return new u.ExternalRangeExpression(r.source,e,o,s,l,a,v,p,y)}else if((t>=0||!a||!p)&&i===-1){if(e=r.startRow+(a?t:0),s=r.endRow+(p?t:0),e<s)return new u.ErrorExpression(h);if(f.destinationContains(n,t,-1,1,-1)?(k=a?f.rowOffset():0,g=a?f.rowOffset():0,e-=k,s-=g):f.sourceContains(n,t,-1,1,-1)&&(k=a?f.rowOffset():0,g=a?f.rowOffset():0,e+=k,s+=g),it=s-e,f.sourceContains(tt,e,-1,it,-1)?(w=f.rowOffset(),e+=w,s+=w):f.destinationContains(tt,e,-1,it,-1)&&(w=f.rowOffset(),e-=w,s-=w),e-=a?t:0,s-=p?t:0,e!==r.startRow||s!==r.endRow)if(r.t===2)return new u.RangeExpression(e,r.startColumn,s,r.endColumn,a,r.startColumnRelative,p,r.endColumnRelative);else if(r.t===3)return new u.ExternalRangeExpression(r.source,e,r.startColumn,s,r.endColumn,a,r.startColumnRelative,p,r.endColumnRelative)}else if(t===-1&&(i>=0||!v||!y)){if(o=r.startColumn+(v?i:0),l=r.endColumn+(y?i:0),o<l)return new u.ErrorExpression(h);if(f.destinationContains(n,-1,i,-1,1)?(d=v?f.colOffset():0,nt=y?f.colOffset():0,o-=d,l-=nt):f.sourceContains(n,-1,i,-1,1)&&(d=v?f.colOffset():0,nt=y?f.colOffset():0,o+=d,l+=nt),rt=l-o,f.sourceContains(tt,-1,o,-1,rt)?(b=f.colOffset(),o+=b,l+=b):f.destinationContains(tt,-1,o,-1,rt)&&(b=f.colOffset(),o-=b,l-=b),o-=v?i:0,l-=y?i:0,o!==r.startColumn||l!==r.endColumn)if(r.t===2)return new u.RangeExpression(r.startRow,o,r.endRow,l,r.startRowRelative,v,r.endRowRelative,y);else if(r.t===3)return new u.ExternalRangeExpression(r.source,r.startRow,o,r.endRow,l,r.startRowRelative,v,r.endRowRelative,y)}}else if(ut===c.row){if(a=r.startRowRelative,p=r.endRowRelative,t>=0||!a||!p){if(e=r.startRow+(a?t:0),s=r.endRow+(p?t:0),e<s)return new u.ErrorExpression(h);if(f.destinationContains(n,t,-1,1,-1)?(k=a?f.rowOffset():0,g=p?f.rowOffset():0,e-=k,s-=g):f.sourceContains(n,t,-1,1,-1)&&(k=a?f.rowOffset():0,g=p?f.rowOffset():0,e+=k,s+=g),it=s-e,f.sourceContains(tt,e,-1,it,-1)?(w=f.rowOffset(),e+=w,s+=w):f.destinationContains(tt,e,-1,it,-1)&&(w=f.rowOffset(),e-=w,s-=w),e-=a?t:0,s-=p?t:0,e!==r.startRow||s!==r.endRow)if(r.t===2)return ft=new u.RangeExpression,ft.initBand(e,s,a,p,!0),ft;else if(r.t===3)return et=new u.ExternalRangeExpression,et.initBand(r.source,e,s,a,p,!0),et}}else if(ut===c.column){if(v=r.startColumnRelative,y=r.endColumnRelative,o=r.startColumn+(v?i:0),l=r.endColumn+(y?i:0),o>l)return new u.ErrorExpression(h);if(f.destinationContains(n,-1,i,-1,1)?(d=v?f.colOffset():0,nt=y?f.colOffset():0,o-=d,l-=nt):f.sourceContains(n,-1,i,-1,1)&&(d=v?f.colOffset():0,nt=y?f.colOffset():0,o+=d,l+=nt),rt=l-o,f.sourceContains(tt,-1,o,-1,rt)?(b=f.colOffset(),o+=b,l+=b):f.destinationContains(tt,-1,o,-1,rt)&&(b=f.colOffset(),o-=b,l-=b),o-=v?i:0,l-=y?i:0,o!==r.startColumn||l!==r.endColumn)if(r.t===2)return ot=new u.RangeExpression,ot.initBand(o,l,v,y,!1),ot;else if(r.t===3)return st=new u.ExternalRangeExpression,st.initBand(r.source,o,l,v,y,!1),st}return r},n.prototype.adjustFormulasOnMoveSwap=function(n,i,r,u,e,o,s,h,c){var l=this,nt=l.adjustFormulaOnMoveSwap,g=new br(n,i,r,u,e,o,s,h),a,v,y,p,d={},w,b,k;for(l.adjustDataValidatorFormulasOnMoveSwap(g,c);l._head;){if(a=l._head.sourceModel,v=l._head.row,y=l._head.column,d[v]&&d[v][y]){l.removeAdjust(l._head,0);continue}if(p=a.getExpression(v,y),p)if(p=nt.call(l,a.getSource(),v,y,p,g,c),w=a.getArrayInfo(v,y),w)for(w=new t.Range(v,y,w.rowCount,w.colCount),b=v;b<v+w.rowCount;b++)for(d[b]||(d[b]={}),k=y;k<y+w.colCount;k++)a.setExpression(b,k,p,w,b===v&&k===y),d[b][k]=!0;else a.setExpression(v,y,p,w,!0);else(a.getRowExpression&&a.getRowExpression(v)||a.getColumnExpression&&a.getColumnExpression(y))&&a._addCellsToDirty(v,y,1,1);l.removeAdjust(l._head,0)}while(l._headRows)a=l._headRows.sourceModel,v=l._headRows.row,a.getRowExpression&&(p=a.getRowExpression(v),p&&a._setRowExpression&&a._setRowExpression(v,nt.call(l,a.getSource(),v,-1,p,g,c),f)),l.removeAdjust(l._headRows,1);while(l._headCols)a=l._headCols.sourceModel,y=l._headCols.column,a.getColumnExpression&&(p=a.getColumnExpression(y),p&&a._setColumnExpression&&a._setColumnExpression(y,nt.call(l,a.getSource(),-1,y,p,g,c),f)),l.removeAdjust(l._headCols,2)},n.prototype._addDependentsToAdjust=function(n,t,i,r,u){n.addDependents(t,i,r,u,!0,!1)},n.prototype._addCellsToAdjust=function(n,t,i,u,f){for(var e,c,l=this,a=t+u,v=i+f,s,h,o=t;o<a;o++)for(e=i;e<v;e++)(s=n._getCalc(o,e),h=n._getExpr(o,e),s||h)&&(n._setCalc(o,e,r),c=n._getCellCalc(o,e,!0),l.addAdjust(c,0))},n.prototype._addColumnsToAdjust=function(n,t,i){for(var f,e=this,u=t;u!==-1&&u<t+i;u++)(n._getCalc(-1,u)||n._getExpr(-1,u))&&(n._setCalc(-1,u,r),f=n._getColumnCalc(u,!0),e.addAdjust(f,2))},n.prototype._addRowsToAdjust=function(n,t,i){for(var f,e=this,u=t;u!==-1&&u<t+i;u++)(n._getCalc(u,-1)||n._getExpr(u,-1))&&(n._setCalc(u,-1,r),f=n._getRowCalc(u,!0),e.addAdjust(f,1))},n.prototype._addVolatitleToAdjust=function(n){for(var i,f=this,e,o=n.getCalcService().getAllSouceModels(),r,t,u=0;u<o.length;u++)for(e=o[u],r=e._getAllVolatitles(),i=0;i<r.length;i++)t=r[i],t&&t instanceof pt&&!f.isAdjustCell(t)&&f.addAdjust(t,0)},n.prototype.onBeforeAddRemoveRows=function(n,t){var r=this,i=n.rC(),u=n.cC();n.unlinkCellExpression(t,0,i-t,u);n.unlinkRowExpression(t,i-t);r._addDependentsToAdjust(n,t,-1,i-t,-1)},n.prototype.onAfterAddRemoveRows=function(n,t,i,r){var u=this,f=n.rC(),e=n.cC();r?n._addCellsToDirty(t,0,i,e):f+=i;u._addCellsToAdjust(n,t,0,f-t,e);u._addRowsToAdjust(n,t,f-t);u._addVolatitleToAdjust(n);u.adjustFormulasOnAddRemove(n.getSource(),t,i,!0,r);n.getCalcService().autoCalculation&&n.getCalcService().recalculateAll(!1)},n.prototype.onAfterAddRemoveColumns=function(n,t,i,r){var u=this,e=n.rC(),f=n.cC();r?n._addCellsToDirty(0,t,e,i):f+=i;u._addCellsToAdjust(n,0,t,e,f-t);u._addColumnsToAdjust(n,t,f-t);u._addVolatitleToAdjust(n);u.adjustFormulasOnAddRemove(n.getSource(),t,i,!1,r);n.getCalcService().autoCalculation&&n.getCalcService().recalculateAll(!1)},n.prototype.onBeforeAddRemoveColumns=function(n,t){var r=this,u=n.rC(),i=n.cC();n.unlinkCellExpression(0,t,u,i-t);n.unlinkColumnExpression(t,i-t);r._addDependentsToAdjust(n,-1,t,-1,i-t)},n._copyExpression=function(r,u,f,e,o){var h=r,a=n,v=a._copyExpression,s,p;if(!t.util.hasCalc()||!r)return h;var c=i.Expressions,w=l.maxRowCount,b=l.maxColumnCount,y=i.Errors.Reference,k=c.ErrorExpression,d=c.ExternalErrorExpression;if(r.t===14)h=new c.ParenthesesExpression,h.argument=v.call(a,r.argument,u,f,e,o);else if(r.t===0||r.t===1){if(r.rowRelative&&(r.row+u<0||r.row+u>w)||r.columnRelative&&(r.column+f<0||r.column+f>b))return r.source?new d(r.source,y):new k(y);h=r.offset(0,0,!1)}else if(r.t===2||r.t===3||r.t===16){if(s=r,s.startRowRelative&&(s.startRow+u<0||s.startRow+u>w)||s.startColumnRelative&&(s.startColumn+f<0||s.startColumn+f>b)||s.endRowRelative&&(s.endRow+u<0||s.endRow+u>w)||s.endColumnRelative&&(s.endColumn+f<0||s.endColumn+f>b))return r.startSource?new c.SheetRangeErrorExpression(r.startSource,r.endSource,y):r.source?new d(r.source,y):new k(y);h=r.offset(0,0,!1)}else if(r.t===11)h=new c.UnaryOperatorExpression(r.operator,v.call(a,r.operand,u,f,e,o));else if(r.t===10)h=new c.BinaryOperatorExpression(r.operator,v.call(a,r.left,u,f,e,o),v.call(a,r.right,u,f,e,o));else if(r.t===7){if(h=new c.FunctionExpression(r.fn,[]),r.args&&r.args.length>0)for(p=0;p<r.args.length;p++)h.args[p]=v.call(a,r.args[p],u,f,e,o)}else r.t===17&&(h=r.offsetWhenCopy(e,o));return h},n.copyFormula=function(t,r,e,o,s,h,c,l,a){var yt=t,ut=o,ui=t.getSource(),ot=o.getSource(),ni=n,fi,et,v,y,lt,ti,at,w,b,p,it,dt,gt,pt,ct,g,ii,ri,vt,d;if(yt&&ut){var wt={},nt,bt=r,kt=e,tt=s,ft=h,st=c,ht=l;for(r<0&&(bt=0,st=rt(t.rC(),o.rC())),e<0&&(kt=0,ht=rt(t.cC(),o.cC())),s<0&&(tt=0),h<0&&(ft=0),fi=!(t===o),yt&&yt.unlinkCellExpression(tt,ft,st,ht),et=new i.CalcSourceModel(t.getCalcService(),ui),v=0;v<st;v++)for(y=0;y<ht;y++)yt._copyExpr(et,v+bt,y+kt,v,y),lt=t.getSource().getSheet().getStyleObject(v+tt,y+ft),lt&&lt.validator&&(nt=lt.validator.condition,nt&&nt.getFormulas&&nt.getFormulas().length>0&&(wt[lt.validator.id]=nt));for(ti={},at=o.getCalcService(),v=0;v<st;v++)if(!a||!ot.isHiddenRow(v+tt))for(w=v+tt,y=0;y<ht;y++)if(b=y+ft,p=et._getExpr(v,y),p){if(p===ti)continue;if(p=ni._copyExpression(et._getExpr(v,y),w,b,s-r,h-e),it=et.getArrayInfo(v,y),ot)if(it){for(dt=st-v<it.rowCount?st-v:it.rowCount,gt=ht-y<it.colCount?ht-y:it.colCount,d=0;d<dt;d++)for(pt=0;pt<gt;pt++)et._setExpr(v+d,y+pt,p);o.setArrayFormula(w,b,dt,gt,at.unparseWithoutCulture(ot,p,w,b))}else ct=p?at.unparseWithoutCulture(ot,p,w,b):f,ot.setFormula(w,b,ct),g=et._getWorkingExpr(v,y),g&&(g=ni._copyExpression(g,w,b,s-r,h-e),ii=new k(ot,!1,w,b),g=u._mappingArray(ii,p,!1,0,0),g=g===p?f:g),ut._setCellExpression(w,b,p,g,it);else ut._setExpr(v+tt,y+ft,p),ut._setArrayInfo(v+tt,y+ft,it)}else ut&&ut.getExpression(w,b)&&ut._clearAllExpr(w,b);for(ri in wt){for(nt=wt[ri],vt=nt.getFormulas(),d=0;d<vt.length;d++)ct=vt[d],p=at.parse(t.getSource(),ct,bt,kt),ct=at.unparse(t.getSource(),p,tt,ft),vt[d]=ct;nt.setFormulas(vt)}}},n.prototype.onAfterRemoveName=function(n,t){var i=n._getNameCalc(t,!1);i&&(i.updateListening(!0,!1),i.addToDirty(),i.updateListeningOnRemoved())},n.prototype.adjustFormulaOnRemoveName=function(n,t,i){var w=this,c=w.adjustFormulaOnRemoveName,l=t,o,a,e,v,y,s,p;if(t.t===8||t.t===18||t.t===9){if(t.name===i&&(!t.source||t.source===n.getSource()))return t.source?new u.ExternalErrorExpression(t.source,h):new u.ErrorExpression(h)}else if(t.t===14)o=c.call(this,n,t.argument,i),o!==t.argument&&(l=new u.ParenthesesExpression(o));else if(t.t===11)o=c.call(this,n,t.operand,i),o!==t.operand&&(l=new u.UnaryOperatorExpression(t.operator,o));else if(t.t===10)v=c.call(this,n,t.left,i),y=c.call(this,n,t.right,i),(v!==t.left||y!==t.right)&&(l=new u.BinaryOperatorExpression(t.operator,v,y));else if(t.t===7){for(s=r,p=t.argCount(),e=0;e<p;e++)if(a=t.getArg(e),o=c.call(this,n,a,i),o!==a){s=[];s[e]=o;break}if(s){for(e=0;e<p;e++)a=t.getArg(e),(s[e]===f||s[e]===r)&&(s[e]=c.call(this,n,a,i));l=new u.FunctionExpression(t.fn,s)}}return l},n.prototype.invalidName=function(n,t){if(t){var r=n.getCalcSourceModel(),i=r._getNameCalc(t.toUpperCase(),!0);i&&i.addListenersToAdjust()}},n.prototype.onAfterRemoveTable=function(n){for(var f=this,n,i,r,h,s={},c,u,e,o;f._head;){if(n=f._head.sourceModel,c=n.getSource(),i=f._head.row,r=f._head.column,s[i]&&s[i][r]){f.removeAdjust(f._head,0);continue}if(h=n._getExpr(i,r),h)if(u=n.getArrayInfo(i,r),u)for(u=new t.Range(i,r,u.rowCount,u.colCount),e=i;e<i+u.rowCount;e++)for(s[e]||(s[e]={}),o=r;o<r+u.colCount;o++)n.setExpression(e,o,h,u,e===i&&o===r),s[e][o]=!0;else n.setExpression(i,r,h,u,!0);else(n.getRowExpression&&n.getRowExpression(i)||n.getColumnExpression&&n.getColumnExpression(r))&&n._addCellsToDirty(i,r,1,1);f.removeAdjust(f._head,0)}},n}();i.CalcOperatorAdjustor=ai;br=function(){function n(n,t,i,r,u,f,e,o){var s=this;s._fromModel=n;s._fromRow=t;s._fromColumn=i;s._toModel=r;s._toRow=u;s._toColumn=f;s._rowCount=e;s._columnCount=o}return n.prototype.rowOffset=function(){return this._toRow-this._fromRow},n.prototype.colOffset=function(){return this._toColumn-this._fromColumn},n.prototype.sourceContains=function(n,t,i,r,u){var f=this;return f._fromModel===n&&(f._fromRow===-1||f._fromRow<=t&&t+r<=f._fromRow+f._rowCount)&&(f._fromColumn===-1||f._fromColumn<=i&&i+u<=f._fromColumn+f._columnCount)},n.prototype.destinationContains=function(n,t,i,r,u){var f=this;return f._toModel===n&&(f._toRow===-1||f._toRow<=t&&t+r<=f._toRow+f._rowCount)&&(f._toColumn===-1||f._toColumn<=i&&i+u<=f._toColumn+f._columnCount)},n.prototype.intersectWith=function(n,t,i,u,f){var e=this,o,s;return e._toModel!==n?r:(o=e._createValidCellRange(n,t,i,u,f),s=e._createValidCellRange(n,e._fromRow,e._fromColumn,u,f),s.intersectWith(o))},n.prototype._createValidCellRange=function(n,t,i,r,u){var f=t===-1?0:t,e=t===-1||r===-1?n.rowCount:r,o=i===-1?0:i,s=i===-1||u===-1?n.columnCount:u;return{row:f,column:o,rowCount:e,columnCount:s,intersectWith:kr}},n}();dr=function(){function n(t){this.id=n.sourceId++;this._service=t;this._calcSourceModel=null}return n.prototype.getCalcService=function(){return this._service},n.prototype.setCalcService=function(n){this._service=n},n.prototype.getCalcSourceModel=function(){return this._calcSourceModel},n.prototype.setCalcSourceModel=function(n){this._calcSourceModel=n},n.prototype.getValue=function(n,t,i){return r},n.prototype.getValueByName=function(n,t){return r},n.prototype.getName=function(){return""},n.prototype.setValue=function(n,t,i){},n.prototype.setValueByName=function(n,t){},n.prototype.getReference=function(n,i,r,u){return new d(this,[new t.Range(n,i,r,u)])},n.prototype.getSheetRangeReference=function(n,i,r,u,f){return new d(this,[new t.Range(i,r,u,f)])},n.prototype.getSources=function(n){return[this]},n.prototype.referenceToArray=function(n,t,i,u,o,h){var ft=this,tt,it,v=1,y=1,w,b,p,c=[],et,l,g,ot,st,ht=wr[t],ct=bu,lt=e.CalcConvertedError,rt,ut,a,at,vt,nt,k,d;if(p=n.getRangeCount(),p===0)return c.isError=!0,[];for(rt=this.getRowCount(),ut=this.getColumnCount(),i=i===f?!0:i,a=0;a<p;a++){if(i||(g=[],c.push(g)),v=n.getRowCount(a),v===0)return c.isError=!0,[];if(y=n.getColumnCount(a),y===0)return c.isError=!0,[];for(w=n.getRow(a),b=n.getColumn(a),v=Math.min(w+v,rt)-w,y=Math.min(b+y,ut)-b,k=0;k<v;k++)for(tt=w+k,i||(nt=[],g.push(nt)),d=0;d<y;d++){if(it=b+d,l=ft.getValue(tt,it),u&&e.err(l))return c=[l],c.isError=!0,c;if(l=e.convertValue(l,t,!0,h),o&&l===e.CalcConvertedError)return c=[s],c.isError=!0,c;l===r&&h||(i?c.push(l):nt.push(l))}}return i||p!==1||(c=c[0]),c.rowCount=v,c.colCount=y,c.rangeCount=p,c},n.prototype.getSheetReference=function(){var n=this;return n._reference=n._reference||new d(n),n._reference},n.prototype.setFormula=function(n,t,i){},n.prototype.setFormulaByName=function(n,t){},n.prototype.setArrayFormula=function(n,t,i,r,u){},n.prototype.getRowCount=function(){return 1e3},n.prototype.getColumnCount=function(){return 100},n.prototype.isHiddenRow=function(n,t){return!1},n.prototype.getParserContext=function(n,t,i,r){return new et(this,n,t,i,r)},n.prototype.startCalculation=function(){},n.prototype.endCalculation=function(){},n.prototype.getEvaluatorContext=function(n,t,i,r,u,e,o){return i?(r=r===f?n:r,u=u===f?t:u,e=e===f?1:e,o=o===f?1:o,new k(this,i,r,u,e,o,n,t)):new k(this,i,n,t)},n.prototype.getCustomFunction=function(n){return r},n.prototype.getCustomName=function(n){return r},n.prototype.refresh=function(){},n.prototype.toJSON=function(n,t){},n.sourceId=1,n}();i.CalcSource=dr;gr=function(){function n(){this._sourceModeles={};this.autoCalculation=!0;this._headNames=["_head","_headRows","_headCols","_headNamIDs"];this._tailNames=["_tail","_tailRows","_tailCols","_tailNameIDs"];this.maximumIterations=1;this.maximumChange=.01;var n=this;n._parser=new l;n._evaluator=new hr;n.useR1C1=!1;n._suspended=0;n._operatorAdjustor=new ai}return n.prototype.getOperatorAdjustor=function(){return this._operatorAdjustor},n.prototype.getSourceModel=function(n){var t=this._sourceModeles[n.id];return t||(t=this._sourceModeles[n.id]=new ri(this,n),n.setCalcSourceModel(t),n.setCalcService(this)),t},n.prototype.getGlobalSourceModel=function(n){return this._globalSourceModel||(this._globalSourceModel=new ri(this,n)),this._globalSourceModel},n.prototype.setSourceModel=function(n,t){this._sourceModeles[n.id]=t},n.prototype.getAllSouceModels=function(){var n=[],t=this._sourceModeles;for(var i in t)n.push(t[i]);return n},n.prototype.removeSource=function(n){var t=this._sourceModeles[n.id];t&&(this._operatorAdjustor.adjustFormulasOnRemoveSheet(n),delete this._sourceModeles[n.id])},n.prototype.clearSource=function(){this._sourceModeles={};this.clearDirties()},n.prototype.ignoreDirty=function(){return this._ignoreDirty},n.prototype.suspend=function(n){this._parseCache||(this._parseCache={});this._suspended++;this._ignoreDirty=n?!0:n},n.prototype.resume=function(n){var t=this;t._suspended--;t._suspended<0&&(t._suspended=0);t.IsSuspended()||(this._parseCache=r,t._ignoreDirty=!1,t.recalculateAll(n))},n.prototype.clearDirties=function(){for(var n=this,t,i,e=[n._head,n._headRows,n._headCols,n._headNamIDs],u=0;u<e.length;u++)for(t=e[u];t;)i=t.nextDirty,i?(t.nextDirty=i.preDirty=f,t=i):t=r;n._head=n._tail=n._headRows=n._tailRows=n._headCols=n._tailCols=n._headNamIDs=n._tailNameIDs=r},n.prototype.resumeWithoutCalc=function(){this._suspended=0;this.clearDirties()},n.prototype.IsSuspended=function(){return this._suspended>0},n.prototype.recalculate=function(n,t,i){var r=this.getSourceModel(n);i===-1?r._addCellsToDirty(t,0,1,r.cC()):t===-1?r._addCellsToDirty(0,i,r.rC(),1):r._addCellsToDirty(t,i,1,1);this.IsSuspended()||this.recalculateAll(!1)},n.prototype.recalculateByName=function(n,t){if(t){var i=this.getSourceModel(n),r=i._getNameIDCalc(t.toUpperCase(),!0);this.addDirty(r,3);this.IsSuspended()||this.recalculateAll(!1)}},n.prototype.recalcRange=function(n,t,i,r,u){var f=this.getSourceModel(n);i===-1?f._addCellsToDirty(t,0,r,f.cC()):t===-1?f._addCellsToDirty(0,i,f.rC(),u):f._addCellsToDirty(t,i,r,u);this.IsSuspended()||this.recalculateAll(!1)},n.prototype.recalculateAll=function(n){var r=this,t,i,f,e,u;if(!r.IsSuspended()){r._evaluator.startCache();i=this._sourceModeles;for(u in i)t=i[u],t.getSource().startCalculation(),n!==!1?(f=t.cC(),e=t.rC(),t._addColumnsToDirty(0,f),t._addRowsToDirty(0,e),t._addCellsToDirty(0,0,e,f)):t._addVolatitlesToDirty();r._recalculateImp();for(u in i)t=i[u],t.getSource().endCalculation();r._evaluator.endCache()}},n.prototype._cacheHeadDirtyColumns=function(n,t){for(var r=n.length,i=t;i;)n[r]=i,r++,i=i.nextDirty},n.prototype._recalculateImp=function(n){var y,tt,it,rt,e,k,v,d,ut,ft;n===undefined&&(n=!0);var t=this,a=r,w=!1,u,o,s,g,nt,p,b,i,c,h,l;if(n){for(y=[],t._headCols&&t._cacheHeadDirtyColumns(y,t._headCols);t._headRows;){for(u=t._headRows.sourceModel,b=u.cC(),s=0;s<b;s++)t.addDirty(u._getCellCalc(t._headRows.row,s,!0),0);t.removeDirty(t._headRows,1)}while(t._headCols){if(u=t._headCols.sourceModel,p=u.rC(),p>0)for(o=0;o<p;o++)t.addDirty(u._getCellCalc(o,t._headCols.column,!0),0);else t._headCols.addListenersToDirty();t.removeDirty(t._headCols,2)}for(i=t._head;i;i=i.nextDirty){for(u=i.sourceModel,g=i.row,nt=i.column,c=u._getRowCalc(g,!1),h=u._getColumnCalc(nt,!1),l=u._getRangeCalc(!1),i.addListenersToDirty(),c&&c.addListenersToDirty(),h&&h.addListenersToDirty(),l&&l.addListenersToDirty(g,nt,1,1);t._headRows;){for(u=t._headRows.sourceModel,b=u.cC(),s=0;s<b;s++)t.addDirty(u._getCellCalc(t._headRows.row,s,!0),0);t.removeDirty(t._headRows,1)}while(t._headCols){for(tt=!1,v=0;v<y.length;v++)if(y[v]==t._headCols){tt=!0;break}if(tt){t.removeDirty(t._headCols,2);continue}else y[y.length]=t._headCols;for(u=t._headCols.sourceModel,p=u.rC(),o=0;o<p;o++)t.addDirty(u._getCellCalc(o,t._headCols.column,!0),0);t.removeDirty(t._headCols,2)}}for(e=t._headNamIDs;e;e=e.nextDirty)u=e.sourceModel,e.addListenersToDirty()}for(i=t._head;i;i=a)u=i.sourceModel,it=u.rC(),rt=u.cC(),a=i.nextDirty,i.row<it&&i.column<rt?(pu&&(h=u._getColumnCalc(i.column,!1),h&&(h.delay=0)),i.delay=0):t.removeDirty(i,0);for(e=t._headNamIDs;e;e=e.nextDirty)e.delay=0;for(i=t._head;i;i=i.nextDirty)u=i.sourceModel,o=i.row,s=i.column,c=u._getRowCalc(o,!1),h=u._getColumnCalc(s,!1),l=u._getRangeCalc(!1),i.adjustDelayOfListeners(!0),c&&c.adjustDelayOfListeners(!0),h&&h.adjustDelayOfListeners(!0),l&&l.adjustDelayOfListeners(o,s,!0);for(e=t._headNamIDs;e;e=e.nextDirty)e.adjustDelayOfListeners(!0);do{for(w=!1,i=t._head;i;i=a)if(a=i.nextDirty,i.delay===0){if(u=i.sourceModel,o=i.row,s=i.column,c=u._getRowCalc(o,!1),h=u._getColumnCalc(s,!1),h&&h.delay)continue;l=u._getRangeCalc(!1);u.recalculateCell(o,s);t.removeDirty(i,0);i.adjustDelayOfListeners(!1);c&&c.adjustDelayOfListeners(!1);h&&h.adjustDelayOfListeners(!1);l&&l.adjustDelayOfListeners(o,s,!1);w=!0}for(e=t._headNamIDs;e;e=e.nextDirty)e.delay===0&&(u=e.sourceModel,u.recalculateNameID(e.name),t.removeDirty(e,3),e.adjustDelayOfListeners(!1),w=!0)}while(w);if(t._head){for(k=!0,v=0;k&&v<t.maximumIterations;v++)for(k=!1,i=t._head;i;i=a)a=i.nextDirty,d=i.sourceModel,o=i.row,s=i.column,ut=d.getSource().getValue(o,s),d.recalculateCell(o,s),ft=d.getSource().getValue(o,s),t._iterationChange(ut,ft)>=t.maximumChange&&(k=!0),i.nextDirty=f,a&&(a.preDirty=f);t._head=t._tail=f}},n.prototype._iterationChange=function(n,t){var i=parseFloat(n),r=parseFloat(t);return it(r-i)},n.prototype.initParserContext=function(n){var t=this._parserContext;t||(this._parserContext=t=n.getParserContext(this.useR1C1,0,0,r))},n.prototype.getParserContext=function(n){var i=this,t=i._parserContext;return t||(n?i._parserContext=t=n.getParserContext(i.useR1C1,0,0,r):t=new et(r,i.useR1C1,0,0,r)),t.setSource(n),t},n.prototype.parse=function(n,t,i,r,u,f){var o=this,s=o._parseCache,e=o.getParserContext(n),h,c;return e.useR1C1=f?!1:o.useR1C1,e.ignoreError=u,e.row=i,e.column=r,s?(e.useR1C1||(e.useR1C1=!0,t=o._parser.a1ToR1C1(e,t)),h=s[t],h)?h:(c=o._parser.parse(t,e),s[t]=c,c):o._parser.parse(t,e)},n.prototype.unparse=function(n,t,i,r){var u=this.getParserContext(n);return u.useR1C1=this.useR1C1,u.row=i,u.column=r,this._parser.unparse(t,u)},n.prototype.unparseWithoutCulture=function(n,t,i,r,u){var f=this.getParserContext(n),e;return f.row=i,f.column=r,f.useR1C1=this.useR1C1,f.source=n,u&&(f.toStandard=!0,f.useR1C1=!1),e=this._parser.unparseWithoutCulture(t,f),f.toStandard=!1,e},n.prototype.isDirtyCell=function(n){return!!n.preDirty||n===this._head},n.prototype.addDirty=function(n,t){var i=this,u=i._headNames[t],f=i._tailNames[t];n&&!n.preDirty&&n!==i[u]&&(i[u]?i[f].nextDirty=n:i[u]=n,n.preDirty=i[f],n.nextDirty=r,i[f]=n)},n.prototype.removeDirty=function(n,t){var i=this,e=i._headNames[t],o=i._tailNames[t],u,f;n&&(n.preDirty||n===i[e])&&(u=n.preDirty,f=n.nextDirty,u?u.nextDirty=f:i[e]=f,f?f.preDirty=u:i[o]=u,n.preDirty=r,n.nextDirty=r)},n.prototype.isDirtyRow=function(n){return n.preDirty||n===this._headRows},n.prototype.isDirtyColumn=function(n){return n.preDirty||n===this._headCols},n.prototype.evaluateParsedFormula=function(n,t,i,r,u,f,o,c,l,a){var nt=n.getEvaluatorContext(i,r,u,o,c,l,a),v,y,w,b,k;if(v=arguments.length===5&&u?this._evaluator.evaluateExpression(t,nt,f,!0):this._evaluator.evaluateExpression(t,nt,f,!1),u&&arguments.length<=5)return v;if(e.ref(v))if(y=v.getRowCount(0),w=v.getColumnCount(0),v.getRangeCount()<=0)return h;else if(v.getRangeCount()!==1)return s;else try{if(b=u?i-o:i-v.getRow(0),k=u?r-c:r-v.getColumn(0),y===1&&w===1)v=v.getValue(0,0,0);else if(y===1&&w>1&&k>=0&&k<w)v=v.getValue(0,0,k);else if(y>1&&w===1&&b>=0&&b<y)v=v.getValue(0,b,0);else if(u&&b<y&&k<w)v=v.getValue(0,b,k);else return u?p:s}catch(it){return s}else if(e.arr(v))if(u){var tt=v,d=tt.getRowCount(),g=tt.getColumnCount();if(d!=1&&i-o>=d||g!=1&&r-c>=g)return p;v=v.getValue(d==1?0:i-o,g==1?0:r-c)}else v=v.getValueByIndex(0);return v},n.prototype._getParserContext=function(n,t,i){var f=this,e=f._parseCache,u=f._parserContext;return u||(f._parserContext=u=n.getParserContext(f.useR1C1,0,0,r)),u.useR1C1=f.useR1C1,u.row=t,u.column=i,u},n.prototype.evaluate=function(n,t,i,r){var u=this;return u._evaluator.evaluateFormula(t,n.getParserContext(u.useR1C1,i,r),n.getEvaluatorContext(i,r,!1),!1)},n}();i.CalcService=gr,function(n){n[n.Adjust=0]="Adjust";n[n.dirty=1]="dirty"}(i.ListenerActions||(i.ListenerActions={}));du=i.ListenerActions;ri=function(){function n(n,t){this._lastNonNullRow=0;this._lastNonNullColumn=0;this._volatitleCells=[];var i=this;i.dataTable={};i.dataTableByName={};i._rowDataArray=[];i._columnDataArray=[];i._defaultDataNode=r;i._source=t;i._service=n}return n.prototype.getNode=function(n,t,i){var u=this,f=r,e;return n>=0&&t>=0?(e=u.dataTable[n],i&&!e&&(e=u.dataTable[n]={},n>u._lastNonNullRow&&(u._lastNonNullRow=n)),e&&(f=e[t],i&&!f&&(f=e[t]={},t>u._lastNonNullColumn&&(u._lastNonNullColumn=t)))):n===-1&&t>=0?(f=u._columnDataArray[t],i&&!f&&(f=u._columnDataArray[t]={},t>u._lastNonNullColumn&&(u._lastNonNullColumn=t))):n>=0&&t===-1?(f=u._rowDataArray[n],i&&!f&&(f=u._rowDataArray[n]={},t>u._lastNonNullColumn&&(u._lastNonNullColumn=t))):n===-1&&t===-1&&(f=u._defaultDataNode,i&&!f&&(f=u._defaultDataNode={})),f},n.prototype.getNodeByName=function(n,t){var r=this,i=r.dataTableByName[n];return t&&!i&&(i=r.dataTableByName[n]={}),i},n.prototype._getExpr=function(n,t){var i=this.getNode(n,t);return i&&i.expr},n.prototype.getExpr=function(n,t){return this._getExpr(n,t)},n.prototype.getArray=function(n,t){return this._getArrayInfo(n,t)},n.prototype.clear=function(n,t,i,r){this._clear(n,t,i,r)},n.prototype.addRows=function(n,i){var r=this,f=r.rC(),u;if(!(n<0)&&!(n>f)&&!(i<0))for(t._ModelHelper.addElements(r.dataTable,f,n,i),t._ModelHelper.addElements(r._rowDataArray,f,n,i),u=0;u<i;u++)r.dataTable[n+u]={rs:"n"}},n.prototype.deleteRows=function(n,i){var u=this,r=u.rC();n<0||n>=r||i<=0||(n+i>r&&(i=r-n),t._ModelHelper.deleteElements(u.dataTable,r,n,i),t._ModelHelper.deleteElements(u._rowDataArray,r,n,i))},n.prototype.addColumns=function(n,i){var f=this,o=f.rC(),r=f.cC(),u,e;if(!(n<0)&&!(n>r)&&!(i<0)){for(u=0;u<o;u++)e=f.dataTable[u],e&&n<r&&t._ModelHelper.addElements(e,r,n,i);t._ModelHelper.addElements(this._columnDataArray,r,n,i)}},n.prototype.deleteColumns=function(n,i){var e=this,o=e.rC(),r=e.cC(),u,f;if(!(n<0)&&!(n>=r)&&!(i<0)){for(u=0;u<o;u++)f=this.dataTable[u],f&&n<r&&t._ModelHelper.deleteElements(f,r,n,i);t._ModelHelper.deleteElements(this._columnDataArray,r,n,i)}},n.prototype._setExpr=function(n,t,i){var r=this.getNode(n,t,!0);r.expr=i},n.prototype._clearAllExpr=function(n,t){var i=this.getNode(n,t,!0);i&&(i.expr=f,i.workingExpr&&(i.workingExpr=f),i.arrayInfo&&(i.arrayInfo=f),i.isVolatile&&this._removeVolatile(i))},n.prototype._copyExpr=function(n,i,r,u,f){var e=this.getNode(i,r),o;e&&e.expr&&(o=n.getNode(u,f,!0),e.arrayInfo&&(o.arrayInfo=new t.Range(u,f,e.arrayInfo.rowCount-(i-e.arrayInfo.row),e.arrayInfo.colCount-(r-e.arrayInfo.col))),o.expr=e.expr,e.workingExpr&&(o.workingExpr=e.workingExpr));e&&e.isVolatile&&(o.isVolatile=!0)},n.prototype._containsNoe=function(n,t){var r=this.dataTable,i=r[n];return i&&i[t]},n.prototype._getWorkingExpr=function(n,t){var i=this.getNode(n,t);return i&&i.workingExpr},n.prototype._setWorkingExpr=function(n,t,i){var r=this.getNode(n,t,!0);r.workingExpr=i},n.prototype._getArrayInfo=function(n,t){var i=this.getNode(n,t);return i&&i.arrayInfo},n.prototype._setArrayInfo=function(n,t,i){var r=this.getNode(n,t,!0);r.arrayInfo=i},n.prototype._getCalc=function(n,t){var i=this.getNode(n,t);return i&&i.calc},n.prototype._setCalc=function(n,t,i){var r=this.getNode(n,t,!0);r&&(r.calc&&r.calc.isVolatile&&this._removeVolatile(r),r.calc=i,i&&(i.node=r))},n.prototype._setNode4Swap=function(n,t,i,r,u){var f=this,e;i>=0&&r>=0?(e=f.dataTable[i],e||(e=f.dataTable[i]={}),e[r]=u,u&&u.calc&&delete u.calc):i>=0&&r===-1&&n>=0&&t===-1?f._rowDataArray[i]=u:r>=0&&i===-1&&t>=0&&n===-1&&(f._columnDataArray[r]=u)},n.prototype._swapNode=function(n,t,i,u){var f=this,e=f.getNode(n,t),o=f.getNode(i,u);e?f._setNode4Swap(n,t,i,u,e):o&&f._setNode4Swap(n,t,i,u,r);o?f._setNode4Swap(i,u,n,t,o):e&&f._setNode4Swap(i,u,n,t,r)},n.prototype._getAllVolatitles=function(){return this._volatitleCells},n.prototype._setVolatile=function(n){n.isVolatile||(n.isVolatile=!0,this._volatitleCells.push(n))},n.prototype._removeVolatile=function(n){var i,r,t;for(n.isVolatile=undefined,i=this._volatitleCells,r=i.length,t=0;t<r;t++)if(i[t]===n){i.splice(t,1);return}},n.prototype._clearCore=function(n,t){for(var i,r=0;r<n.length;r++)i=n[r],i&&(t&1)>0&&(i.arrayInfo&&(i.arrayInfo=f),i.expr&&(i.expr=f),i.workingExpr&&(i.workingExpr=f))},n.prototype.getCalcService=function(){return this._service},n.prototype.getSource=function(){return this._source},n.prototype.hasFormula=function(n,t){return n=n!==f?n:-1,t=t!==f?t:-1,!!this.getExpression(n,t)},n.prototype.setFormula=function(n,i,u,e){var o=this,s,h,c,l;if(u&&u.length===0&&(u=r),!e&&o._intersectWithArrayFormula(n,i,1,1)&&o._throwArrayPartException(),s=o.getFormula(n,i),s!==u&&!(s===""&&!u||!s&&u==="")){if(h=o.getCalcService(),c=r,h)try{c=u?h.parse(o._source,u,n>=0?n:0,i>=0?i:0,e,e):r;o.setExpression(n,i,c,f,!1)}catch(a){if(!e)throw a;}n>=0&&i>=0&&(l=t.Culture()===""||t.Culture()==="en-us",o._source.setFormula(n,i,e||l?u:h.unparseWithoutCulture(o._source,c,n,i)))}},n.prototype.getFormula=function(n,t){var f=this.getCalcService(),u,i;return f&&(u=this.getExpression(n,t),u)?(i=this.getArrayInfo(n,t),n=i?i.row:n,t=i?i.col:t,f.unparse(this._source,u,n,t)):r},n.prototype.setFormulaByName=function(n,i,u){var e,o,s,h,c;if(n&&(n=n.toUpperCase(),e=this,i&&i.length===0&&(i=r),o=e.getFormulaByName(n),o!==i&&!(o===""&&!i||!o&&i===""))){if(s=e.getCalcService(),h=r,s)try{h=i?s.parse(e._source,i,0,0,u):r;e.setExpressionByName(n,h,f,!1)}catch(l){if(!u)throw l;}c=t.Culture()===""||t.Culture()==="en-us";e._source.setFormulaByName(n,u||c?i:s.unparseWithoutCulture(e._source,h,0,0))}},n.prototype.getFormulaByName=function(n){var i=this.getCalcService(),t;return i&&n&&(t=this.getExpressionByName(n.toUpperCase()),t)?i.unparse(this._source,t,0,0):r},n.prototype._throwArrayPartException=function(){throw t.SR.Exp_ArrayFromulaPart;},n.prototype.rC=function(){return Math.min(this._source.getRowCount())},n.prototype.cC=function(){return Math.min(this._source.getColumnCount())},n.prototype.setArrayFormula=function(n,i,u,f,e,o){var s=this,h,a,c,l;if((e&&e.length===0&&(e=r),s._intersectWithArrayFormula(n,i,u,f)&&s._throwArrayPartException(),n=n<0?0:n,i=i<0?0:i,h=s.getCalcService(),h)&&(s._clear(n,i,u,f),e)){try{a=e?h.parse(s._source,e,n,i,o,o):r}catch(v){if(!o)throw v;return}for(c=n;c<n+u;c++)for(l=i;l<i+f;l++)s.setExpression(c,l,a,new t.Range(n,i,u,f),!1);n>=0&&i>=0&&s._source.setArrayFormula(n,i,u,f,h.unparseWithoutCulture(s._source,a,n,i))}},n.prototype.getExprInfo=function(n,t,i){var e=this,f=r,u,o=e._source;return n>=o.getRowCount()||t>=o.getColumnCount()?f:(n>=0&&t>=0?(u=e.getNode(n,t),f=u&&u[i],f||(u=e.getNode(n,-1),f=u&&u[i]),f||(u=e.getNode(-1,t),f=u&&u[i])):n>=0&&t===-1?(u=e.getNode(n,-1),f=u&&u[i]):n===-1&&t>=0?(u=e.getNode(-1,t),f=u&&u[i]):(u=e.getNode(-1,-1),f=u&&u[i]),f)},n.prototype.getArrayInfo=function(n,t){return this.getExprInfo(n,t,au)},n.prototype.getWorkingExpression=function(n,t){return this.getExprInfo(n,t,vu)},n.prototype.getExpression=function(n,t){return this.getExprInfo(n,t,lu)},n.prototype.getWorkingExpressionByName=function(n){var t=this.getNodeByName(n);return t&&t.workingExpr},n.prototype.getExpressionByName=function(n){var t=this.getNodeByName(n);return t&&t.expr},n.prototype.setExpression=function(n,t,i,r,e){var o=this,c=o.getCalcService(),s=r!==f&&r!==null,v=new k(o._source,s,s?r.row:n,s?r.col:t),h=u._mappingArray(v,i,s,s?n-r.row:0,s?t-r.col:0),l,a;h=h===i?f:h;r!==f&&(l=r);n>=0&&t>=0?((e===f||e)&&(a=i?c.unparseWithoutCulture(o._source,i,n>=0?n:0,t>=0?t:0):f,o._source.setFormula(n,t,a)),o._setCellExpression(n,t,i,h,l)):n>=0&&t===-1?o._setRowExpression(n,i,h):n===-1&&t>=0&&o._setColumnExpression(t,i,h);c.autoCalculation&&!c.IsSuspended()&&c.recalculateAll(!1)},n.prototype.setExpressionByName=function(n,t,i,r){var e=this,o=e.getCalcService(),c=new k(e._source,!1,0,0),s=u._mappingArray(c,t,!1,0,0),h;s=s===t?f:s;(r===f||r)&&(h=t?o.unparseWithoutCulture(e._source,t,0,0):f,e._source.setFormulaByName(n,h));e._setNameExpression(n,t,s);o.autoCalculation&&!o.IsSuspended()&&o.recalculateAll(!1)},n.prototype.getRowExpression=function(n){return this.getExpression(n,-1)},n.prototype.getColumnExpression=function(n){return this.getExpression(-1,n)},n.prototype._setNameExpression=function(n,t,i){var f=this,r=f._getNameIDCalc(n,!0),u;r&&(r.stopListening(),u=this.getNodeByName(n,!0),u.expr=t,i=t&&i?i:undefined,u.workingExpr=i,r.startListening(),f._service.addDirty(r,3))},n.prototype._setCellExpression=function(n,t,i,r,u){var e=this,o;o=u?e._getCellCalc(n,t,!0):e._getCellCalc(n,t,!0);o&&(o.stopListening(),e._setExpr(n,t,i),i?((r||e._getWorkingExpr(n,t))&&e._setWorkingExpr(n,t,r),(u||e.getArrayInfo(n,t))&&e._setArrayInfo(n,t,u)):(e._setWorkingExpr(n,t,f),e._setArrayInfo(n,t,f)),o.startListening(),e._service.addDirty(o,0))},n.prototype._setRowExpression=function(n,t,i){var r=this,u=r._getRowCalc(n,!0);u&&(u.stopListening(),r._setExpr(n,-1,t),(i||r._getWorkingExpr(n,-1))&&r._setWorkingExpr(n,-1,i),u.startListening(),r._service.addDirty(u,1))},n.prototype._setColumnExpression=function(n,t,i){var r=this,u=r._getColumnCalc(n,!0);u&&(u.stopListening(),r._setExpr(-1,n,t),(i||r._getWorkingExpr(-1,n))&&r._setWorkingExpr(-1,n,i),u.startListening(),r._service.addDirty(u,2))},n.prototype._clear=function(n,i,u,e){for(var o,p,s=this,l=n<0?0:n,a=i<0?0:i,w=n<0?s.rC():u,b=i<0?s.cC():e,k=l+w-1,d=a+b-1,g=s.getCalcService(),nt=!1,tt=[],it=[],v,y,c,h=l;h<=k&&h>=0;h++)for(o=a;o<=d&&o>=0;o++)v=s._getWorkingExpr(h,o),y=s._getExpr(h,o),(v||y)&&(c=s._getArrayInfo(h,o),p=c?new t.Range(c.row,c.col,c.rowCount,c.colCount):f,s.setExpression(h,o,r,p,!0))},n.prototype._intersectWithArrayFormula=function(n,t,i,r){return this._getFormulaExps(n,t,i,r,!0,!0)},n.prototype._getFormulaExps=function(n,i,r,u,f,e){for(var h,o,v,c=this,a=n<0?0:n,y=i<0?0:i,k=n<0?c.rC():r,d=i<0?c.cC():u,g=a+(k===0?1:k)-1,nt=y+(d===0?1:d)-1,rt=c.getCalcService(),tt=!1,p=[],w=[],l,b,it=c.dataTable,s=a;s<=g&&s>=0;s++){if(s>c._lastNonNullRow)break;if(b=it[s],b)for(h=y;h<=nt&&h>=0;h++){if(h>c._lastNonNullColumn)break;if(l=b[h],l)if(o=l.arrayInfo,o){if(o.row<a||o.row+o.rowCount-1>g||o.col<y||o.col+o.colCount-1>nt){if(f)return!0;tt=!0}if(s!==o.row&&s!==a)continue;p.push(new t.Range(o.row,o.col,o.rowCount,o.colCount));v=l.expr;w.push(v);h=o.col+o.colCount-1}else!e&&(v=l.expr)&&(p.push({row:s,col:h}),w.push(v))}}return f?!1:{hasPart:tt,ranges:p,formulas:w}},n.prototype._getNameIDCalc=function(n,t){var f=this,i=r,u=f.getNodeByName(n,t);return u&&(i=u.calc,!i&&t&&(i=new bi(f,n),u.calc=i,i.node=u)),i},n.prototype._getCellCalc=function(n,t,i){var u=this,f=r,s,o,e;if(n>=0&&t>=0){if(s=u.dataTable,o=s[n],!o)if(i)o=s[n]={},n>u._lastNonNullRow&&(u._lastNonNullRow=n);else return f;if(e=o[t],!e)return i&&(e=o[t]={},f=new pt(u,n,t),e.calc=f,f.node=e,t>u._lastNonNullColumn&&(u._lastNonNullColumn=t)),f;f=e.calc;!f&&i&&(f=new pt(u,n,t),e.calc=f,f.node=e,n>u._lastNonNullRow&&(u._lastNonNullRow=n),t>u._lastNonNullColumn&&(u._lastNonNullColumn=t))}return f},n.prototype._getRowCalc=function(n,t){var i=this,u=r;return n>=0&&(u=i._getCalc(n,-1),!u&&t&&(u=new yi(i,n),i._setCalc(n,-1,u),n>i._lastNonNullRow&&(i._lastNonNullRow=n))),u},n.prototype._getColumnCalc=function(n,t){var i=this,u=r;return n>=0&&(u=i._getCalc(-1,n),!u&&t&&(u=new pi(i,n),i._setCalc(-1,n,u),n>i._lastNonNullColumn&&(i._lastNonNullColumn=n))),u},n.prototype._getRangeCalc=function(n){var t=this;return!t._rangeCalc&&n&&(t._rangeCalc=new ki(t)),t._rangeCalc},n.prototype._getNameCalc=function(n,t){var i=this,u=r,f;return i._nameCalcs||(i._nameCalcs={}),u=i._nameCalcs[n],!u&&t&&(u=i._nameCalcs[n]=new wi(i,n)),u},n.prototype._addColumnsToDirty=function(n,t){for(var u,r=this,f=Math.min(r._lastNonNullColumn,n+t-1),i=n;i!==-1&&i<=f;i++)r.isDirty(-1,i)&&(u=r._getColumnCalc(i,!0),r._service.addDirty(u,2))},n.prototype._addRowsToDirty=function(n,t){for(var u,r=this,f=Math.min(r._lastNonNullRow,n+t-1),i=n;i!==-1&&i<=f;i++)r.isDirty(i,-1)&&(u=r._getRowCalc(i,!0),r._service.addDirty(u,1))},n.prototype._addCellsToDirty=function(n,t,i,r){for(var f,s,o,u=this,h=Math.min(u._lastNonNullRow,n+i-1),c=Math.min(u._lastNonNullColumn,t+r-1),e=n;e<=h;e++)for(f=t;f<=c;f++)u._containsNoe(e,f)&&(s=u._getCellCalc(e,f,!0),u._service.addDirty(s,0));u._addRowsToDirty(n,i);u._addColumnsToDirty(t,r);o=u._getRangeCalc(!1);o&&o.addListenersToDirty(n,t,i,r)},n.prototype._addVolatitlesToDirty=function(){for(var t,e,n=this,f=n._getAllVolatitles(),i,r,u=0;u<f.length;u++)t=f[u],t&&t instanceof pt&&!n._service.isDirtyCell(t)&&(e=n._getCellCalc(t.row,t.column,!0),n._service.addDirty(e,0),i=n._getRowCalc(t.row,!1),i&&!n._service.isDirtyRow(i)&&n._addRowsToDirty(t.row,1),r=n._getColumnCalc(t.column,!1),r&&!n._service.isDirtyRow(r)&&n._addColumnsToDirty(t.column,1))},n.prototype.isDirty=function(n,t){return!!(this._getCalc(n,t)||this._getExpr(n,t))},n.prototype.recalculateCell=function(n,t){var i=this,e=i._source,o=i.getWorkingExpression(n,t)||i.getExpression(n,t),u;if(o){var f=e.getValue(n,t),s=!1,h,c,l,a,r=i.getArrayInfo(n,t);if(r&&(s=!0,h=r.row,c=r.col,l=r.rowCount,a=r.colCount),u=i._service.evaluateParsedFormula(i._source,o,n,t,s,!0,h,c,l,a),f===u)return;else if(f instanceof Date&&u instanceof Date&&f.valueOf()===u.valueOf())return;e.setValue(n,t,u)}},n.prototype.recalculateNameID=function(n){var t=this,u=t._source,f=t.getWorkingExpressionByName(n)||t.getExpressionByName(n),r,i;if(f){if(r=u.getValueByName(n),i=t._service.evaluateParsedFormula(t._source,f,0,0,!1,!0,0,0,1,1),r===i)return;else if(r instanceof Date&&i instanceof Date&&r.valueOf()===i.valueOf())return;u.setValueByName(n,i)}},n.prototype._dealWithExpression=function(n,t,f,e,o,s){for(var w=this,d,st,ht,g,ut,nt,ft,wt,bt,p,tt,rt,a,v,b,l,k,h,at,kt,y,vt,pt,ot,yt,lt,ct,gt,et,ni,dt;e.t===24;)e=e.expr;while(e.t===14)e=e.argument;if(e.t===17){if(d=e.getRange(t,f,!0),d===r)return;e=d.rowCount===1&&d.columnCount===1?new u.CellExpression(d.row,d.column,!1,!1):new u.RangeExpression(d.row,d.column,d.row+d.rowCount-1,d.column+d.columnCount-1,!1,!1,!1,!1)}if(o&&o!==e&&(o.t===8||o.t===9)&&(ot=o.name.toUpperCase(),b=o.source||w._source,b.getCustomName(ot)?l=b.getCalcSourceModel():(l=w._service.getGlobalSourceModel(),l.getSource().getCustomName(ot)||(yt=b.getCalcSourceModel()._getNameCalc(ot,!0),yt.processCellListener(n,s))),lt=l._getNameCalc(ot,!0),lt.processCellListener(n,s),o=null),e.t===0||e.t===1){if(k=e,b=e.source||w._source,l=b.getCalcSourceModel(),0<=t&&0<=f){if(st=k.row+(k.rowRelative?t:0),ht=k.column+(k.columnRelative?f:0),p=l._getCellCalc(st,ht,!0),!p)return;p.processCellListener(n,s)}else if(0<=t&&f===-1)if(st=k.row+(k.rowRelative?t:0),ht=k.column,k.columnRelative){if(tt=l._getRowCalc(st,!0),!tt)return;tt.processRowListener2(n,-ht,s)}else{if(p=l._getCellCalc(st,ht,!0),!p)return;p.processRowListener(n,s)}else if(t===-1&&0<=f)if(st=k.row,ht=k.column+(k.columnRelative?f:0),k.rowRelative){if(rt=l._getColumnCalc(ht,!0),!rt)return;rt.processColumnListener2(n,-st,s)}else{if(p=l._getCellCalc(st,ht,!0),!p)return;p.processColumnListener(n,s)}}else if(e.t===2||e.t===3)if(b=e.source||w._source,l=b.getCalcSourceModel(),h=e,at=h._getRangeType(),at===c.cell){if(0<=t&&0<=f)if(g=h.startRow+(h.startRowRelative?t:0),nt=h.startColumn+(h.startColumnRelative?f:0),ut=h.endRow+(h.endRowRelative?t:0),ft=h.endColumn+(h.endColumnRelative?f:0),wt=it(ut-g)+1,bt=it(ft-nt)+1,w.shouldUseRange(st,ht,wt,bt)){if(kt=l._getRangeCalc(!0),!kt)return;kt.processCellListener(g,nt,wt,bt,n,s)}else for(a=g;a<=ut;a++)for(v=nt;v<=ft;v++)p=l._getCellCalc(a,v,!0),p&&p.processCellListener(n,s);else if(0<=t&&f===-1)for(g=h.startRow+(h.startRowRelative?t:0),nt=h.startColumn,ut=h.endRow+(h.endRowRelative?t:0),ft=h.endColumn,a=g;a<=ut;a++)for(v=nt;v<=ft;v++)h.startColumnRelative||h.endColumnRelative?(tt=l._getRowCalc(a,!0),tt&&tt.processRowListener2(n,-v,s)):(p=l._getCellCalc(a,v,!0),p&&p.processRowListener(n,s));else if(t===-1&&0<=f)for(g=h.startRow,nt=h.startColumn+(h.startColumnRelative?f:0),ut=h.endRow,ft=h.endColumn+(h.endColumnRelative?f:0),a=g;a<=ut;a++)for(v=nt;v<=ft;v++)h.startRowRelative||h.endRowRelative?(rt=l._getColumnCalc(v,!0),rt&&rt.processColumnListener2(n,-a,s)):(p=l._getCellCalc(a,v,!0),p&&p.processColumnListener(n,s))}else if(at===c.row){if(0<=t&&0<=f)for(g=h.startRow+(h.startRowRelative?t:0),ut=h.endRow+(h.endRowRelative?t:0),a=g;a<=ut;a++)tt=l._getRowCalc(a,!0),tt&&tt.processCellListener(n,s);else if((!(0<=t)||f!==-1)&&t===-1&&0<=f&&!h.startRowRelative&&!h.endRowRelative)for(g=h.startRow,ut=h.endRow,a=g;a<=ut;a++)tt=l._getRowCalc(a,!0),tt&&tt.processColumnListener(n,s)}else if(at===c.column){if(0<=t&&0<=f)for(nt=h.startColumn+(h.startColumnRelative?f:0),ft=h.endColumn+(h.endColumnRelative?f:0),v=nt;v<=ft;v++)rt=l._getColumnCalc(v,!0),rt&&rt.processCellListener(n,s);else if((!(0<=t)||f!==-1)&&t===-1&&0<=f)for(nt=h.startColumn+(h.startColumnRelative?f:0),ft=h.endColumn+(h.endColumnRelative?f:0),v=nt;v<=ft;v++)rt=l._getColumnCalc(v,!0),rt&&rt.processColumnListener(n,s)}else at===c.sheet&&(0<=t&&0<=f||0<=t&&f===-1||t===-1&&0<=f);else if(e.t===16)for(y=e,vt=y.startSource.getSources(y.endSource),et=0;et<vt.length;et++)pt=new u.ExternalRangeExpression(vt[et],y.startRow,y.startColumn,y.endRow,y.endColumn,y.startRowRelative,y.startColumnRelative,y.endRowRelative,y.endColumnRelative),y.isFullRow?pt.initBand(vt[et],y.startRow,y.endRow,y.startRowRelative,y.endRowRelative,!0):y.isFullColumn&&pt.initBand(vt[et],y.startColumn,y.endColumn,y.startColumnRelative,y.endColumnRelative,!1),w._dealWithExpression(n,t,f,pt,r,s);else if(e.t===11)w._dealWithExpression(n,t,f,e.operand,o&&o.t===11&&o.operand,s);else if(e.t===10)w._dealWithExpression(n,t,f,e.left,o&&o.t===10&&o.left,s),w._dealWithExpression(n,t,f,e.right,o&&o.t===10&&o.right,s);else if(e.t===8||e.t===9){if(b=e.source||w._source,ot=e.name.toUpperCase(),b.getCustomName(ot)?l=b.getCalcSourceModel():(l=w._service.getGlobalSourceModel(),l.getSource().getCustomName(ot)||(yt=b.getCalcSourceModel()._getNameCalc(ot,!0),yt.processCellListener(n,s))),lt=l._getNameCalc(ot,!0),!lt)return;lt.processCellListener(n,s);w._dealWithExpression(n,t,f,b.getCustomName(e.name),r,s)}else if(e.t===7){if(ct=e,ct.fn&&ct.fn instanceof i.Functions.Function&&(ct.fn.isVolatile()&&(s?w._setVolatile(n):w._removeVolatile(n)),!ct.fn.precedentReference()))return;for(gt=ct.argCount(),et=0;et<gt;et++)w._dealWithExpression(n,t,f,ct.getArg(et),o&&o.t===7&&o.getArg(et),s)}else if(e.t===25||e.t===26){if(ni=e,b=e.source||w._source,l=b.getCalcSourceModel(),dt=l._getNameIDCalc(ni.nameIdentity,!0),!dt)return;dt.processCellListener(n,s)}},n.prototype.shouldUseRange=function(n,t,i,r){return n===-1&&r>127||t===-1&&i>127||i*r>127},n.prototype.dealWithNameIDExpression=function(n,t){var i=this.getNodeByName(n);i&&(i.workingExpr||i.expr)&&this._dealWithExpression(this._getNameIDCalc(n),0,0,i.workingExpr||i.expr,i.expr,t)},n.prototype.dealWithCellExpression=function(n,t,i,r,u){for(var f,o=this,l=n+i,a=t+r,h,s,c,e=n;e<l;e++)for(f=t;f<a;f++)h=o._getWorkingExpr(e,f),s=o._getExpr(e,f),(h||s)&&(c=o._getArrayInfo(e,f),c?o._dealWithExpression(o._getCellCalc(e,f),c.row,c.col,h||s,s,u):o._dealWithExpression(o._getCellCalc(e,f),e,f,h||s,s,u))},n.prototype._dealWithColumnExpression=function(n,t,i){for(var u,f=n+t,r=n;r!==-1&&r<f;r++)u=this.getColumnExpression(r),u&&this._dealWithExpression(this._getColumnCalc(r,!1),-1,r,u,u,i)},n.prototype.linkCellExpression=function(n,t,i,r){this.dealWithCellExpression(n,t,i,r,!0)},n.prototype.unlinkCellExpression=function(n,t,i,r){this.dealWithCellExpression(n,t,i,r,!1)},n.prototype.linkRowExpression=function(n,t){},n.prototype.unlinkRowExpression=function(n,t){},n.prototype.linkColumnExpression=function(n,t){this._dealWithColumnExpression(n,t,!0)},n.prototype.unlinkColumnExpression=function(n,t){this._dealWithColumnExpression(n,t,!1)},n.prototype._iterateEachCell=function(n,t,i,r,u,f){for(var e,o,h=n+i,c=t+r,s=n;s<h;s++)for(e=t;e<c;e++)o=this._getCellCalc(s,e,!1),o&&(u&&o.addListenersToAdjust(),f&&o.addListenersToDirty())},n.prototype._iterateEachRow=function(n,t,i,r){var e=this._rowDataArray,u,f,o;if(e)for(u=n;u!==-1&&u<n+t&&u<e.length;u++)(f=e[u],f&&f.calc)&&(o=f.calc,i&&o.addListenersToAdjust(),r&&o.addListenersToDirty())},n.prototype._iterateEachColumn=function(n,t,i,r){var e=this._columnDataArray,u,f,o;if(e)for(u=n;u!==-1&&u<n+t&&u<e.length;u++)(f=e[u],f&&f.calc)&&(o=f.calc,i&&o.addListenersToAdjust(),r&&o.addListenersToDirty())},n.prototype.addDependents=function(n,t,i,r,u,f){var e,o,s;(u||f)&&(e=this,0<=n&&0<=t?(e._iterateEachCell(n,t,i,r,u,f),e._iterateEachRow(n,i,u,f),e._iterateEachColumn(t,r,u,f),e._rangeCalc&&(u&&e._rangeCalc.addListenersToAdjust(n,t,i,r),f&&e._rangeCalc.addListenersToDirty(n,t,i,r))):0<=n&&t===-1?(e._iterateEachCell(n,0,i,e.cC(),u,f),e._iterateEachRow(n,i,u,f),e._rangeCalc&&(u&&e._rangeCalc.addListenersToAdjust(n,t,i,r),f&&e._rangeCalc.addListenersToDirty(n,t,i,r))):n===-1&&0<=t?(e._iterateEachCell(0,t,e.rC(),r,u,f),e._iterateEachColumn(t,r,u,f),e._rangeCalc&&(u&&e._rangeCalc.addListenersToAdjust(n,t,i,r),f&&e._rangeCalc.addListenersToDirty(n,t,i,r))):n===-1&&t===-1&&(o=e.rC(),s=e.cC(),e._iterateEachCell(0,0,o,s,u,f),e._iterateEachRow(0,o,u,f),e._iterateEachColumn(0,s,u,f),e._rangeCalc&&(u&&e._rangeCalc.addListenersToAdjust(n,t,i,r),f&&e._rangeCalc.addListenersToDirty(n,t,i,r))))},n.prototype.getAllNodes=function(){var t=[],r=this.dataTable,u=this._rowDataArray,f=this._columnDataArray,e=this._defaultDataNode,i,n,o;e&&t.push(e);for(n in u)t.push(u[n]);for(n in f)t.push(f[n]);for(o in r){i=r[o];for(n in i)t.push(i[n])}return t},n.prototype.toJSON=function(n){this._source.toJSON(n,this.dataTable)},n}();i.CalcSourceModel=ri;var hf="cell",cf="row",lf="column",ct="cellListeners",lt="rowListeners",at="columnListeners",vi="rowSliceListeners",gu="columnSliceListeners",yt=function(){function n(n){this.cellListeners=[];this.rowListeners=[];this.columnListeners=[];this.sourceModel=n}return n.prototype.hasListeners=function(){for(var t,i=this,r=i._listeners,n=0;n<r.length;n++)if(t=i[r[n]],t&&t.length>0)return!0;return!1},n.prototype.processCellListener=function(n,t){var r=this.cellListeners,i;if(t)r.push(n);else for(i=0;i<r.length;i++)if(r[i]===n){r.splice(i,1);return}},n.prototype.processRowListener=function(n,t){var r=this.rowListeners,i;if(t)r.push(n);else for(i=0;i<r.length;i++)if(r[i]===n){r.splice(i,1);return}},n.prototype.processColumnListener=function(n,t){var r=this.columnListeners,i;if(t)r.push(n);else for(i=0;i<r.length;i++)if(r[i]===n){r.splice(i,1);return}},n.prototype.addListenersToAdjust=function(){for(var n,f,t,r=this._listeners,u,i=0;i<r.length;i++)if(n=this[r[i]],n)for(f=n.length,t=0;t<f;t++)u=n[t],u.addToAdjust()},n.prototype.addListenersToDirty=function(){for(var t,f,i,u=this._listeners,n,r=0;r<u.length;r++)if(t=this[u[r]],t)for(f=t.length,i=0;i<f;i++)n=t[i],n.preDirty||n.nextDirty||n.addToDirty()},n.prototype.adjustDelayOfListeners=function(n){for(var t,e,i,u=this._listeners,f,o=n?1:-1,r=0;r<u.length;r++)if(t=this[u[r]],t)for(e=t.length,i=0;i<e;i++)f=t[i],f.delay+=o},n.prototype.addToAdjust=function(){},n.prototype.addToDirty=function(){},n.prototype.stopListening=function(){},n.prototype.startListening=function(){},n}();i.BaseCalc=yt;pt=function(n){function t(t,i,r){n.call(this,t);var u=this;u.row=i;u.column=r;u.delay=0;u._listeners=[ct,lt,at]}return __extends(t,n),t.prototype.startListening=function(){var n=this;n.sourceModel.linkCellExpression(n.row,n.column,1,1)},t.prototype.stopListening=function(){var n=this;n.sourceModel.unlinkCellExpression(n.row,n.column,1,1)},t.prototype.addToAdjust=function(){this.sourceModel.getCalcService().getOperatorAdjustor().addAdjust(this,0)},t.prototype.addToDirty=function(){this.sourceModel.getCalcService().addDirty(this,0)},t}(yt);i.CellCalc=pt;yi=function(n){function t(t,i){n.call(this,t);var r=this;r.row=i;r._listeners=[ct,lt,vi,at]}return __extends(t,n),t.prototype.incrementDelay2=function(n,t){},t.prototype.decrementDelay2=function(n,t){},t.prototype.startListening=function(){this.sourceModel.linkRowExpression(this.row,1)},t.prototype.stopListening=function(){this.sourceModel.unlinkRowExpression(this.row,1)},t.prototype.processRowListener2=function(n,t,i){i?nf(this,vi,{row:n,columnOffset:t,columnCount:1}):tf(this,vi,{row:n,columnOffset:t,columnCount:1})},t.prototype.addToAdjust=function(){this.sourceModel.getCalcService().getOperatorAdjustor().addAdjust(this,1)},t.prototype.addToDirty=function(){this.sourceModel.getCalcService().addDirty(this,1)},t}(yt);i.RowCalc=yi;pi=function(n){function t(t,i){n.call(this,t);var r=this;r.column=i;r._listeners=[ct,lt,at,gu]}return __extends(t,n),t.prototype.incrementDelay2=function(n,t){},t.prototype.decrementDelay2=function(n,t){},t.prototype.startListening=function(){this.sourceModel.linkColumnExpression(this.column,1)},t.prototype.stopListening=function(){this.sourceModel.unlinkColumnExpression(this.column,1)},t.prototype.processColumnListener2=function(n,t,i){this.processColumnListener(n,i)},t.prototype.addToAdjust=function(){this.sourceModel.getCalcService().getOperatorAdjustor().addAdjust(this,2)},t.prototype.addToDirty=function(){this.sourceModel.getCalcService().addDirty(this,2)},t}(yt);i.ColumnCalc=pi;wi=function(n){function t(t,i){n.call(this,t);this.name=i;this._listeners=[ct,lt,at]}return __extends(t,n),t.prototype.updateListening=function(n,t){for(var u,h,f,o=this,s=o._listeners,i,r,e=0;e<s.length;e++)if(u=o[s[e]],u)for(h=u.length,f=0;f<h;f++)i=u[f],r=i.node,i.stopListening(),r&&(!r.arrayInfo||r.arrayInfo.row===i.row&&r.arrayInfo.col===i.column)&&i.sourceModel.setExpression(i.row,i.column,r.expr,r.arrayInfo,!0)},t.prototype.updateListeningOnRemoved=function(){for(var o,v,s,y,c,i=this,l=i._listeners,r,u,n,t,e,a=i.sourceModel,p=a.getCalcService(),h=0;h<l.length;h++)if(o=i[l[h]],o)for(v=o.length,s=0;s<v;s++)r=o[s],u=r.sourceModel,n=r.row,t=r.col,n=n===f?-1:n,t=t===f?-1:t,e=u.getExpr(n,t),y=u.getArrayInfo(n,t),e&&(c=p.getOperatorAdjustor().adjustFormulaOnRemoveName(a,e,i.name),c!==e&&u.setExpression(n,t,c,y,!0))},t.prototype.addToDirty=function(){for(var n,f,t,r=this._listeners,u,i=0;i<r.length;i++)if(n=this[r[i]],n)for(f=n.length,t=0;t<f;t++)u=n[t],u.addToDirty()},t}(yt);i.NameCalc=wi;bi=function(n){function t(t,i){n.call(this,t);var r=this;r.name=i;r.delay=0;r._listeners=[ct,lt,at]}return __extends(t,n),t.prototype.startListening=function(){var n=this;n.sourceModel.dealWithNameIDExpression(n.name,!0)},t.prototype.stopListening=function(){var n=this;n.sourceModel.dealWithNameIDExpression(n.name,!1)},t.prototype.addToAdjust=function(){this.sourceModel.getCalcService().getOperatorAdjustor().addAdjust(this,3)},t.prototype.addToDirty=function(){this.sourceModel.getCalcService().addDirty(this,3)},t}(yt);i.NameIDCalc=bi;ki=function(){function n(n){this.sourceModel=n;this._listeners=[ct,lt,at]}return n.prototype.processListener=function(n,t,i,r,u,f,e){var c=this,h=c[n],l=t+","+i+","+r+","+u,o,s;if(h||(c[n]=h={}),o=h[l],!o){if(!e)return;o=h[l]=[];o.row=t;o.column=i;o.rowCount=r;o.columnCount=u}if(e){for(s=0;s<o.length;s++)if(o[s]===f)return;o.push(f)}else for(s=0;s<o.length;s++)o[s]===f&&o.splice(s,1)},n.prototype.processCellListener=function(n,t,i,r,u,f){this.processListener(ct,n,t,i,r,u,f)},n.prototype.processRowListener=function(n,t,i,r,u,f,e,o,s){this.processListener(lt,n,t,i,r,u,s)},n.prototype.processColumnListener=function(n,t,i,r,u,f,e,o,s){this.processListener(at,n,t,i,r,u,s)},n.prototype.addListenersToAdjust=function(n,t,i,r){this.visit(0,n,t,i,r)},n.prototype.visit=function(n,t,i,r,u){for(var e,y,o,a=this._listeners,s,v,h=0;h<a.length;h++)if(e=this[a[h]],e)for(v in e){var f=e[v],c=f.row,l=f.column,p=f.rowCount,w=f.columnCount;if((c===-1||t===-1||c<t+r&&t<c+p)&&(l===-1||i===-1||l<i+u&&i<l+w))for(y=f.length,o=0;o<y;o++)s=f[o],n===0?s.addToAdjust():s.addToDirty()}},n.prototype.addListenersToDirty=function(n,t,i,r){this.visit(1,n,t,i,r)},n.prototype.adjustDelayOfListeners=function(n,t,i){for(var u,h,f,c,e,s=this._listeners,r,l=i?1:-1,o=0;o<s.length;o++)if(u=this[s[o]],u)for(h in u)if(f=u[h],r=f,(r.row===-1||r.row<=n&&n<r.row+r.rowCount)&&(r.column===-1||r.column<=t&&t<r.column+r.columnCount))for(c=f.length,e=0;e<c;e++)f[e].delay+=l},n.prototype.startListening=function(){},n.prototype.stopListening=function(){},n}();i.RangeCalc=ki;b=function(){function n(n,t){this._error=n;this._code=t}return n.prototype.toString=function(){return this._error},n.parse=function(t){var i=n._parseCore(t);if(i===f)throw"Incorrect error!";return i},n._parseCore=function(t){var i,u;if(typeof t!==w&&t!==r&&t!=="")for(i=0;i<ii.length;i++)if(u=ii[i],u===t||u===t.toUpperCase())return new n(u,yu[i]);return f},n}();i.CalcError=b;var rf=new b(cr,0),ui=new b(lr,7),s=new b(ar,15),h=new b(ci,23),ut=new b(vr,29),p=new b(yr,42),di=new b(pr,36),nu=function(){function n(){}return n.Null=rf,n.DivideByZero=ui,n.Value=s,n.Reference=h,n.Name=ut,n.NotAvailable=p,n.Number=di,n}();i.Errors=nu;fi=function(){function n(){}return n.prototype.getRowCount=function(){return 1},n.prototype.getColumnCount=function(){return 1},n.prototype.length=function(){return this.getRowCount()*this.getColumnCount()},n.prototype.getValueByIndex=function(n){var t=this.getColumnCount(),i=parseInt(n/t,10),r=n%t;return this.getValue(i,r)},n.prototype.getValue=function(n,t){return r},n.prototype.toArray=function(n,t,i,r,u){var l=this,a=1,v=1,o=[],s,y,p=e.CalcConvertedError,h,c;for(t=t===f?!0:t,a=l.getRowCount(),v=l.getColumnCount(),h=0;h<a;h++)for(t||(y=[],o.push(y)),c=0;c<v;c++){if(s=l.getValue(h,c),i&&e.err(s))return o=[s],o.isError=!0,o;if(s=e.convertValue(s,n,!1,u),r&&s===p)return o=[s],o.isError=!0,o;t?o.push(s):y.push(s)}return o.rowCount=a,o.colCount=v,o.rangeCount=1,o},n.prototype.slice=function(n,t,i,r){throw"slice function not implement.";},n}();i.CalcArray=fi;ft=function(n){function t(t,i){var r,f,u;if(n.call(this),r=this,f=t.length,r._array=t,r._rowCount=f,arguments.length<2)for(i=0,u=0;u<f;u++)i=ht(t[u].length,i);r._columnCount=i}return __extends(t,n),t.prototype.getRowCount=function(){return this._rowCount},t.prototype.getColumnCount=function(){return this._columnCount},t.prototype.getValue=function(n,t){return this._array[n][t]},t.prototype.toArray=function(n,t,i,r,u){var b=this,h=1,a=1,f=[],o,v=b._array,y,p,w,k=e.CalcConvertedError,c,l;if(h=v.length,h===0)return f.isError=!0,f;for(w=e.convertArray(v,n,!1),a=v[0].length,c=0;c<h;c++)for(t||(y=[],f.push(y)),p=w[c],l=0;l<a;l++){if(o=p[l],i&&e.err(o))return f=[o],f.isError=!0,f;if(o=e.convertValue(o,n,!1),r&&o===k)return f=[s],f.isError=!0,f;t?f.push(o):y.push(o)}return f.rowCount=h,f.colCount=a,f.rangeCount=1,f},t.prototype.slice=function(n,i,r,u){var f=this,c=f._array,h=[],s,e,o;for(n=n<0?0:n,i=i<0?0:i,r=n+r>f._rowCount?f._rowCount-n:r,u=i+u>f._columnCount?f._columnCount-i:u,e=0;e<r;e++)for(s=[],h.push(s),o=0;o<u;o++)s.push(c[e+n][o+i]);return new t(h)},t}(fi);i._ConcreteArray=ft;dt=function(){function n(){}return n.prototype.getRangeCount=function(){return 1},n.prototype.getRow=function(n){return 0},n.prototype.getColumn=function(n){return 0},n.prototype.getRowCount=function(n){return 0},n.prototype.getColumnCount=function(n){return 0},n.prototype.getValue=function(n,t,i){return r},n.prototype.isSubtotal=function(n,t,i){return!1},n.prototype.isHiddenRow=function(n,t,i){return!1},n.prototype.getSource=function(){return r},n.prototype.create=function(n){throw"create not implement.";},n.prototype.toArray=function(n,t,i,r,u){var l=this,a=1,v=1,c,o=[],h,b,k,d=e.CalcConvertedError,y,p,w;if(t=t===f?!0:t,c=l.getRangeCount(),c===0)return o.isError=!0,[];if(a=l.getRowCount(0),a===0)return o.isError=!0,[];if(v=l.getColumnCount(0),v===0)return o.isError=!0,[];for(y=0;y<c;y++)for(t||(b=[],o.push(b)),p=0;p<a;p++)for(t||(k=[],b.push(k)),w=0;w<v;w++){if(h=l.getValue(y,p,w),i&&e.err(h))return o=[h],o.isError=!0,o;if(h=e.convertValue(h,n,!0,u),r&&h===d)return o=[s],o.isError=!0,o;t?o.push(h):k.push(h)}return t||c!==1||(o=o[0]),o.rowCount=a,o.colCount=v,o.rangeCount=c,o},n}();i.Reference=dt;gi=function(n){function i(i){var f,o,e,u;if(n.call(this),!i||i.length===0)throw t.SR.Exp_InvalidArgument;for(f=r,o=0;o<i.length;o++)if(e=i[o],f){if(e.getRangeCount()!==f.getRangeCount())throw t.SR.Exp_InvalidArgument;for(u=0;u<e.getRangeCount();u++)if(e.getColumn(u)!==f.getColumn(u)||e.getColumnCount(u)!==f.getColumnCount(u)||e.getRow(u)!==f.getRow(u)||e.getRowCount(u)!==f.getRowCount(u))throw t.SR.Exp_InvalidArgument;}else f=e;this._references=i.slice(0)}return __extends(i,n),i.prototype.getSheetCount=function(){return this._references.length},i.prototype.getRangeCount=function(){return this._references[0].getRangeCount()},i.prototype.getRow=function(n){return this._references[0].getRow(n)},i.prototype.getColumn=function(n){return this._references[0].getColumn(n)},i.prototype.getRowCount=function(n){return this._references[0].getRowCount(n)},i.prototype.getColumnCount=function(n){return this._references[0].getColumnCount(n)},i.prototype.getValue=function(n,t,i){return r},i.prototype.isHiddenRow=function(n,t,i){return!1},i.prototype.isSubtotal=function(n,t,i){return!1},i.prototype.getSource=function(){return r},i.prototype.toArray=function(n,t,i,r,u){for(var f=[],h=this._references,e,c,l,o,s=0;s<h.length;s++){if(e=h[s].toArray(n,t,i,r,u),e.rangeCount>1)return f.isError=!0,[];t?f=f.concat(e):f.push(e[0]);c=e.rowCount;l=e.colCount;o=o||e.isError}return f.isArray=!1,f.isReference=!0,f.rowCount=c,f.colCount=l,f.isError=o,f},i}(dt);i._SheetRangeReference=gi,function(n){n.getSource=function(n){return this._references[n].getSource()};n.getValue=function(n,t,i,u){return(typeof n===w||n===r)&&(n=0),this._references[n].getValue(t,i,u)};n.isSubtotal=function(n,t,i,u){return(typeof n===w||n===r)&&(n=0),this._references[n].isSubtotal(t,i,u)};n.isHiddenRow=function(n,t,i,u){return(typeof n===w||n===r)&&(n=0),this._references[n].isHiddenRow(t,i,u)}}(gi.prototype);d=function(n){function t(t,i){n.call(this);var r=this;r._sheetSource=t;i?(r._ranges=i,r._rangeCount=i.length):r._rangeCount=1}return __extends(t,n),t.prototype.getRangeCount=function(){return this._rangeCount},t.prototype.getRow=function(n){return this._ranges?this._ranges[n].row:0},t.prototype.getColumn=function(n){return this._ranges?this._ranges[n].col:0},t.prototype.getRowCount=function(n){return this._ranges?this._ranges[n].rowCount:this._sheetSource.getRowCount()},t.prototype.getColumnCount=function(n){return this._ranges?this._ranges[n].colCount:this._sheetSource.getColumnCount()},t.prototype.getValue=function(n,t,i){if(t>=0||i>=0){var r=this._ranges;if(r){if(n<r.length)return this._sheetSource.getValue(t+r[n].row,i+r[n].col)}else return this._sheetSource.getValue(t,i)}return h},t.prototype.isHiddenRow=function(n,t,i){return this._sheetSource.isHiddenRow(t+this.getRow(n),i)},t.prototype.isSubtotal=function(n,t,i){var u=this._sheetSource,r;return n===0&&t<u.getRowCount()&&i<u.getColumnCount()?(r=u.getCalcSourceModel().getExpression(t,i),r&&r.t===7&&r.getFunctionName().toUpperCase()==="SUBTOTAL"):!1},t.prototype.getSource=function(){return this._sheetSource},t.prototype.create=function(n){return new t(this._sheetSource,n)},t.prototype.toArray=function(n,t,i,r,u){return this._sheetSource.referenceToArray(this,n,t,i,r,u)},t}(dt);i.SheetReference=d;tu=function(n){function i(i,r,u,f,e,o,s,h){n.call(this,i,[new t.Range(r,u,f,e)]);var c=this;c.Action=o;c.Operand1=s;c.Operand2=h}return __extends(i,n),i.prototype.getValue=function(t,i,r){var u=this;return u.Action(n.prototype.getValue.call(this,t,i,r),u.Operand1,u.Operand2)},i}(d);i._TernaryCompositeConcreteReference=tu;iu=function(n){function i(i,r,u,f,e,o){n.call(this,i,[new t.Range(r,u,f,e)]);this.Action=o}return __extends(i,n),i.prototype.getValue=function(t,i,r){return this.Action(n.prototype.getValue.call(this,t,i,r))},i}(d);i._UnaryCompositeConcreteReference=iu;ru=function(n){function i(i,r,u,f,e,o,s,h){n.call(this,i,[new t.Range(r,u,f,e)]);var c=this;c.Action=o;c.Operand1=s;c.SwitchOrder=h}return __extends(i,n),i.prototype.getValue=function(t,i,r){var u=this,f=n.prototype.getValue.call(this,t,i,r);return u.SwitchOrder?u.Action(u.Operand1,f):u.Action(f,u.Operand1)},i}(d);i._BinaryCompositeConcreteReference=ru;e=function(){function n(){}return n.num=function(n){return typeof n===ot||typeof n===tt||!isNaN(n)&&!isNaN(parseFloat(n))||n instanceof Date},n.err=function(n){return n instanceof b},n.arr=function(n){return n instanceof fi},n.ref=function(n){return n instanceof dt},n.toResult=function(n){return isNaN(n)||!isFinite(n)?di:n},n.toArr=function(i,r,u,f,e,o){var h,c,l;if(i&&i.length&&i.rowCount&&i.colCount)return i;else if(n.arr(i))h=i.toArray(r,u,f,e,o),h.isArray=!0;else if(n.ref(i))h=i.toArray(r,u,f,e,o),h.isReference=!0;else if(t.GC$.isArray(i)&&i.length>0){if(h=[],t.GC$.isArray(i[0]))return n.convertArray(i,r,!0);for(c=0;c<i.length;c++)l=n.convertValue(i[c],r,!1),l===n.CalcConvertedError&&(h.isConvertError=!0),h.push(l);h.rowCount=1;h.colCount=i.length;h.rangeCount=1}else n.arr(i)?h=[]:(i=n.convertValue(i,r,!0),f&&n.err(i)?(h=[s],h.isError=!0):i===n.CalcConvertedError?(h=[n.CalcConvertedError],h.isConvertError=!0):u?(h=[],h.push(i)):(h=[[]],h[0].push(i)),h.rowCount=1,h.colCount=1,h.rangeCount=1);return h},n.convertValue=function(i,u,e,o){var h,s,c;if(n.err(i))return i;if(h={value:r},s=n.CalcConvertedError,o&&u!==0&&(i===r||i===f))return s;switch(u){case 1:e?i=n.rD(i,h)?h.value:s:typeof i===ot||i instanceof Date||(i=s);break;case 4:typeof i===y?(c=t._DateTimeHelper.parseLocale(i),i=typeof c!==w&&c!==r?new t._DateTimeHelper(c).toOADate():s):e?i=n.rD(i,h)?h.value:s:typeof i===ot||i instanceof Date||(i=s);break;case 3:e?i=n.rB(i,h)?h.value:!1:typeof i!==tt&&(i=s);break;case 2:i=i===r||i===f?"":i.toString();break}return i},n.convertArray=function(t,i,u){var o,h,l;if(!t||!t.length||!t[0].length)return o=[],o.isError=!0,[[nu.Value]];if(i===0)return t;else{var v=wr[i],b=t.length,k=t[0].length,y,a,e,c={value:r},p=!1,s=!1,w=n.CalcConvertedError;if(o=t[v],!o)for(o=[],t[v]=o,h=0;h<b;h++)for(y=t[h],a=o[h]=[],l=0;l<k;l++){if(e=y[l],n.err(e)){p||(o.isError=!0,p=!0);a.push(e);continue}switch(i){case 1:u?n.rD(e,c)?e=c.value:(s||(s=!0,o.isConvertError=!0),e=0):typeof e===ot||e instanceof Date||(s||(s=!0,o.isConvertError=!0),e=w);break;case 3:u?n.rB(e,c)?e=c.value:(s||(s=!0,o.isConvertError=!0),e=!1):typeof e!==tt&&(s||(s=!0,o.isConvertError=!0),e=w);break;case 2:e=e===r||e===f?"":e.toString();break}a.push(e)}}return o},n._isNaNOrInfinite=function(n){return isNaN(n)||!isFinite(n)},n.I=function(i){var r=n.D(i);if(it(r)<1e21)return parseInt(r,10);throw t.SR.Exp_InvalidCast;},n.rI=function(t,i){var r=n.rD(t,i);return r?it(i.value)<1e21?(i.value=parseInt(i.value,10),!0):!1:!1},n.D=function(i){var r={value:0};if(n.rD(i,r))return r.value;throw t.SR.Exp_InvalidCast;},n.rD=function(i,u){var f=r,e,o;if(typeof i===w||i===r)return u.value=0,!0;e=typeof i;try{if(e===ot)f=i;else if(e===y){if(i=i.trim(),i.length===0)return u.value=0,!0;if(o=!1,i.charAt(i.length-1)==="%"&&(o=!0,i=i.substr(0,i.length-1)),i.length>=2&&i[0]==="0"&&i[1]==="x")return!1;if(f=new Number(i).valueOf(),n._isNaNOrInfinite(f)){if(f=new Date(i),n._isNaNOrInfinite(f.valueOf()))return!1;f=t._DateTimeHelper.___toOADate(f)}o&&(f/=100)}else if(e===tt)f=i?1:0;else if(i instanceof Date)f=new t._DateTimeHelper(i).toOADate();else return!1}catch(s){return!1}return u.value=f,!0},n.rB=function(i,u){try{if(typeof i===w||i===r)return!1;else if(typeof i!==tt)if(i instanceof Date)i=t._DateTimeHelper.___toOADate(i)!==0;else if(n.num(i))i=i!==0;else throw t.SR.Exp_InvalidCast;}catch(f){}return u.value=i,!0},n.B=function(i){if(typeof i===w||i===r)return!1;else if(typeof i===tt)return i;else if(i instanceof Date)return new t._DateTimeHelper(i).toOADate()!==0;else if(n.num(i))return i!==0;else if(n.err(i))return!1;else throw t.SR.Exp_InvalidCast;},n.S=function(i){try{if(typeof i===w||i===r)return"";else if(typeof i===tt)return i?bt:kt;else if(typeof i===y)return i;else if(i instanceof Date)return t._DateTimeHelper.___toOADate(i).toString();else if(n.arr(i))throw t.SR.Exp_InvalidCast;else return i.toString()}catch(u){throw t.SR.Exp_InvalidCast;}},n.DT=function(i){var u={value:r};if(n.rDT(i,u))return u.value;throw t.SR.Exp_InvalidCast;},n.rDT=function(n,i){if(typeof n===w||n===r)i.value=t._DateTimeHelper.fromOADate(0);else if(n instanceof Date)i.value=new Date(n);else if(typeof n===y){var u=t._DateTimeHelper.parseLocale(n);if(!u)if(isNaN(n)){if(u=new Date(n),isNaN(u.valueOf()))return!1}else if(u=t._DateTimeHelper.fromOADate(parseFloat(n)),!u)return!1;i.value=u}else if(typeof n===ot)i.value=t._DateTimeHelper.fromOADate(n);else return!1;return!0},n.CalcConvertedError={},n}();i.Convert=e;gt=function(){function n(){}return n._argumentExists=function(n,t){return n&&t<n.length&&n[t]!==i.missingArgument},n._argumentValid=function(n,t){if(!n)return!1;var u=n[t];return u!==i.missingArgument&&u!==r&&u!==f&&!u._error},n.getArrayValue=function(n,t,i){return typeof n===w||n===r?s:t<n.getRowCount()&&i<n.getColumnCount()?n.getValue(t,i):i>=n.getColumnCount()&&n.getColumnCount()===1&&t<n.getRowCount()?n.getValue(t,0):t>=n.getRowCount()&&n.getColumnCount()===1&&i<n.getColumnCount()?n.getValue(0,i):s},n.tryExtractToSingleValue=function(n){var i=!0,t;return(e.ref(n)||e.arr(n))&&(t=e.toArr(n,0,!1,!0),t.isError?n=t[0]:t.rowCount===1&&t.colCount===1?n=t[0][0]:(n=t,i=!1)),{value:n,success:i}},n}();i._Helper=gt;uu=function(){function n(){}return n.getLength=function(n,t){if(e.arr(n))return n.getRowCount()*n.getColumnCount();else if(e.ref(n))return t=t?t:0,n.getRowCount(t)*n.getColumnCount(t)},n.getRowCount=function(n,t){if(e.arr(n))return n.getRowCount();else if(e.ref(n))return t=t?t:0,n.getRowCount(t)},n.getColumnCount=function(n,t){if(e.arr(n))return n.getColumnCount();else if(e.ref(n))return t=t?t:0,n.getColumnCount(t)},n.getValueByIndex=function(n,t,i){if(e.arr(n))return n.getValueByIndex(t);else if(e.ref(n)){i=i?i:0;var r=n.getColumnCount(i);return n.getValue(i,parseInt(t/r,10),t%r)}},n.getValue=function(n,t,i,r){if(e.arr(n))return n.getValue(t,i);else if(e.ref(n))return r=r?r:0,n.getValue(r,t,i)},n}();i.CalcArrayHelper=uu;i.compareStringIgnoreCase=ei,function(n){function c(n,t){return n===t?!0:it(n-t)<it(n)/281474976710656}function o(n,t){var i,u;if(e.err(n))return{error:n};if(e.err(t))return{error:t};if((n===f||n===r)&&(n=0),(t===f||t===r)&&(t=0),typeof n===y&&typeof t===y)return{result:n.toString().toUpperCase()-t.toString().toUpperCase()};else if(typeof n===y)return{result:1};else if(typeof t===y)return{result:-1};return(i={value:0},!e.rD(n,i))?{error:s}:(n=i.value,u={value:0},!e.rD(t,u))?{error:s}:(t=u.value,{result:c(n,t)?0:n-t})}var h=function(){function n(n){this.name=n}return n.prototype.getName=function(){return this.name},n.prototype.compareTo=function(n){return ei(this.name,n.name)},n.prototype.toString=function(){return this.getName()},n}(),u,t;n.Operator=h;u=function(n){function t(t){n.call(this,t)}return __extends(t,n),t.prototype._evaluateSingle=function(n,t){},t.prototype._evaluateImp=function(n,t){var i=r,s,u,o;if(e.arr(n)&&(i=n),e.ref(n)&&(i=e.toArr(n,0,!1,!1)),i===f||i===r)return this._evaluateSingle(n,t);if(i.length()<1)return di;for(s=[],u=0;u<i.getRowCount();u++)for(s[u]=[],o=0;o<i.getColumnCount();o++)s[u][o]=this._evaluateSingle(i.getValue(u,o),t);return new ft(s,i.getColumnCount())},t.prototype.evaluate=function(n,t){return this._evaluateImp(n,t)},t}(h);n.UnaryOperator=u;n.plus=new u("+");n.plus._evaluateSingle=function(n,t){if(n===f||n===r)return 0;var i={value:0};return e.rD(n,i)?e.D(i.value):typeof n=="string"?n:s};n.negate=new u("-");n.negate._evaluateSingle=function(n,t){if(n===f||n===r)return 0;var i={value:0};return e.rD(n,i)?-i.value:s};n.percent=new u("%");n.percent._evaluateSingle=function(n,t){if(n===f||n===r)return 0;var i={value:0};return e.rD(n,i)?i.value/100:s};t=function(n){function t(t,i){n.call(this,t);this.acceptsReference=i}return __extends(t,n),t.prototype._evaluateSingle=function(n,t,i){},t.prototype.evaluate=function(n,t,i){var r=gt.tryExtractToSingleValue(n),u=gt.tryExtractToSingleValue(t),v,c,a;if(r.success&&u.success)return this._evaluateSingle(r.value,u.value);n=r.value;t=u.value;var f=r.success?-1:n.rowCount,e=r.success?-1:n.colCount,o=u.success?-1:t.rowCount,s=u.success?-1:t.colCount,l=-1,h=-1;if(r.success||u.success)r.success?(l=o,h=s):(l=f,h=e);else{if(f!=1&&o!=1&&f!=o||e!=1&&s!=1&&e!=s)return p;l=f==1?o:f;h=e==1?s:e}for(v=[],c=0;c<l;c++)for(v[c]=[],a=0;a<h;a++)v[c][a]=!r.success&&(f!==1&&f<l||e!==1&&e<h)||!u.success&&(o!==1&&o<l||s!==1&&s<h)?p:this._evaluateSingle(r.success?n:n[f===1?0:c][e===1?0:a],u.success?t:t[o==1?0:c][s===1?0:a]);return new ft(v,h)},t}(h);n.BinaryOperator=t;n.add=new t("+",!1);n.add._evaluateSingle=function(n,t,i){var u,o;return e.err(n)?n:e.err(t)?t:((n===f||n===r)&&(n=0),(t===f||t===r)&&(t=0),u={value:0},!e.rD(n,u))?s:(o={value:0},!e.rD(t,o))?s:u.value+o.value};n.subtract=new t("-",!1);n.subtract._evaluateSingle=function(n,t,i){var u,o;return e.err(n)?n:e.err(t)?t:((n===f||n===r)&&(n=0),(t===f||t===r)&&(t=0),u={value:0},!e.rD(n,u))?s:(o={value:0},!e.rD(t,o))?s:u.value-o.value};n.multiply=new t("*",!1);n.multiply._evaluateSingle=function(n,t,i){var u,o;return e.err(n)?n:e.err(t)?t:((n===f||n===r)&&(n=0),(t===f||t===r)&&(t=0),u={value:0},!e.rD(n,u))?s:(o={value:0},!e.rD(t,o))?s:u.value*o.value};n.divide=new t("/",!1);n.divide._evaluateSingle=function(n,t,i){var o,u;return t===f||t===r||t===""||t===0?ui:e.err(n)?n:e.err(t)?t:((n===f||n===r)&&(n=0),o={value:0},!e.rD(n,o))?s:(u={value:0},!e.rD(t,u))?s:u.value===0?ui:o.value/u.value};n.exponent=new t("^",!1);n.exponent._evaluateSingle=function(n,t,i){var u,o;return e.err(n)?n:e.err(t)?t:((n===f||n===r)&&(n=0),(t===f||t===r)&&(t=0),u={value:0},!e.rD(n,u))?s:(n=u.value,o={value:0},!e.rD(t,o))?s:(t=o.value,n===0&&t<0)?ui:wu(n,t)};n.concatenate=new t("&",!1);n.concatenate._evaluateSingle=function(n,t,u){return e.err(n)?n:e.err(t)?t:((n===f||n===r)&&(n=""),(t===f||t===r)&&(t=""),i.Convert.S(n)+i.Convert.S(t))};n.equal=new t("=",!1);n.equal._evaluateSingle=function(n,t,i){var u,o,h,l;return e.err(n)?n:e.err(t)?t:((n===f||n===r)&&(n=typeof t===y?"":0),(t===f||t===r)&&(t=typeof n===y?"":0),typeof n===y||typeof t===y?n.toString().toUpperCase()===t.toString().toUpperCase():(u={value:0},!e.rD(n,u))?s:(n=u.value,o={value:0},!e.rD(t,o))?s:(t=o.value,h=n,l=t,c(h,l)))};n.notEqual=new t("<>",!1);n.notEqual._evaluateSingle=function(t,i,r){var u=n.equal._evaluateSingle.call(this,t,i,r);return typeof u===tt?!u:u};n.lessThan=new t("<",!1);n.lessThan._evaluateSingle=function(n,t,i){var r=o(n,t);return r.error?r.error:r.result<0};n.greaterThan=new t(">",!1);n.greaterThan._evaluateSingle=function(n,t,i){var r=o(n,t);return r.error?r.error:r.result>0};n.lessThanOrEqual=new t("<=",!1);n.lessThanOrEqual._evaluateSingle=function(n,t,i){var r=o(n,t);return r.error?r.error:r.result<=0};n.greaterThanOrEqual=new t(">=",!1);n.greaterThanOrEqual._evaluateSingle=function(n,t,i){var r=o(n,t);return r.error?r.error:r.result>=0};n.range=new t(":",!0);n.range.evaluate=function(n,t,i){var u;if(n===f||n===r||t===f||t===r||n.getRangeCount()!==1||t.getRangeCount()!==1||(u=n.getSource(),!u||u!==t.getSource()))return s;var e=n.getRow(0),o=n.getColumn(0),h=t.getRow(0),c=t.getColumn(0),l=rt(e,h),a=rt(o,c),v=ht(e+n.getRowCount(0),h+t.getRowCount(0))-l,y=ht(o+n.getColumnCount(0),c+t.getColumnCount(0))-a;return new d(u,[{row:l,col:a,rowCount:v,colCount:y}])};n.union=new t(",",!0);n.union.evaluate=function(n,t,i){if(n===f||n===r||t===f||t===r)return s;for(var e=[],u=0,u=0;u<n.getRangeCount();u++)e.push({row:n.getRow(u),col:n.getColumn(u),rowCount:n.getRowCount(u),colCount:n.getColumnCount(u)});for(u=0;u<t.getRangeCount();u++)e.push({row:t.getRow(u),col:t.getColumn(u),rowCount:t.getRowCount(u),colCount:t.getColumnCount(u)});return new d(n.getSource(),e)};n.intersection=new t(" ",!0);n.intersection.evaluate=function(n,t,i){var u;if(n===f||n===r||t===f||t===r||n.getRangeCount()!==1||t.getRangeCount()!==1||(u=n.getSource(),!u||u!==t.getSource()))return s;var e=n.getRow(0),o=n.getColumn(0),h=t.getRow(0),c=t.getColumn(0),l=ht(e,h),a=ht(o,c),v=rt(e+n.getRowCount(0),h+t.getRowCount(0))-l,y=rt(o+n.getColumnCount(0),c+t.getColumnCount(0))-a;return new d(u,[{row:l,col:a,rowCount:v,colCount:y}])}}(i.Operators||(i.Operators={}));v=i.Operators,function(n){function o(i,u,e){var o,s;if(i===f||i===r)throw t.SR.Exp_InvalidFunctionName;if(i=i.toUpperCase(),n._builtInFunctions.hasOwnProperty(i))throw t.SR.Exp_InvalidOverrideFunction;if(n._customFunctions.hasOwnProperty(i))if(o=n._customFunctions[i],o){if(!e||!e.override)throw t.SR.Exp_OverrideNotAllowed;}else n._customFunctions[i]=new n.Function(i,0,255),o=n[i.toUpperCase()];else o=new n.Function(i,0,255),n._customFunctions[i]=o;if(u&&typeof u=="function"&&(o.evaluate=u),e)for(s in e)e.hasOwnProperty(s)&&s!=="override"&&(o[s]=e[s]);return o}function s(t){return t===f||t===r?r:(t=t.toUpperCase(),n._builtInFunctions&&n._builtInFunctions.hasOwnProperty(t))?n._builtInFunctions[t]:n._customFunctions.hasOwnProperty(t)?n._customFunctions[t]:r}var e,i,u;(function(n){n[n.normal=0]="normal";n[n.allwaysExpand=1]="allwaysExpand";n[n.neverExpand=2]="neverExpand"})(n.ArrayArgumentEvaluateMode||(n.ArrayArgumentEvaluateMode={}));e=n.ArrayArgumentEvaluateMode;i=function(){function t(n,t,i){var r=arguments.length;this._init(n,r<2?0:t,r<3?0:i);this.typeName=""}return t.prototype._init=function(n,t,i){var r=this;r.name=n;r.minArgs=t;r.maxArgs=i},t.prototype.acceptsArray=function(n){return!1},t.prototype.acceptsReference=function(n){return!1},t.prototype.acceptsError=function(n){return!1},t.prototype.acceptsMissingArgument=function(n){return!1},t.prototype.isVolatile=function(){return!1},t.prototype.isContextSensitive=function(){return!1},t.prototype.isBranch=function(){return!1},t.prototype.findTestArgument=function(){return-1},t.prototype.findBranchArgument=function(n){return-1},t.prototype.expandRows=function(){return!0},t.prototype.expandColumns=function(){return!0},t.prototype.precedentReference=function(){return!0},t.prototype.returnReference=function(){return!1},t.prototype.evaluate=function(n,t){},t.prototype.evaluateWithContext=function(n,t){var i=this;return i.isContextSensitive()?i.evaluate(n,t):i.evaluate(n)},t.prototype.toString=function(){return this.name},t._create=function(t,i,r){var f=new n.Function(t,0,255),u;if(i&&typeof i=="function"&&(f.evaluate=i),r)for(u in r)r.hasOwnProperty(u)&&u!=="override"&&(f[u]=r[u]);return f},t.prototype.toJSON=function(){var t={};for(var n in this)this.hasOwnProperty(n)&&(t[n]=this[n]);return t},t.prototype.fromJSON=function(n){if(n)for(var t in n)n[t]!==f&&(this[t]=n[t])},t}();n.Function=i;u=function(n){function t(t,i,r){n.call(this,t,i,r)}return __extends(t,n),t.prototype.isContextSensitive=function(){return!0},t.prototype.evaluate=function(n,t){return this.evaluateAsync(n,t)},t.prototype.evaluateAsync=function(n,t){},t.prototype.defaultValue=function(){return 0},t}(i);n.AsyncFunction=u;n._customFunctions={};n._builtInFunctions={};n.defineGlobalCustomFunction=o;n.findGlobalFunction=s}(i.Functions||(i.Functions={}));nr=i.Functions;c={cell:0,row:1,column:2,sheet:3},function(n){function ui(u,f,e,o,h){var pi=u.row,wi=u.column,pt=[],yt=0,ni,bt,ir,kt,ai,hr,ki,fi,rr,it,ur,c,at,vt,fr,dt,cr,ft,lr,er,di,si,ar,ei,gi;pt[yt]={expr:f,acceptsArray:!1,acceptsRef:!1,index:-1};for(var hi=0,nr=0,gt=!1,ci=o,li=h,tr=!1,vr=!1,g,bi,or,nt,wt;yt>=0;){if(g=pt[yt--],bi=g.acceptsArray,or=g.acceptsRef,f=g.expr,nt=r,f)if(f.t===7){if(ni=f,ir=ni.argCount(),typeof ni.fn===y)if(u)if(bt=u.getFunction(ni.fn),bt)if(ir<bt.minArgs||ir>bt.maxArgs){nt=new t(s);continue}else ni.fn=bt;else{nt=new t(ut);continue}else nt=new t(ut);if(bt=ni.fn,kt=g.index,ft=g.neeedExpendindexs,kt<0?(g.noExpendCatchValue=tr,g.arrayFormulaCatchValue=e,bt.arrayArgumentEvaluateMode===2&&(tr=!0),bt.arrayArgumentEvaluateMode===1&&(e=!0),g.args=[]):(bt.acceptsArray(kt)?hi--:gt&&(ft||(ft=[],g.neeedExpendindexs=ft),ni.getArg(kt)!=wt,ft.push(kt)),g.args.push(wt)),kt==ir-1){if(tr=g.noExpendCatchValue,e=g.arrayFormulaCatchValue,ai=g.args,hr=!1,ai&&ai.length>0)for(ki=0;ki<ai.length;ki++)if(ai[ki]!==ni.getArg(ki)){hr=!0;break}nt=hr?new ot(ni.fn,ai):f;ft&&ft.length>0&&(nt=new d(nt,ft),gt=!0)}else gt=!1,kt++,g.index=kt,bt.acceptsArray(kt)&&hi++,pt[++yt]=g,pt[++yt]={expr:ni.getArg(kt),acceptsArray:bt.acceptsArray(kt),acceptsRef:bt.acceptsReference(kt),index:-1}}else if(f.t===0||f.t===1){if(fi=f,nr&&(fi.rowRelative||fi.columnRelative)){var oi=f.source||u.source,vi=oi.getRowCount(),yi=oi.getColumnCount(),at=fi.rowRelative?(fi.row+u.activeRow)%l.maxRowCount%vi:fi.row,vt=fi.columnRelative?(fi.column+u.activeColumn)%l.maxColumnCount%yi:fi.column;at=at<0?at+vi:at;vt=vt<0?vt+yi:vt;f=f.t===1?new v(oi,at,vt,!1,!1):new a(at,vt,!1,!1)}}else if(f.t===2||f.t===3||f.t===16||f.t===17){if(f.t===17){if(rr=f,c=rr.getRange(pi,wi),!c){nt=f;wt=f;continue}f=rr.source()===u.source?new w(c.row,c.column,c.row+c.rowCount-1,c.column+c.columnCount-1):new rt(rr.source(),c.row,c.column,c.row+c.rowCount-1,c.column+c.columnCount-1)}if(it=f,nr&&(it.startRowRelative||it.startColumnRelative||it.endRowRelative||it.endColumnRelative)){var oi=f.source||f.startSource||u.source,vi=oi.getRowCount(),yi=oi.getColumnCount(),ti=it.startRowRelative?(it.startRow+u.activeRow)%vi:it.startRow,ii=it.startColumnRelative?(it.startColumn+u.activeColumn)%yi:it.startColumn,ri=it.endRowRelative?(it.endRow+u.activeRow)%vi:it.endRow,ui=it.endColumnRelative?(it.endColumn+u.activeColumn)%yi:it.endColumn;ti=ti<0?ti+vi:ti;ii=ii<0?ii+yi:ii;ri=ri<0?ri+vi:ri;ui=ui<0?ui+yi:ui;ti>ri&&(ur=ti,ti=ri,ri=ur);ii>ui&&(ur=ii,ii=ui,ui=ur);f=f.t===2?new w(ti,ii,ri,ui,!1,!1,!1,!1):f.t===3?new rt(oi,ti,ii,ri,ui,!1,!1,!1,!1):new b(oi,f.endSource,ti,ii,ri,ui,!1,!1,!1,!1)}or&&(bi||!e)||u.row<0||u.column<0||(hi>0&&!e||hi===0||tr?(c=it.getRange(pi,wi),e?!it.isFullColumn&&c.rowCount!=1&&ci>=c.rowCount||!it.isFullRow&&c.columnCount!=1&&li>=c.columnCount?nt=new t(p):(at=(it.isFullColumn?0:c.row)+(c.rowCount==1?0:ci),vt=(it.isFullRow?0:c.column)+(c.columnCount==1?0:li),nt=f.t===16?new b(f.startSource,f.endSource,at,vt,at,vt,!1,!1,!1,!1):f.t===3?new v(f.source,at,vt,!1,!1):new a(at,vt,!1,!1)):c.rowCount>1&&c.columnCount>1||c.rowCount>1&&!it.isFullColumn&&(pi<c.row||pi>=c.row+c.rowCount)||c.columnCount>1&&!it.isFullRow&&(wi<c.column||wi>=c.column+c.columnCount)?nt=new t(s):(at=it.isFullColumn||c.rowCount>1?pi:c.row,vt=it.isFullRow||c.columnCount>1?wi:c.column,nt=f.t===16?new b(f.startSource,f.endSource,at,vt,at,vt,!1,!1,!1,!1):f.t===3?new v(f.source,at,vt,!1,!1):new a(at,vt,!1,!1))):gt=!0)}else if(f.t===11)fr=f,g.index===-1?(g.index=0,pt[++yt]=g,pt[++yt]={expr:fr.operand,acceptsArray:!1,acceptsRef:!1,index:-1}):(nt=wt!=fr.operand?new ct(fr.operator,wt):f,gt&&(ft=[],ft.push(0),nt=new d(nt,ft)));else if(f.t===10)dt=f,cr=dt.operator.acceptsReference,g.index===-1?(g.index=0,pt[++yt]=g,pt[++yt]={expr:dt.left,acceptsArray:!1,acceptsRef:cr,index:-1}):g.index==0?(wt!=dt.left&&(nt=new tt(dt.operator,wt,dt.right),g.expr=nt),gt&&(ft=[],ft.push(0),g.neeedExpendindexs=ft,gt=!1),g.index=1,pt[++yt]=g,pt[++yt]={expr:dt.right,acceptsArray:!1,acceptsRef:cr,index:-1}):(nt=wt!=dt.right?new tt(dt.operator,dt.left,wt):dt,ft=g.neeedExpendindexs,gt&&(ft||(ft=[]),ft.push(1)),ft&&(nt=new d(nt,ft),gt=!0));else if(f.t===14)lr=f,g.index===-1?(g.index=0,pt[++yt]=g,pt[++yt]={expr:lr.argument,acceptsArray:bi,acceptsRef:or,index:-1}):lr.argument!==wt&&(nt=new et(wt));else if(f.t===8||f.t===9)er=f,g.index==1?(nr--,nt=wt,g.context&&(u=g.context)):(nr++,pt[++yt]={expr:f,acceptsArray:!0,acceptsRef:!0,index:1},si=u,f.t===9?(ar=f.source,si=new k(ar),si.cloneFrom(u),di=ar.getCustomName(er.name)):(di=u.getName(er.name),u.source.getCustomName(er.name)||(si=new sr(u.source),si.cloneFrom(u))),di||(di=new n.ErrorExpression(ut)),si&&(u=si),pt[++yt]={expr:di,acceptsArray:!0,acceptsRef:!0,index:-1,context:u});else if(f.t===15)if(ei=f,!bi&&(hi>0||e))gt=!0;else if(!bi&&hi==0)if(ci>=ei.value.RowCount&&ei.value.RowCount>1||li>=ei.value.ColumnCount&&ei.value.ColumnCount>1)nt=new t(p);else try{ei.value.RowCount==1&&(ci=0);ei.value.ColumnCount==1&&(li=0);gi=ei.value.getValue(ci,li);typeof gi=="string"?nt=new ht(gi):typeof gi=="number"&&(nt=new st(gi));lt||(lt=new i.Parser);nt=lt.parse(ei.value.getValue(ci,li).toString(),r)}catch(yr){nt=new t(p)}nt===r?nt=f:nt!=f&&(vr=!0);wt=nt}return nt}var u=function(){function n(){}return n.prototype.offset=function(n,t,i){return this},n}(),et,ot,g,at,vt,e,yt,st,ht,t,pt,wt,bt,kt,dt,nt,ct,tt,o,it,a,gt,v,w,ni,rt,b,ti,ii,ri,d,lt;n.Expression=u;et=function(n){function t(t){n.call(this);this.argument=t;this.t=14}return __extends(t,n),t.prototype.offset=function(n,t,i){return this.argument.offset(n,t,i)},t}(u);n.ParenthesesExpression=et;ot=function(n){function t(t,i){n.call(this);this.fn=t;this.args=i;this.t=7}return __extends(t,n),t.prototype.argCount=function(){return this.args?this.args.length:0},t.prototype.getArg=function(n){return this.args?this.args[n]:r},t.prototype.getFunctionName=function(){var n=this;return typeof n.fn===y?n.fn:n.fn.name},t.prototype.offset=function(n,i,r){for(var f=this.args,e=[],u=0;u<f.length;u++)e.push(f[u].offset(n,i,r));return new t(this.fn,e)},t}(u);n.FunctionExpression=ot;g=function(n){function t(t){n.call(this);this.name=t;this.t=8}return __extends(t,n),t}(u);n.NameExpression=g;at=function(n){function t(t){n.call(this,t);this.t=18}return __extends(t,n),t}(g);n.BangNameExpression=at;vt=function(n){function t(t,i){n.call(this,i);this.source=t;this.t=9}return __extends(t,n),t}(g);n.ExternalNameExpression=vt;e=function(n){function t(t){n.call(this);this.value=t}return __extends(t,n),t}(u);n.ConstantExpression=e;yt=function(n){function t(t){n.call(this,t);this.t=6}return __extends(t,n),t}(e);n.BooleanExpression=yt;st=function(n){function t(t,i){n.call(this,t);this.originalValue=i;this.t=4}return __extends(t,n),t}(e);n.DoubleExpression=st;ht=function(n){function t(t){n.call(this,t);this.t=5}return __extends(t,n),t}(e);n.StringExpression=ht;t=function(n){function t(t){n.call(this,t);this.t=12}return __extends(t,n),t}(e);n.ErrorExpression=t;pt=function(n){function t(t,i){n.call(this,i);this.source=t;this.t=13}return __extends(t,n),t}(t);n.ExternalErrorExpression=pt;wt=function(n){function t(t,i,r){n.call(this,r);this.startSource=t;this.endSource=i;this.t=19}return __extends(t,n),t}(t);n.SheetRangeErrorExpression=wt;bt=function(n){function t(t){n.call(this,t);this.t=20}return __extends(t,n),t}(t);n.BangErrorExpression=bt;kt=function(n){function t(t){n.call(this,new ft(t));this.t=15}return __extends(t,n),t}(e);n.ArrayExpression=kt;dt=function(n){function t(){n.call(this,i.missingArgument);this.t=21}return __extends(t,n),t}(e);n.MissingArgumentExpression=dt;nt=function(n){function t(t){n.call(this);this.operator=t}return __extends(t,n),t}(u);n.OperatorExpression=nt;ct=function(n){function t(t,i){n.call(this,t);this.operand=i;this.t=11}return __extends(t,n),t.prototype.offset=function(n,i,r){return new t(this.operator,this.operand.offset(n,i,r))},t}(nt);n.UnaryOperatorExpression=ct;tt=function(n){function t(t,i,r){n.call(this,t);this.left=i;this.right=r;this.t=10}return __extends(t,n),t.prototype.offset=function(n,i,r){return new t(this.operator,this.left.offset(n,i,r),this.right.offset(n,i,r))},t}(nt);n.BinaryOperatorExpression=tt;o=function(n){function t(){n.call(this)}return __extends(t,n),t.prototype.getRange=function(n,t){return r},t}(u);n.ReferenceExpression=o;it=function(n){function t(t){n.call(this);this.source=t}return __extends(t,n),t}(o);n.ExternalReferenceExpression=it;a=function(n){function t(t,i,r,u){n.call(this);var f=this;f.row=t;f.column=i;f.rowRelative=r;f.columnRelative=u;this.t=0}return __extends(t,n),t.prototype.getRange=function(n,t){return fu.call(this,n,t)},t.prototype.offset=function(n,i,r){var u=this;return new t(u.row+(u.rowRelative||r?n:0),u.column+(u.columnRelative||r?i:0),u.rowRelative,u.columnRelative)},t}(o);n.CellExpression=a;gt=function(n){function t(t,i,r,u){n.call(this,t,i,r,u);this.t=22}return __extends(t,n),t.prototype.offset=function(n,i,r){var u=this;return new t(u.row+(u.rowRelative||r?n:0),u.column+(u.columnRelative||r?i:0),u.rowRelative,u.columnRelative)},t}(a);n.BangCellExpression=gt;v=function(n){function t(t,i,r,u,f){n.call(this,t);var e=this;e.row=i;e.column=r;e.rowRelative=u;e.columnRelative=f;this.t=1}return __extends(t,n),t.prototype.getRange=function(n,t){return fu.call(this,n,t)},t.prototype.offset=function(n,i,r){var u=this;return new t(u.source,u.row+(u.rowRelative||r?n:0),u.column+(u.columnRelative||r?i:0),u.rowRelative,u.columnRelative)},t}(it);n.ExternalCellExpression=v;w=function(t){function i(n,i,r,u,f,e,o,s){t.call(this);arguments.length===0?this._initDefault():this.init(n,i,r,u,f,e,o,s);this.t=2}return __extends(i,t),i.prototype._initDefault=function(){var n=l.BAND_INDEX_CONST,t=this;t.init(n,n,n,n,!1,!1,!1,!1);t.isFullRow=!0;t.isFullColumn=!0},i.prototype.init=function(n,t,i,r,u,f,e,o){var s=this;u===e&&n>i?(s.startRow=i,s.endRow=n,s.startRowRelative=e,s.endRowRelative=u):(s.startRow=n,s.endRow=i,s.startRowRelative=u,s.endRowRelative=e);f===o&&t>r?(s.startColumn=r,s.endColumn=t,s.startColumnRelative=o,s.endColumnRelative=f):(s.startColumn=t,s.endColumn=r,s.startColumnRelative=f,s.endColumnRelative=o);s.isFullRow=!1;s.isFullColumn=!1},i.prototype.initBand=function(n,t,i,r,u){var e,o,f;n>t&&(e=n,n=t,t=e,o=i,i=r,r=o);f=this;u?(f.startRow=n,f.startColumn=l.BAND_INDEX_CONST,f.endRow=t,f.endColumn=l.BAND_INDEX_CONST,f.startRowRelative=i,f.startColumnRelative=!1,f.endRowRelative=r,f.endColumnRelative=!1,f.isFullRow=!0,f.isFullColumn=!1):(f.startRow=l.BAND_INDEX_CONST,f.startColumn=n,f.endRow=l.BAND_INDEX_CONST,f.endColumn=t,f.startRowRelative=!1,f.startColumnRelative=i,f.endRowRelative=!1,f.endColumnRelative=r,f.isFullRow=!1,f.isFullColumn=!0)},i.prototype._getRangeType=function(){var n=this;return n.isFullRow&&n.isFullColumn?c.sheet:n.isFullRow?c.row:n.isFullColumn?c.column:c.cell},i.prototype.getRange=function(n,t){return tr.call(this,n,t)},i.prototype.offset=function(t,i,r){var u=this,f=new n.RangeExpression(u.startRow+(!u.isFullColumn&&(u.startRowRelative||r)?t:0),u.startColumn+(!u.isFullRow&&(u.startColumnRelative||r)?i:0),u.endRow+(!u.isFullColumn&&(u.endRowRelative||r)?t:0),u.endColumn+(!u.isFullRow&&(u.endColumnRelative||r)?i:0),u.startRowRelative,u.startColumnRelative,u.endRowRelative,u.endColumnRelative);return f.isFullRow=u.isFullRow,f.isFullColumn=u.isFullColumn,f},i.prototype.offset2=function(t,i,r,u){var f=this,e=new n.RangeExpression(f.startRow+(f.isFullColumn?0:t),f.startColumn+(f.isFullRow?0:i),f.endRow+(f.isFullColumn?0:r),f.endColumn+(f.isFullRow?0:u),f.startRowRelative,f.startColumnRelative,f.endRowRelative,f.endColumnRelative);return e.isFullRow=f.isFullRow,e.isFullColumn=f.isFullColumn,e},i}(o);n.RangeExpression=w;ni=function(t){function i(n,i,r,u,f,e,o,s){t.call(this,n,i,r,u,f,e,o,s);this.t=23}return __extends(i,t),i.prototype.offset=function(t,i,r){var u=this,f=new n.BangRangeExpression(u.startRow+(!u.isFullColumn&&(u.startRowRelative||r)?t:0),u.startColumn+(!u.isFullRow&&(u.startColumnRelative||r)?i:0),u.endRow+(!u.isFullColumn&&(u.endRowRelative||r)?t:0),u.endColumn+(!u.isFullRow&&(u.endColumnRelative||r)?i:0),u.startRowRelative,u.startColumnRelative,u.endRowRelative,u.endColumnRelative);return f.isFullRow=u.isFullRow,f.isFullColumn=u.isFullColumn,f},i}(w);n.BangRangeExpression=ni;rt=function(t){function i(n,i,u,f,e,o,s,h,c){t.call(this,r);arguments.length===1?this._initDefault(n):this.init(n,i,u,f,e,o,s,h,c);this.t=3}return __extends(i,t),i.prototype._initDefault=function(n){var t=l.BAND_INDEX_CONST,i=this;i.init(n,t,t,t,t,!1,!1,!1,!1);i.isFullRow=!0;i.isFullColumn=!0},i.prototype.init=function(n,t,i,r,u,f,e,o,s){var h=this;h.source=n;f===o&&t>r?(h.startRow=r,h.endRow=t,h.startRowRelative=o,h.endRowRelative=f):(h.startRow=t,h.endRow=r,h.startRowRelative=f,h.endRowRelative=o);e===s&&i>u?(h.startColumn=u,h.endColumn=i,h.startColumnRelative=s,h.endColumnRelative=e):(h.startColumn=i,h.endColumn=u,h.startColumnRelative=e,h.endColumnRelative=s)},i.prototype.initBand=function(n,t,i,r,u,f){var e=this,o,s;e.source=n;t>i&&(o=t,t=i,i=o,s=r,r=u,u=s);f?(e.startRow=t,e.startColumn=l.BAND_INDEX_CONST,e.endRow=i,e.endColumn=l.BAND_INDEX_CONST,e.startRowRelative=r,e.startColumnRelative=!1,e.endRowRelative=u,e.endColumnRelative=!1,e.isFullRow=!0):(e.startRow=l.BAND_INDEX_CONST,e.startColumn=t,e.endRow=l.BAND_INDEX_CONST,e.endColumn=i,e.startRowRelative=!1,e.startColumnRelative=r,e.endRowRelative=!1,e.endColumnRelative=u,e.isFullColumn=!0)},i.prototype._getRangeType=function(){var n=this;return n.isFullRow&&n.isFullColumn?c.sheet:n.isFullRow?c.row:n.isFullColumn?c.column:c.cell},i.prototype.getRange=function(n,t){return tr.call(this,n,t)},i.prototype.offset=function(t,i,r){var u=this,f=new n.ExternalRangeExpression(u.source,u.startRow+(!u.isFullColumn&&(u.startRowRelative||r)?t:0),u.startColumn+(!u.isFullRow&&(u.startColumnRelative||r)?i:0),u.endRow+(!u.isFullColumn&&(u.endRowRelative||r)?t:0),u.endColumn+(!u.isFullRow&&(u.endColumnRelative||r)?i:0),u.startRowRelative,u.startColumnRelative,u.endRowRelative,u.endColumnRelative);return f.isFullRow=u.isFullRow,f.isFullColumn=u.isFullColumn,f},i.prototype.offset2=function(t,i,r,u){var f=this,e=new n.ExternalRangeExpression(f.source,f.startRow+(f.isFullColumn?0:t),f.startColumn+(f.isFullRow?0:i),f.endRow+(f.isFullColumn?0:r),f.endColumn+(f.isFullRow?0:u),f.startRowRelative,f.startColumnRelative,f.endRowRelative,f.endColumnRelative);return e.isFullRow=f.isFullRow,e.isFullColumn=f.isFullColumn,e},i}(it);n.ExternalRangeExpression=rt;b=function(t){function i(n,i,r,u,f,e,o,s,h,c){t.call(this);this.init(n,i,r,u,f,e,o,s,h,c);this.t=16}return __extends(i,t),i.prototype.init=function(n,t,i,r,u,f,e,o,s,h){var c=this;c.startSource=n;c.endSource=t;e===s&&i>u?(c.startRow=u,c.endRow=i,c.startRowRelative=s,c.endRowRelative=e):(c.startRow=i,c.endRow=u,c.startRowRelative=e,c.endRowRelative=s);o===h&&r>f?(c.startColumn=f,c.endColumn=r,c.startColumnRelative=h,c.endColumnRelative=o):(c.startColumn=r,c.endColumn=f,c.startColumnRelative=o,c.endColumnRelative=h)},i.prototype.initBand=function(n,t,i,r,u,f,e){var o=this,s,h;o.startSource=n;o.endSource=t;i>r&&(s=i,i=r,r=s,h=u,u=f,f=h);e?(o.startRow=i,o.startColumn=l.BAND_INDEX_CONST,o.endRow=r,o.endColumn=l.BAND_INDEX_CONST,o.startRowRelative=u,o.startColumnRelative=!1,o.endRowRelative=f,o.endColumnRelative=!1,o.isFullRow=!0):(o.startRow=l.BAND_INDEX_CONST,o.startColumn=i,o.endRow=l.BAND_INDEX_CONST,o.endColumn=r,o.startRowRelative=!1,o.startColumnRelative=u,o.endRowRelative=!1,o.endColumnRelative=f,o.isFullColumn=!0)},i.prototype.getRange=function(n,t){return tr.call(this,n,t)},i.prototype._getRangeType=function(){var n=this;return n.isFullRow&&n.isFullColumn?c.sheet:n.isFullRow?c.row:n.isFullColumn?c.column:c.cell},i.prototype.offset=function(t,i,r){var u=this,f=new n.SheetRangeExpression(u.startSource,u.endSource,u.startRow+(!u.isFullColumn&&(u.startRowRelative||r)?t:0),u.startColumn+(!u.isFullRow&&(u.startColumnRelative||r)?i:0),u.endRow+(!u.isFullColumn&&(u.endRowRelative||r)?t:0),u.endColumn+(!u.isFullRow&&(u.endColumnRelative||r)?i:0),u.startRowRelative,u.startColumnRelative,u.endRowRelative,u.endColumnRelative);return f.isFullRow=u.isFullRow,f.isFullColumn=u.isFullColumn,f},i}(o);n.SheetRangeExpression=b;ti=function(n){function i(t,i){n.call(this);i!==r&&t&&this._parseStructReferenceString(i,t);this.t=17}return __extends(i,n),i.create=function(n,t,u,f,e){typeof t=="undefined"&&(t=16);typeof u=="undefined"&&(u=1);typeof f=="undefined"&&(f=0);typeof e=="undefined"&&(e=n.endColumn()-n.startColumn());var o=new i(r,r);return o._baseTable=n,o._referencePortions=t,o._columnReferenceStartInTable=f,o._columnReferenceEndInTable=e,o._referenceColumnSpecifier=u,o},i.prototype.tableName=function(){return this._baseTable.tableName()},i.prototype.baseTable=function(){return this._baseTable},i.prototype._updateCatch=function(){this._catchedTableStartColumn=this._baseTable.startColumn()},i.prototype.columnReferenceStart=function(){return this._columnReferenceStartInTable+this._baseTable.startColumn()},i.prototype.columnReferenceEnd=function(){return this._columnReferenceEndInTable+this._baseTable.startColumn()},i.prototype.referencePortions=function(){return this._referencePortions},i.prototype.referenceColumnSpecifier=function(){return this._referenceColumnSpecifier},i.prototype.source=function(){return this._baseTable.source()},i.prototype.getRange=function(n,t,i){var s=this;s._updateCatch();var u,l,f,a,v,y,e=s._baseTable.startRow(),o=s._baseTable.endRow(),h=s._baseTable.hasTotalsRow(),c=s._baseTable.hasHeadersRow();switch(s._referencePortions){case 3:case 16:u=c?e+1:e;f=h?o-1:o;break;case 2:if(c)u=e,f=e;else if(i)u=e-1,f=e-1;else return r;break;case 8:if(h)u=o,f=o;else if(i)u=o+1,f=o+1;else return r;break;case 1:u=n;f=n;break;case 6:u=e+(i&&!c?-1:0);f=h?o-1:o;break;case 12:u=c?e+1:e;f=o+(i&&!h?1:0);break;case 14:default:u=e+(i&&!c?-1:0);f=o+(i&&!h?1:0);break}return(l=s.columnReferenceStart(),a=s.columnReferenceEnd(),f<u||!i&&u<e||!i&&f>o)?r:(v=f-u+1,y=a-l+1,{row:u,column:l,rowCount:v,columnCount:y})},i.prototype._parseStructReferenceString=function(n,t){var h=i,e=this,y,p,l,v,k,w;t=t.trim();var u=0,f=t.charAt(u),o=h._parseTableObject(n,t,u,f);for(o.table===r&&h._throwError(),y=o.table,e._baseTable=y,u=o.charIndex,f=o.currentChar,u++,f=t.charAt(u),p=u;f===" ";)u++,f=t.charAt(u);f!=="@"&&f!=="["&&(u=p,f=t.charAt(u));for(var s=1,c=!1,a=!1,b=t.length;s!==0&&u<b;)if(f==="["&&(s++,u++,f=t.charAt(u)),f==="#")c&&s<=1&&h._throwError(),o=h._parsePortion(t,u,f,s),l=o.portion,u=o.charIndex,f=o.currentChar,s=o.lbracketLever,c?e._referencePortions===2&&l===3||l===2&&e._referencePortions===3?e._referencePortions=6:e._referencePortions===3&&l===8||l===3&&e._referencePortions===8?e._referencePortions=12:h._throwError():e._referencePortions=l,c=!0;else if(f==="@"){for((s>1||c)&&h._throwError(),c=!0,e._referencePortions=1,u++,f=t.charAt(u);f===" ";)u++,f=t.charAt(u);f===","&&h._throwError()}else{for(v=u,k=!1;f!=="]"&&f!=="[";)if(f==="'"&&u++,f===","){for(u++,f=t.charAt(u),w=u;f===" ";)u++,f=t.charAt(u);if(f==="["){u=w;f=",";break}}else u++,f=t.charAt(u);if(u>v&&((a||f==="["&&s>1)&&h._throwError(),o=e._parseColumnRange(t,u,f,s,v),u=o.charIndex,f=o.currentChar,s=o.lbracketLever,a=!0),f==="]"){if(s--,s===0)break;else u>=t.length&&h._throwError();u++;f=t.charAt(u)}f===","&&(u++,f=t.charAt(u))}c||(e._referencePortions=16);a||(e._columnReferenceStartInTable=0,e._columnReferenceEndInTable=e._baseTable.endColumn()-e._baseTable.startColumn(),e._referenceColumnSpecifier=1)},i.prototype._parseColumnRange=function(n,t,r,u,e){var c=this,y=i,s="",l="",w=!1,b=!1,o,p,h,a,v,k;if(u>1)w=!0,u--,s=n.substring(e,t),t++,r=n.charAt(t),r===":"&&(t++,r=n.charAt(t),b=r==="[",o=y._getColumnEndString(n,t,r,u),l=o.columnEndString,t=o.charIndex,r=o.currentChar,u=o.lbracketLever);else if(r==="["){for(b=!0,h=t-1,r=n[h];r===" ";)h--,r=n[h];r!==":"&&y._throwError();s=n.substring(e,h);w||(s=y._trimStart(s));r=n.charAt(t);o=y._getColumnEndString(n,t,r,u);l=o.columnEndString;t=o.charIndex;r=o.currentChar;u=o.lbracketLever}else(c._referencePortions===f||c._referencePortions===16)&&(w=!0),p=n.substring(e,t),h=p.indexOf(":"),h>0?(s=p.substring(0,h),s=s,l=p.substring(h+1),l.charAt(0)!=="["&&y._throwError()):s=p;if(a=c._getColumnIndex(s,w),l?(v=c._getColumnIndex(l,b),c._referenceColumnSpecifier=4):(v=a,c._referenceColumnSpecifier=2),a>v&&(k=a,a=v,v=k),c._columnReferenceStartInTable=a,c._columnReferenceEndInTable=v,t++,t<n.length)for(r=n.charAt(t);r===" ";)t++,r=n.charAt(t);return{charIndex:t,currentChar:r,lbracketLever:u}},i._trimStart=function(n){for(var t=n.length-1;t>=0&&n[t]===" ";)t--;while(t>=0&&n[t]!==" ")t--;return t>=0?n.substr(t+1,n.length-t-1):n},i._trimEnd=function(n){for(var t=0,r=n.length,i=0;t<r&&n[t]===" ";)t++;for(i=t,t=r-1;t>i&&n[t]===" ";)t++;return t>=i?n.substring(i,t+1):n},i.prototype._getColumnIndex=function(n,t){var u,r,f,e;if(n&&i._validateColumnString(n,t)){for(u="",r=0,f=n.length;r<f;r++)n[r]==="'"&&r<f-1&&n.charAt(r+1)!=="'"||(u+=n.charAt(r));return n=u,e=this._baseTable.getColumnIndexInTable(n),e<0&&i._throwError(),e}return-1},i._validateColumnString=function(n,t,i){var r,u,f;if(t)return!0;if(arguments.length===2&&(i=!0),r="",r=n[0],u=r,r==="#"||r===" "||r==="@"||r===" "||r===","||r===":"||r==="["||r==="]")return!1;for(f=1;f<n.length;f++){if(r=n[f],r===" "||r===","||r===":"||r==="["&&u!=="'"||r==="]"&&u!=="'"||r==="@"&&u!=="'"||r==="#"&&u!=="'")return!1;u=r}return!0},i._getValidaColumnString=function(n){for(var t="",r="",t=n.charAt(0),i=0;i<n.length;i++)t=n.charAt(i),(t==="["||t==="]"||t==="@"||t==="#"||t==="'")&&(r+="'"),r+=t;return r},i._containsInvalidateColumnString=function(n){var t="",i;if(t=n.charAt(0),t==="#"||t===" "||t==="@"||t===" "||t===","||t===":"||t==="["||t==="]")return!0;for(i=1;i<n.length;i++)if(t=n.charAt(i),t===" "||t===","||t===":"||t==="["||t==="]"||t==="@"||t==="#")return!0;return!1},i._getColumnEndString=function(n,t,r,u){var o=!1,e,f;if(r==="[")for(o=!0,u++,t++,r=n.charAt(t);r===" ";)t++,r=n.charAt(t);for(e=t;r!=="]"&&(r!==","||u>1);)r==="'"&&t++,t++,r=n.charAt(t);return t<=e&&i._throwError(),f=n.substring(e,t),u>1&&u--,o||(f=i._trimEnd(f)),{columnEndString:f,charIndex:t,currentChar:r,lbracketLever:u}},i._parsePortion=function(n,t,r,u){for(var f=i,h=14,l=t,o,s,e,c;r!=="]";)r==="'"&&t++,t++,r=n.charAt(t);for(o=n.substring(l,t).toLowerCase().trim(),s=!1,e=0;e<f._structReferenceKeywordsLlowercase.length;e++)if(c=f._structReferenceKeywordsLlowercase[e],o===c){h=f._getPortion(o);s=!0;break}if(s||f._throwError(),t++,t>=n.length)u--;else{for(r=n.charAt(t);r===" ";)t++,r=n.charAt(t);if(r===","){for(u<=1&&f._throwError(),t++,r=n.charAt(t);r===" ";)t++,r=n.charAt(t);for(r==="["&&(u++,t++,r=n.charAt(t));r===" ";)t++,r=n.charAt(t)}u>1&&u--}return{portion:h,charIndex:t,currentChar:r,lbracketLever:u}},i._getPortion=function(n){switch(n){case"#all":return 14;case"#data":return 3;case"#headers":return 2;case"#totals":return 8;case"#this row":return 1;default:break}return 14},i._parseTableObject=function(n,t,i,u){for(var f=r,e=0,s=t.length,o;u!=="["&&i<s;)i++,u=t.charAt(i);return e=i,e>0?(o=t.substring(0,e),f=n.getTableByName(o)):f=n.getTableByIndex(n.row,n.column),{table:f,charIndex:i,currentChar:u}},i._throwError=function(){throw"";},i.prototype.unParse=function(n,t){var r=this,f,o,s,u,e;if(r._referencePortions===16&&r._referenceColumnSpecifier===1){t.content+=r._baseTable.tableName();n.toStandard&&(t.content+="[]");return}f=i;o=n.source===r._baseTable.source()&&n.row>=r._baseTable.startRow()&&n.column>=r._baseTable.startColumn()&&n.row<=r._baseTable.endRow()&&n.column<=r._baseTable.endColumn();(!o||n.toStandard)&&(t.content+=r._baseTable.tableName());t.content+="[";r._referencePortions!==16&&(s=f._getPortionsString(r._referencePortions,r._referenceColumnSpecifier!==1,n.toStandard),t.content+=s);r._referenceColumnSpecifier!==1&&((r._referencePortions!==1||n.toStandard)&&r._referencePortions!==16&&(t.content+=", "),u=r._baseTable.getColumnName(r._columnReferenceStartInTable),u=f._getValidaColumnString(u),r._referenceColumnSpecifier===4?(e=r._baseTable.getColumnName(r._columnReferenceEndInTable),e=f._getValidaColumnString(e),t.content+="["+u+"]:["+e+"]"):t.content+=(r._referencePortions!==1||n.toStandard||f._containsInvalidateColumnString(u))&&r._referencePortions!==16?"["+u+"]":u);t.content+="]"},i._getPortionsString=function(n,t,i){switch(n){case 1:return i?"[#This Row]":"@";case 2:return t?"[#Headers]":"#Headers";case 3:return t?"[#Data]":"#Data";case 8:return t?"[#Totals]":"#Totals";case 6:return"[#Headers], [#Data]";case 12:return"[#Data], [#Totals]";case 14:case 16:break;default:break}return t?"[#All]":"#All"},i.prototype.offsetWhenInsertRemoveColumn=function(n,u,f){var o=this,s=o._catchedTableStartColumn,c,e;return n<s||n===s&&f||n>o._columnReferenceEndInTable+s?o:(u=f?u:-u,c=n-s,e=new i(r,r),e._baseTable=o._baseTable,e._columnReferenceEndInTable=o._columnReferenceEndInTable+u,e._columnReferenceStartInTable=o._columnReferenceStartInTable,n<=s+o._columnReferenceStartInTable&&(e._columnReferenceStartInTable+=u,e._columnReferenceStartInTable<c&&(e._columnReferenceStartInTable=c)),e._referenceColumnSpecifier=o._referenceColumnSpecifier,e._referencePortions=o._referencePortions,e._columnReferenceEndInTable<e._columnReferenceStartInTable)?new t(h):e},i.prototype.offsetWhenCopy=function(n,t){var f=this,u=new i(r,r),e;return u._baseTable=f._baseTable,u._columnReferenceEndInTable=f._columnReferenceEndInTable,u._columnReferenceStartInTable=f._columnReferenceStartInTable,f._referenceColumnSpecifier===2&&t&&(e=f._baseTable.endColumn()-f._baseTable.startColumn()+1,t%=e,u._columnReferenceStartInTable+=t,u._columnReferenceStartInTable<0&&(u._columnReferenceStartInTable+=e),u._columnReferenceEndInTable=u._columnReferenceStartInTable),u._referenceColumnSpecifier=f._referenceColumnSpecifier,u._referencePortions=f._referencePortions,u},i.prototype.offset=function(n,t,u){var e=this,f=new i(r,r);return f._baseTable=e._baseTable,f._referencePortions=e._referencePortions,f._columnReferenceStartInTable=e._columnReferenceStartInTable,f._columnReferenceEndInTable=e._columnReferenceEndInTable,f._referenceColumnSpecifier=e._referenceColumnSpecifier,f},i._structReferenceKeywordsLlowercase=["#all","#data","#headers","#totals","#this row"],i}(o);n.StructReferenceExpression=ti;ii=function(n){function t(t){n.call(this);this.nameIdentity=t.toUpperCase();this.t=25}return __extends(t,n),t}(u);n.NameIdentityExpression=ii;ri=function(n){function t(t,i){n.call(this);this.nameIdentity=i.toUpperCase();this.source=t;this.t=26}return __extends(t,n),t}(u);n.ExternalNameIdentityExpression=ri;d=function(n){function t(t,i){n.call(this);this.expr=t;this.needExpendIndexs=i;this.t=24}return __extends(t,n),t}(u);n.ExpandExpression=d;n._mappingArray=ui}(i.Expressions||(i.Expressions={}));u=i.Expressions,function(n){n[n.ThisRow=1]="ThisRow";n[n.Headers=2]="Headers";n[n.Data=3]="Data";n[n.Totals=8]="Totals";n[n.HeadersAndData=6]="HeadersAndData";n[n.DataAndTotals=12]="DataAndTotals";n[n.All=14]="All";n[n.NotSpecific=16]="NotSpecific"}(i.StructReferencePortions||(i.StructReferencePortions={}));uf=i.StructReferencePortions,function(n){n[n.All=1]="All";n[n.NotSpecific=1]="NotSpecific";n[n.SingleColumn=2]="SingleColumn";n[n.ColumnRange=4]="ColumnRange"}(i.StructReferenceColumnSpecifier||(i.StructReferenceColumnSpecifier={}));var af=i.StructReferenceColumnSpecifier,a={None:0,Sign:1,Int:2,Dot:3,Decimal:4,Exponent:5,SignExponent:6,ScientificNotation:7,Number:8},g={UppercaseLetter:0,LowercaseLetter:1,DecimalDigitNumber:8,OtherNumber:10,SpaceSeparator:11,Control:14,ConnectorPunctuation:18,DashPunctuation:19,OpenPunctuation:20,ClosePunctuation:21,InitialQuotePunctuation:22,FinalQuotePunctuation:23,OtherPunctuation:24,MathSymbol:25,currencySymbol:26,ModifierSymbol:27,OtherSymbol:28},nt=[14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,11,24,24,24,26,24,24,24,20,21,24,25,24,19,24,24,8,8,8,8,8,8,8,8,8,8,24,24,25,25,25,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,20,24,21,27,18,27,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,20,25,21,25,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,11,24,26,26,26,26,28,28,27,28,1,22,25,19,28,27,28,25,10,10,27,1,28,24,27,10,1,23,10,10,10,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,25,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,25,1,1,1,1,1,1,1,1];(function(n){n[n.Operand=0]="Operand";n[n.Function=1]="Function";n[n.Subexpression=2]="Subexpression";n[n.Argument=3]="Argument";n[n.OperatorPrefix=4]="OperatorPrefix";n[n.OperatorInfix=5]="OperatorInfix";n[n.OperatorPostfix=6]="OperatorPostfix";n[n.Whitespace=7]="Whitespace";n[n.Unknown=8]="Unknown"})(i.ExcelFormulaTokenType||(i.ExcelFormulaTokenType={}));ef=i.ExcelFormulaTokenType,function(n){n[n.Nothing=0]="Nothing";n[n.Start=1]="Start";n[n.Stop=2]="Stop";n[n.Text=3]="Text";n[n.Number=4]="Number";n[n.Logical=5]="Logical";n[n.Error=6]="Error";n[n.RangeOrName=7]="RangeOrName";n[n.Concatenation=8]="Concatenation";n[n.Intersection=9]="Intersection";n[n.Union=10]="Union";n[n.RangeOp=11]="RangeOp"}(i.ExcelFormulaTokenSubtype||(i.ExcelFormulaTokenSubtype={}));of=i.ExcelFormulaTokenSubtype;o=function(){function n(n,t,i,u){(u===f||u===r)&&(u=0);var e=this;e.value=n;e.type=t;e.index=i;e.subType=u;e.children=[]}return n}();et=function(){function n(n,t,i,u,f){this.toStandard=!1;this.ignoreError=!1;this.source=r;var e=this;e.useR1C1=t;e.row=i;e.column=u;e.option=f;this.source=n}return n.prototype.getExternalSource=function(n,t){for(var e=this.source.getCalcService(),f=e.getAllSouceModels(),u=0;u<f.length;u++)if(i.compareStringIgnoreCase(f[u].getSource().getName(),t))return f[u].getSource();return r},n.prototype.getExternalSourceToken=function(n){return n.getName()},n.prototype.getTableByName=function(n){return r},n.prototype.getTableByIndex=function(n,t){return r},n.prototype.setSource=function(n){this.source=n},n}();i.ParserContext=et;l=function(){function e(n){typeof n!==w&&n!==r&&e.setParserOption(n)}return e.setParserOption=function(n){e.listSeparator=hi(n,"listSeparator",",");e.numberDecimalSeparator=hi(n,"numberDecimalSeparator",".");e.arrayGroupSeparator=hi(n,"arrayGroupSeparator",";");e.arrayListSeparator=hi(n,"arrayListSeparator",",");e._operatorInfix="\\+-*/^&=><: "+e.listSeparator},e.getParserOption=function(){return{numberDecimalSeparator:e.numberDecimalSeparator,listSeparator:e.listSeparator,arrayGroupSeparator:e.arrayGroupSeparator,arrayListSeparator:e.arrayListSeparator}},e.prototype.parse=function(n,t){var i=this,u;return t||(t=new et(r,!1,0,0)),t.option&&e.setParserOption(t.option),u=i._parseToToken(n),i._buildExpressionTree(t,u)},e.prototype.unparse=function(n,t){if(e.unparseWithoutCulture=!1,!n)return"";t||(t=new et(r,!1,0,0));t.option&&e.setParserOption(t.option);var i={content:""};return this._unparseExpression(n,t,i),i.content},e.prototype.unparseWithoutCulture=function(n,t){if(e.unparseWithoutCulture=!0,!n)return"";t||(t=new et(r,!1,0,0));t.option&&e.setParserOption(t.option);var i={content:""};return this._unparseExpression(n,t,i),e.unparseWithoutCulture=!1,i.content},e.prototype.a1ToR1C1=function(n,t){for(var i=0,a=t.length,f,u,l,h,v,et=nt,ot=g,c=-1,b=-1,y=-1,r=!1,st,tt,s="",p=!0,k=!0,it,w,rt,ut,o,ft,d;i<a&&t.charAt(i)===" ";)i++;for(t.charAt(i)==="="&&i++,i=0;i<=a;i++)if(i!==a?(f=t[i],h=f.charCodeAt(0),v=h|32):(f="\0",h=v=0),f==="$")l||(r?(l=!0,u=r=!1):u&&(r=!0,p=!1));else if(h<127&&v>=96&&v<=122)l||(r?(l=!0,u=r=!1):u?rt.push(v):(i>0&&t.charAt(i-1)==="$"?(c=i-1,k=!1):c=i,u=!0,rt=[v]));else if(h<127&&h>=48&&h<=57||h>=127&&(et[h]===ot.DecimalDigitNumber||et[h]===ot.OtherNumber))l||(r=!0,!u&&c<0&&(i>0&&t.charAt(i-1)==="$"?(c=i-1,p=!1):c=i),y<0&&(y=i));else if(f==="'"||f==='"'||f==="[")l=u=r=!1,c=y=-1,p=k=!0,ut=f==="["?er(t,i,"[","]","'",!1):si(t,i,f,f,!1),i=ut?ut.endIndex:a-1;else if(f==="_"||f==="\\"||f==="?"||f===".")l=!0,u=r=!1;else if(l||u||r){if((u||r)&&f!=="!"){if(tt="",u&&r)tt=t.substring(y,i);else{for(o=c-1;o>=0&&t.charAt(o)===" ";)o--;if(o<=0||t.charAt(o)!==":")for(o=i;o<a&&t.charAt(o)===" ";)o++;o>0&&o<a&&t.charAt(o)===":"?r&&(tt=t.substr(y,i-1)):u=r=!1}if(r&&(it=parseInt(tt,10),it>e.maxRowCount&&(r=u=!1)),u){for(w=0,ft=rt.length-1,d=ft;d>=0;d--)w=w+(rt[d]-96)*Math.pow(26,ft-d);w>e.maxColumnCount&&(r=u=!1)}(u||r)&&(c>b+1&&(s+=t.substring(b+1,c)),b=i-1);r&&(s+="R",p&&(s+="[",it-=n.row+1),s+=it.toString(),p&&(s+="]"));u&&(s+="C",k&&(s+="[",w-=n.column+1),s+=w.toString(),k&&(s+="]"))}l=u=r=!1;c=y=-1;p=k=!0}return a>b+1&&(s+=t.substring(b+1,a)),s},e.prototype._unparseExpression=function(i,r,f){var o=this,c,h,s;if(i instanceof u.ConstantExpression)o._unparseConstantExpression(i,r,f);else if(i instanceof u.OperatorExpression)o._unParseOperatorExpressions(i,r,f);else if(i instanceof u.ReferenceExpression)o._unParseRefenceExpressions(i,r,f);else if(i.t===18)f.content+="!",f.content+=i.name;else if(i.t===9)c=i.source,o._unparseSource(c,r,f),f.content+="!",h=i.name,f.content+=h;else if(i.t===8)h=i.name,f.content+=h;else if(i.t===14)f.content+="(",o._unparseExpression(i.argument,r,f),f.content+=")";else if(i.t===7){for(f.content+=i.getFunctionName(),f.content+="(",s=0;s<i.argCount();s++)s!==0&&(f.content+=e.unparseWithoutCulture?",":n.Sheets.CR.listSeparator),o._unparseExpression(i.getArg(s),r,f);f.content+=")"}else throw t.SR.Exp_NotSupport;},e.prototype._unparseSource=function(n,t,i){t.getExternalSourceToken&&(i.content+=this._getValidSource(t,t.getExternalSourceToken(n),t.useR1C1))},e.prototype._unparseSource2=function(n,t,i,r){var u=this,f={content:""};u._unparseSource(n,i,f);var s=u._removeApostrophe(f),h=u._removeWorkbook(f),c=h.success,o=h.workBookName,e={content:""};u._unparseSource(t,i,e);s|=u._removeApostrophe(e);o=u._removeWorkbook(e).workBookName;s?(r.content+="'",c&&(r.content+=o),r.content+=f.content,r.content+=":",r.content+=e.content,r.content+="'"):(c&&(r.content+=o),r.content+=f.content,r.content+=":",r.content+=e.content)},e.prototype._getValidSource=function(n,t,i){if(t===f||t===r||t==="")return"";var u=this._readSheetReference(n,t,i,!0),e=t.length;return u.success?(t.charAt(0)==="'"&&t.charAt(e-1)==="'"&&(t=t.substr(1,e-2),t=t.replace("'","''"),t="'"+t+"'"),t):(u=this._readSheetReference(n,"'"+t+"'",i,!0),u.success)?(t=t.replace("'","''"),"'"+t+"'"):""},e.prototype._unParseRefenceExpressions=function(n,i,r){var e=this,h=i.row,c=i.column,a,v,l,o,s,f,u;if(n.t===22)r.content+="!",a=n,e._unParseCell(i.useR1C1,h,c,a.row,a.column,a.rowRelative,a.columnRelative,r);else if(n.t===0)v=n,e._unParseCell(i.useR1C1,h,c,v.row,v.column,v.rowRelative,v.columnRelative,r);else if(n.t===1)l=n,e._unparseSource(l.source,i,r),r.content+="!",e._unParseCell(i.useR1C1,h,c,l.row,l.column,l.rowRelative,l.columnRelative,r);else if(n.t===23)r.content+="!",o=n,e._unParseRange(i.useR1C1,h,c,o.startRow,o.startColumn,o.endRow,o.endColumn,o.startRowRelative,o.startColumnRelative,o.endRowRelative,o.endColumnRelative,r,o._getRangeType());else if(n.t===2)s=n,e._unParseRange(i.useR1C1,h,c,s.startRow,s.startColumn,s.endRow,s.endColumn,s.startRowRelative,s.startColumnRelative,s.endRowRelative,s.endColumnRelative,r,s._getRangeType());else if(n.t===3)f=n,e._unparseSource(f.source,i,r),r.content+="!",e._unParseRange(i.useR1C1,h,c,f.startRow,f.startColumn,f.endRow,f.endColumn,f.startRowRelative,f.startColumnRelative,f.endRowRelative,f.endColumnRelative,r,f._getRangeType());else if(n.t===16)u=n,e._unparseSource2(u.startSource,u.endSource,i,r),r.content+="!",e._unParseRange(i.useR1C1,h,c,u.startRow,u.startColumn,u.endRow,u.endColumn,u.startRowRelative,u.startColumnRelative,u.endRowRelative,u.endColumnRelative,r,u._getRangeType());else if(n.t===17)n.unParse(i,r);else throw t.SR.Exp_NotSupport;},e.prototype._removeApostrophe=function(n){var t=n.content,i=t.length;return t.charAt(i-1)==="'"?(n.content=t.substr(1,i-2),!0):!1},e.prototype._removeWorkbook=function(n){if(n.content.charAt(0)!=="[")return{success:!1,workBookName:""};var t=n.content.indexOf("]"),i=n.content.substr(0,t+1);return n.content=n.content.substr(t),{success:!0,workBookName:i}},e.prototype._unParseCell=function(n,t,i,u,o,s,l,a,v){var g,b,k,p,y,w,d,nt,tt;if((v===f||v===r)&&(v=c.cell),g=e.BAND_INDEX_CONST,b=e.maxRowCount-1,(v===c.cell||v===c.row)&&u!==g&&u>-b&&u<=2*b&&(u+=s?t:0,u=hu(u,b)),k=e.maxColumnCount-1,(v===c.cell||v===c.column)&&o!==g&&o>-k&&o<=2*k&&(o+=l?i:0,o=hu(o,k)),this._isCellIndexsError(t,i,u,o,s,l,v)){a.content+=h.toString();return}if(p="",y="",n){if(p="R",u>=0&&(t!==u||!s)&&(s?p=p+"["+(u-t)+"]":(u++,p=p+u)),o<0){a.content+=p;return}if(y="C",i===o&&l||(l?y=y+"["+(o-i)+"]":(o++,y=y+o)),s&&u<0||!s&&u<=0){a.content+=y;return}a.content+=p;a.content+=y}else{if(u++,p=""+u,s||(p="$"+u),o<0){a.content+=p;return}for(w=o,d=1,nt=li.length;d<nt;d++)tt=li[nt-d],o=parseInt(w/tt,10),w=w%tt,o!==0&&(y=y+String.fromCharCode(o+65-1));if(y=y+String.fromCharCode(w+65),l||(y="$"+y),u<=0){a.content+=y;return}a.content+=y;a.content+=p}},e.prototype._isCellIndexsError=function(n,t,i,r,u,f,e){var o=!1;switch(e){case c.sheet:break;case c.cell:o|=i<0;o|=r<0;break;case c.row:o|=i<0;break;case c.column:o|=r<0;break}return o},e.prototype._unParseRange=function(n,t,i,u,o,s,h,l,a,v,y,p,w){(w===f||w===r)&&(w=c.cell);this._unParseCell(n,t,i,u,o,l,a,p,w);var b=e.BAND_INDEX_CONST;n&&u===s&&o===h&&(s===b||h===b)||(s!==b||h!==b)&&(p.content+=":",this._unParseCell(n,t,i,s,h,v,y,p,w))},e.prototype._unParseOperatorExpressions=function(n,i,r){var u=this,s,f,o;if(n.t===11)s=n.operator,s===v.percent?(u._unparseExpression(n.operand,i,r),r.content+=s.name):(r.content+=s.name,u._unparseExpression(n.operand,i,r));else if(n.t===10){f={content:""};o={content:""};u._unparseExpression(n.right,i,o);var c=n.left.t===10,l=n.right.t===10,h=ti(n.operator.name);c&&ti(n.left.operator.name)>h?(f.content+="(",u._unparseExpression(n.left,i,f),f.content+=")"):u._unparseExpression(n.left,i,f);l&&ti(n.right.operator.name)>h&&(o.content+="(",u._unparseExpression(n.right,i,o),o.content+="(");r.content+=f.content;r.content+=n.operator.t===11?e.listSeparator:n.operator.name;r.content+=o.content}else throw t.SR.Exp_NotSupport;},e.prototype._unparseConstantExpression=function(i,o,s){var p=this,w=t.SR.Exp_InvalidArray,v,c,b,k,l,a,d,h;if(i.t===5)s.content+='"',s.content+=i.value,s.content+='"';else if(i.t===4)v=i.originalValue,e.unparseWithoutCulture||(v=t._NumberHelper.replaceNormalToCultureSymble(v.toString())),s.content+=v;else if(i.t===6)s.content+=i.value?bt:kt;else if(i.t===15){if(s.content+="{",c=i.value,c.getRowCount()<=0)throw w;for(b=e.BAND_INDEX_CONST,k=b,l=0;l<c.getRowCount();l++)for(l>=1&&(s.content+=e.unparseWithoutCulture?";":n.Sheets.CR.arrayGroupSeparator),a=0;a<c.getColumnCount();a++){if(k!==b&&(k!==c.getColumnCount()||c.getColumnCount()===0))throw w;if(a!==0&&(d=e.unparseWithoutCulture?",":n.Sheets.CR.arrayListSeparator,s.content+=d),h=c.getValue(l,a),h===f||h===r)throw w;h instanceof u.Expression?p._unparseExpression(h,o,s):typeof h===y?(s.content+='"',s.content+=h,s.content+='"'):s.content+=typeof h===tt?h?bt:kt:e.unparseWithoutCulture||typeof h!==ot?h.toString():t._NumberHelper.replaceNormalToCultureSymble(h.toString())}s.content+="}"}else if(i.t===13)p._unparseSource(i.source,o,s),s.content+="!",s.content+=i.value.toString();else if(i.t===19)p._unparseSource2(i.startSource,i.endSource,o,s),s.content+="!",s.content+=i.value.toString();else if(i.t===20)s.content+="!",s.content+=i.value.toString();else if(i.t===12)s.content+=i.value.toString();else if(i.t!==21)throw t.SR.Exp_NotSupport;},e.prototype._parseToToken=function(n,i){var r,f,p,g,rt,w,ut,k,nt,ft,tt,b,it;typeof i=="undefined"&&(i=!0);for(var et=this,y=n.length,s=[],v=[],l=-1,u="",c,h=0,d=0,a;d<y&&n.charAt(d)===" ";)d++;for(n.charAt(d)==="="&&d++,h=d,r=d;r<y;r++)if(f=n.charAt(r),f==='"')p=si(n,r,'"','"',i),p?(s.push(new o(p.result,0,r+1,3)),r=p.endIndex,h=r+1):(u+=n.substring(r,y),r=y-1);else if(f==="'")p=si(n,r,"'","'",i),p?(u+="'",u+=p.result,u+="'",r=p.endIndex):(u+="'",r=r+1);else if(f==="[")if(p=er(n,r,"[","]","'",i),p)u+=p.result,u+="]",r=p.endIndex;else{if(u==="R"||u==="r"||u==="C"||u==="c")continue;u+=n.substring(r,y);r=y-1}else if(f==="\r"||f==="\n")continue;else if(f==="#")g=ou(n,r),g?(rt=r<y?n.charAt(r+1):'\0',r>0&&n.charAt(r-1)==="!"?u+=g.result:ci===g.result.toUpperCase()&&r<y&&(fr(rt)||rt==="$")?u+=g.result:(s.push(new o(g.result,0,r,6)),h=r+1),r=g.endIndex):u+=f;else if(f==="+"||f==="-")w=s.length===0?null:s[s.length-1],u.length!==0?(s.push(new o(u,0,h)),s.push(new o(f,5,r)),u="",h=r+1):(w&&w.type===7&&(s.pop(),w=s[s.length-1]),w&&(w.type===1&&w.subType===2||w.type===2&&w.subType===2||w.type===6||w.type===0)?(s.push(new o(f,5,r)),h=r+1):(s.push(new o(f,4,r)),h=r+1));else if(f===e.numberDecimalSeparator||ur(f))if(u.length>0)u+=f;else if((ut=ff(n,r,e.numberDecimalSeparator)).result){for(k=ut.endIndex,nt=n.slice(r,k+1),e.numberDecimalSeparator!=="."&&(nt=t._NumberHelper.replaceCultureSymbolToNormal(nt));k<=y-2&&n.charAt(k+1)===" ";)k++;k<=y-2&&n.charAt(k+1)===":"?(u+=nt,u+=":",k++,h=r):(s.push(new o(nt,0,r,4)),h=r+1);r=k}else u+=f;else if(f==="{"){if(u.length>0&&i)throw t._StringHelper.format(t.SR.Exp_FormulaInvalid,[f,r]);c=new o(vt,1,r,1);s.push(c);v[++l]=c;c=new o(st,1,r,1);s.push(c);v[++l]=c;h=r+1}else if(f===e.arrayGroupSeparator&&l>=0&&(v[l].value===vt||v[l].value===st)){if(u.length>0&&(s.push(new o(u,0,h)),u=""),l<0&&i)throw t._StringHelper.format(t.SR.Exp_FormulaInvalid,[f,r]);a=v[l--];a=new o(f,a.type,r,2);s.push(a);s.push(new o(e.listSeparator,3,r));c=new o(st,1,r+1,1);s.push(c);v[++l]=c;h=r+1}else if(f==="}"){if(u.length>0&&(s.push(new o(u,0,h)),u=""),k<0&&i)throw t._StringHelper.format(t.SR.Exp_FormulaInvalid,[f,r]);a=v[l--];a=new o(f,a.type,r,2);s.push(a);a=v[l--];a=new o(f,a.type,r,2);s.push(a);h=r+1}else if(f===" "){for(ft=r,r++;r<y&&u.charAt(u.length-1)===" ";)r++;u.length>0&&u.charAt(u.length-1)!==":"&&r<y&&n.charAt(r)!==":"&&(s.push(new o(u,0,h)),u="",s.push(new o("",7,ft)));h=r;r--}else if(r+2<=y&&f==="<"&&n.charAt(r+1)==="="||f===">"&&n.charAt(r+1)==="="||f==="<"&&n.charAt(r+1)===">")u.length>0&&(s.push(new o(u,0,h)),u=""),s.push(new o(n.slice(r,r+2),5,r,5)),r++,h=r+1;else if(f==="%")u.length>0&&(s.push(new o(u,0,h)),u=""),s.push(new o(n.charAt(r),6,r)),h=r+1;else if(f==="+"||f==="-"||f==="*"||f==="/"||f==="="||f===">"||f==="<"||f==="&"||f==="^")u.length>0&&(s.push(new o(u,0,h)),u=""),s.push(new o(f,5,r)),h=r+1;else if(f==="(")u.length>0?(tt=u.charAt(u.length-1),tt===":"||tt===e.listSeparator||tt===" "?(u=u.slice(0,u.length-1),s.push(new o(u,0,h,7)),s.push(new o(tt,5,r-1,0)),c=new o("",2,r,1),s.push(c),v[++l]=c):(b=u.indexOf(":"),it=":",b===-1&&(b=u.indexOf(e.listSeparator),it=e.listSeparator),b===-1&&(b=u.indexOf(" "),it=" "),b!==-1&&b>0?(s.push(new o(u.substr(0,b),0,h,7)),s.push(new o(it,5,h+b,0)),u=u.slice(b+1),c=new o(u.toUpperCase(),1,h+b+1,1),s.push(c),v[++l]=c):(c=new o(u.toUpperCase(),1,r-u.length,1),s.push(c),v[++l]=c)),u=""):(c=new o("",2,r,1),s.push(c),v[++l]=c),h=r+1;else if(f===e.listSeparator||f===e.arrayListSeparator||f===e.arrayGroupSeparator)u.length>0&&(s.push(new o(u,0,h)),u=""),l<0||v[l].type!==1?s.push(new o(e.listSeparator,5,r,10)):s.push(new o(e.arrayListSeparator,3,r)),h=r+1;else if(f===")"){if(u.length>0&&(s.push(new o(u,0,h)),u=""),l<0&&i)throw t._StringHelper.format(t.SR.Exp_FormulaInvalid,[f,r]);a=v[l--];a=new o(f,a.type,r,2);s.push(a);h=r+1}else f===":"?u.length===0&&s[s.length-1].subType===2?(s.push(new o(":",5,r,11)),h=r+1):u+=":":u+=f;return u.length>0&&s.push(new o(u,0,h)),et._processTokens(s,i)},e.prototype._processTokens=function(n,i){var h=this._removeWhiteSpace(n),s=[],y=new o("",8,0,1),l,v,e,u,f,c,a,p;for(s.push(y),v=h.length,e=0;e<v;e++)if(u=h[e],u){if(f=e===0?r:h[e-1],c=e===v-1?r:h[e+1],u.type===0&&u.subType===0?(a=u.value.toUpperCase(),a===bt||a===kt?(u.subType=5,u.value=a):u.subType=7):u.type===1&&u.value.length>0&&u.value.charAt(0)==="@"&&(u.value=u.value.substr(1)),s.length===0&&i)throw t._StringHelper.format(t.SR.Exp_InvalidTokenAt,[u.index]);if(l=s[s.length-1],l.value===st&&i&&u.type!==3&&u.subType!==6&&u.subType!==2&&u.subType!==5&&u.subType!==4&&u.subType!==3&&u.type!==4)throw t._StringHelper.format(t.SR.Exp_InvalidArrayAt,[u.index]);switch(u.type){case 0:if(i&&f&&(f.type===0||f.type===6||f.type===1&&f.subType===2||f.type===2&&f.subType===2))throw t._StringHelper.format(t.SR.Exp_InvalidTokenAt,[u.index]);break;case 1:case 2:if(u.value!==vt||u.type!==1||u.subType!==1||f){if(i&&(u.subType===2&&(!f||f.type===4||f.type===5)||u.subType===1&&f&&(!c||f.type===6||f.subType===2||f.type===0)))throw t._StringHelper.format(t.SR.Exp_InvalidTokenAt,[u.index]);}else break;if(i&&u.subType===2&&u.type===2&&f.subType===1)throw t._StringHelper.format(t.SR.Exp_InvalidTokenAt,[u.index]);if(i&&u.subType===2&&u.type===1&&f.type===2&&f.subType===1)throw t._StringHelper.format(t.SR.Exp_InvalidTokenAt,[u.index]);if(i&&u.subType===1&&f&&(f.type===1&&f.subType===2||f.type===0||f.type===6))throw t._StringHelper.format(t.SR.Exp_InvalidTokenAt,[u.index]);break;case 3:if(i&&(!c||!f||f.type===5||f.type===4))throw t._StringHelper.format(t.SR.Exp_InvalidTokenAt,[u.index]);break;case 4:if(i&&(!c||f&&f.type===6))throw t._StringHelper.format(t.SR.Exp_InvalidTokenAt,[u.index]);break;case 5:if(i&&(!c||!f||f.type===5||f.type===4||f.type===3||f.type===1&&f.subType===1||f.type===2&&f.subType===1))throw t._StringHelper.format(t.SR.Exp_InvalidTokenAt,[u.index]);break;case 6:if(i&&(!f||f.type===4||f.type===5||f.type===1&&f.subType===1||f.type===2&&f.subType===1))throw t._StringHelper.format(t.SR.Exp_InvalidTokenAt,[u.index]);break;default:if(i)throw t._StringHelper.format(t.SR.Exp_InvalidTokenAt,[u.index]);}if(i)if(u.subType===1)s.push(u),l.children.push(u);else if(u.subType===2){if(s.length===0&&(p=u.value===vt||u.value===st?"}":")",i))throw t._StringHelper.format(t.SR.Exp_FormulaInvalid,[p,u.index]);s.pop()}else l.children.push(u)}return i?y.children:h},e.prototype._removeWhiteSpace=function(n){for(var f,i,u,e=[],s=n.length,t=0;t<s;t++)if(f=n[t],f){if(f.type!==7){e.push(f);continue}(i=t==0?r:n[t-1],u=t==s-1?r:n[t+1],i&&u)&&(i.type===1&&i.subType===2||i.type===2&&i.subType===2||i.type===0)&&(u.type===1&&u.subType===1||u.type===2&&u.subType===1||u.type===0)&&e.push(new o(" ",5,f.index,9))}return e},e.prototype._buildExpressionNode=function(n,t){var r=this,i;return t.type===1?i=t.value===vt?r._buildArraryExpression(n,t):r._buildFunctionExpression(n,t):t.type===2?i=r._buildSubExpression(n,t):t.type===0&&(t.subType===4?i=new u.DoubleExpression(parseFloat(t.value),t.value):t.subType===6?i=new u.ErrorExpression(b.parse(t.value)):t.subType===5?ei(t.value,bt)?i=new u.BooleanExpression(!0):ei(t.value,kt)&&(i=new u.BooleanExpression(!1)):i=t.subType===7?r._buildCellReferenceOrNameExpressions(n,t.value,t.index):new u.StringExpression(t.value)),i},e.prototype._buildExpressionTree=function(n,t){for(var r=this._parseToBinaryOperatorList(n,t),f,e,o,s,h,i=3;i<r.length;)if(s=r[i],h=r[i-2],s&&s.type===5){while(i>=3&&ti(s.value)>=ti(h.value))e=r[i-3],o=r[i-1],f=new u.BinaryOperatorExpression(su(h),e,o),r.splice(i-3,3),r.splice(i-3,0,f),i-=2,i>=3&&(h=r[i-2]);i+=2}else i++;if(r.length===1)return r[0];else{for(i=r.length-2;i>0;i-=2)e=r[i-1],o=r[i+1],f=new u.BinaryOperatorExpression(su(r[i]),e,o),r.splice(i-1,3),r.push(f);return f}},e.prototype._parseToBinaryOperatorList=function(n,t){for(var i,o,s,h,r=[],f,e=0;e<t.length;e++)if(i=t[e],i.type===4){for(o=[];i.type===4;)o.push(i.value==="+"?v.plus:v.negate),e++,i=t[e];for(s=t[e],f=new u.UnaryOperatorExpression(o.pop(),this._buildExpressionNode(n,s));o.length>0;)f=new u.UnaryOperatorExpression(o.pop(),f);r.push(f)}else i.type===6?(h=r[r.length-1],f=new u.UnaryOperatorExpression(v.percent,h),r.pop(),r.push(f)):i.type===5?r.push(i):(f=this._buildExpressionNode(n,i),r.push(f));return r},e.prototype._buildFunctionExpression=function(n,i){for(var s,f,h,r=[],e=[],o=0;o<i.children.length;o++)s=i.children[o],s.type!==3?e.push(s):e.length===0?r.push(new u.MissingArgumentExpression):(r.push(this._buildExpressionTree(n,e)),e=[]);if(e.length!==0?r.push(this._buildExpressionTree(n,e)):i.children.length!==0&&r.push(new u.MissingArgumentExpression),f=nr.findGlobalFunction(i.value),f||(f=n.source.getCustomFunction(i.value)),f){if(h=r.length,h<f.minArgs||h>f.maxArgs)throw t._StringHelper.format(t.SR.Exp_InvalidParameters,[i.index]);return new u.FunctionExpression(f,r)}else return new u.FunctionExpression(i.value,r)},e.prototype._buildSubExpression=function(n,t){return new u.ParenthesesExpression(this._buildExpressionTree(n,t.children))},e.prototype._buildArraryExpression=function(n,e){for(var v,w,s,h,a,g,c=[],k=-1,o,d=e.children,nt=d.length,l=0;l<nt;l++){if(o=d[l],v=l===0?r:d[l-1],o.type===3){if(!v||v.type===3||l===nt-1)throw t._StringHelper.format(t.SR.Exp_InvalidArrayAt,[o.index]);continue}else if(v&&v.type!==3)throw t._StringHelper.format(t.SR.Exp_InvalidArrayAt,[o.index]);else if(o.type!==1||o.value!==st)throw t._StringHelper.format(t.SR.Exp_InvalidArrayAt,[o.index]);else if(k!==-1&&o.children.length!==k)throw t._StringHelper.format(t.SR.Exp_InvalidArrayColumns,[o.index]);else k=o.children.length;w=[];c.push(w);var y=o.children,b=y.length,p=r;for(s=0;s<b;s++){if(h=y[s],h.type===3)p&&p.type!==3&&s!==b-1||w.push(i.missingArgument);else if(p&&p.type!==3)throw t._StringHelper.format(t.SR.Exp_InvalidArrayAt,[o.index]);else{if(h.type===4){if(s+1>=b)throw t._StringHelper.format(t.SR.Exp_InvalidArrayAt,[o.index]);a=y[s+1];a.value=""+h.value+a.value;h=a;s++}else s+1<b&&y[s+1].type===6&&(a=y[s+1],h.value=""+h.value+a.value,s++);g=this._buildExpressionNode(n,h);g&&w.push(g.value)}p=h}}if(c.length===0||c[0]===f||c[0]===r||c[0].length===0)throw t._StringHelper.format(t.SR.Exp_InvalidArrayAt,[o.index]);return new u.ArrayExpression(c)},e.prototype._buildCellReferenceOrNameExpressions=function(n,i,r){var s=this._buildCellReferenceOrNameExpressions2(n,i,r),f=s.endIndex,e=s.expression,c=i.length,o,l,h;if(!e)throw t._StringHelper.format(t.SR.Exp_InvalidCellReference,[r]);if(f<=0||f>=c)return e;if(i.charAt(f)!==":")throw t._StringHelper.format(t.SR.Exp_InvalidCellReference,[r]);for(f++,o=[],o.push(e);f>0&&f<c;){if(l=f,s=this._buildCellReferenceOrNameExpressions2(n,i.substr(f),r),f=s.endIndex,e=s.expression,!e)throw t._StringHelper.format(t.SR.Exp_InvalidCellReference,[r]);if(o.push(e),f+=l,f<c&&i.charAt(f)!==":")throw t._StringHelper.format(t.SR.Exp_InvalidCellReference,[r]);f++}for(e=o[0],h=1;h<o.length;h++)e=new u.BinaryOperatorExpression(v.range,e,o[h]);return e},e.prototype._buildCellReferenceOrNameExpressions2=function(n,t,e){var b=this,c,g,it,p,ut,ft,rt,tt,ot,st,et,ht,l,d,ct,lt,at;if(t===f||t===r||t==="")return{endIndex:0,expression:r};if(c=t.length,t.length>=5&&t.substr(0,5)==="#REF!")return{endIndex:c,expression:new u.ErrorExpression(h)};if(g=t.charAt(0)==="!",it=g?1:0,c<1)return{endIndex:0,expression:r};var y=-1,nt="",o=0;if(g)y=it;else if(t.charAt(0)==="'")y=t.indexOf("!")+1,nt=t.substr(0,y-1);else if(p=t.indexOf("!"),l=t.indexOf(":"),p!==-1)if(ut=t.substr(it,p-it),l<0||p<l)p<c-1&&(nt=ut,y=p+1);else{if(ft=b._parseToCellReference(n,ut,g),ft.expression)return ft;else p<c-1&&(nt=ut,y=p+1);o=ft.endIndex}var k="",a="",w="";if(y!==-1&&nt&&nt!==""){if(rt=b._readSheetReference(n,nt,n.useR1C1,!1),!rt.success)return{endIndex:o,expression:r};k=rt.workBookName;a=rt.startSheetName;w=rt.endSheetName}else y=it;if(et=!1,(k&&k!==""||a&&a!=="")&&(et=!0,n.getExternalSource&&(ot=n.getExternalSource(k,a),!ot)))return{endIndex:o,expression:new u.ErrorExpression(h)};if(w&&w!==""&&(et=!0,n.getExternalSource&&(st=n.getExternalSource(k,w),!st)))return{endIndex:o,expression:new u.ErrorExpression(h)};var v=t.substr(y),vt=b._parseToCellReference(n,v,g,ot,st),s=vt.expression;if(o=vt.endIndex,s)if(!et||s.t===16||s instanceof u.ExternalReferenceExpression||s.t===13||s.t===19||s.t===9)if(o<v.length-1){if(o=c-(v.length-o),t.charAt(o)!==":"){if(a&&a!==""){if(w&&w!=="")return{endIndex:o,expression:r};if(!n.getExternalSource)return{endIndex:o,expression:new u.ErrorExpression(h)};if(tt=n.getExternalSource(k,a),!tt)return{endIndex:o,expression:new u.ErrorExpression(h)};s=new u.ExternalNameExpression(tt,v)}else s=new u.NameExpression(v);o=c}}else o=c;else return{endIndex:c,expression:new u.ErrorExpression(h)};else{for(l=-1,d=0;d<t.length;d++)if(ht=t[d],ht==="[")ct=er(t,d,"[","]","'"),ct&&(d=ct.endIndex);else if(ht===":"){l=d;break}if(g)s=new u.BangNameExpression(v);else if(a&&a!==""){if(w&&w!=="")return{endIndex:o,expression:r};if(!n.getExternalSource)return{endIndex:o,expression:new u.ErrorExpression(h)};if(tt=n.getExternalSource(k,a),!tt)return{endIndex:o,expression:new u.ErrorExpression(h)};s=new u.ExternalNameExpression(tt,v)}else if(l>0)if(lt=t.substr(0,l),n.ignoreError||b._validateName(lt))return s=new i.Expressions.BinaryOperatorExpression(i.Operators.range,new i.Expressions.NameExpression(lt),b._buildCellReferenceOrNameExpressions(n,t.substr(l+1),e+l+1)),{range1EndIndex:l,endIndex:c,expression:s};else s=r;else s=new u.NameExpression(v);o=c}if(s&&(s.t===9||s.t===8))if(at=b._createStructExpression(n,v,e),at)s=at;else if(!n.ignoreError&&!b._validateName(v))return{endIndex:o,expression:r};return{endIndex:o,expression:s}},e.prototype._parseToCellReference=function(n,t,i,u,f){var h=this,a=0,c,l,o,s,v;if(t.charAt(0)==="#"&&(c=ou(t,0),a=c.endIndex+1,l=b.parse(c.result),l))return{endIndex:a,expression:h._createExternalErrorExpression(l,i,u,f)};if(o=n.useR1C1?h._isR1C1CellReferance(t,n.row,n.column):h._isA1CellReferance(t),s=e.BAND_INDEX_CONST,o.success&&n.useR1C1&&o.startRow!==s&&o.startColumn===s&&o.endRow===s&&o.endColumn===s)o.endRow=o.startRow,o.endRowRelative=o.startRowRelative;else if(o.success&&n.useR1C1&&o.startColumn!==s&&o.startRow===s&&o.endRow===s&&o.endColumn===s)o.endColumn=o.startColumn,o.endColumnRelative=o.startColumnRelative;else if(!o.success||o.startRow===s&&(o.startColumn===s||o.endColumn===s)||o.startColumn===s&&o.endRow===s)return{endIndex:o.endIndex,expression:r};return v=h._createCellReferenceExpression(n,n.row,n.column,o.startRow,o.startColumn,o.endRow,o.endColumn,o.startRowRelative,o.startColumnRelative,o.endRowRelative,o.endColumnRelative,i,u,f),{endIndex:o.endIndex,expression:v}},e.prototype._createExternalErrorExpression=function(n,t,i,r){return t?new u.BangErrorExpression(n):i&&r?new u.SheetRangeErrorExpression(i,r,n):i?new u.ExternalErrorExpression(i,n):new u.ErrorExpression(n)},e.prototype._createCellReferenceExpression=function(n,t,i,f,o,s,h,c,l,a,v,y,p,w){var b=e.BAND_INDEX_CONST,k,d,g;return f!==b&&s!=b&&f>s&&(d=f,f=s,s=d,g=c,c=a,a=g),o!==b&&h!=b&&o>h&&(d=o,o=h,h=d,g=l,l=v,v=g),f-=f!==b&&c?t:0,o-=o!=b&&l?i:0,s-=s!==b&&a?t:0,h-=h!==b&&v?i:0,p&&w?(k=new u.SheetRangeExpression(p,w),f===b?k.initBand(p,w,o,h,l,v,!1):o===b?k.initBand(p,w,f,s,c,a,!0):((s===b||h===b)&&(s=f,h=o),k.init(p,w,f,o,s,h,c,l,a,v)),k):s===b&&h===b?y?p||w?r:new u.BangCellExpression(f,o,c,l):p?new u.ExternalCellExpression(p,f,o,c,l):new u.CellExpression(f,o,c,l):y?p&&w?r:(k=new u.BangRangeExpression,f===b?k.initBand(o,h,l,v,!1):o===b?k.initBand(f,s,c,a,!0):k.init(f,o,s,h,c,l,a,v),k):p?(k=new u.ExternalRangeExpression,f===b?k.initBand(p,o,h,l,v,!1):o===b?k.initBand(p,f,s,c,a,!0):k.init(p,f,o,s,h,c,l,a,v),k):(k=new u.RangeExpression,f===b?k.initBand(o,h,l,v,!1):o===b?k.initBand(f,s,c,a,!0):k.init(f,o,s,h,c,l,a,v),k)},e.prototype._readSheetReference=function(n,t,i,r){var u={success:!1,startSheetName:"",endSheetName:"",workBookName:""},e=!1,l=t.length,f,c,o,s,h;return(t.charAt(0)==="'"&&t.charAt(l-1)==="'"&&(e=!0,t=t.substr(1,l-2)),f=t.indexOf("["),f!==-1&&(f!==0&&(u.workBookName=t.substr(0,f),u.workBookName.charAt(f-1)!=="\\"&&(u.workBookName=u.workBookName+"\\")),c=si(t,f,"[","]"),u.workBookName=u.workBookName+c.result,t=t.substr(c.endIndex+1)),o=t.indexOf(":"),o===-1?u.startSheetName=t:(u.startSheetName=t.substr(0,o),u.endSheetName=t.substr(o+1)),!u.startSheetName||u.startSheetName==="")?(u.success=!1,u):(s=this,h=s._validateWorkbook(u.workBookName,e),h=n.ignoreError&&!r||s._validateSheetName(u.startSheetName,i,e),h&=n.ignoreError&&!r||s._validateSheetName(u.endSheetName,i,e),r&&(u.startSheetName&&(u.startSheetName=u.startSheetName.replace("'","''")),u.endSheetName&&(u.endSheetName=u.endSheetName.replace("'","''"))),u.success=h,u)},e.prototype._isStartWithCellReference=function(n,t){return t?this._isR1C1CellReferance(n):this._isA1CellReferance(n)},e.prototype._isA1CellReferance=function(n){var u=this,s=e.BAND_INDEX_CONST,t={startRow:s,startColumn:s,endRow:s,endColumn:s,startRowRelative:!0,startColumnRelative:!0,endRowRelative:!0,endColumnRelative:!0,success:!1,endIndex:0},h,r,i,c,l,a,f,o;if(n=n.replace(" ",""),h=n.length,r=u._readOneA1Element(n,0),t.endIndex=r.endIndex,!r.success||t.endIndex>h)return t;if(r.isRow)return t.startRow=r.elementIndex,t.startRowRelative=r.isRelative,n.charAt(t.endIndex)===":"?(t.endIndex++,i=u._readOneA1Element(n,t.endIndex),t.endIndex=i.endIndex,!i.success||!i.isRow)?t:(t.endRow=i.elementIndex,t.endRowRelative=i.isRelative,t.success=!0,t):t;else if(t.startColumn=r.elementIndex,t.startColumnRelative=r.isRelative,n.charAt(t.endIndex)===":")return(t.endIndex++,i=u._readOneA1Element(n,t.endIndex),t.endIndex=i.endIndex,!i.success||i.isRow)?t:(t.endColumn=i.elementIndex,t.endColumnRelative=i.isRelative,t.success=!0,t);if(ni(n.charAt(t.endIndex))||n.charAt(t.endIndex)==="$"){if(i=u._readOneA1Element(n,t.endIndex),t.endIndex=i.endIndex,!i.success||!i.isRow)return t;if(t.startRow=i.elementIndex,t.startRowRelative=i.isRelative,c=t.endIndex,t.endIndex<h-1&&n.charAt(t.endIndex)===":"){if(n.charAt(t.endIndex+1)==="'"||(l=n.indexOf("!",t.endIndex+1),a=n.indexOf(":",t.endIndex+1),l!==-1&&(a===-1||a>l)))return t.success=!0,t;if(t.endIndex++,f=u._readOneA1Element(n,t.endIndex),!f.success||f.isRow)return t.endIndex=c,t.success=!0,t;else t.endIndex=f.endIndex;if(t.endColumn=f.elementIndex,t.endColumnRelative=f.isRelative,o=u._readOneA1Element(n,t.endIndex),o.success&&o.isRow)t.endIndex=o.endIndex;else return t.endIndex=c,t.endColumn=s,t.success=!0,t;return t.endRow=o.elementIndex,t.endRowRelative=o.isRelative,t.success=!0,t}else return t.success=!0,t}else return t},e.prototype._isR1C1CellReferance=function(n,t,i){var o=this,c=e.BAND_INDEX_CONST,r={startRow:c,startColumn:c,endRow:c,endColumn:c,startRowRelative:!0,startColumnRelative:!0,endRowRelative:!0,endColumnRelative:!0,success:!1,endIndex:0},l,f,u,a,v,y,s,h;if(n=n.replace(" ",""),l=n.length,f=o._readOneR1C1Element(n,t,i,0),r.endIndex=f.endIndex,!f.success)return r;if(f.isRow){if(r.startRow=f.elementIndex,r.startRowRelative=f.isRelative,r.endIndex>=l)return r.success=!0,r;if(n.charAt(r.endIndex)===":")return(r.endIndex++,u=o._readOneR1C1Element(n,t,i,r.endIndex),r.endIndex=u.endIndex,!u.success||!u.isRow)?r:(r.endRow=u.elementIndex,r.endRowRelative=u.isRelative,r.success=!0,r)}else return(r.startColumn=f.elementIndex,r.startColumnRelative=f.isRelative,r.endIndex>=l)?(r.success=!0,r):n.charAt(r.endIndex)===":"?(r.endIndex++,u=o._readOneR1C1Element(n,t,i,r.endIndex),r.endIndex=u.endIndex,!u.success||u.isRow)?r:(r.endColumn=u.elementIndex,r.endColumnRelative=u.isRelative,r.success=!0,r):r;if(n.charAt(r.endIndex)==="C"||n.charAt(r.endIndex)==="c"){if(u=o._readOneR1C1Element(n,t,i,r.endIndex),r.endIndex=u.endIndex,!u.success||u.isRow)return r;if(r.startColumn=u.elementIndex,r.startColumnRelative=u.isRelative,a=r.endIndex,r.endIndex<l-1&&n.charAt(r.endIndex)===":"){if(n.charAt(r.endIndex+1)==="'"||(v=n.indexOf("!",r.endIndex+1),y=n.indexOf(":",r.endIndex+1),v!==-1&&(y===-1||y>v)))return r.success=!0,r;if(r.endIndex++,s=o._readOneR1C1Element(n,t,i,r.endIndex),s.success&&s.isRow)r.endIndex=s.endIndex;else return r.endIndex=a,r.success=!0,r;if(r.endRow=s.elementIndex,r.endRowRelative=s.isRelative,h=o._readOneR1C1Element(n,t,i,r.endIndex),!h.success||h.isRow)return r.endIndex=a,r.success=!0,r;else r.endIndex=h.endIndex;return r.endColumn=h.elementIndex,r.endColumnRelative=h.isRelative,r.success=!0,r}else return r.success=!0,r}else return r},e.prototype._readOneA1Element=function(n,t){var c=e.BAND_INDEX_CONST,i={endIndex:t,elementIndex:c,isRow:!0,isRelative:!0,success:!1},s=n.length,r,u,f,o,h;if(t>=s||(n.charAt(t)==="$"&&(i.isRelative=!1,t++),t>=s))return i;if(r=t,f=n.charAt(r),ni(f)&&f!=="0"){for(i.isRow=!0;r<s&&ni(f);)r++,r<s&&(f=n.charAt(r));if(u=parseInt(n.substr(t,r-t),10),u>=1&&u<=e.maxRowCount)return i.elementIndex=u-1,i.endIndex=r,i.success=!0,i}else if(oi(f)){for(i.isRow=!1;r<s&&oi(f);)r++,r<s&&(f=n.charAt(r));if(o=n.substr(t,r-t),o.length>3)return i;for(o=o.toUpperCase(),u=0,h=o.length-1;h>=0;h--)u+=(o.charCodeAt(h)-64)*li[o.length-h-1];if(u<=e.maxColumnCount)return i.elementIndex=u-1,i.endIndex=r,i.success=!0,i}return i},e.prototype._readOneR1C1Element=function(n,t,i,r){var a=e.BAND_INDEX_CONST,u={endIndex:r,elementIndex:a,isRow:!0,isRelative:!1,success:!1},s=n.length,f,o,c,l,h;if(r>=s)return u;if(f=r,o=n.charAt(f),o==="R"||o==="r")u.isRow=!0,c=t;else if(o==="C"||o==="c")u.isRow=!1,c=i;else return u;if(r++,f++,r>=s)return u.endIndex=r,u.elementIndex=c,u.isRelative=!0,u.success=!0,u;if((o=n.charAt(f),o==="["&&(r++,f++,u.isRelative=!0),r>=s)||(l=!1,o=n.charAt(f),u.isRelative&&o==="-"&&(r++,f++,l=!0),r>=s))return u;if(o=n.charAt(f),ni(o)){while(f<s&&ni(o))f++,f<s&&(o=n.charAt(f));if(h=parseInt(n.substr(r,f-r),10),u.isRelative){if(f>=s||n.charAt(f)!=="]")return u;f++}if(h<(u.isRow?e.maxRowCount:e.maxColumnCount))return u.isRelative?(h=l?-h:h,u.elementIndex=h+c):u.elementIndex=h-1,u.endIndex=f,u.success=!0,u}else return u.isRelative?u:(u.endIndex=r,u.elementIndex=c,u.isRelative=!0,u.success=!0,u)},e.prototype._validateWorkbook=function(n,t){var i,u;if(n===f||n===r||n==="")return!0;for(u=0;u<n.length;u++)if(i=n[u],t){if(i==="*"||i===":"||i==="["||i==="]"||i==="?"||i==="'"&&(u===0||u>=n.length-1||n.charAt(u+1)!=="'"))return!1}else if(i==="'"||i==="["||i==="]"||i==="?"||i==="%"||e._operatorInfix.indexOf(i)!==-1)return!1;return!0},e.prototype._validateSheetName=function(n,t,i){var s,u,o;if(n===f||n===r||n==="")return!0;if(!i&&ur(n.charAt(0))||(s=this._isStartWithCellReference(n,t),!i&&s.success&&s.endIndex===n.length))return!1;for(o=0;o<n.length;o++)if(u=n.charAt(o),i){if(u==="*"||u===":"||u==="["||u==="]"||u==="?"||u==="\\"||u==="/")return!1}else if(u==="'"||u==="["||u==="]"||u==="?"||u==="\\"||u==="%"||u==='"'||e._operatorInfix.indexOf(u)!==-1)return!1;return!0},e.prototype._createStructExpression=function(n,i,f){if(i.charAt(i.length-1)==="]")try{return new u.StructReferenceExpression(i,n)}catch(o){throw t._StringHelper.format(t.SR.Exp_FormulaInvalid,["{",f]);}else{var e=n.getTableByName(i);if(e)return u.StructReferenceExpression.create(e)}return r},e.prototype._validateName=function(n){var u,t,i;if(n===f||n===r||n===""||(u=n.length,u===1&&(n==="R"||n==="r"||n==="C"||n==="c"))||(t=n.charAt(0),!(t==="_"||t==="\\"||oi(t)||eu(t))))return!1;for(i=1;i<u;i++)if(t=n.charAt(i),!(t==="_"||t==="\\"||t==="?"||t==="."||fr(t)||eu(t)))return!1;return!0},e.prototype.parseReferenceExpressionInfos=function(n,t,i,r){var f=this,u=[];try{u=f._parseToToken(n,!1)}catch(e){}return u=f._fillBlankToTokens(u,n),f._getExpressToken(u,n,t,i,r)},e.prototype._adjustArrayTokens=function(n){for(var t,r=0,i=0;i<n.length;i++)t=n[i],t.type===1&&t.subType===1&&t.value===vt?r=0:t.type===1&&t.subType===1&&t.value===st?(r===0&&(n.splice(i,1),i--),r++):t.type===1&&t.subType===2&&t.value==="}"&&(r--,r===0&&(n.splice(i,1),i--));return n},e.prototype._fillBlankToTokens=function(n,i){var h=0,s,e,f,r,u;for(n.splice(0,0,new o("=",1,0,0)),f=n.length-1;f>0;f--)n[f].index===n[f-1].index&&n[f].value===n[f-1].value&&(n=t.ArrayHelper.removeByIndex(n,f));for(r=0;r<n.length-1;r++)e=this._getTokenLength(n[r]),h=n[r+1].index-n[r].index-e,h>0&&(s={index:n[r].index+e,value:i.substring(n[r].index+e,n[r+1].index),type:7},n.splice(r+1,0,s));for(e=this._getTokenLength(n[r]),n.length>0&&i.length>n[r].index+e&&(s={index:n[r].index+n[r].value.length,value:i.substring(n[r].index+n[r].value.length,i.length),type:7},n.splice(r+1,0,s)),u=0;u<n.length;u++)n[u].value.trim()==="("?(n[u].type=1,n[u].subType=1):n[u].value.trim()===")"?(n[u].type=1,n[u].subType=2):n[u].value.trim()==="{"?(n[u].type=1,n[u].subType=1):n[u].value.trim()==="}"&&(n[u].type=1,n[u].subType=2);return n},e.prototype._getTokenLength=function(n){return n.type===1&&(n.value==="ARRAY"||n.value==="ARRAYROW")&&(n.value==="ARRAY"||n.value==="ARRAYROW")?1:n.value.length},e.prototype._getExpressToken=function(n,e,s,h,c){var b=this,ut,nt=f,tt=s._getSheetSource(),st=s.getCalcService(),y,it,l,d,w,ht,ot,p;for(st?(ut=new i.SheetParserContext(s,st.useR1C1,h,c),nt=new k(tt,!1,h,c)):ut=new et(r,!1,0,0),y=[],it=0;it<n.length;it++)try{if(l=n[it],l.value==="["||t.StringUtil.startsWith(l.value,"#")||l.subType===3){y.push({text:l.value,type:l.type,subType:l.subType,canDrag:!1,ranges:l.ranges,value:l.value});continue}if(d=[],b._buildExpressionInfo(ut,l,d),d.length>0){for(p=0;p<d.length;p++)if(w=d[p],w instanceof o)y.push({text:w.value,type:w.type,subType:w.subType,canDrag:g,ranges:[],value:w.value});else if(w instanceof wt){var ft=w,a=ft.expression,rt=e.substring(ft.startIndex,ft.endIndex+1),v=[],g=!0;if(a)if(a.t===8)g=!1,nt&&(ht=nt.getName(a.name),b._getRanges(ht,v,nt,h,c));else if(a.t===17)g=!1,a.source()===tt?(ot=a.getRange(h,c),ot&&v.push(b._cellRange2Range(ot))):v=null;else if(a instanceof u.ReferenceExpression)if(a.t===16){var lt=a.startSource,at=a.endSource,ct=lt.getSources(at);for(p=0;p<ct.length;p++)if(ct[p]===tt){v.push(b._cellRange2Range(a.getRange(h,c)));break}}else a instanceof u.ExternalReferenceExpression?a.source===tt?v.push(b._cellRange2Range(a.getRange(h,c))):v=null:v.push(b._cellRange2Range(a.getRange(h,c)));else v=null;else v=null;v&&v.length>0?y.push({text:rt,type:0,subType:7,canDrag:g,ranges:v,value:rt}):y.push({text:rt,type:l.type,subType:l.subType,canDrag:g,ranges:v,value:rt})}}else y.push({text:l.value,type:l.type,subType:l.subType,canDrag:!1,ranges:l.ranges,value:l.value})}catch(vt){y.push({text:l.value,type:l.type,subType:l.subType,canDrag:!1,ranges:l.ranges,value:l.value})}return y},e.prototype._cellRange2Range=function(n){return new t.Range(n.row,n.column,n.rowCount,n.columnCount)},e.prototype._getRanges=function(n,t,i,f,e){var o,a,s,p,h,v,y,l,c;if(n){while(n.t===14)n=n.argument;if(o=this,n.t===24&&(a=n,n=a.expr),!(n instanceof u.ConstantExpression))if(n instanceof u.ExternalReferenceExpression)i.source&&n.source===i.source&&(s=n.getRange(f,e),t.push(o._cellRange2Range(s)));else if(n.t===17)n.source()===i.source&&(s=n.getRange(f,e),s&&t.push(o._cellRange2Range(s)));else if(n instanceof u.ReferenceExpression)s=n.getRange(f,e),t.push(o._cellRange2Range(s));else if(n.t===9)h=r,(p=n.source.getCalcService())&&(h=new k(n.source,!1,f,e)),v=h.getName(n.name),o._getRanges(v,t,h,f,e);else if(n.t===8)y=i.getName(n.name),o._getRanges(y,t,i,f,e);else if(n.t===11)o._getRanges(n.operand,t,i,f,e);else if(n.t===10)o._getRanges(n.left,t,i,f,e),o._getRanges(n.right,t,i,f,e);else if(n.t===7)for(l=n,c=0;c<l.argCount();c++)o._getRanges(l.getArg(c),t,i,f,e)}},e.prototype._buildExpressionInfo=function(n,t,i){var s,a,v,h,c;if(typeof t!="undefined"&&typeof t!="function"&&t!==null&&t.type===0){var l=this,f=t.value,r,e,u=l._buildCellReferenceOrNameExpressions2(n,f,t.index);if(u!=null&&(r=u.endIndex,e=u.expression,e.t===10?(a=e.left,v=e.right,i.push(new wt(t.index,t.index+u.range1EndIndex-1,a)),i.push(new wt(t.index+u.range1EndIndex,t.index+r-1,v))):(s=new wt(t.index,t.index+r-1,e),i.push(s)),!(r<=0)&&!(r>=f.length))&&f[r]==":")for(i.push(new o(":",5,r+t.index)),r++;r>0&&r<f.length;){if(h=r+t.index,u=l._buildCellReferenceOrNameExpressions2(n,f.substring(r),t.index),u==null)return;if(c=u.endIndex,e=u.expression,s=new wt(h,h+c-1,e),i.push(s),r+=c,r>=f.length||f[r]!==":")return;i.push(new o(":",5,r+t.index));r++}}},e.BAND_INDEX_CONST=-2147483648,e.maxRowCount=1048576,e.maxColumnCount=16384,e._isLetter=oi,e._isLetterOrDigit=fr,e.listSeparator=",",e.numberDecimalSeparator=".",e.arrayGroupSeparator=";",e.arrayListSeparator=",",e._operatorInfix="\\+-*/^&=><: "+e.listSeparator,e.unparseWithoutCulture=!1,e}();i.Parser=l;wt=function(){function n(n,t,i){var r=this;this.startIndex=n;this.endIndex=t;this.expression=i}return n}();k=function(){function n(n,t,i,r,u,e,o,s){this.asyncId=0;this.asyncCount=0;this._expandArrayToMultiCallCount=0;var h=this,c=arguments.length;h.source=n;h.arrayFormulaMode=!!t;h.row=i||0;h.column=r||0;h.rowCount=u||1;h.columnCount=e||1;h.activeRow=o!==f?o:h.row;h.activeColumn=s!==f?s:h.column;h.rowOffset=o===f?h.row:h.activeRow-h.row;h.columnOffset=s===f?h.column:h.activeColumn-h.column}return n.prototype.getValue=function(n,t,i){return n?n.getValue(t,i):h},n.prototype.getReference=function(n,t,i,r,u){return n?n.getReference(t,i,r,u):h},n.prototype.getSheetRangeReference=function(n,t,i,r,u,f){return!n||!t?h:n.getSheetRangeReference(t,i,r,u,f)},n.prototype.getFunction=function(n){var t=this;return t.source?t.source.getCustomFunction(n):r},n.prototype.getName=function(n){var t=this,i=t.source?t.source.getCustomName(n):r;return!i&&t.source&&(i=t.source.getCalcService().getGlobalSourceModel().getSource().getCustomName(n)),i},n.prototype._isExpandArrayToMultiCall=function(){return this._expandArrayToMultiCallCount>0},n.prototype._beginExpandArrayToMultiCall=function(){this._expandArrayToMultiCallCount++},n.prototype._endExpandArrayToMultiCall=function(){this._expandArrayToMultiCallCount--},n.prototype._offset=function(t,i){var r=this;return new n(r.source,r.arrayFormulaMode,r.row+t,r.column+i,r.rowCount,r.columnCount,r.rowOffset,r.columnOffset)},n.prototype.SetAsyncResult=function(n,t){this.source.getCalcService()._evaluator.SetAsyncResult(n,t);this.source.refresh()},n.prototype.cloneFrom=function(n){var t=this;t.acceptsReference=n.acceptsReference;t.activeColumn=n.activeColumn;t.activeRow=n.activeRow;t.arrayFormulaMode=n.arrayFormulaMode;t.column=n.column;t.columnCount=n.columnCount;t.columnOffset=n.columnOffset;t.row=n.row;t.rowCount=n.rowCount;t.rowOffset=n.rowOffset},n}();i.EvaluateContext=k;or=function(){function n(n){this.id=n.asyncId++;this.ctx=n;this.row=n.activeRow;this.col=n.activeColumn}return n.prototype.SetAsyncResult=function(n){this.ctx.SetAsyncResult(this,n)},n}();i.AsyncEvaluateContext=or;sr=function(n){function t(t,i,r,u,f,e,o,s){n.call(this,t,i,r,u,f,e,o,s);this._globalSource=t.getCalcService().getGlobalSourceModel().getSource()}return __extends(t,n),t.prototype.getName=function(n){var t=this;return t._globalSource?t._globalSource.getCustomName(n):r},t}(k);i.GloableEvaluateContext=sr;cu=new l;hr=function(){function n(){this._aync={}}return n.prototype.evaluateFormula=function(n,t,i,r){return this.evaluateExpression(cu.parse(n,t),i,r)},n.prototype.evaluateExpression=function(n,t,i,u,e){var o=this._evaluate(n,t,!!u,!!e);return o===f||o===r?i===!1?o:0:typeof o=="number"&&o.toString().length>=15?+o.toPrecision(15):o},n.prototype._evaluate=function(n,i,f,e){var s,o,h,l,v,c,a;if(!n)throw t.SR.Exp_ExprIsNull;while(n.t===14)n=n.argument;return s=this,h=r,n.t===24&&(l=n,n=l.expr,h=l.needExpendIndexs),n instanceof u.ConstantExpression?o=s._evaluateConst(n,i,f):n instanceof u.ReferenceExpression?o=s._evaluateReference(n,i,e,f):n.t===9?(c=r,(v=n.source.getCalcService())&&(c=new k(n.source,i.arrayFormulaMode,i.row,i.column)),c||(o=ut),o=s._evaluateName(n.name,c,i,f,e)):n.t===8?o=s._evaluateName(n.name,i,i,f,e):n.t===11?o=s._evaluateUnaryOperation(n,i,f,e,h):n.t===10?o=s._evaluateBinaryOperation(n,i,f,e,h):n.t===7?o=s._evaluateFunction(n,i,f,e,h):(n.t===25||n.t===26)&&(a=n.source||i&&i.source,o=a&&a.getValueByName(n.nameIdentity)),o},n.prototype._evaluateConst=function(n,t,i){var r=n.value;return e.arr(r)?i||t&&(t.arrayFormulaMode||t._isExpandArrayToMultiCall())?r:gt.getArrayValue(r,0,0):r},n.prototype._evaluateReference=function(n,t,i,r){var c,p,l,y,w,b;if(!t)return s;c=t.source;n instanceof u.ExternalReferenceExpression?c=n.source:n.t===17&&(c=n.source());var k=t.row,d=t.column,f=n.getRange(k,d);if(!f)return h;var a=f.row<0?0:f.row,v=f.column<0?0:f.column,o=f.rowCount,e=f.columnCount;if(i||t.arrayFormulaMode)return n.t===16?t.getSheetRangeReference(n.startSource,n.endSource,f.row,f.column,o,e):t.getReference(c,f.row,f.column,o,e);else if(r&&(o>1||e>1)){for(p=[],l=0;l<o;l++)for(p[l]=[],y=0;y<e;y++)p[l][y]=t.getValue(c,l+a,y+v);return new ft(p,e)}if(o>1||e>1)if(w=t.row>=f.row&&t.row<f.row+o,b=t.column>=f.column&&t.column<f.column+e,w||b)if(w&&!b&&e===1)a=t.row;else if(!w&&b&&o===1)v=t.column;else if(o===1||e===1)a=t.row,v=t.column;else return s;else return s;else if(f.row===-1&&o===-1){if(e!==1)return s;a=t.row}else if(f.column===-1&&e===-1){if(o!==1)return s;v=t.column}return t.getValue(c,a,v)},n.prototype._evaluateName=function(n,t,i,r,u){if(!t||!i)return ut;var f=t.getName(n);return f?this._evaluate(f,i,r,u):ut},n.prototype._evaluateOperationArg=function(n,t,r,u){var f=this._evaluate(n,t,r,u);return e.err(f)?f:f===i.missingArgument?p:f},n.prototype._evaluateUnaryOperation=function(n,t,u,f,o){var h=!1,s;return(o!=r&&o.length>0&&(u=!0,h=!0),s=this._evaluate(n.operand,t,u,h),e.err(s))?s:s===i.missingArgument?p:this._evaluateWithArgs(n,function(i){return n.operator.evaluate(i[0],t)},t,o,[s],u,f)},n.prototype._evaluateBinaryOperation=function(n,t,u,f,o){var l=[u,u],a=[n.operator.acceptsReference,n.operator.acceptsReference],v,c,s,h;if(o!=r&&o.length>0)for(s=0;s<o.length;s++)l[o[s]]=!0,a[o[s]]=!0;for(v=[n.left,n.right],c=[],s=0;s<2;s++){if(h=this._evaluate(v[s],t,l[s],a[s]),e.err(h))return h;if(h===i.missingArgument)return p;c[s]=h}return this._evaluateWithArgs(n,function(i){return n.operator.evaluate(i[0],i[1],t)},t,o,c,u,f)},n.prototype.startCache=function(){this._functionResultCaches={}},n.prototype.endCache=function(){this._functionResultCaches=r},n.prototype._evaluateFunction=function(n,t,u,o,s){var y,p,w,k,rt,a,h,l,d,g,ft,et,nt;if(!n||!n.fn||typeof n.fn=="string")return ut;var tt=n.argCount(),v=this,ot=t.asyncCount,c=n.fn,b,it=r;if(tt===0)b=[];else{for(b=[],y=[],p=[],h=0;h<tt;h++)y[h]=c.acceptsArray(h),p[h]=c.acceptsReference(h);if(s&&s.length>0){for(it=[],h=0;h<tt;h++)it[h]=!0;for(h=0;h<s.length;h++)w=s[h],y[w]=!0,p[w]=!0,it[w]=!(c.acceptsReference(w)&&!c.acceptsArray(w))}for(c.isBranch()&&(t.arrayFormulaMode||t._isExpandArrayToMultiCall())&&(y[c.findTestArgument()]=!0,p[c.findTestArgument()]=!0),a=-1,rt=-1,c.isBranch()&&(a=c.findTestArgument(),c.acceptsArray(a)&&t._beginExpandArrayToMultiCall(),k=v._evaluate(n.getArg(a),t,y[a],p[a]),c.acceptsArray(a)&&t._endExpandArrayToMultiCall(),e.ref(k)||e.arr(k)||(rt=c.findBranchArgument(k))),h=0;h<tt;h++){if(a===h)l=k;else if(rt>=0&&h!==rt){b[h]=null;continue}else c.acceptsArray(h)&&t._beginExpandArrayToMultiCall(),l=v._evaluate(n.getArg(h),t,y[h],p[h]),c.acceptsArray(h)&&t._endExpandArrayToMultiCall();if(!c.acceptsArray(h)&&e.arr(l)||!c.acceptsReference(h)&&e.ref(l))if(d=e.arr(l)?l:r,g=e.ref(l)?l:r,d!=r&&d.getRowCount()==1&&d.getColumnCount()==1)l=d.getValue(0,0);else if(g!=r&&g.getRowCount(0)==1&&g.getColumnCount(0)==1)l=g.getValue(0,0,0);else{if(ft=[],et=!1,s!=r)for(nt=0;nt<s.length;nt++)ft.push(s[nt]),s[nt]==h&&(et=!0);et||(ft.push(h),s=ft)}if(e.err(l)&&!c.acceptsError(h))return l;l===i.missingArgument&&(c.acceptsMissingArgument(h)||(l=r));b[h]=l}}return v._evaluateWithArgs(n,function(n){var g,a,it,y,p,u,w,b,h,l,nt,e,tt,k,d,s;if(c.isContextSensitive())return(t.acceptsReference=o||t._isExpandArrayToMultiCall(),c instanceof nr.AsyncFunction)?(g=t.source.getName()+"_"+t.activeRow+"_"+t.activeColumn+"_"+t.asyncId,a=v._aync[g],a!==f)?(delete v._aync[g],a):(it=new or(t),t.asyncCount++,(t.asyncCount=ot+1)?(a=c.evaluateWithContext(n,it),a===f&&(a=c.defaultValue())):a=c.defaultValue(),a):c.evaluateWithContext(n,t);else{if(y=t.arrayFormulaMode?v._functionResultCaches:r,y)if(p=!1,u=y[c.name+n.length],u)for(s=0;s<u.length;s++){if(w=u[s],p=!0,w.args.length===n.length)for(b=0;b<n.length;b++)if(h=w.args[b],l=n[b],h!==l)if(h instanceof i.SheetReference&&l instanceof i.SheetReference){if(nt=h._rangeCount,h._sheetSource!==l._sheetSource||nt!==l._rangeCount){p=!1;break}for(e=0;e<nt;e++)if(h.getRow(e)!==l.getRow(e)||h.getColumn(e)!==l.getColumn(e)||h.getRowCount(e)!==l.getRowCount(e)||h.getColumnCount(e)!==l.getColumnCount(e)){p=!1;break}}else{p=!1;break}if(p)return w.flag++,w.value}else u=y[c.name+n.length]=[];if(tt=c.evaluate(n),y){if(k=u.length,k>=100){for(d=[],s=0;s<k;s++)u[s].flag>0&&d.push(u[s]);d.sort(function(n,t){return t.flag-n.flag});k=Math.min(50,d.length);u=d.slice(0,k);y[c.name+n.length]=u}u.push({args:n,value:tt,flag:0})}return tt}},t,s,b,u,o,it)},n.prototype.SetAsyncResult=function(n,t){var i=n.ctx,r=i.source.getName()+"_"+i.activeRow+"_"+i.activeColumn+"_"+n.id;this._aync[r]=t;i.source.getCalcService().recalculate(i.source,i.activeRow,i.activeColumn)},n.prototype._evaluateWithArgs=function(n,t,i,u,f,o,h,c){var b,a,v,tt,k,it,l,y,nt,w,d;if(u&&u.length>0){if(b=this._expandArgs(i,n,f,u,c),b==r)return p;var g=[],rt=b[0].length,ut=b[0][0].length;for(a=0;a<rt;a++)for(g[a]=[],v=0;v<ut;v++)try{for(tt=[],k=0;k<f.length;k++)tt[k]=b[k][a][v];if(l=t(tt),e.ref(l)){if(n.t===7&&(it=n.fn,it.returnReference&&it.returnReference()))return l;l=this.getOneValue(i,l)}g[a][v]=l}catch(et){g[a][v]=s}return new ft(g)}else try{if(l=t(f),i.arrayFormulaMode&&i._isExpandArrayToMultiCall())return l;if(e.arr(l)&&!o)return this.getOneValue(i,l);else if(e.ref(l)&&!h){if(y=l,o&&y.getRangeCount()===1){for(nt=[],w=0;w<y.getRowCount(0);w++)for(nt[w]=[],d=0;d<y.getColumnCount(0);d++)nt[w][d]=y.getValue(0,w,d);return new ft(nt,y.getColumnCount(0))}return this.getOneValue(i,l)}else return l}catch(et){return s}},n.prototype.getOneValue=function(n,t){var i,f,r,u;return e.ref(t)?(i=t,i.getRangeCount()>1?t=s:(n.rowOffset!=-1||n.columnOffset!=-1?(r=i.getRowCount(0)==1?0:n.rowOffset,u=i.getColumnCount(0)==1?0:n.columnOffset):(r=i.getRowCount(0)==1?0:n.row-i.getRow(0),u=i.getColumnCount(0)==1?0:n.column-i.getColumn(0)),t=r>=i.getRowCount(0)||u>=i.getColumnCount(0)?p:i.getValue(0,r,u))):e.arr(t)&&(f=t,n.arrayFormulaMode&&(n.rowOffset!=-1||n.columnOffset!=-1)?(r=f.getRowCount()==1?0:n.rowOffset,u=f.getColumnCount()==1?0:n.columnOffset,t=r>=f.getRowCount()||u>=f.getColumnCount()?p:f.getValue(r,u)):t=f.getValue(0,0)),t},n.prototype._expandArgs=function(n,i,u,f,o){var k=1,d=1,g=-1,ot=!0,st=!0,y=i.t===7?i:r,nt,ht,tt,w,rt,a,v,b;if(y==r||y.fn.expandRows()||(ot=!1),y==r||y.fn.expandColumns()||(st=!1),y!=r&&y.fn.isBranch&&(n.arrayFormulaMode||n._isExpandArrayToMultiCall())){if(g=y.fn.findTestArgument(),nt=[],ht=!1,f)for(tt=0;tt<f.length;tt++)nt.push(f[tt]),f[tt]===g&&(ht=!0);if(ht||e.arr(u[g])||e.ref(u[g])){for(w=0;w<y.argCount();w++)w!=g&&t.ArrayHelper.indexOf(nt,w)<0&&(e.arr(u[w])||e.ref(u[w]))&&nt.push(w);f=nt}}for(rt=0;rt<f.length;rt++){var ut=u[f[rt]],l=e.arr(ut)?ut:null,s=e.ref(ut)?ut:null,h=0,c=0;if(l!=r)h=l.getRowCount(),c=l.getColumnCount();else if(s!=r){if(s.getRangeCount()>1)return r;h=ot?s.getRowCount(0):1;c=st?s.getColumnCount(0):1}k=h>k?h:k;d=c>d?c:d}var ft=[],et=0,ct=f[et];for(a=0;a<u.length;a++){ft[a]=[];var it=u[a],l=null,s=null,h=1,c=1;if(a===ct){if(l=e.arr(it)?it:r,s=e.ref(it)?it:r,(l!=r||s!=r)&&(h=l!=r?l.getRowCount():ot?s.getRowCount(0):1,c=l!=r?l.getColumnCount():st?s.getColumnCount(0):1,(h!=1&&h!=k||c!=1&&c!=d)&&(g==-1||a==g)&&!n.arrayFormulaMode))return r;et++;ct=et<f.length?f[et]:-1}if(s!=r){var vt=i.source||n.source,lt=s.getRow(0),at=s.getColumn(0);k=lt+k-lt;d=at+d-at}for(v=0;v<k;v++)for(ft[a][v]=[],b=0;b<d;b++)ft[a][v][b]=h!=1&&v>=h||c!=1&&b>=c?p:l!=r?l.getValue(h==1?0:v,c==1?0:b):s!=r?o==r||o[a]?s.getValue(0,h==1?0:v,c==1?0:b):s.create([new t.Range(s.getRow(0)+(h==1?0:v),s.getColumn(0)+(c==1?0:b),1,1)]):it}return ft},n}();i.Evaluator=hr})(t.Calc||(t.Calc={}));var i=t.Calc})(n.Sheets||(n.Sheets={}));var t=n.Sheets})(GcSpread||(GcSpread={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){(function(t){(function(i){function k(t,r,e,o,s){var l=t&&t instanceof n.Sheets.Sheet&&t,a=new i.Parser,h,c;return e=e===u?0:e,o=o===u?0:o,h=new f(l,!!s,e,o),c=a.parse(r,h),i.evaluateExpression(t,c,e,o)}function d(n,t,i,r){var o=n.getCalcService(),f,e;return i===u&&(i=n.getActiveRowIndex()),r===u&&(r=n.getActiveColumnIndex()),f=n._getSheetSource(),e=o.evaluateParsedFormula(f,t,i,r,!1,!0),e}function g(n,t,r,u,f){var h=n.row,c=n.col,v=n.row+n.rowCount-1,y=n.col+n.colCount-1,o=!1,l=!1,s=!1,a=!1,e,p,w;return(arguments.length>=4&&(o=(u&1)!=0,l=(u&4)!=0,s=(u&2)!=0,a=(u&8)!=0,h-=o?t:0,v-=l?t:0,c-=s?r:0,y-=a?r:0),f&&(p=nt(n,f,t),w=tt(n,f,t),p&&w))?i.Expressions.StructReferenceExpression.create(f,p,w,n.col-f.dataRange().col,n.col+n.colCount-f.dataRange().col-1):(n.row<0&&n.col<0?e=new i.Expressions.RangeExpression:n.row<0?(e=new i.Expressions.RangeExpression,e.initBand(c,y,s,a,!1)):n.col<0?(e=new i.Expressions.RangeExpression,e.initBand(h,v,o,l,!0)):e=n.rowCount===1&&n.colCount===1?new i.Expressions.CellExpression(h,c,o,s):new i.Expressions.RangeExpression(h,c,v,y,o,s,l,a),e)}function nt(n,t,i){if(n.rowCount===1){if(t.hasHeadersRow()&&n.row===t.startRow())return 2;if(t.hasTotalsRow()&&n.row===t.endRow())return 8;if(i===n.row)return 1}else{if(t.hasHeadersRow()&&n.row===t.startRow()){if(n.rowCount===t.dataRange().rowCount+1)return 6;if(t.hasTotalsRow()&&n.rowCount===t.dataRange().rowCount+1+1)return 14}if(n.row===t.dataRange().row){if(n.rowCount===t.dataRange().rowCount)return 3;if(t.hasTotalsRow()&&n.rowCount===t.dataRange().rowCount+1)return 12}}return u}function tt(n,t,i){return n.col===t.startColumn()&&n.colCount===t.dataRange().colCount?1:n.colCount===1?2:n.col>=t.startColumn()&&n.col+n.colCount-1<=t.endColumn()?4:u}function it(n,t,u,f,e){var o=i.rangeToExpression(n,t,u,f),s=new i.ParserContext(r,!!e,t,u),h=new i.Parser;return h.unparse(o,s)}function rt(n,t,r,u,f,e,o){var s=i.rangeToExpression(t,r,u,f,o),h=new i.SheetParserContext(n,!!e,r,u),c=new i.Parser;return c.unparse(s,h)}function ut(n,i,r,u){var h,f,o,s,e;if(!i)return null;if(r=r?r:0,u=u?u:0,h=n.getCalcService(),f=h.parse(n._getSheetSource(),i,r,u),f)if(o=f.source,o&&f.t===17)o=f.source();else if(f.t===16){var a=f.startSource,v=f.endSource,c=a.getSources(v),l=!1;for(s=0;s<c.length;s++)if(c[s]===n._getSheetSource()){l=!0;break}f=l&&f}return f&&f.getRange&&(!o||o===n._getSheetSource())?(e=f.getRange(r,u),!e)?null:new t.Range(e.row,e.column,e.rowCount,e.columnCount):null}function ft(n,t,u,f,e){var o="",l=new i.Parser,a=new i.ParserContext(r,!!e,t,u),s,c,h;for(n.length>1&&(o="("),s=0;s<n.length;s++)c=i.rangeToExpression(n[s],t,u,f),h=l.unparse(c,a),s>0?o+=", "+h:o=h;return n.length>1&&(o+=")"),o}var p,f,et;t.feature("calc.common",["core.stringResource","core.common","core.globalize"]);var ot="undefined",st="number",ht="string",ct="boolean",lt="TRUE",at="FALSE",vt="ARRAY",yt="ARRAYROW",e="#NULL!",o="#DIV/0!",s="#VALUE!",h="#REF!",c="#NAME?",l="#N/A",a="#NUM!",pt=[e,o,s,h,c,l,a],wt=[0,7,15,23,29,42,36],bt=[1,26,676],r=null,u=undefined,kt=!1,dt=Math.min,gt=Math.max,ni=Math.abs,ti=Math.pow,v=["v","n","s","b","d"],w=[r,0,"",!1,new Date],ii=new i.CalcError(e,0),ri=new i.CalcError(o,7),y=new i.CalcError(s,15),ui=new i.CalcError(h,23),fi=new i.CalcError(c,29),ei=new i.CalcError(l,42),oi=new i.CalcError(a,36),b=function(n){function e(t){n.call(this,r);this._sheet=t}return __extends(e,n),e.prototype.startCalculation=function(){if(!this._valueCaches){var n=this.getRowCount(),t=this.getColumnCount();this._valueCaches={rowCount:n,colCount:t};this._changedCells=[]}},e.prototype.endCalculation=function(){this._valueCaches=r;var n=this._changedCells;n&&n.length>0&&this._sheet.triggerRangeChanged({sheet:this._sheet,sheetName:this._sheet.getName(),row:0,column:0,rowCount:this._sheet.getRowCount(),columnCount:this._sheet.getColumnCount(),changedCells:n,action:6});this._changedCells=r},e.prototype.getValue=function(n,t,f){var s=this,h=s._sheet,e,a,p,w,c,o,l;return(f=f===u?0:f,n<0||t<0)?y:h._isValidatingCell&&h._validatingRow===n&&h._validatingColumn===t?h._validatingValue:(e=s._valueCaches,a=v[f],e?(p=e.rowCount,w=e.colCount,n>=p)?r:t>=w?r:(c=e[n],c||(c=e[n]={}),o=c[t],o||(o=c[t]={v:h.getValue(n,t)}),l=o[a],l===u&&(l=i.Convert.convertValue(o.v,f,!0),o[a]=l),l):n>=s.getRowCount()?r:t>=s.getColumnCount()?r:s._sheet.getValue(n,t))},e.prototype.getReference=function(n,t,r,u){var f=this;return n===-1&&t===-1?f.getSheetReference():n===-1?new i.SheetReference(f,[{row:0,rowCount:f.getRowCount(),col:t,colCount:u}]):t===-1?new i.SheetReference(f,[{row:n,rowCount:r,col:0,colCount:f.getColumnCount()}]):new i.SheetReference(f,[{row:n,rowCount:r,col:t,colCount:u}])},e.prototype.getSheetRangeReference=function(n,t,r,u,f){var s;if(this._sheet&&this._sheet.parent&&this._sheet.parent.sheets&&n instanceof e){var c=this._sheet.parent.sheets,l=!1,o,h=[];for(s=0;s<c.length;s++){if(o=c[s]._getSheetSource(),o===this)l=!0;else if(o===n){h.push(o.getReference(t,r,u,f));break}l&&h.push(o.getReference(t,r,u,f))}return new i._SheetRangeReference(h)}},e.prototype.getSources=function(n){var i;if(this._sheet&&this._sheet.parent&&this._sheet.parent.sheets&&n instanceof e){var u=this._sheet.parent.sheets,f=!1,t,r=[];for(i=0;i<u.length;i++){if(t=u[i]._getSheetSource(),t===this&&(f=!0),t===n){r.push(t);break}f&&r.push(t)}return r}},e.prototype.referenceToArray=function(n,t,f,e,o,s){var at=this,b,k,d=1,g=1,et,ot,nt,h=[],pt,c,st,tt=at._sheet,l=at._valueCaches,rt,it,ht=v[t],wt=w,bt=i.Convert.CalcConvertedError,vt,yt,p,kt,dt,ct,a,lt,ut,ft;if(nt=n.getRangeCount(),nt===0)return h.isError=!0,[];if(l&&(it=n.getRangeCount()+"_"+n.getRow(0)+"_"+n.getColumn(0)+"_"+n.getRowCount(0)+"_"+n.getColumnCount(0)+"_"+t+"_"+f,c=l[it],c))return h=c.slice(0),h.rowCount=c.rowCount,h.colCount=c.colCount,h.rangeCount=c.rangeCount,h;for(vt=this.getRowCount(),yt=this.getColumnCount(),f=f===u?!0:f,p=0;p<nt;p++){if(f||(st=[],h.push(st)),d=n.getRowCount(p),d===0)return h.isError=!0,[];if(g=n.getColumnCount(p),g===0)return h.isError=!0,[];if(et=n.getRow(p),ot=n.getColumn(p),e&&(et+d>vt||ot+g>yt))return h=[r],h.isError=!0,h;for(lt=tt._isValidatingCell,ut=0;ut<d;ut++)for(b=et+ut,f||(ct=[],st.push(ct)),l&&(rt=l[b],rt||(rt=l[b]={})),ft=0;ft<g;ft++){if(k=ot+ft,lt&&tt._validatingRow===b&&tt._validatingColumn===k)c=tt._validatingValue,lt=!1;else{if(l?(a=rt[k],a?c=a.v:(c=tt.getValue(b,k),a=rt[k]={v:c})):c=tt.getValue(b,k),e&&i.Convert.err(c))return h=[c],h.isError=!0,h;if(a&&a[ht]!==u)c=a[ht];else if(c=i.Convert.convertValue(c,t,!0,s),a&&(a[ht]=c),o&&a===c)return h=[y],h.isError=!0,h}c===r&&s||(f?h.push(c):ct.push(c))}}return f||nt!==1||(h=h[0]),h.rowCount=d,h.colCount=g,h.rangeCount=nt,l&&(l[it]=h.slice(0),l[it].rowCount=d,l[it].colCount=g,l[it].rangeCount=nt),h},e.prototype.getColumnCount=function(){return this._sheet.getColumnCount()},e.prototype.getRowCount=function(){return this._sheet.getRowCount()},e.prototype.isHiddenRow=function(n,t){var i=this._sheet,r=i.hasRowFilterOut();return r||!t?i.getRowHeight(n)===0:!1},e.prototype.getName=function(){return this._sheet.getName()},e.prototype.setValue=function(n,i,r){var a=this,f=a._sheet,v=a._valueCaches,c,u,s,p,w,o,l,b;if(v&&(c=v[n],c&&(u=c[i],u&&(u.v=r,u.b!==undefined&&(u.b=undefined),u.d!==undefined&&(u.d=undefined),u.n!==undefined&&(u.n=undefined),u.s!==undefined&&(u.s=undefined)))),s=f._getModel(),s){var k=f.getValue(n,i),h=!1,y=f._tableManager,e=y&&y.find(n,i);e&&(p=e.showHeader()&&n===e.headerIndex(),w=e.showFooter()&&n===e.footerIndex(),p||w||(h=e._setValue(n,i,r)));o=f._bindingManager;!h&&o&&o._dataSource&&(l=o.getValue(n,i),l.hasBinding&&(b=t.GC$.extend({},f.getDataItem(n)),s._updateDirty(n,i,{originalItem:b,oldValue:o.getValue(n,i).value}),o.setValue(n,i,r)),h=l.hasBinding);(!h||f.checkingChanges)&&s.setValue(n,i,r);this._changedCells?this._changedCells.push({row:n,column:i}):this._sheet.triggerCellChanged({sheet:this._sheet,sheetName:this._sheet.getName(),row:n,col:i,sheetArea:3,propertyName:"value",oldValue:k,newValue:r})}},e.prototype.getCustomFunction=function(n){return this._sheet?this._sheet._findCustomFunction(n):r},e.prototype.getCustomName=function(n){var t=this._sheet?this._sheet.getCustomName(n):r;return t?t.getExpression():r},e.prototype.getSheet=function(){return this._sheet},e.prototype.getParserContext=function(n,t,i,r){return new f(this._sheet,n,t,i,r)},e.prototype.setFormula=function(n,t,i){},e.prototype.setArrayFormula=function(n,t,i,r,u){},e.prototype.setFormulaByName=function(n,t){},e.prototype.refresh=function(){this._sheet.repaint()},e.prototype.toJSON=function(n,i){var f,y=i,c,r,e,u,h=n.data||{},o,l,s,a,v;for(o in y){l=parseInt(o,10);f=h.dataTable||{};c=y[o];e=f[o]||{};for(s in c)a=parseInt(s,10),r=c[s],r&&r.expr&&(u=e[s]||{},v=this.getCalcService().unparseWithoutCulture(this,r.expr,l,a,!0),r.arrayInfo?r.arrayInfo.row===l&&r.arrayInfo.col===a&&(u.arrayInfo=r.arrayInfo,u.formula=v):u.formula=v,t.GC$.isEmptyObject(u)||(e[s]=u));t.GC$.isEmptyObject(e)||(f[o]=e);t.GC$.isEmptyObject(f)||(h.dataTable=f)}t.GC$.isEmptyObject(h)||(n.data=h)},e}(i.CalcSource);i.SheetSource=b;p=function(n){function t(t){n.call(this,r);this._spread=t}return __extends(t,n),t.prototype.getCustomFunction=function(n){return this._spread?this._spread.getCustomFunction(n):r},t.prototype.getCustomName=function(n){var t=this._spread?this._spread.getCustomName(n):r;return t?t.getExpression():r},t}(i.CalcSource);i.SpreadSource=p;f=function(n){function t(t,i,r,u,f){n.call(this,t._getSheetSource(),i,r,u,f);this._sheet=t}return __extends(t,n),t.prototype.getExternalSource=function(t,u){var s=this,e=s._sheet.parent,f,o,h;if(t&&(!e||e.name!==t))return r;else if(!e)return i.compareStringIgnoreCase(s._sheet._name,u)?s._sheet._getSheetSource():r;if(f=e.sheets,f&&f.length>0)for(o=0;o<f.length;o++)if(h=f[o],i.compareStringIgnoreCase(h._name,u))return h._getSheetSource();return n.prototype.getExternalSource.call(this,t,u)},t.prototype.getExternalSourceToken=function(n){return n.getName()},t.prototype.getTableByName=function(n){return this._sheet.findTableByName(n)},t.prototype.getTableByIndex=function(n,t){return this._sheet.findTable(n,t)},t.prototype.setSource=function(n){this.source=n;n&&n.getSheet&&(this._sheet=n.getSheet())},t}(i.ParserContext);i.SheetParserContext=f;i.evaluateFormula=k;i.evaluateExpression=d;i.rangeToExpression=g;i.rangeToFormula=it;i.rangeToFormulaWithStructReference=rt;i.formulaToRange=ut;i.rangesToFormula=ft,function(n){n[n.allAbsolute=0]="allAbsolute";n[n.startRowRelative=1]="startRowRelative";n[n.startColRelative=2]="startColRelative";n[n.endRowRelative=4]="endRowRelative";n[n.endColRelative=8]="endColRelative";n[n.rowRelative=5]="rowRelative";n[n.colRelative=10]="colRelative";n[n.allRelative=15]="allRelative"}(i.RangeReferenceRelative||(i.RangeReferenceRelative={}));et=i.RangeReferenceRelative})(t.Calc||(t.Calc={}));var i=t.Calc})(n.Sheets||(n.Sheets={}));var t=n.Sheets}(GcSpread||(GcSpread={})),function(n){(function(t){(function(i){(function(r){function ai(n,i,r){var u,f;if(n===h||n===s)throw t.SR.Exp_InvalidFunctionName;if(n=n.toUpperCase(),c._builtInFunctions.hasOwnProperty(n))if(u=c._builtInFunctions[n],u){if(!r||!r.override)throw t.SR.Exp_OverrideNotAllowed;}else c._builtInFunctions[n]=new c.Function(n,0,255),u=c[n.toUpperCase()];else u=new c.Function(n,0,255),c._builtInFunctions[n]=u;if(i&&typeof i=="function"&&(u.evaluate=i),r)for(f in r)r.hasOwnProperty(f)&&f!=="override"&&(u[f]=r[f]);return u}function e(n){return!0}function nu(){return!1}function gt(n){return n!==0}function d(n){return n===1}function y(n){return n===2}function ni(n){return n===0||n===2}function ti(n){return n===0||n%2==1}function wt(n){return n===3}function ot(){return!0}function st(n){return n===1||n===2}function yi(){return!0}function ii(n){return n===0}function ri(n,r,f){var e,o,s,h,c;if(u.err(n))return f.value=n,!1;else if(u.ref(n)){for(e=0;e<n.getRangeCount();e++)for(o=0;o<n.getRowCount(e);o++)for(s=0;s<n.getColumnCount(e);s++)if(n instanceof i._SheetRangeReference){for(h=0;h<n.getSheetCount();h++)if((f.includeSubtotal||!n.isSubtotal(h,e,o,s))&&r(n.getValue(h,e,o,s),f)===!1)return!1}else if((f.includeSubtotal||!n.isSubtotal(e,o,s))&&r(n.getValue(e,o,s),f)===!1)return!1}else if(u.arr(n)){for(c=0;c<n.length();c++)if(r(n.getValueByIndex(c),f)===!1)return!1}else if(t.GC$.isArray(n))t.GC$.each(n,function(n,t){return r(t,f)});else if(r(n,f)===!1)return!1;return!0}function pi(){return 0}function tu(n){if(u.err(n))return-1;var t=!1;try{t=u.B(n)}catch(i){}return t?1:2}function ui(n){return n>0}function iu(n){return n===1}function fi(n){return n===1||n===2||n===3}function ru(n){return n===2}function uu(n){return n===0||n===2}function fu(n){return n===0||n===1}function eu(n){return n===0||n%2==1}function ht(n){return n===0}function ei(n){return n===0||n===1||n===2}function ou(n){return n%2==0}function su(n){return n===3}function oi(n){return n!==3}function hu(n){return n===3||n===4}function cu(n){return n!==1}function lu(n){return n===3||n===4}function it(n){return n===2||n===3}function au(n){return n>0}function vu(n){return n===4}function yu(n){return n===4||n===5}function pu(n){return n===5}function wu(n){return n===6}function bu(n){return n===8}function ku(n){return n===7}function du(n){return n!==2}function gu(n){return n===5||n===6}function nf(n){return n===4||n===6||n===7}function tf(n){return n===3||n===4||n===5}function rf(n){return n>=1}function uf(n){return n===2||n===3||n===4}function ff(n){return n===1||n===2||n===3}function ea(n){if(n===""||n===h||n===s)return n;for(var t in ct)ct.hasOwnProperty(t)&&(n=n.replace(ct[t],ct[t].source));return n=n.replace("~?","{113E2532-EAF5-444c-A5CB-3D7446971C4D}"),n=n.replace("~*","{E21523B3-0F1F-458f-B547-23D25713D0EC}"),n=n.replace("?","."),n=n.replace("*","((.|\\n)*)"),n=n.replace("{113E2532-EAF5-444c-A5CB-3D7446971C4D}","\\?"),n=n.replace("{E21523B3-0F1F-458f-B547-23D25713D0EC}","\\*"),n.toString()}function ef(n){var t;return isNaN(t=u.D(n[0]))?f:u.toResult(l(t))}function of(n){var t=parseFloat(n[0]);return t===h||t===s?f:c._MathHelper.approxFloor(t)}function sf(n){var i=u.D(n[0]),t=u.D(n[1]);return isNaN(i)||isNaN(t)?f:i===0||t===0?0:i>0&&t<0?o:i<0&&0<t?(t=-t,c._MathHelper.approxFloor(i/t)*t):c._MathHelper.approxCeiling(i/t)*t}function hf(n){var i=parseFloat(n[0]),t=parseFloat(n[1]),e,r;if(isNaN(i)||isNaN(t))return f;if(i<0||t<0||i<t)return o;for(e=1,t=vt(i-t,t),r=1;r<=t;r++)e*=i-r+1,e/=r;return u.toResult(e)}function cf(n){var t;return isNaN(t=parseFloat(n[0]))?f:180*t/yt}function lf(n){var t=parseFloat(n[0]);return t<0?(t=nt(t),t%2!=0&&(t-=1)):(t=dt(t),t%2!=0&&(t+=1)),t}function af(n){var t=parseInt(n[0],10),r=1,i;if(isNaN(t))return f;if(t<0||170<t)return o;for(i=1;i<=t;i++)r*=i;return r}function vf(n){var t=parseInt(n[0],10),r=1,i;if(isNaN(t))return f;if(t<0||300<t)return o;for(i=t;i>1;i-=2)r*=i;return r}function yf(n){var t=parseFloat(n[0]);return t===h||t===s?f:t<=0?o:u.toResult(k(t))}function pf(n){var i=parseFloat(n[0]),t=parseFloat(n[1]);return t===0?"#DIV/0!":i-t*nt(i/t)}function wf(n){var t=parseFloat(n[0]);return t<0?(t=nt(t),t%2==0&&(t-=1)):(t=dt(t),t%2==0&&(t+=1)),t}function bf(n){return yt}function kf(n){var t=parseFloat(n[0]),i=parseFloat(n[1]);return et(t,i)}function df(n,i){var f,r;return u.err(n)?(i.value=n,!1):u.ref(n)||u.arr(n)||t.GC$.isArray(n)?ri(n,df,i):(f={value:0},u.rD(n,f)&&(r=f.value,!isNaN(r)&&isFinite(r)&&(i.value+=r)),!0)}function gf(n){var o,s,h,c,e,i,r,f;if(!n||n.length<1)throw t.SR.Exp_InvalidArgument;for(o=0,e=0;e<n.length;e++){if(i=n[e],u.err(i))return i;else if(u.ref(i)||u.arr(i)){if(r=u.toArr(i,1,!0,!0,!1),r.isError)return r[0]}else r=u.toArr(i,1,!0,!0,!0);for(s=r.length,f=0;f<s;f++)r[f]!==u.CalcConvertedError&&(o+=r[f])}return o}function ne(n){var t=parseFloat(n[0]);return t>0?1:t===0?0:-1}function bi(n,t){while(t!==0){var i=n%t;n=t;t=i}return n}function te(n){for(var t,i,r,e=0,s=0;s<n.length;s++){if(t=u.toArr(n[s],1,!0,!0,!1),t.isError)return t[0];if(t.isConvertError)return f;for(i=0;i<t.length;i++)if(r=t[i],r!==u.CalcConvertedError){if(r<0)return o;e=bi(e,u.I(r))}}return e}function ie(n){for(var t,e,i,s,l,r=1,h=[],c=0;c<n.length;c++){if(t=u.toArr(n[c],1,!0,!0,!1),t.isError)return t[0];if(t.isConvertError)return f;for(e=0;e<t.length;e++)if(i=t[e],i!==u.CalcConvertedError){if(i<0)return o;else if(i===0)return 0;h.push(u.I(i))}for(s=0;s<h.length;s++)l=h[s],r/=bi(r,l),r*=l}return r}function ki(n,t,i){for(var r,f,h,y,p,o,c,s,l,a=1,v=0,e=0;e<n.length;e++)for(r=u.toArr(n[e],1,!1,!1,!1,!0),f=0;f<r.rangeCount;f++)for(h=r.rangeCount>1?r[f]:r,r.isReference&&(y=n[e].getRow(f),p=n[e].getColumn(f)),o=0;o<h.length;o++)if(t||!r.isReference||!n[e].isHiddenRow(f,o,i))for(c=h[o],s=0;s<c.length;s++)!t&&r.isReference&&n[e].isSubtotal(f,o+y,s+p)||(l=c[s],l!==u.CalcConvertedError&&(a*=u.D(l),v++));return u.toResult(v>0?a:0)}function re(n){return ki(n,!0,!0)}function ue(n){var t=parseFloat(n[0]);return t>=0?rt(t):o}function fe(n){if(u.err(n[0]))return n[0];if(u.err(n[1]))return n[1];var i=u.D(n[0]),t=u.D(n[1]);return isNaN(i)||isNaN(t)?f:t===0?w:parseInt((i/t).toString(),10)}function ee(n){for(var s,e,t=u.I(n[0]),r=[],o=1;o<n.length;o++)r[o-1]=n[o];if(s=i.Functions,e=s._StatHelper,t===1||t===101)return e.__averageIncludeSubtotals(r,!1,t===1);else if(t===2||t===102)return e.__countIncludeSubtotals(r,!1,t===2);else if(t===3||t===103)return e.__countaIncludeSubtotals(r,!1,t===3);else if(t===4||t===104)return e.__maxIncludeSubtotals(r,!1,t===4);else if(t===5||t===105)return e.__minIncludeSubtotals(r,!1,t===5);else if(t===6||t===106)return ki(r,!1,t===6);else if(t===7||t===107)return e.__stdevIncludeSubtotals(r,!1,t===7);else if(t===8||t===108)return e.__stdevpIncludeSubtotals(r,!1,t===8);else if(t===9||t===109)return e.__sumIncludeSubtotals(r,!1,t===9);else if(t===10||t===110)return e.__varrIncludeSubtotals(r,!1,t===10);else if(t===11||t===111)return e.__varpIncludeSubtotals(r,!1,t===11);return f}function oe(n){var i=u.D(n[0]),t=u.D(n[1]),r;return isNaN(i)||isNaN(t)?f:i===0||t===0?0:i>0&&t<0?o:(r=c._MathHelper,i<0&&0<t)?(t=-t,r.approxCeiling(i/t)*t):r.approxFloor(i/t)*t}function se(n){var i=u.D(n[0]),t=u.D(n[1]);return isNaN(i)||isNaN(t)?f:i===0||t===0?0:i<0&&0<t||t<0&&0<i?o:c._MathHelper.approxFloor(i/t+.5)*t}function si(n){var t=u.D(n[0]);if(isNaN(t))return f;var r=u.I(n[1]),e=c._MathHelper,i=e.pow10(l(r));return r<0?t/=i:t*=i,t=t<0?e.approxCeiling(t-.5):e.approxFloor(t+.5),r<0?t*=i:t/=i,u.toResult(t)}function he(n){var t=u.D(n[0]);if(isNaN(t))return f;var r=u.I(n[1]),e=c._MathHelper,i=e.pow10(l(r));return r<0?t/=i:t*=i,t=t<0?e.approxCeiling(t):e.approxFloor(t),r<0?t*=i:t/=i,u.toResult(t)}function ce(n){var t=u.D(n[0]);if(isNaN(t))return f;var r=u.I(n[1]),e=c._MathHelper,i=e.pow10(l(r));return r<0?t/=i:t*=i,t=t<0?e.approxFloor(t):e.approxCeiling(t),r<0?t*=i:t/=i,u.toResult(t)}function le(n){var t=u.D(n[0]);if(isNaN(t))return f;var e=i._Helper._argumentExists(n,1)?u.I(n[1]):0,o=c._MathHelper,r=o.pow10(l(e));return e<0?t/=r:t*=r,t=t<0?o.approxCeiling(t):o.approxFloor(t),e<0?t*=r:t/=r,u.toResult(t)}function ae(n){var t;return isNaN(t=u.D(n[0]))?f:u.toResult(v(t))}function di(n){var r=u.D(n[0]),t;if(i._Helper._argumentExists(n,1)){if(t=u.D(n[1]),isNaN(t))return f}else t=1;return r==0||t==0?0:c._MathHelper.approxCeiling(r/l(t))*l(t)}function ve(n){var r=u.D(n[0]),t=i._Helper._argumentExists(n,1)?u.D(n[1]):1;return r==0||t==0?0:c._MathHelper.approxFloor(r/l(t))*l(t)}function ye(n){var r=u.D(n[0]),t;if(isNaN(r))return f;if(i._Helper._argumentExists(n,1)){if(t=u.D(n[1]),isNaN(t))return f}else t=10;return r<=0||t<=0?o:t===1?w:u.toResult(lt.log(r,t))}function pe(n){var t=u.D(n[0]);return isNaN(t)?f:t<=0?o:u.toResult(lt.log10(t))}function kt(n,t,i){var l=0,d,g,r,o,e,nt,tt;if(n===h||n===s)return l;var w=c._MathHelper.parseCriteria(n),a=u.arr(t),v=u.arr(i),b=t,y=t,k=i,p=i,it=a?1:y.getRangeCount();if(it!=(v?1:p.getRangeCount())||(d=a?b.getRowCount():y.getRowCount(0),d>(v?k.getRowCount():p.getRowCount(0)))||(g=a?b.getColumnCount():y.getColumnCount(0),g>(v?k.getColumnCount():p.getColumnCount(0))))return f;if(r=t.toArray(0,!0,!0),r.isError)return r[0];if(o=i.toArray(1,!0,!0),o.isError)return o[0];for(e=0;e<r.length;e++)nt=r[e],w&&w(nt)&&(tt=o[e],l+=tt);return u.toResult(l)}function we(n){var v=n[0],y=n[1],o,r,c,f,e,p,l,a;if(y===h||y===s)throw t.SR.Exp_CriteriaIsNull;if(o=i._Helper._argumentExists(n,2)?n[2]:n[0],r=n[1],u.ref(r))return(c=r.getRowCount(0),f=r.getColumnCount(0),c===1&&f===1)?kt(r.getValue(0,0,0),v,o):new i._TernaryCompositeConcreteReference(r.getSource(),r.getRow(0),r.getColumn(0),c,f,kt,v,o);if(e=n[1],u.arr(e)){for(c=e.getRowCount(),f=e.getColumnCount(),p=new i._ConcreteArray(e,f),l=0;l<c;l++)for(a=0;a<f;a++)p._array[l][a]=kt(e.getValue(l,a),v,o);return p}return kt(y,v,o)}function be(n){var a=0,i=u.toArr(n[0],1,!0,!0,!1),r,y,o,p,e,s,t,l;if(i.isError)return i[0];var w=i.length,b=i.rowCount,k=i.colCount,h=[],v=[];for(t=1;t<n.length;t=t+2){if(r=u.toArr(n[t],0,!0,!1,!1),r.rowCount!==b||r.colCount!==k)return f;y=n[t+1];o=c._MathHelper.parseCriteria(y);h.push(r);v.push(o)}for(p=h.length,e=0;e<w;e++){for(s=!0,t=0;t<p;t++){var r=h[t],o=v[t],d=r[e];if(s=o&&o(d),!s)break}s&&(l=i[e],l!==u.CalcConvertedError&&(a+=l))}return u.toResult(a)}function ke(n){for(var t,r,e,o,s=0,v=u,h=[],c,l,a,i=0;i<n.length;i++){if(t=u.toArr(n[i],1,!0,!0,!1),t.isError)return t[0];if(t.isConvertError)return f;if(i==0)c=t.rowCount,l=t.colCount,a=t.length;else if(t.rowCount!==c||t.colCount!==l)return f;h.push(t)}for(i=0;i<a;i++){for(r=1,e=0;e<n.length;e++)if(o=h[e][i],o!==u.CalcConvertedError)r*=o;else{r=0;break}s+=r}return u.toResult(s)}function de(n){for(var t,r,i,o=0,e=0;e<n.length;e++){if(t=u.toArr(n[e],1,!0,!0,!1),t.isError)return t[0];if(t.isConvertError)return f;for(r=0;r<t.length;r++)i=t[r],i!==u.CalcConvertedError&&(o+=i*i)}return u.toResult(o)}function ge(n){var s=0,e,o,t=u.toArr(n[0],1,!0,!0,!1),i,r;if(t.isError)return t[0];if(t.isConvertError)return f;if(i=u.toArr(n[1],1,!0,!0,!1),i.isError)return i[0];if(i.isConvertError)return f;if(t.length!==i.length)return a;for(r=0;r<t.length;r++)e=t[r],o=i[r],e!==u.CalcConvertedError&&o!==u.CalcConvertedError&&(s+=e*e-o*o);return u.toResult(s)}function no(n){var s=0,e,o,t=u.toArr(n[0],1,!0,!0,!1),i,r;if(t.isError)return t[0];if(t.isConvertError)return f;if(i=u.toArr(n[1],1,!0,!0,!1),i.isError)return i[0];if(i.isConvertError)return f;if(t.length!==i.length)return a;for(r=0;r<t.length;r++)e=t[r],o=i[r],e!==u.CalcConvertedError&&o!==u.CalcConvertedError&&(s+=e*e+o*o);return u.toResult(s)}function to(n){var s=0,e,o,t=u.toArr(n[0],1,!0,!0,!1),i,r;if(t.isError)return t[0];if(t.isConvertError)return f;if(i=u.toArr(n[1],1,!0,!0,!1),i.isError)return i[0];if(i.isConvertError)return f;if(t.length!==i.length)return a;for(r=0;r<t.length;r++)e=t[r],o=i[r],e!==u.CalcConvertedError&&o!==u.CalcConvertedError&&(s+=(e-o)*(e-o));return u.toResult(s)}function io(n){var e,o,s,t,r,i,h;if(isNaN(e=u.D(n[0]))||isNaN(s=u.I(n[1]))||isNaN(o=u.I(n[2])))return f;if(t=u.toArr(n[3],1,!0,!0,!0),t.isError)return t[0];if(t.isConvertError)return f;for(r=0,i=0;i<t.length;i++){if(isNaN(h=u.D(t[i])))return f;r+=h*et(e,s+i*o)}return u.toResult(r)}function ro(n){var t;return isNaN(t=u.D(n[0]))?f:t<0?o:u.toResult(rt(t*yt))}function uo(n){var t;return isNaN(t=u.D(n[0]))?f:yt*t/180}function fo(n){var t;return isNaN(t=u.D(n[0]))?f:u.toResult(ar(t))}function eo(n){var t;return isNaN(t=u.D(n[0]))?f:t<-1||1<t?o:u.toResult(vr(t))}function oo(n){var t;return isNaN(t=u.D(n[0]))?f:u.toResult((v(t)+v(-t))/2)}function so(n){var t;return isNaN(t=u.D(n[0]))?f:t<1?o:u.toResult(k(t+rt(t*t-1)))}function ho(n){var t;return isNaN(t=u.D(n[0]))?f:u.toResult(cr(t))}function co(n){var t;return isNaN(t=u.D(n[0]))?f:t<-1||1<t?o:u.toResult(lr(t))}function lo(n){var t;return isNaN(t=u.D(n[0]))?f:u.toResult((v(t)-v(-t))/2)}function ao(n){var t;return isNaN(t=u.D(n[0]))?f:u.toResult(k(t+rt(t*t+1)))}function vo(n){var t;return isNaN(t=u.D(n[0]))?f:u.toResult(yr(t))}function yo(n){var t;return isNaN(t=u.D(n[0]))?f:u.toResult(pr(t))}function po(n){var t,i;return isNaN(t=u.D(n[0]))||isNaN(i=u.D(n[1]))?f:t===0&&i===0?w:u.toResult(wr(i,t))}function wo(n){var t,i,r;return isNaN(t=u.D(n[0]))?f:(i=v(t),r=v(-t),u.toResult(i-r)/(i+r))}function bo(n){var t;return isNaN(t=u.D(n[0]))?f:t<=-1||1<=t?o:u.toResult(k((1+t)/(1-t))/2)}function ko(n){var p=u,w=u.CalcConvertedError,t=u.toArr(n[0],1,!1,!0,!0),r,l,i,a,o,e,v,s,y,h,c;if(t.isError)return t[0];if(t.rangeCount>1||t.rowCount!==t.colCount)return f;for(r=t.rowCount,l=1,i=0;i<r-1;i++){if(t[i][i]===0){for(a=!1,o=i+1;!a&&o<r;o++)if(t[o][i]!==0){for(e=i;e<r;e++)v=t[i][e],t[i][e]=t[o][e],t[o][e]=v;l*=-1;a=!0}if(!a)return 0}for(s=i+1;s<r;s++)if(t[s][i]!==0)for(y=t[s][i]/t[i][i],h=i;h<r;h++)t[s][h]-=y*t[i][h]}for(c=0;c<r;c++)l*=t[c][c];return l}function go(n){var rt=u,ut=u.CalcConvertedError,r=u.toArr(n[0],1,!1,!0,!0),e,s,v,p,t,k,h,l,nt,a,tt,c,g,w,b,y,it,d;if(r.isError)return r[0];if(r.rangeCount>1||r.rowCount!==r.colCount)return f;for(e=r.rowCount,s=[],v=0;v<e;v++)for(s[v]=[e],p=0;p<e;p++)s[v][p]=v===p?1:0;for(t=0;t<e;t++){if(r[t][t]===0){for(k=!1,h=t+1;!k&&h<e;h++)if(r[h][t]!==0){for(l=t;l<e;l++)nt=r[t][l],r[t][l]=r[h][l],r[h][l]=nt;for(a=1;a<e;a++)tt=s[t][a],s[t][a]=s[h][a],s[h][a]=tt;k=!0}if(!k)return o}for(c=0;c<e;c++)if(c!==t&&r[c][t]!==0){for(g=r[c][t]/r[t][t],w=t;w<e;w++)r[c][w]-=g*r[t][w];for(b=0;b<e;b++)s[c][b]-=g*s[t][b]}}for(y=0;y<e;y++)for(it=r[y][y],d=0;d<e;d++)s[y][d]/=it;return new i._ConcreteArray(s)}function ns(n){var t=u.toArr(n[0],1,!1,!0,!0),r=u.toArr(n[1],1,!1,!0,!0),h,a,v,e,o,c,s;if(t.isError||r.isError)return t.isError?t[0]:r[0];var y=t.rowCount,p=t.colCount,l=r.rowCount,w=r.colCount;if(t.isConvertError||r.isConvertError||p!==l)return f;for(h=[],e=0;e<y;e++)for(h[e]=a=[],v=t[e],o=0;o<w;o++){for(c=0,s=0;s<l;s++)c+=v[s]*r[s][o];a[o]=c}return new i._ConcreteArray(h)}function gi(n){for(var i=1,t=n;t>1;t--)i*=t;return i}function ts(n){for(var e,c,i,r=0,h=1,l=u,t,s=0;s<n.length;s++){if(t=u.toArr(n[s],0,!0,!0,!1),t.isError)return t[0];if(t.isConvertError)return f;for(e=0;e<t.length;e++){if(c=t[e],i=u.I(c),i<0||170<i)return o;r+=i;h*=gi(i)}}return r<0||170<r?o:gi(r)/h}function is(n){var t=li(),i=-1+t*2;return l(i)}function rs(n){var t,i,r;return u.err(n[1])?n[1]:u.err(n[0])?n[0]:isNaN(t=u.I(n[0]))||isNaN(i=u.I(n[1]))?f:i<t?o:(r=li(),u.I(t+r*(i-t+1)))}function us(){var n=[];return n.push(new g("M",1e3)),n.push(new g("D",500)),n.push(new g("C",100)),n.push(new g("L",50)),n.push(new g("X",10)),n.push(new g("V",5)),n.push(new g("I",1)),n}function fs(n){var w=u,p=i._Helper,e,s,o,t,r,h,l,v,c,a,y;if(u.err(n[0]))return n[0];if(e=u.I(n[0]),s=0,p._argumentExists(n,1)){if(u.err(n[1]))return n[1];s=typeof n[1]=="boolean"?n[1]?0:4:u.I(n[1])}if(o=[],e<0||3999<e||s<0||4<s)return f;for(t=us(),r=0;r<t.length;r+=2){if(2<=r&&t[r-2].Value-t[r].Value<=e){for(h=r,l=r-2,v=0;v<s&&h+1<t.length&&t[l].Value-t[h+1].Value<=e;v++)h++;o.push(t[h].Key);o.push(t[l].Key);e+=t[h].Value;e-=t[l].Value}if(1<=r&&t[r-1].Value<=e&&(o.push(t[r-1].Key),e-=t[r-1].Value),1<=r&&t[r-1].Value-t[r].Value<=e){for(c=r,a=r-1,y=0;y<s&&c+1<t.length&&t[a].Value-t[c+1].Value<=e;y++)c++;o.push(t[c].Key);o.push(t[a].Key);e+=t[c].Value;e-=t[a].Value}while(t[r].Value<=e)o.push(t[r].Key),e-=t[r].Value}return o.join("")}function es(n){for(var t,r,i=0;i<n.length;i++){if(t=u.toArr(n[i],3,!0,!0,!1),t.isError)return t[0];else if(t.isConvertError)return f;for(r=0;r<t.length;r++)if(!t[r])return!1}return!0}function os(n){for(var t,i,r=0;r<n.length;r++){if(t=u.toArr(n[r],3,!0,!0,!1),t.isError)return t[0];else if(t.isConvertError)return f;for(i=0;i<t.length;i++)if(t[i]&&t[i]!==u.CalcConvertedError)return!0}return!1}function nr(n){try{var t=u.B(n);return!t}catch(i){return f}}function ss(n){var t,r,o,s;if(u.ref(n[0]))return n[0].getRangeCount()>1?f:new i._UnaryCompositeConcreteReference(n[0].getSource(),n[0].getRow(0),n[0].getColumn(0),n[0].getRowCount(0),n[0].getColumnCount(0),nr);if(u.arr(n[0])){var e=[],c=n[0].getRowCount(),h=n[0].getColumnCount();for(t=0;t<c;t++)for(e[t]=[h],r=0;r<h;r++)o=n[0].getValue(t,r),s=typeof o,e[t][r]=s===pt||s===br?!o:f;return new i._ConcreteArray(e)}return nr(n[0])}function tr(n,t,i){try{var r=u.B(n);return r?t:i}catch(e){return f}}function hs(n){var f=n[0],o=n[1],e=i._Helper,s=e._argumentExists(n,2)?n[2]:n.length===2?!1:0,t=e.tryExtractToSingleValue(f),c,r,u;if(t.success)return f=t.value,tr(f,o,s);t=e.tryExtractToSingleValue(o);o=t.value;c=t.success;t=e.tryExtractToSingleValue(s);s=t.value;var a=t.success,v=f.getRowCount(),l=f.getColumnCount(),h=[];for(r=0;r<v;r++)for(h[r]=[l],u=0;u<l;u++)h[r][u]=tr(f.getValue(r,u),c?o:e.getArrayValue(o,r,u),a?s:e.getArrayValue(s,r,u));return new i._ConcreteArray(h)}function cs(n,t){return u.err(n)?t!==h&&t!==s?t:0:n!==h&&n!==s?n:0}function ls(n){var r=u.err(n[0]),t;return!r&&u.ref(n[0])?(t=n[0],t.getRangeCount()>1)?f:new i._BinaryCompositeConcreteReference(t.getSource(),t.getRow(0),t.getColumn(0),t.getRowCount(0),t.getColumnCount(0),cs,n[1]):r?n[1]!==h&&n[1]!==s?n[1]:0:n[0]!==h&&n[0]!==s?n[0]:0}function as(n){return!0}function vs(n){return!1}function ys(n){var t,r,e,i;try{return isNaN(t=u.I(n[0]))||isNaN(r=u.I(n[1]))||isNaN(e=u.I(n[2]))?f:t<0||9999<t?o:(t<=1899&&(t+=1900),i=new Date(t,r-1,e),i<new Date(1899,11,30))?o:i}catch(s){return o}}function ps(t){var r,e,s,i;try{return isNaN(r=u.I(t[0]))||isNaN(e=u.I(t[1]))||isNaN(s=u.I(t[2]))?f:(i=n.Sheets._DateTimeHelper.fromOADate(0),i.setHours(r),i.setMinutes(e),i.setSeconds(s),i.setMilliseconds(0),i.getHours()<0&&i.getMinutes()<0&&i.getSeconds()<0)?o:i}catch(h){return o}}function ft(n){return n%400==0||n%4==0&&n%100!=0||n===1900}function ws(t){var r,i,o,c,l;try{if((r=u.S(t[0]),r===h||r===s||r==="")||(i=n.Sheets._DateTimeHelper.parseLocale(r),i||(i=new Date(r),(!i||isNaN(i.valueOf()))&&(i=null)),!i)||(o=i.getFullYear(),o<1900))return f;var a=i.getMonth(),v=i.getDate(),e=0;for(c=1900;c<o;c++)e+=ft(c)?366:365;for(l=0;l<a;l++)switch(l){case 0:case 2:case 4:case 6:case 7:case 9:case 11:e+=31;break;case 1:e+=ft(o)?29:28;break;case 3:case 5:case 8:case 10:e+=30;break}return e+v}catch(y){return f}}function bs(t){try{return n.Sheets._DateTimeHelper.parseLocale(t)}catch(i){return f}}function ir(n){var t=u.S(n[0]);if(t===h||t===s||t==="")return f;try{var i=bs(t),r=(i.getHours()*60+i.getMinutes())*60+i.getSeconds(),e=86400;return r/e}catch(o){return f}}function ks(n){return new Date}function ds(n){var t=new Date;return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t}function gs(n){try{var t=u.DT(n[0]);return t.getHours()}catch(i){return f}}function nh(n){try{var t=u.DT(n[0]);return t.getMinutes()}catch(i){return f}}function th(n){try{var t=u.DT(n[0]);return t.getSeconds()}catch(i){return f}}function ih(n){try{var t=u.DT(n[0]);return t.getDate()}catch(i){return f}}function rh(n){try{var t=u.DT(n[0]);return t.getMonth()+1}catch(i){return f}}function uh(n){try{var t=u.DT(n[0]);return t.getFullYear()}catch(i){return f}}function fh(n){for(var r=n.getFullYear(),u=n.getMonth(),f=n.getDate(),t=0,i=0;i<u;i++)switch(i){case 0:case 2:case 4:case 6:case 7:case 9:case 11:t+=31;break;case 1:t+=ft(r)?29:28;break;case 3:case 5:case 8:case 10:t+=30;break}return t+f}function eh(n,t){var f=fh(n),r=new Date(n.getFullYear(),0,1).getDay(),i;return t===2&&(r-=1,r<0&&(r=6)),i=f-1-(6-r),i<0&&(i=0),1+u.I(i/7)+(i%7!=0?1:0)}function oh(n){var r,t,s;try{r=u.DT(n[0])}catch(e){return f}if(isNaN(t=u.I(i._Helper._argumentExists(n,1)?n[1]:1)))return f;switch(t){case 1:case 2:return eh(r,t);default:return o}}function b(n){var t,e,r;try{t=u.DT(n[0])}catch(s){return f}if(isNaN(e=u.I(i._Helper._argumentExists(n,1)?n[1]:1)))return f;switch(e){case 1:r=t.getDay()+1;break;case 2:r=t.getDay()===0?7:t.getDay();break;case 3:r=t.getDay()===0?6:t.getDay()-1;break;default:return o}return r}function sh(n){var t,i;try{t=u.DT(n[0])}catch(r){return f}return isNaN(i=u.I(n[1]))?f:(t.setMonth(t.getMonth()+i),t)}function hh(n,t){switch(t){case 0:case 2:case 4:case 6:case 7:case 9:case 11:return 31;case 1:return ft(n)?29:28;case 3:case 5:case 8:case 10:return 30}}function ch(n){var t,i,r;try{t=u.DT(n[0])}catch(e){return f}return isNaN(i=u.I(n[1]))?f:(t.setMonth(t.getMonth()+i),r=hh(t.getFullYear(),t.getMonth()),t.setDate(r),t)}function rr(n,t){return n-t}function oa(n,t){for(var r,u=n.length,i=0;i<u;i++)if(r=n[i],rr(r,t)===0)return!0;return!1}function lh(r){var y=u,v=i._Helper,s=u.DT(r[0]),h=u.I(r[1]),c=[],l,a,e;if(v._argumentExists(r,2)){if(c=u.toArr(r[2],4,!0,!0,!0),c.isError)return c[0];if(c.isConvertError)return f}if(l=[],l[0]=s,l[1]=3,a=b(l),u.err(a))return a;for(e=u.I(a);h<0;++h){try{s.setDate(s.getDate()-1)}catch(p){return o}e===0?e=6:e--;e===5||e===6?h--:c.indexOf(t._DateTimeHelper.___toOADate(s))>=0&&h--}for(;h>0;--h){try{s.setDate(s.getDate()+1)}catch(w){return o}e===6?e=0:e++;e===5||e===6?h++:c.indexOf(t._DateTimeHelper.___toOADate(s))>=0&&h++}return new n.Sheets._DateTimeHelper(s).toOADate()}function ah(n){var w=u,v=i._Helper,e=u.DT(n[0]),s=u.I(n[1]),p=v._argumentExists(n,2)?n[2]:"0000011",c=hi(p),y,h,l,a,r;if(u.err(c))return c;if(y=c.join(""),y==="1111111")return f;if(h=[],v._argumentExists(n,3)){if(h=u.toArr(n[3],4,!0,!0,!0),h.isError)return h[0];if(h.isConvertError)return f}if(l=[],l[0]=e,l[1]=3,a=b(l),u.err(a))return a;for(r=u.I(a);s<0;++s){try{e.setDate(e.getDate()-1)}catch(k){return o}r===0?r=6:r--;c[r]?s--:h.indexOf(t._DateTimeHelper.___toOADate(e))>=0&&s--}for(;s>0;--s){try{e.setDate(e.getDate()+1)}catch(d){return o}r===6?r=0:r++;c[r]?s++:h.indexOf(t._DateTimeHelper.___toOADate(e))>=0&&s++}return t._DateTimeHelper.___toOADate(e)}function ur(n){var v=u,h=i._Helper,e=u.DT(n[0]),o=u.DT(n[1]),c=h._argumentExists(n,2)?u.B(n[2]):!1,t=e.getDate(),r=o.getDate(),l=e.getMonth(),f=o.getMonth(),a=e.getFullYear(),s=o.getFullYear();return c?(r=r===31?30:r,t=t===31?30:t):(t=t===31?30:t,r===31&&(t<30?(r=1,f++,f>12&&(f=1,s++)):r=30)),((s-a)*12+(f-l))*30+(r-t)}function vh(n,t){return t&&t.length&&t.length>0?t[b([n,3])]:n.getDay()===6||n.getDay()===0}function fr(n,r,f,e,o){var b=u,v=i._Helper,s,c,y,p,l,a,h,w;if(o){if(y=v._argumentExists(n,2)?n[2]:"0000011",c=hi(y),u.err(c))return c;v._argumentExists(n,3)&&(s=u.toArr(n[3],4,!0,!0,!1))}else v._argumentExists(n,2)&&(s=u.toArr(n[2],4,!0,!0,!1));if(!s)return e;if(s.isError)return s[0];for(p=s.length,l=[],a=0;a<p;a++)h=s[a],w=t._DateTimeHelper._fromOADate(h),l.indexOf(h)===-1&&!vh(w,c)&&h>=r&&h<=f&&l.push(h);return e-l.length}function yh(t,i,r){var c=u,o=n.Sheets._DateTimeHelper,f=u.I(new o(i).toOADate()-new o(t).toOADate())%7,s=u.I(b([t,2])+f),e,h;return f=s>5?s-5:0,e=t.getDay()===0?1:2,f=f>e?e:f,r-=f,h=nt(r/7)*2,r-h}function ph(t){var a=u,s=n.Sheets._DateTimeHelper,e=u.DT(t[0]),o=u.DT(t[1]),r=u.I(new s(e).toOADate()),f=u.I(new s(o).toOADate()),h=!1,c,l,i;return(r>f&&(c=e,l=r,r=f,f=l,e=o,o=c,h=!0),i=f-r+1,i=yh(e,o,i),i<=0)?0:(i=fr(t,r,f,i),h?-i:i)}function wh(t){var a=u,s=n.Sheets._DateTimeHelper,e=u.DT(t[0]),o=u.DT(t[1]),r=u.I(new s(e).toOADate()),f=u.I(new s(o).toOADate()),h=!1,c,l,i;return(r>f&&(c=e,l=r,r=f,f=l,e=o,o=c,h=!0),i=f-r+1,i=bh(t,e,o,i),u.err(i))?i:i<=0?0:(i=fr(t,r,f,i,!0),h?-i:i)}function bh(n,t,r,f){var k=u,p=i._Helper,w=p._argumentExists(n,2)?n[2]:"0000011",o=hi(w),l,c,s,y;if(u.err(o))return o;for(l=0,c=0;c<o.length;c++)o[c]===1&&l++;if(s=0,f<30){for(e=0;e<f;e++)o[(u.I(b([t,3]))+e)%7]&&s++;return f-s}else{for(var h=f,a=0,v=0,e=0;e<h;e++){if(u.I(b([t,3])+e)%7==0)break;a++}for(e=0;e<a;e++)o[(u.I(b([t,3]))+e)%7]&&s++;for(e=0;e<h;e++){if((u.I(b([r,3]))+7-e)%7==6)break;v++}for(e=0;e<v;e++)o[(u.I(b([r,3]))+7-e)%7]&&s++;return h=h-a-v,y=u.I(h/7)*l,f-=y,f-s}}function hi(n){var t,r,i;if(typeof n===ut){if(n.length!==7||isNaN(parseInt(n)))return f}else if(!isNaN(n)){if(nt(n)<1||nt(n)>17)return o;n=n.toString()}t=[0,0,0,0,0,0,0];r=n.length;switch(r){case 1:switch(n){case"1":t[5]=1;t[6]=1;break;case"2":t[6]=1;t[0]=1;break;case"3":t[0]=1;t[1]=1;break;case"4":t[1]=1;t[2]=1;break;case"5":t[2]=1;t[3]=1;break;case"6":t[3]=1;t[4]=1;break;case"7":t[4]=1;t[5]=1;break;default:return o}break;case 2:if(n[0]==="1")switch(n[1]){case"1":t[6]=1;break;case"2":t[0]=1;break;case"3":t[1]=1;break;case"4":t[2]=1;break;case"5":t[3]=1;break;case"6":t[4]=1;break;case"7":t[5]=1;break;default:return o}else return o;break;case 7:for(i=0;i<7;i++)t[i]=parseInt(n[i]);break;default:return f}return t}function kh(t,r,f){var k=i.Functions,y=k._FinancialHelper,h=y.__days_between_basis(t,r,f),c,p,o,s,e,w,l,a,v,b;return h<0&&(h=-h,p=t,t=r,r=p),f===1?(o=t.getFullYear(),s=r.getFullYear(),e=t,e.setFullYear(e.getFullYear()+1),rr(r,e)>0?(a=s+1-o,e=new Date(o,0,1),w=new Date(s+1,0,1),v=n.Sheets._DateTimeHelper,l=u.I(new v(w).toOADate()-new v(e).toOADate())-365*(s+1-o)):(a=1,l=ft(o)&&t.getMonth()<3||ft(s)&&r.getMonth()*256+r.getDate()>=541?1:0),b=u.D(l)/u.D(a),c=365+b):c=y.__annual_year_basis(new Date,f),h/c}function er(n){var s=u,r=i._Helper,f=u.DT(n[0]),e=u.DT(n[1]),t=r._argumentExists(n,2)?u.I(n[2]):0;return t<0||t>4?o:kh(f,e,t)}function dh(){var n=[];return n[0]=function(n,t){return t.getFullYear()-n.getFullYear()+(t.getMonth()<n.getMonth()||t.getMonth()===n.getMonth()&&t.getDate()<n.getDate()?-1:0)},n[1]=function(n,t){return 12*(t.getFullYear()-n.getFullYear())+(t.getMonth()-n.getMonth())+(t.getDate()<n.getDate()?-1:0)},n[2]=function(n,t){return(t.getTime()-n.getTime())/864e5},n[3]=function(n,t){var i=new Date(t.getFullYear(),t.getMonth()+t.getDate()<n.getDate()?-1:0,n.getDate());return(t.getTime()-i.getTime())/864e5},n[4]=function(n,t){return t.getMonth()-n.getMonth()+(t.getMonth()<n.getMonth()||t.getMonth()===n.getMonth()&&t.getDate()<n.getDate()?12:0)+(t.getDate()<n.getDate()?-1:0)},n[5]=function(n,t){var i=new Date(t.getFullYear()+(t.getMonth()<n.getMonth()||t.getMonth()===n.getMonth()&&t.getDate()<n.getDate()?-1:0),n.getMonth(),n.getDate());return(t-i)/864e5},n}function gh(n,i){var r;switch(i){case"Y":r=0;break;case"M":r=1;break;case"D":r=2;break;case"MD":r=3;break;case"YM":r=4;break;case"YD":r=5;break;default:throw t.SR.Exp_NotSupport;}return n[r]}function nc(n){var i=u.DT(n[0]),r=u.DT(n[1]),s=u.S(n[2]).toLocaleUpperCase(),e,t;if(r<i)return o;if(e=dh(),t=gh(e,s),t)try{return t(i,r)}catch(h){return f}return o}function tc(n){return 0<=n&&n<=31||127===n||128<=n&&n<=159}function ic(n){for(var i=u.S(n[0]),r=[],t=0;t<i.length;t++)tc(i.charCodeAt(t))||r.push(i[t]);return r.join("")}function or(n){return n===" "||n==="\t"||n==="\n"}function rc(n){for(var t,r=u.S(n[0]).trim(),f=[],e=!0,i=0;i<r.length;i++)t=r.charAt(i),(!or(t)||e)&&f.push(t),e=!or(t);return f.join("")}function sr(n){var i=n.toString(),e="",u,t,r;if(n<0&&(i=i.substr(1),e="-"),u=i.split("."),u.length<1||u.length>2)return f;for(t=[],u.length===2&&(t.push(u[1]),t.push(".")),i=u[0],r=i.length-3;r>=0;r=r-3)t.push(i.substr(r,3)),r>0&&t.push(",");return t.push(i.substring(0,r+3)),t.reverse(),e+t.join("")}function uc(n){var i=sr(n),t;return n<0&&(i=i.substr(1)),t=[],t.push("$"),t.push(i),n<0&&(t.push(")"),t.unshift("(")),t.join("")}function fc(n){var t,o=u,e=i._Helper,r;return isNaN(t=u.D(n[0]))?f:(r=e._argumentExists(n,1)?u.I(n[1]):2,r>99)?f:(t=u.D(si([t,r])),uc(t))}function ec(n){var t,c=u,s=i._Helper;if(isNaN(t=u.D(n[0])))return f;var e=s._argumentExists(n,1)?u.I(n[1]):2,h=s._argumentExists(n,2)?u.B(n[2]):!1,r=[],o=0;return e<0?(o=u.I(et(10,l(e))),t/=o,r[0]=t,r[1]=0):(r[0]=t,r[1]=e),t=u.D(si(r)),e<0&&(t*=o),h?t.toString():sr(t)}function oc(n){var i,r,u,f;if(t.StringUtil.startsWith(n,"[$-"))return n;if(n.indexOf("[")!==-1&&n.indexOf("]")!==-1)for(i=n.indexOf("["),r=n.indexOf("]",i);i!==-1&&r!==-1;)u=n.substring(0,i),f=n.substring(r+1),n=u.concat(f),i=n.indexOf("["),r=i===-1?-1:n.indexOf("]",i);return n}function sc(n){var r=n[0],o=u,c=t._StandardDateTimeFormatter,l=t._StandardNumberFormatter,i=u.S(n[1]),e;if(i===""||i===s||i===h)return u.S(r);(r===s||r===h)&&(r=0);i=oc(i);try{return e=new t.GeneralFormatter(i),e.Format(r)}catch(a){return f}}function hc(t){var l=u,e=n.Sheets._DateTimeHelper,o=u.S(t[0]),i=e.parseLocale(o),r,c;return i!==h&&i!==s?(r=new e(i).toOADate(),l.err(r)?ir([i]):r):isNaN(c=parseFloat(o))?f:c}function cc(n){var t=u.S(n[0]);return t.toLowerCase()}function lc(n){var t=u.S(n[0]);return t.toUpperCase()}function ac(n){var r=u.S(n[0]),o=r.length,f=[],e,s,t;if(o>0)for(e=r.toUpperCase(),s=r.toLowerCase(),f[0]=e[0],t=1;t<o;)f[t]=i.Parser._isLetter(r[t-1])?s[t]:e[t],t++;return f.join("")}function vc(n){var t=u.I(n[0]);return t<1||255<t?f:String.fromCharCode(t)}function yc(n){var t=u.S(n[0]);if(t===""||t===h||t===s)return f;try{return t[0].charCodeAt(0)}catch(i){return f}}function pc(n){var i=u.S(n[0]),t=u.I(n[1]),r=u.I(n[2]),s=u.S(n[3]),e,o;return t<1||r<0?f:(t=vt(t,i.length+1),r=vt(r,i.length-t+1),e=i.substring(0,t-1),o=i.substr(t-1+r),e.concat(s).concat(o))}function wc(n){var e=u.S(n[0]),i=u.S(n[1]),a=u.S(n[2]),o,c,r,l,v,y;if(i===""||i===h||i===s)return e;if(n.length>3){if(c=u.I(n[3]),r=0,c<1)return f;for(l=0;l<c;l++){if(r=e.indexOf(i,r),r===-1)return e;r+=i.length}r-=i.length;v=e.substring(0,r);y=e.substr(r+i.length);o=v.concat(a).concat(y)}else o=t.StringUtil.replace(e,i,a);return o}function bc(n){for(var f,o,t,i,e=[],c=n.length,r=0;r<c;r++)for(f=u.toArr(n[r],0,!0,!1,!1),o=f.length,t=0;t<o;t++)i=f[t],i!==h&&i!==s&&e.push(u.S(i));return e.join("")}function kc(n){var o=u,e=i._Helper,t=u.S(n[0]),r=e._argumentExists(n,1)?u.I(n[1]):1;return r<0?f:r>=t.length?t:t.substr(0,r)}function dc(n){var i=u.S(n[0]),t=u.I(n[1])-1,r=u.I(n[2]);return t<0||r<0?f:t>=i.length?"":i.length<t+r?i.substr(t):i.substr(t,r)}function gc(n){var o=u,e=i._Helper,t=u.S(n[0]),r=e._argumentExists(n,1)?u.I(n[1]):1;return r<0?f:t.length<r?t:t.substr(t.length-r,r)}function nl(n){var e=u.S(n[0]),t=u.I(n[1]),i,r;if(t<0||32767<t*e.length)return f;for(i=[],r=0;r<t;r++)i.push(e);return i.join("")}function tl(n){return u.S(n[0]).length}function il(n){var h=u,o=i._Helper,s=u.S(n[0]),e=u.S(n[1]),t=o._argumentExists(n,2)?u.I(n[2]):1,r;return t<1||e.length<t?f:(r=e.indexOf(s,t-1),r===-1)?f:r+1}function rl(n){var p=u,y=i._Helper,l=u.S(n[0]),a=u.S(n[1]),o=y._argumentExists(n,2)?u.I(n[2]):1,r,c,v,e;if(o--,o<0)return f;r=-1;try{c=t.RegUtil.getWildcardCriteria(l);c?(v=t.RegUtil.getRegIgnoreCase(c),e=v.exec(a),r=e!==h&&e!==s?e.index:-1):r=a.toLowerCase().indexOf(l.toLowerCase(),o)}catch(w){}return r===-1?f:r+1}function ul(n){var t=u.S(n[0]),i=u.S(n[1]);return t===i}function fl(n){var t=n[0];return typeof t=="string"?t:""}function el(n,t){if(u.err(n))t.value=!0;else if(typeof n===ut){var r=i.CalcError._parseCore(n);t.value=r!==h&&r!==s}t.value=!1}function ol(n,t){if(u.err(n)&&n._code!==a._code)t.value=!0;else if(typeof n===ut){var r=i.CalcError._parseCore(n);t.value=r!==h&&r!==s&&r!==a}t.value=!1}function p(n){if(n===h||n===s)throw t.SR.Exp_InvalidArgument;else if(n.length<1||n.length>1)throw t.SR.Exp_InvalidArgument;}function sl(n){p(n);var t={value:!1};return u.err(n[0])?t.value=!0:ri(n[0],el,t),t.value}function hl(n){p(n);var t={value:!1};return u.err(n[0])&&n[0]._code!==a._code?t.value=!0:u.err(n[0])&&n[0]._code===a._code?t.value=!1:ri(n[0],ol,t),t.value}function cl(n){return(p(n),u.err(n[0]))?n[0]._code===a._code:!1}function ll(n){p(n);var t=n[0];if(t!==h&&t!==s&&u.err(t))switch(t._code){case kr._code:return 1;case w._code:return 2;case f._code:return 3;case dr._code:return 4;case gr._code:return 5;case o._code:return 6;case a._code:return 7;default:break}return a}function al(n){return p(n),u.num(n[0])}function vl(n){p(n);var t;return isNaN(t=u.D(n[0]))?f:c._MathHelper.approxFloor(l(t))%2==0}function yl(n){p(n);var t;return isNaN(t=u.D(n[0]))?f:c._MathHelper.approxFloor(l(t))%2!=0}function pl(n){p(n);var t=n[0];if(u.num(t))return u.D(t);else if(typeof t===pt)return t?1:0;else if(u.err(t))return t;return 0}function wl(n){return p(n),n[0]===h||n[0]===s}function bl(n){return p(n),typeof n[0]===pt}function kl(n){return p(n),typeof n[0]===ut}function dl(n){return p(n),typeof n[0]!==ut}function gl(n){return p(n),u.ref(n[0])}function na(n){p(n);var t=n[0];return typeof t===pt?4:u.num(t)?1:typeof t===ut?2:u.err(t)?16:u.arr(t)?64:f}function ta(n){return a}function ia(n){var ft=u,et=i._Helper,l=u.toArr(n[0],0,!1,!0,!1),h=[],b,ot,t,r,y,e,s,p,c,k,w,d,v,tt,o,rt,ut;for(h=et._argumentExists(n,1)?u.toArr(n[1],0,!1,!0,!1):l,b=et._argumentExists(n,2)?u.toArr(n[2],0,!1,!0,!1):h,ot=et._argumentExists(n,3)?u.B(n[3]):!0,t=0;t<l.rowCount;t++)for(r=0;r<l.colCount;r++)if(!ft.num(l[t][r]))return f;for(t=0;t<h.rowCount;t++)for(r=0;r<h.colCount;r++)if(!ft.num(h[t][r]))return f;for(t=0;t<b.rowCount;t++)for(r=0;r<b.colCount;r++)if(!ft.num(b[t][r]))return f;if(l.rowCount===h.rowCount&&l.colCount===h.colCount){p=h.rowCount*h.colCount;var g=0,nt=0,st=0,it=0,ht;for(t=0;t<h.rowCount;t++)for(r=0;r<h.colCount;r++){if(isNaN(c=u.D(h[t][r]))||isNaN(k=u.D(l[t][r])))return f;g+=c;nt+=c*c;st+=k;it+=c*k}for(ot?(s=(p*it-g*st)/(p*nt-g*g),ht=(st*nt-g*it)/(p*nt-g*g)):(s=it/nt,ht=0),w=[],t=0;t<b.rowCount;t++)for(w[t]=[],r=0;r<b.colCount;r++){if(isNaN(c=u.D(b[t][r])))return f;w[t][r]=s*c+ht}return new i._ConcreteArray(w)}else if(l.colCount===1&&l.rowCount===h.rowCount||l.rowCount===1&&l.colCount===h.colCount){if(k=[],c=[],l.colCount===1){for(p=h.rowCount,s=h.colCount,t=0;t<p;t++){if(isNaN(y=u.D(l[t][0])))return f;k[t]=y}for(t=0;t<p;t++)for(c[t]=[],r=0;r<s;r++){if(isNaN(y=u.D(h[t][r])))return f;c[t][r]=y}}else{for(p=h.colCount,s=h.rowCount,c=[],k=[],t=0;t<p;t++){if(isNaN(y=u.D(l[0][t])))return f;k[t]=y}for(t=0;t<p;t++)for(c[t]=[],r=0;r<s;r++){if(isNaN(y=u.D(h[r][t])))return f;c[t][r]=y}}for(o=[],e=0;e<s+1;e++)o[e]=[];for(rt=0;rt<s+1;rt++)for(ut=0;ut<s+2;ut++)o[rt][ut]=0;for(e=0;e<p;e++)for(o[0][s+1]=o[0][s+1]+k[e],t=0;t<s;t++)for(o[0][t+1]=o[0][t+1]+c[e][t],o[t+1][0]=o[0][t+1],o[t+1][s+1]=o[t+1][s+1]+c[e][t]*k[e],r=t;r<s;r++)o[r+1][t+1]=o[r+1][t+1]+c[e][t]*c[e][r],o[t+1][r+1]=o[r+1][t+1];if(o[0][0]=p,ot)for(t=0;t<s+1;t++){if(o[t][t]===0){for(d=!1,r=t+1;!d&&r<s+1;r++)if(o[r][t]!==0){for(e=0;e<s+2;e++)tt=o[t][e],o[t][e]=o[r][e],o[r][e]=tt;d=!0}if(!d)return a}for(v=1/o[t][t],e=0;e<s+2;e++)o[t][e]=o[t][e]*v;for(r=0;r<s+1;r++)if(r!==t)for(v=-o[r][t],e=0;e<s+2;e++)o[r][e]=o[r][e]+v*o[t][e]}else for(t=1;t<s+1;t++){if(o[t][t]===0){for(d=!1,r=t+1;!d&&r<s+1;r++)if(o[r][t]!==0){for(e=0;e<s+2;e++)tt=o[t][e],o[t][e]=o[r][e],o[r][e]=tt;d=!0}if(!d)return a}for(v=1/o[t][t],e=1;e<s+2;e++)o[t][e]=o[t][e]*v;for(r=1;r<s+1;r++)if(r!==t)for(v=-o[r][t],e=1;e<s+2;e++)o[r][e]=o[r][e]+v*o[t][e];o[0][s+1]=0}if(l.colCount===1){for(w=[],t=0;t<b.rowCount;t++){for(w[t]=[],v=o[0][s+1],r=0;r<s;r++){if(isNaN(y=u.D(b[t][r])))return f;v+=o[r+1][s+1]*y}w[t][0]=v}return new i._ConcreteArray(w)}else{for(w=[],w[0]=[],t=0;t<b.colCount;t++){for(v=o[0][s+1],r=0;r<s;r++){if(isNaN(y=u.D(b[r][t])))return f;v+=o[r+1][s+1]*y}w[0][t]=v}return new i._ConcreteArray(w)}}return a}function ra(n){var at=i.Convert,st=i._Helper,p=u.toArr(n[0],1,!1,!0,!0),l=[],it,ht,b,nt,t,f,e,d,y,w,tt,et,g,h,c,s,r,ut;for(l=st._argumentExists(n,1)?u.toArr(n[1],1,!1,!0,!0):p,it=st._argumentExists(n,2)?u.toArr(n[2],1,!1,!0,!0):l,ht=st._argumentExists(n,3)?u.B(n[3]):!0,t=0;t<p.rowCount;t++)for(f=0;f<p.colCount;f++)if(c=p[t][f],c<=0)return o;if(p.rowCount===l.rowCount&&p.colCount===l.colCount){d=l.rowCount*l.colCount;var rt=0,ft=0,ct=0,ot=0,lt;for(t=0;t<l.rowCount;t++)for(f=0;f<l.colCount;f++)y=l[t][f],w=p[t][f],w=k(w),rt+=y,ft+=y*y,ct+=w,ot+=y*w;for(ht?(e=(d*ot-rt*ct)/(d*ft-rt*rt),lt=(ct*ft-rt*ot)/(d*ft-rt*rt)):(e=ot/ft,lt=0),g=[],t=0;t<it.rowCount;t++)for(g[t]=[],f=0;f<it.colCount;f++)y=it[t][f],g[t][f]=v(e*y+lt);return new i._ConcreteArray(g)}else if(p.colCount===1&&p.rowCount===l.rowCount||p.rowCount===1&&p.colCount===l.colCount){if(w=[],y=[],p.colCount===1){for(d=l.rowCount,e=l.colCount,t=0;t<d;t++)b=p[t][0],w[t]=k(b);for(t=0;t<d;t++)for(y[t]=[],f=0;f<e;f++)b=l[t][f],y[t][f]=b}else{for(d=l.colCount,e=l.rowCount,y=[],w=[],t=0;t<d;t++)b=p[0][t],w[t]=b;for(t=0;t<d;t++)for(y[t]=[],f=0;f<e;f++)b=l[f][t],y[t][f]=b}for(r=[],tt=0;tt<e+1;tt++)for(r[tt]=[],et=0;et<e+2;et++)r[tt][et]=0;for(ut=[],tt=0;tt<e+2;tt++)ut[tt]=0;for(nt=0;nt<d;nt++)for(ut[e+1]=ut[e+1]+w[nt]*w[nt],r[0][e+1]=r[0][e+1]+w[nt],ut[0]=r[0][e+1],t=0;t<e;t++)for(r[0][t+1]=r[0][t+1]+y[nt][t],r[t+1][0]=r[0][t+1],r[t+1][e+1]=r[t+1][e+1]+y[nt][t]*w[nt],ut[t+1]=r[t+1][e+1],f=t;f<e;f++)r[f+1][t+1]=r[f+1][t+1]+y[nt][t]*y[nt][f],r[t+1][f+1]=r[f+1][t+1];if(r[0][0]=d,ht)for(h=0;h<e+1;h++){for(t=h;t<e+1&&r[t][h]===0;)t++;if(t>=e+1)return a;for(s=0;s<e+2;s++)c=r[h][s],r[h][s]=r[t][s],r[t][s]=c;for(c=1/r[h][h],s=0;s<e+2;s++)r[h][s]=r[h][s]*c;for(t=0;t<e+1;t++)if(t!==h)for(c=-r[t][h],s=0;s<e+2;s++)r[t][s]=r[t][s]+c*r[h][s]}else for(h=1;h<e+1;h++){for(t=h;t<e+1&&r[t][h]===0;)t++;if(t>=e+1)return a;for(s=1;s<e+2;s++)c=r[h][s],r[h][s]=r[t][s],r[t][s]=c;for(c=1/r[h][h],r[h][s]=r[h][s]*c,t=1;t<e+1;t++)t!==h&&(c=-r[t][h],r[t][s]=r[t][s]+c*r[h][s]);r[0][e+1]=0}if(p.colCount===1){for(g=[],t=0;t<it.rowCount;t++){for(g[t]=[],c=r[0][e+1],f=0;f<e;f++)b=it[(t,f)],c+=r[f+1][e+1]*b;g[t][0]=v(c)}return new i._ConcreteArray(g)}else{for(g=[],g[0]=[],t=0;t<it.colCount;t++){for(c=r[0][e+1],f=0;f<e;f++)b=it[f][t],c+=r[f+1][e+1]*b;g[0][t]=v(c)}return new i._ConcreteArray(g)}}return a}function ua(n){var p,e,y,t,o;if(isNaN(p=u.D(n[0])))return f;var s,r,c=0,i=0,l=0,b=0,k,v,h=u.toArr(n[1],1,!0,!0,!1);if(h.isError)return h[0];if(e=u.toArr(n[2],1,!0,!0,!1),e.isError)return e[0];if(y=h.length,y!==e.length)return a;for(t=0,o=0;o<y;o++)s=h[o],r=e[o],s!==u.CalcConvertedError&&r!==u.CalcConvertedError&&(c+=s,i+=r,l+=r*r,b+=r*s,t++);return t===0?w:t*l-i*i==0?w:(v=(t*b-i*c)/(t*l-i*i),k=c/t-v*(i/t),u.toResult(k+v*p))}function fa(n){return bt.__averageIncludeSubtotals(n,!0,!0)}function hr(n){return bt.__stdevIncludeSubtotals(n,!0,!0)}function ci(n){var s,a=i.Convert,e,t,h,c,r,l;if(isNaN(s=u.D(n[1])))return f;if(e=u.toArr(n[0],1,!0,!0,!1,!0),e.isError)return e[0];if(e.isConvertError)return f;for(t=[],h=0;h<e.length;h++)c=e[h],c!==u.CalcConvertedError&&t.push(c);return(t.sort(function(n,t){return n-t}),t.length===0)?o:s<0||1<s?o:(r=s*(t.length-1),l=r%1,r=parseInt(r.toString(),10),l===0?t[r]:u.D(t[r])+l*(u.D(t[r+1])-u.D(t[r])))}var vi,g,ct,wi,bt,lt;t.feature("calc.functions",["calc.common"]);var s=null,h=undefined,u=i.Convert,l=Math.abs,rt=Math.sqrt,at=Math.max,vt=Math.min,nt=Math.floor,dt=Math.ceil,cr=Math.sin,lr=Math.asin,ar=Math.cos,vr=Math.acos,yr=Math.tan,pr=Math.atan,wr=Math.atan2,v=Math.exp,k=Math.log,yt=Math.PI,li=Math.random,et=Math.pow,ut="string",pt="boolean",br="number",tt=i.Errors,kr=tt.Null,w=tt.DivideByZero,f=tt.Value,dr=tt.Reference,gr=tt.Name,a=tt.NotAvailable,o=tt.Number,c=i.Functions;c._builtInFunctions=c._builtInFunctions||{};r._defineBuildInFunction=ai;r.def=ai;vi=function(){function n(){}return n.days360=ur,n.yearfrac=er,n}();r._DateHelper=vi;r.acceptsAny=e;r.acceptsNone=nu;r.acceptsNotZero=gt;r.acceptsOne=d;r.acceptsTwo=y;r.acceptsZeroTwo=ni;r.acceptsZeroOdd=ti;r.acceptsThree=wt;r.isVolatile=ot;r.acceptsOneTwo=st;r.isBranch=yi;r.acceptsZero=ii;r.findTestArgument=pi;r.acceptAboveZero=ui;r.acceptsSecond=iu;r.acceptsSecondOrThirdOrFourth=fi;r.acceptsThird=ru;r.acceptsFirstOrThird=uu;r.acceptsFirstOrOne=fu;r.acceptsFirstOrOdd=eu;r.acceptsFirst=ht;r.acceptsFirstOrSecondOrThird=ei;r.acceptsEven=ou;r.acceptsFourth=su;r.acceptsNotFourth=oi;r.acceptsFourthOrFifth=hu;r.acceptsNotSecond=cu;r.acceptsThreeFour=lu;r.acceptsTwoThree=it;r.acceptsPositive=au;r.acceptsFour=vu;r.acceptsFourFive=yu;r.acceptsFive=pu;r.acceptsSix=wu;r.acceptsEight=bu;r.acceptsSeven=ku;r.acceptsNotTwo=du;r.acceptsFiveSix=gu;r.acceptsFourSixSeven=nf;r.acceptsThreeFourFive=tf;r.acceptsMoreThanOne=rf;r.acceptsTwoThreeFour=uf;r.acceptsOneTwoThree=ff;g=function(){function n(n,t){this.Key=n;this.Value=t}return n}();ct=[/\\/g,/\(/g,/\[/g,/\{/g,/\^/g,/\$/g,/\|/g,/\)/g,/\+/g,/\./g];wi=function(){function t(){}return t.__isLeapYear=function(n){return n%400==0||n%4==0&&n%100!=0||n===1900},t.__compareDateTime=function(n,t){return n-t},t.__toOADate=function(t){return new n.Sheets._DateTimeHelper(t).toOADate()},t.__annual_year_basis=function(n,i){var r;switch(i){case 0:return 360;case 1:return r=t.__isLeapYear(n.getFullYear()),r?366:365;case 2:return 360;case 3:return 365;case 4:return 360;default:return-1}},t.__getDaysInMonth=function(n,i){switch(i){case 0:case 2:case 4:case 6:case 7:case 9:case 11:return 31;case 1:return t.__isLeapYear(n)?29:28;break;case 3:case 5:case 8:case 10:return 30}},t.__Days_Between_BASIS_30E_360=function(n,t){var u,f,i,e,o,r;return u=n.getFullYear(),f=n.getMonth(),i=n.getDate(),e=t.getFullYear(),o=t.getMonth(),r=t.getDate(),i===31&&(i=30),r===31&&(r=30),(e-u)*360+(o-f)*30+(r-i)},t.__Days_Between_BASIS_30Ep_360=function(n,t){var f,e,i,o,u,r;return f=n.getFullYear(),e=n.getMonth(),i=n.getDate(),o=t.getFullYear(),u=t.getMonth(),r=t.getDate(),i===31&&(i=30),r===31&&(r=1,u++),(o-f)*360+(u-e)*30+(r-i)},t.__Days_Between_BASIS_MSRB_30_360_SYM=function(n,i){var o,f,r,s,e,u;return o=n.getFullYear(),f=n.getMonth(),r=n.getDate(),s=i.getFullYear(),e=i.getMonth(),u=i.getDate(),f===2&&t.__getDaysInMonth(o,f)===r&&(r=30),e===2&&t.__getDaysInMonth(s,e)===u&&(u=30),u===31&&r>=30&&(u=30),r===31&&(r=30),(s-o)*360+(e-f)*30+(u-r)},t.__Days_Between_BASIS_MSRB_30_360=function(n,i){var o,f,r,s,e,u;return o=n.getFullYear(),f=n.getMonth(),r=n.getDate(),s=i.getFullYear(),e=i.getMonth(),u=i.getDate(),f===2&&t.__getDaysInMonth(o,f)===r&&e===2&&t.__getDaysInMonth(s,e)===u&&(r=30,u=30),u===31&&r>=30&&(u=30),r===31&&(r=30),(s-o)*360+(e-f)*30+(u-r)},t.__days_between_basis=function(n,i,r){var f=1,e;t.__compareDateTime(n,i)>0&&(e=n,n=i,i=e,f=-1);switch(r){case 1:case 2:case 3:return f*u.I(t.__toOADate(i)-t.__toOADate(n));case 4:return f*t.__Days_Between_BASIS_30E_360(n,i);case 5:return f*t.__Days_Between_BASIS_30Ep_360(n,i);case 6:return f*t.__Days_Between_BASIS_MSRB_30_360_SYM(n,i);default:return f*t.__Days_Between_BASIS_MSRB_30_360(n,i)}},t}();r._FinancialHelper=wi;bt=function(){function n(){}return n.__dev1=function(n,t,i,r){for(var e,o,l,v,y,s,a,h,c,f=0;f<n.length;f++)for(e=u.toArr(n[f],1,!1,!1,!1,!0),o=0;o<e.rangeCount;o++)for(l=e.rangeCount>1?e[o]:e,e.isReference&&(v=n[f].getRow(o),y=n[f].getColumn(o)),s=0;s<l.length;s++)if(i||!e.isReference||!n[f].isHiddenRow(o,s,r))for(a=l[s],h=0;h<a.length;h++)!i&&e.isReference&&n[f].isSubtotal(o,s+v,h+y)||(c=a[h],c!==u.CalcConvertedError&&(t.sumx+=c,t.sumx2+=c*c,t.n++))},n.st_normsdist=function(n){var e,o,t,r,i;return isNaN(e=u.D(n[0]))?f:(o=6,e===0?r=0:(t=.5*l(e),t>=o*.5?r=1:t<1?(i=t*t,r=((((((((.000124818987*i-.001075204047)*i+.005198775019)*i-.019198292004)*i+.059054035642)*i-.151968751364)*i+.319152932694)*i-.5319230073)*i+.797884560593)*t*2):(t-=2,r=(((((((((((((-45255659e-12*t+.00015252929)*t-19538132e-12)*t-.000676904986)*t+.001390604284)*t-.00079462082)*t-.002034254874)*t+.006549791214)*t-.010557625006)*t+.011630447319)*t-.009279453341)*t+.005353579108)*t-.002141268741)*t+.000535310849)*t+.999936657524)),e>0?(r+1)*.5:(1-r)*.5)},n.__averageIncludeSubtotals=function(n,t,i){for(var r,f,c,y,p,o,l,s,a,v=0,h=0,h=0,e=0;e<n.length;e++)for(r=u.toArr(n[e],1,!1,!1,!1,!0),f=0;f<r.rangeCount;f++)for(c=r.rangeCount>1?r[f]:r,r.isReference&&(y=n[e].getRow(f),p=n[e].getColumn(f)),o=0;o<c.length;o++)if(t||!r.isReference||!n[e].isHiddenRow(f,o,i))for(l=c[o],s=0;s<l.length;s++)!t&&r.isReference&&n[e].isSubtotal(f,o+y,s+p)||(a=l[s],a!==u.CalcConvertedError&&(v+=a,h++));return h===0?w:u.toResult(v/h)},n.__countIncludeSubtotals=function(n,t,i){for(var r,f,c,v,y,o,l,s,h,a=0,e=0;e<n.length;e++)for(r=u.toArr(n[e],0,!1,!1,!1,!0),f=0;f<r.rangeCount;f++)for(c=r.rangeCount>1?r[f]:r,r.isReference&&(v=n[e].getRow(f),y=n[e].getColumn(f)),o=0;o<c.length;o++)if(t||!r.isReference||!n[e].isHiddenRow(f,o,i))for(l=c[o],s=0;s<l.length;s++)!t&&r.isReference&&n[e].isSubtotal(f,o+v,s+y)||(h=l[s],h!==null&&h!==""&&h!==u.CalcConvertedError&&u.num(h)&&a++);return a},n.__countaIncludeSubtotals=function(n,t,i){for(var r,f,l,p,w,o,a,c,v,y=0,e=0;e<n.length;e++)for(r=u.toArr(n[e],0,!1,!1,!1),f=0;f<r.rangeCount;f++)for(l=r.rangeCount>1?r[f]:r,r.isReference&&(p=n[e].getRow(f),w=n[e].getColumn(f)),o=0;o<l.length;o++)if(t||!r.isReference||!n[e].isHiddenRow(f,o,i))for(a=l[o],c=0;c<a.length;c++)!t&&r.isReference&&n[e].isSubtotal(f,o+p,c+w)||(v=a[c],v!==s&&v!==h&&y++);return y},n.__maxIncludeSubtotals=function(n,t,i){for(var r,e,a,p,w,s,v,h,y=!1,l=0,c,o=0;o<n.length;o++){if(r=u.toArr(n[o],1,!1,!0,!1,!0),r.isError)return r[0];if(r.isConvertError)return f;for(e=0;e<r.rangeCount;e++)for(a=r.rangeCount>1?r[e]:r,r.isReference&&(p=n[o].getRow(e),w=n[o].getColumn(e)),s=0;s<a.length;s++)if(t||!r.isReference||!n[o].isHiddenRow(e,s,i))for(v=a[s],h=0;h<v.length;h++)!t&&r.isReference&&n[o].isSubtotal(e,s+p,h+w)||(c=v[h],c!==u.CalcConvertedError&&((!y||c>l)&&(l=c),y=!0))}return l},n.__minIncludeSubtotals=function(n,t,i){for(var r,e,a,p,w,s,v,h,y=!1,l=0,c,o=0;o<n.length;o++){if(r=u.toArr(n[o],1,!1,!0,!1,!0),r.isError)return r[0];if(r.isConvertError)return f;for(e=0;e<r.rangeCount;e++)for(a=r.rangeCount>1?r[e]:r,r.isReference&&(p=n[o].getRow(e),w=n[o].getColumn(e)),s=0;s<a.length;s++)if(t||!r.isReference||!n[o].isHiddenRow(e,s,i))for(v=a[s],h=0;h<v.length;h++)!t&&r.isReference&&n[o].isSubtotal(e,s+p,h+w)||(c=v[h],c!==u.CalcConvertedError&&((!y||c<l)&&(l=c),y=!0))}return l},n.__sumIncludeSubtotals=function(n,t,i){for(var r,e,l,y,p,s,a,h,v=0,c,o=0;o<n.length;o++){if(r=u.toArr(n[o],1,!1,!0,!1,!0),r.isError)return r[0];if(r.isConvertError)return f;for(e=0;e<r.rangeCount;e++)for(l=r.rangeCount>1?r[e]:r,r.isReference&&(y=n[o].getRow(e),p=n[o].getColumn(e)),s=0;s<l.length;s++)if(t||!r.isReference||!n[o].isHiddenRow(e,s,i))for(a=l[s],h=0;h<a.length;h++)!t&&r.isReference&&n[o].isSubtotal(e,s+y,h+p)||(c=a[h],c!==u.CalcConvertedError&&(v+=c))}return v},n.__stdevIncludeSubtotals=function(t,i,r){var f={sumx:0,sumx2:0,n:0},e=n.__dev1(t,f,i,r);return u.err(e)?e:f.n<=1?w:u.toResult(rt(at(0,(f.n*f.sumx2-f.sumx*f.sumx)/(f.n*(f.n-1)))))},n.__stdevpIncludeSubtotals=function(t,i,r){var f={sumx:0,sumx2:0,n:0},e=n.__dev1(t,f,i,r);return u.err(e)?e:f.n<=0?w:u.toResult(rt(at(0,(f.n*f.sumx2-f.sumx*f.sumx)/(f.n*f.n))))},n.__varrIncludeSubtotals=function(t,i,r){var f={sumx:0,sumx2:0,n:0},e=n.__dev1(t,f,i,r);return u.err(e)?e:f.n<=1?w:u.toResult(at(0,(f.n*f.sumx2-f.sumx*f.sumx)/(f.n*(f.n-1))))},n.__varpIncludeSubtotals=function(t,i,r){var f={sumx:0,sumx2:0,n:0},e=n.__dev1(t,f,i,r);return u.err(e)?e:f.n<=0?w:u.toResult(at(0,(f.n*f.sumx2-f.sumx*f.sumx)/(f.n*f.n)))},n.st_percentile=ci,n}();r._StatHelper=bt;lt=function(){function n(){}return n.log=function(n,t){return isNaN(n)?n:isNaN(t)?t:t!==1&&n===1||t!==0&&t!==Number.POSITIVE_INFINITY?k(n)/k(t):NaN},n.log10=function(t){return n.log(t,10)},n}();r._MathHelper=function(){function i(n){var t=nt(n);return c._MathHelper.approxEqual(n,t+1)?t+1:t}function r(n){var t=dt(n);return c._MathHelper.approxEqual(n,t-1)?t-1:t}function y(n,t){return n===t?!0:l(n-t)<l(n)/281474976710656}function p(){var n=[];return n[0]=1,n[1]=10,n[2]=100,n[3]=1e3,n[4]=1e4,n[5]=1e5,n[6]=1e6,n[7]=1e7,n[8]=1e8,n[9]=1e9,n[10]=1e10,n[11]=1e11,n[12]=1e12,n[13]=1e13,n[14]=1e14,n[15]=1e15,n[16]=1e16,n}function e(n){var i=p(),t=i[n];return t!==h&&t!==s?t:et(10,parseFloat(n))}function n(n,i){var r,l,f,e,a,o,c,v;switch(n){case 0:r=function(n,t){return n<=t};f=function(n,t){return n<=t};break;case 1:r=function(n,t){return n>=t};f=function(n,t){return n>=t};break;case 2:r=function(n,t){return n!==t};f=function(n,t){return n!==t};break;case 3:r=function(n,t){return n<t};f=function(n,t){return n<t};break;case 4:r=function(n,t){return n===t};f=function(n,t){return n===t};e=t.RegUtil.getWildcardCriteriaFullMatch(i);e&&(a=t.RegUtil.getRegIgnoreCase(e),l=function(n){return a.lastIndex=0,a.test(n)});break;case 5:r=function(n,t){return n>t};f=function(n,t){return n>t};break;default:return function(n){return!1}}o=-1;c=!0;try{v={value:0};i===h||i===s?o=0:u.rD(i.toString(),v)?o=v.value:c=!1}catch(y){c=!1}return function(n){var a,t;if((n===h||n===s)&&(n=""),c){a=-1;try{if(t={value:0},u.rD(n,t))return f(t.value,o)}catch(v){}}return e&&l?l(n.toString()):r(n.toString().toUpperCase(),i!==h&&i!==s?i.toString().toUpperCase():"")}}function w(t){var f,e;if(u.num(t))return n(4,t);var o="=><",i=t!==h&&t!==s?t.toString().toUpperCase():"",r='\0';for(f=0;f<2&&f<i.length;f++)if(e=i[f],o.indexOf(e)!==-1)if(e==="=")switch(r){case"<":return n(0,i.substring(2));case">":return n(1,i.substring(2));default:return n(4,r==='\0'?i.substring(1):t)}else{if(r==='\0'){r=e;continue}if(r==="<")return e===">"?n(2,i.substring(2)):n(3,i.substring(1));else if(r===">")return n(5,i.substring(1))}else switch(r){case"<":return n(3,i.substring(1));case">":return n(5,i.substring(1));default:break}return n(4,t)}function b(n,t){if(isNaN(n))return f;var o=e(l(t));return t<0?n/=o:n*=o,n=n<0?r(n-.5):i(n+.5),t<0?n*=o:n/=o,u.toResult(n)}function d(n,t){var r,i;if(isNaN(n)||isNaN(t))return f;if(n<0||t<0||n<t)return o;for(r=1,t=vt(n-t,t),i=1;i<=t;i++)r*=n-i+1,r/=i;return u.toResult(r)}function a(n){return k(1+n)-(1+n-1-n)/(1+n)}function g(n,t){var i;return i=l(n)>.5?et(1+n,t):v(t*a(n)),isFinite(i)?isNaN(i)&&(i=494065645841247e-338):i===Number.POSITIVE_INFINITY?i=179769e303:i===Number.NEGATIVE_INFINITY&&(i=-179769e303),i}function tt(n){return(v(n)+v(-n))/2}function it(n){return(v(n)-v(-n))/2}return{approxFloor:i,approxCeiling:r,approxEqual:y,pow10:e,parseCriteria:w,round:b,combin:d,log10:lt.log10,log:lt.log,pow1p:g,log1p:a,cosh:tt,sinh:it}}();r.def("ABS",ef,{minArgs:1,maxArgs:1});r.def("ACOS",eo,{minArgs:1,maxArgs:1});r.def("ASIN",co,{minArgs:1,maxArgs:1});r.def("ATAN",yo,{minArgs:1,maxArgs:1});r.def("ATAN2",po,{minArgs:2,maxArgs:2});r.def("COS",fo,{minArgs:1,maxArgs:1});r.def("CEILING",sf,{minArgs:2,maxArgs:2});r.def("ODD",wf,{minArgs:1,maxArgs:1});r.def("EVEN",lf,{minArgs:1,maxArgs:1});r.def("FLOOR",oe,{minArgs:2,maxArgs:2});r.def("LN",yf,{minArgs:1,maxArgs:1});r.def("SQRT",ue,{minArgs:1,maxArgs:1});r.def("SIN",ho,{minArgs:1,maxArgs:1});r.def("TAN",vo,{minArgs:1,maxArgs:1});r.def("SIGN",ne,{minArgs:1,maxArgs:1});r.def("GCD",te,{minArgs:1,acceptsReference:e,acceptsArray:e});r.def("LCM",ie,{minArgs:1,acceptsReference:e,acceptsArray:e});r.def("PRODUCT",re,{minArgs:1,acceptsReference:e,acceptsArray:e});r.def("POWER",kf,{minArgs:2,maxArgs:2});r.def("MOD",pf,{minArgs:2,maxArgs:2});r.def("QUOTIENT",fe,{minArgs:2,maxArgs:2});r.def("SUBTOTAL",ee,{minArgs:2,acceptsReference:gt,acceptsArray:gt});r.def("INT",of,{minArgs:1,maxArgs:1});r.def("MROUND",se,{minArgs:2,maxArgs:2});r.def("ROUND",si,{minArgs:2,maxArgs:2});r.def("ROUNDDOWN",he,{minArgs:2,maxArgs:2});r.def("ROUNDUP",ce,{minArgs:2,maxArgs:2});r.def("TRUNC",le,{minArgs:1,maxArgs:2,acceptsMissingArgument:d});r.def("EXP",ae,{minArgs:1,maxArgs:1});r.def("LOG",ye,{minArgs:1,maxArgs:2,acceptsMissingArgument:d});r.def("LOG10",pe,{minArgs:1,maxArgs:1});r.def("SUM",gf,{minArgs:1,acceptsReference:e,acceptsArray:e});r.def("SUMIF",we,{minArgs:2,maxArgs:3,acceptsMissingArgument:y,acceptsReference:ni,acceptsArray:ni});r.def("SUMIFS",be,{minArgs:3,acceptsReference:ti,acceptsArray:ti});r.def("SUMPRODUCT",ke,{minArgs:1,acceptsReference:e,acceptsArray:e,arrayArgumentEvaluateMode:1});r.def("SUMSQ",de,{minArgs:1,acceptsReference:e,acceptsArray:e});r.def("SUMX2MY2",ge,{minArgs:2,maxArgs:2,acceptsReference:e,acceptsArray:e});r.def("SUMX2PY2",no,{minArgs:2,maxArgs:2,acceptsReference:e,acceptsArray:e});r.def("SUMXMY2",to,{minArgs:2,maxArgs:2,acceptsReference:e,acceptsArray:e});r.def("SERIESSUM",io,{minArgs:4,maxArgs:4,acceptsReference:wt,acceptsArray:wt});r.def("PI",bf,{minArgs:0,maxArgs:0});r.def("SQRTPI",ro,{minArgs:1,maxArgs:1});r.def("DEGREES",cf,{minArgs:1,maxArgs:1});r.def("RADIANS",uo,{minArgs:1,maxArgs:1});r.def("COSH",oo,{minArgs:1,maxArgs:1});r.def("ACOSH",so,{minArgs:1,maxArgs:1});r.def("SINH",lo,{minArgs:1,maxArgs:1});r.def("ASINH",ao,{minArgs:1,maxArgs:1});r.def("TANH",wo,{minArgs:1,maxArgs:1});r.def("ATANH",bo,{minArgs:1,maxArgs:1});r.def("MDETERM",ko,{minArgs:1,maxArgs:1,acceptsArray:e,acceptsReference:e});r.def("MINVERSE",go,{minArgs:1,maxArgs:1,acceptsArray:e,acceptsReference:e});r.def("MMULT",ns,{minArgs:2,maxArgs:2,acceptsArray:e,acceptsReference:e});r.def("FACT",af,{minArgs:1,maxArgs:1});r.def("FACTDOUBLE",vf,{minArgs:1,maxArgs:1});r.def("MULTINOMIAL",ts,{minArgs:1,acceptsArray:e,acceptsReference:e});r.def("RAND",is,{minArgs:0,maxArgs:0,isVolatile:ot});r.def("RANDBETWEEN",rs,{minArgs:2,maxArgs:2,isVolatile:ot});r.def("COMBIN",hf,{minArgs:2,maxArgs:2});r.def("ROMAN",fs,{minArgs:1,maxArgs:2,acceptsMissingArgument:d});r.def("CEILING.PRECISE",di,{minArgs:1,maxArgs:2});r.def("ISO.CEILING",di,{minArgs:1,maxArgs:2});r.def("FLOOR.PRECISE",ve,{minArgs:1,maxArgs:2});r.def("AND",es,{minArgs:1,acceptsReference:e,acceptsArray:e});r.def("OR",os,{minArgs:1,acceptsReference:e,acceptsArray:e});r.def("NOT",ss,{minArgs:1,maxArgs:1});r.def("IF",hs,{minArgs:2,maxArgs:3,acceptsReference:st,acceptsArray:st,acceptsError:st,acceptsMissingArgument:y,isBranch:yi,findTestArgument:pi,findBranchArgument:tu});r.def("IFERROR",ls,{minArgs:2,maxArgs:2,acceptsReference:ii,acceptsError:ii});r.def("TRUE",as,{minArgs:0,maxArgs:0});r.def("FALSE",vs,{minArgs:0,maxArgs:0});r.def("DATE",ys,{minArgs:3,maxArgs:3});r.def("TIME",ps,{minArgs:3,maxArgs:3});r.def("DATEVALUE",ws,{minArgs:1,maxArgs:1});r.def("TIMEVALUE",ir,{minArgs:1,maxArgs:1});r.def("NOW",ks,{minArgs:0,maxArgs:0,isVolatile:ot});r.def("TODAY",ds,{minArgs:0,maxArgs:0,isVolatile:ot});r.def("HOUR",gs,{minArgs:1,maxArgs:1});r.def("MINUTE",nh,{minArgs:1,maxArgs:1});r.def("SECOND",th,{minArgs:1,maxArgs:1});r.def("DAY",ih,{minArgs:1,maxArgs:1});r.def("MONTH",rh,{minArgs:1,maxArgs:1});r.def("YEAR",uh,{minArgs:1,maxArgs:1});r.def("WEEKNUM",oh,{minArgs:1,maxArgs:2,acceptsMissingArgument:d});r.def("WEEKDAY",b,{minArgs:1,maxArgs:2,acceptsMissingArgument:d});r.def("EDATE",sh,{minArgs:2,maxArgs:2});r.def("EOMONTH",ch,{minArgs:2,maxArgs:2});r.def("WORKDAY",lh,{minArgs:2,maxArgs:3,acceptsMissingArgument:y,acceptsArray:y,acceptsReference:y});r.def("WORKDAY.INTL",ah,{minArgs:2,maxArgs:4,acceptsMissingArgument:it,acceptsArray:it,acceptsReference:it});r.def("DAYS360",ur,{minArgs:2,maxArgs:3,acceptsMissingArgument:y});r.def("NETWORKDAYS",ph,{minArgs:2,maxArgs:3,acceptsMissingArgument:y,acceptsArray:y,acceptsReference:y});r.def("NETWORKDAYS.INTL",wh,{minArgs:2,maxArgs:4,acceptsMissingArgument:it,acceptsArray:it,acceptsReference:it});r.def("YEARFRAC",er,{minArgs:2,maxArgs:3,acceptsMissingArgument:y});r.def("DATEDIF",nc,{minArgs:3,maxArgs:3});r.def("CLEAN",ic,{minArgs:1,maxArgs:1});r.def("TRIM",rc,{minArgs:1,maxArgs:1});r.def("DOLLAR",fc,{minArgs:1,maxArgs:2,acceptsMissingArgument:d});r.def("FIXED",ec,{minArgs:1,maxArgs:3,acceptsMissingArgument:st});r.def("TEXT",sc,{minArgs:2,maxArgs:2});r.def("VALUE",hc,{minArgs:1,maxArgs:1});r.def("LOWER",cc,{minArgs:1,maxArgs:1});r.def("UPPER",lc,{minArgs:1,maxArgs:1});r.def("PROPER",ac,{minArgs:1,maxArgs:1});r.def("CHAR",vc,{minArgs:1,maxArgs:1});r.def("CODE",yc,{minArgs:1,maxArgs:1});r.def("REPLACE",pc,{minArgs:4,maxArgs:4,acceptsMissingArgument:y});r.def("SUBSTITUTE",wc,{minArgs:3,maxArgs:4,acceptsMissingArgument:wt});r.def("CONCATENATE",bc,{minArgs:2,acceptsArray:e});r.def("LEFT",kc,{minArgs:1,maxArgs:2,acceptsMissingArgument:d});r.def("MID",dc,{minArgs:3,maxArgs:3});r.def("RIGHT",gc,{minArgs:1,maxArgs:2,acceptsMissingArgument:d});r.def("REPT",nl,{minArgs:2,maxArgs:2});r.def("LEN",tl,{minArgs:1,maxArgs:1});r.def("FIND",il,{minArgs:2,maxArgs:3,acceptsMissingArgument:y});r.def("SEARCH",rl,{minArgs:2,maxArgs:3,acceptsMissingArgument:y});r.def("EXACT",ul,{minArgs:2,maxArgs:2});r.def("T",fl,{minArgs:1,maxArgs:1});r.def("ISERROR",sl,{minArgs:1,maxArgs:1,acceptsError:e});r.def("ISERR",hl,{minArgs:1,maxArgs:1,acceptsError:e});r.def("ISNA",cl,{minArgs:1,maxArgs:1,acceptsError:e});r.def("ERROR.TYPE",ll,{minArgs:1,maxArgs:1,acceptsError:e});r.def("ISNUMBER",al,{minArgs:1,maxArgs:1,acceptsError:e});r.def("ISEVEN",vl,{minArgs:1,maxArgs:1});r.def("ISODD",yl,{minArgs:1,maxArgs:1});r.def("N",pl,{minArgs:1,maxArgs:1});r.def("ISBLANK",wl,{minArgs:1,maxArgs:1,acceptsError:e});r.def("ISLOGICAL",bl,{minArgs:1,maxArgs:1,acceptsError:e});r.def("ISTEXT",kl,{minArgs:1,maxArgs:1,acceptsError:e});r.def("ISNONTEXT",dl,{minArgs:1,maxArgs:1,acceptsError:e});r.def("ISREF",gl,{minArgs:1,maxArgs:1,acceptsError:e,acceptsReference:e});r.def("TYPE",na,{minArgs:1,maxArgs:1,acceptsArray:e,acceptsError:e});r.def("NA",ta,{minArgs:0,maxArgs:0});r.def("TREND",ia,{minArgs:1,maxArgs:4,acceptsReference:ei,acceptsArray:ei,acceptsMissingArgument:fi});r.def("GROWTH",ra,{minArgs:1,maxArgs:4,acceptsReference:oi,acceptsArray:oi,acceptsMissingArgument:fi});r.def("FORECAST",ua,{minArgs:3,maxArgs:3,acceptsArray:ui,acceptsReference:ui});r.def("AVERAGE",fa,{minArgs:1,acceptsArray:e,acceptsReference:e});r.def("STDEV",hr,{minArgs:1,acceptsArray:e,acceptsReference:e});r.def("STDEV.S",hr,{minArgs:1,acceptsReference:e,acceptsArray:e});r.def("PERCENTILE",ci,{minArgs:2,maxArgs:2,acceptsArray:ht,acceptsReference:ht});r.def("PERCENTILE.INC",ci,{minArgs:2,maxArgs:2,acceptsReference:ht,acceptArray:ht})})(i.Functions||(i.Functions={}));var r=i.Functions})(t.Calc||(t.Calc={}));var i=t.Calc})(n.Sheets||(n.Sheets={}));var t=n.Sheets}(GcSpread||(GcSpread={}))
